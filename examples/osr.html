

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>osr &mdash; yggdrasil v1.6.3+18.g537444084.dirty documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>osr</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/osr.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="osr">
<span id="osr-rst"></span><h1>osr<a class="headerlink" href="#osr" title="Permalink to this headline">¶</a></h1>
<p>Two models run in a time step synchonization pattern where one of the models is the OpenSimRoot simulation code and the other is a dummy stand in. This example demonstrates how to run OSR simulations as part of yggdrasil integrations and the use of the <cite>timesync</cite> model parameter and communication pattern.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#c-version" id="id2">C Version</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id3">C++ Version</a></p></li>
<li><p><a class="reference internal" href="#fortran-version" id="id4">Fortran Version</a></p></li>
<li><p><a class="reference internal" href="#matlab-version" id="id5">Matlab Version</a></p></li>
<li><p><a class="reference internal" href="#python-version" id="id6">Python Version</a></p></li>
<li><p><a class="reference internal" href="#r-version" id="id7">R Version</a></p></li>
</ul>
</div>
<div class="section" id="c-version">
<h2><a class="toc-backref" href="#id2">C Version</a><a class="headerlink" href="#c-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define _USE_MATH_DEFINES  </span><span class="c1">// Required to use M_PI with MSVC</span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.h&quot;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">timestep_calc</span><span class="p">(</span><span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">generic_t</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;carbonAllocation2Roots&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="s">&quot;g&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;saturatedConductivity&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="s">&quot;cm/day&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">double</span> <span class="n">t_step</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">t_units</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">exit_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C other_model: timestep %f %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">t_start</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">t_end</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">nkeys</span><span class="p">,</span> <span class="n">ikey</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">**</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t_units</span><span class="p">,</span> <span class="s">&quot;hr&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="n">t_end</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">generic_t</span> <span class="n">state_send</span> <span class="o">=</span> <span class="n">init_generic_map</span><span class="p">();</span>
  <span class="n">generic_t</span> <span class="n">state_recv</span> <span class="o">=</span> <span class="n">init_generic_map</span><span class="p">();</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">state_send</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Error in initial timestep calculation.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Set up connections matching yaml</span>
  <span class="c1">// Timestep synchronization connection will be &#39;timesync&#39;</span>
  <span class="n">comm_t</span><span class="o">*</span> <span class="n">timesync</span> <span class="o">=</span> <span class="n">yggTimesync</span><span class="p">(</span><span class="s">&quot;timesync&quot;</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="n">dtype_t</span><span class="o">*</span> <span class="n">out_dtype</span> <span class="o">=</span> <span class="n">create_dtype_json_object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">comm_t</span><span class="o">*</span> <span class="n">out</span> <span class="o">=</span> <span class="n">yggOutputType</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">,</span> <span class="n">out_dtype</span><span class="p">);</span>

  <span class="c1">// Initialize state and synchronize with other models</span>
  <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t_start</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcCall</span><span class="p">(</span><span class="n">timesync</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">state_send</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Initial sync failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">nkeys</span> <span class="o">=</span> <span class="n">generic_map_get_keys</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">keys</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): t = %5.1f %-3s&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">ikey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ikey</span> <span class="o">&lt;</span> <span class="n">nkeys</span><span class="p">;</span> <span class="n">ikey</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;, %s = %+ 5.2f&quot;</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">],</span>
	   <span class="n">generic_map_get_double</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">]));</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

  <span class="c1">// Send initial state to output</span>
  <span class="n">generic_t</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">copy_generic</span><span class="p">(</span><span class="n">state_recv</span><span class="p">);</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Failed to set time in initial output map.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">yggSend</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Failed to send initial output for t=%f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>

  <span class="c1">// Iterate until end</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Perform calculations to update the state</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">t_step</span><span class="p">;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">state_send</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Error in timestep calculation for t = %f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Synchronize the state</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcCall</span><span class="p">(</span><span class="n">timesync</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">state_send</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): sync for t=%f failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nkeys</span> <span class="o">=</span> <span class="n">generic_map_get_keys</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">keys</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): t = %5.1f %-3s&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ikey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ikey</span> <span class="o">&lt;</span> <span class="n">nkeys</span><span class="p">;</span> <span class="n">ikey</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;, %s = %+ 5.2f&quot;</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">],</span>
	     <span class="n">generic_map_get_double</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="c1">// Send output</span>
    <span class="n">generic_t</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">copy_generic</span><span class="p">(</span><span class="n">state_recv</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Failed to set time in output map.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">yggSend</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C): Failed to send output for t=%f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C other_model</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state_send</span><span class="p">);</span>
  <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!--
	Simulation file for SimRoot version 5. This development version, build July 2007
	Author: Jouke Postma
	Note: 
	
	PLEASE KEEP THIS HEADER UP TO DATE! LIST BELOW WHO YOU ARE, WHEN AND WHAT CHANGES YOU MADE AND WHY. LIST YOUR SOURCE AS MUCH AS POSSIBLE!

	change log: 
	11-july-07 added support for include files. 
	
	
--&gt;
&lt;!--STYLE SHEET SECTION: feel free to attach any stylesheet of your choosing--&gt;
&lt;!--?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;tree-view2.xsl&quot;?--&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;XML/treeview.xsl&quot;?&gt;

&lt;!--SIMULATION MODEL--&gt;
&lt;SimulationModel xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../scripts/XML/SimulaXMLSchema.xsd&quot;&gt;
  
	&lt;SimulaBase name=&quot;soil&quot;&gt;
	&lt;/SimulaBase&gt;	

	
	&lt;SimulaBase name=&quot;plants&quot;&gt;
		&lt;SimulaBase name=&quot;maize&quot; objectGenerator=&quot;seedling&quot;&gt;
			&lt;SimulaConstant name=&quot;plantType&quot; type=&quot;string&quot;&gt;
			&lt;!-- 	H99 w64a 36H56 noRCAinLaterals maize-aerenchyma--&gt; 
				maize-aerenchyma
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantingTime&quot;  unit=&quot;day&quot; type=&quot;time&quot;&gt;
				0
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantPosition&quot; type=&quot;coordinate&quot;&gt;
					0 -2 0
			&lt;/SimulaConstant&gt;
		&lt;/SimulaBase&gt;	
	&lt;/SimulaBase&gt;	

	&lt;!-- &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/simulationControlParameters.xml&quot;/&gt; --&gt;
	&lt;SimulaBase name=&quot;simulationControls&quot;&gt;
		&lt;SimulaBase name=&quot;outputParameters&quot;&gt;
			&lt;SimulaBase name=&quot;defaults&quot;&gt;
			&lt;!-- optional section - if an export module section does not list end/start/interval times than you can specify a default here--&gt;
				&lt;SimulaConstant
					name=&quot;startTime&quot;
					type=&quot;time&quot;&gt; 0.&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;endTime&quot;
					type=&quot;time&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt; 1.&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
			&lt;SimulaBase name=&quot;probeAllObjects&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt;
					1 &lt;!--this does not result in any output, just tries to run the code for debugging purposes--&gt;
				&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt;1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;requestedVariables&quot;
					type=&quot;string&quot;&gt; carbonAllocation2Roots, saturatedWaterContent,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;	
			&lt;SimulaBase name=&quot;table&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;!--SimulaConstant name=&quot;timeInterval&quot; type=&quot;time&quot;&gt; 1.0	&lt;/SimulaConstant--&gt;
				&lt;SimulaConstant
					name=&quot;searchingDepth&quot;
					type=&quot;integer&quot;&gt; 5&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;skipTheseVariables&quot;
					type=&quot;string&quot;&gt; primaryRoot, hypocotyl,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
		&lt;/SimulaBase&gt;
	&lt;/SimulaBase&gt;
	
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplateFullModel.xml&quot;/&gt;
	&lt;!-- SimulaIncludeFile fileName=&quot;environments/Rocksprings/Rocksprings-maize.xml&quot;/--&gt;
	&lt;SimulaIncludeFile fileName=&quot;environments/WageningseBovenBuurt/WageningseBovenBuurt-maize.xml&quot;/&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeGeometry.xml&quot; /&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeDryweight.xml&quot; /&gt;

	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorusBC.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorus3D.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrateBasic.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeWaterModule.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrate3D.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePotassium3D.xml&quot; /--&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/configurationCarbon.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeStress.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootHairs.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeAerenchyma.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootLengthProfile.xml&quot;/&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeLocalNutrientResponses.xml&quot;/--&gt;

	&lt;SimulaBase name=&quot;rootTypeParameters&quot; &gt;
	  &lt;!--SimulaIncludeFile fileName=&quot;plantParameters/Maize/H99/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/W64a/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/36H56/maize.xml&quot;/--&gt;
	  &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/maize.xml&quot;/&gt;
	&lt;/SimulaBase&gt;
&lt;/SimulationModel&gt;


</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">additional_variables</span><span class="p">:</span>
      <span class="nt">osr_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">other_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr</span>
    <span class="nt">timesync</span><span class="p">:</span>
      <span class="nt">inputs</span><span class="p">:</span>  <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">outputs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/osr_model.xml</span>
    <span class="nt">copy_xml_to_osr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">update_interval</span><span class="p">:</span>
      <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">c</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/other_model.c</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hr</span>
    <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
      <span class="nt">default_file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model_output.txt</span>
        <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
        <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id3">C++ Version</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#define _USE_MATH_DEFINES  </span><span class="c1">// Required to use M_PI with MSVC</span>
<span class="cp">#include</span> <span class="cpf">&lt;math.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.hpp&quot;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">timestep_calc</span><span class="p">(</span><span class="kt">double</span> <span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">generic_t</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;carbonAllocation2Roots&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="s">&quot;g&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s">&quot;saturatedConductivity&quot;</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="s">&quot;cm/day&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">double</span> <span class="n">t_step</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">t_units</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">exit_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C++ other_model: timestep %f %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">t_start</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">t_end</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">nkeys</span><span class="p">,</span> <span class="n">ikey</span><span class="p">;</span>
  <span class="kt">char</span><span class="o">**</span> <span class="n">keys</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t_units</span><span class="p">,</span> <span class="s">&quot;hr&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="mf">24.0</span> <span class="o">*</span> <span class="n">t_end</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">generic_t</span> <span class="n">state_send</span> <span class="o">=</span> <span class="n">init_generic_map</span><span class="p">();</span>
  <span class="n">generic_t</span> <span class="n">state_recv</span> <span class="o">=</span> <span class="n">init_generic_map</span><span class="p">();</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">state_send</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Error in initial timestep calculation.&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Set up connections matching yaml</span>
  <span class="c1">// Timestep synchronization connection will default to &#39;timesync&#39;</span>
  <span class="n">YggTimesync</span> <span class="n">timesync</span><span class="p">(</span><span class="s">&quot;timesync&quot;</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="n">dtype_t</span><span class="o">*</span> <span class="n">out_dtype</span> <span class="o">=</span> <span class="n">create_dtype_json_object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
  <span class="n">YggOutput</span> <span class="n">out</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">,</span> <span class="n">out_dtype</span><span class="p">);</span>

  <span class="c1">// Initialize state and synchronize with other models</span>
  <span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">t_start</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">state_send</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Initial sync failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">nkeys</span> <span class="o">=</span> <span class="n">generic_map_get_keys</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">keys</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): t = %5.1f %-3s&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">ikey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ikey</span> <span class="o">&lt;</span> <span class="n">nkeys</span><span class="p">;</span> <span class="n">ikey</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;, %s = %+ 5.2f&quot;</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">],</span>
	   <span class="n">generic_map_get_double</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">]));</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

  <span class="c1">// Send initial state to output</span>
  <span class="n">generic_t</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">copy_generic</span><span class="p">(</span><span class="n">state_recv</span><span class="p">);</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Failed to set time in initial output map.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Failed to send initial output for t=%f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>

  <span class="c1">// Iterate until end</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Perform calculations to update the state</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">t_step</span><span class="p">;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">state_send</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Error in timestep calculation for t = %f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Synchronize the state</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">state_send</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): sync for t=%f failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">nkeys</span> <span class="o">=</span> <span class="n">generic_map_get_keys</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">keys</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): t = %5.1f %-3s&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">ikey</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ikey</span> <span class="o">&lt;</span> <span class="n">nkeys</span><span class="p">;</span> <span class="n">ikey</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;, %s = %+ 5.2f&quot;</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">],</span>
	     <span class="n">generic_map_get_double</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span> <span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">]));</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="c1">// Send output</span>
    <span class="n">generic_t</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">copy_generic</span><span class="p">(</span><span class="n">state_recv</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;time&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Failed to set time in output map.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;other_model(C++): Failed to send output for t=%f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C++ other_model</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state_send</span><span class="p">);</span>
  <span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!--
	Simulation file for SimRoot version 5. This development version, build July 2007
	Author: Jouke Postma
	Note: 
	
	PLEASE KEEP THIS HEADER UP TO DATE! LIST BELOW WHO YOU ARE, WHEN AND WHAT CHANGES YOU MADE AND WHY. LIST YOUR SOURCE AS MUCH AS POSSIBLE!

	change log: 
	11-july-07 added support for include files. 
	
	
--&gt;
&lt;!--STYLE SHEET SECTION: feel free to attach any stylesheet of your choosing--&gt;
&lt;!--?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;tree-view2.xsl&quot;?--&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;XML/treeview.xsl&quot;?&gt;

&lt;!--SIMULATION MODEL--&gt;
&lt;SimulationModel xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../scripts/XML/SimulaXMLSchema.xsd&quot;&gt;
  
	&lt;SimulaBase name=&quot;soil&quot;&gt;
	&lt;/SimulaBase&gt;	

	
	&lt;SimulaBase name=&quot;plants&quot;&gt;
		&lt;SimulaBase name=&quot;maize&quot; objectGenerator=&quot;seedling&quot;&gt;
			&lt;SimulaConstant name=&quot;plantType&quot; type=&quot;string&quot;&gt;
			&lt;!-- 	H99 w64a 36H56 noRCAinLaterals maize-aerenchyma--&gt; 
				maize-aerenchyma
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantingTime&quot;  unit=&quot;day&quot; type=&quot;time&quot;&gt;
				0
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantPosition&quot; type=&quot;coordinate&quot;&gt;
					0 -2 0
			&lt;/SimulaConstant&gt;
		&lt;/SimulaBase&gt;	
	&lt;/SimulaBase&gt;	

	&lt;!-- &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/simulationControlParameters.xml&quot;/&gt; --&gt;
	&lt;SimulaBase name=&quot;simulationControls&quot;&gt;
		&lt;SimulaBase name=&quot;outputParameters&quot;&gt;
			&lt;SimulaBase name=&quot;defaults&quot;&gt;
			&lt;!-- optional section - if an export module section does not list end/start/interval times than you can specify a default here--&gt;
				&lt;SimulaConstant
					name=&quot;startTime&quot;
					type=&quot;time&quot;&gt; 0.&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;endTime&quot;
					type=&quot;time&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt; 1.&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
			&lt;SimulaBase name=&quot;probeAllObjects&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt;
					1 &lt;!--this does not result in any output, just tries to run the code for debugging purposes--&gt;
				&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt;1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;requestedVariables&quot;
					type=&quot;string&quot;&gt; carbonAllocation2Roots, saturatedWaterContent,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;	
			&lt;SimulaBase name=&quot;table&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;!--SimulaConstant name=&quot;timeInterval&quot; type=&quot;time&quot;&gt; 1.0	&lt;/SimulaConstant--&gt;
				&lt;SimulaConstant
					name=&quot;searchingDepth&quot;
					type=&quot;integer&quot;&gt; 5&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;skipTheseVariables&quot;
					type=&quot;string&quot;&gt; primaryRoot, hypocotyl,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
		&lt;/SimulaBase&gt;
	&lt;/SimulaBase&gt;
	
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplateFullModel.xml&quot;/&gt;
	&lt;!-- SimulaIncludeFile fileName=&quot;environments/Rocksprings/Rocksprings-maize.xml&quot;/--&gt;
	&lt;SimulaIncludeFile fileName=&quot;environments/WageningseBovenBuurt/WageningseBovenBuurt-maize.xml&quot;/&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeGeometry.xml&quot; /&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeDryweight.xml&quot; /&gt;

	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorusBC.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorus3D.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrateBasic.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeWaterModule.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrate3D.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePotassium3D.xml&quot; /--&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/configurationCarbon.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeStress.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootHairs.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeAerenchyma.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootLengthProfile.xml&quot;/&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeLocalNutrientResponses.xml&quot;/--&gt;

	&lt;SimulaBase name=&quot;rootTypeParameters&quot; &gt;
	  &lt;!--SimulaIncludeFile fileName=&quot;plantParameters/Maize/H99/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/W64a/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/36H56/maize.xml&quot;/--&gt;
	  &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/maize.xml&quot;/&gt;
	&lt;/SimulaBase&gt;
&lt;/SimulationModel&gt;


</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">additional_variables</span><span class="p">:</span>
      <span class="nt">osr_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">other_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr</span>
    <span class="nt">timesync</span><span class="p">:</span>
      <span class="nt">inputs</span><span class="p">:</span>  <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">outputs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/osr_model.xml</span>
    <span class="nt">copy_xml_to_osr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">update_interval</span><span class="p">:</span>
      <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">c++</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/other_model.cpp</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hr</span>
    <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
      <span class="nt">default_file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model_output.txt</span>
        <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
        <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fortran-version">
<h2><a class="toc-backref" href="#id4">Fortran Version</a><a class="headerlink" href="#fortran-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136</pre></div></td><td class="code"><div class="highlight"><pre><span></span>program main
  use fygg

  ! Declare resulting variables and create buffer for received message
  logical :: timestep_calc
  logical :: ret = .true.
  type(yggcomm) :: timesync, out
  character(len=32) :: arg
  character(len=0), dimension(0) :: dtype_keys
  type(yggdtype), dimension(0) :: dtype_vals
  type(yggdtype) :: out_dtype
  real(kind=8) :: t_step, t_start, t_end, t
  character(len=32) :: t_units
  character(len=20), dimension(:), pointer :: keys
  type(ygggeneric) :: state_send, state_recv, msg
  real(kind=8), pointer :: x
  integer :: i

  call get_command_argument(1, arg)
  read(arg, *) t_step
  call get_command_argument(2, arg)
  read(arg, *) t_units
  call get_command_argument(3, arg)
  write (*, &#39;(&quot;Hello from Fortran other_model: timestep &quot;,F10.5,&quot; &quot;,A3)&#39;) &amp;
       t_step, trim(t_units)
  t_start = 0.0
  t_end = 5.0
  if (t_units.eq.&quot;hr&quot;) then
     t_end = 24.0 * t_end
  end if
  state_send = init_generic_map()
  state_recv = init_generic_map()
  ret = timestep_calc(t_start, t_units, state_send)
  if (.not.ret) then
     write (*, &#39;(&quot;other_model(Fortran): Error in initial timestep &amp;
          &amp;calculation.&quot;)&#39;)
  end if

  ! Set up connections matching yaml
  ! Timestep synchronization connection will be &#39;timesync&#39;
  timesync = ygg_timesync(&quot;timesync&quot;, t_units)
  out_dtype = create_dtype_json_object(0, dtype_keys, dtype_vals, .true.)
  out = ygg_output_type(&quot;output&quot;, out_dtype)

  ! Initialize state and synchronize with other models
  t = t_start
  ret = ygg_rpc_call(timesync, [yggarg(t), yggarg(state_send)], &amp;
       yggarg(state_recv))
  if (.not.ret) then
     write (*, &#39;(&quot;other_model(Fortran): Initial sync failed.&quot;)&#39;)
     stop 1
  end if
  write (*, &#39;(&quot;other_model(Fortran): t = &quot;,F5.1,&quot; &quot;,A3)&#39;, advance=&quot;no&quot;) &amp;
       t, adjustl(t_units)
  call generic_map_get_keys(state_recv, keys)
  do i = 1, size(keys)
     call generic_map_get(state_recv, trim(keys(i)), x)
     write (*, &#39;(SP,&quot;, &quot;,A,&quot; = &quot;,F5.2)&#39;, advance=&quot;no&quot;) &amp;
          trim(keys(i)), x
  end do
  write (*, &#39;(&quot;&quot;)&#39;)

  ! Send initial state to output
  msg = copy_generic(state_recv)
  call generic_map_set(msg, &quot;time&quot;, t, t_units)
  ret = ygg_send_var(out, yggarg(msg))
  if (.not.ret) then
     write (*, &#39;(&quot;other_model(Fortran): Failed to send initial output &amp;
          &amp;for t=&quot;,F10.5,&quot;.&quot;)&#39;) t
     stop 1
  end if
  call free_generic(msg)

  ! Iterate until end
  do while (t.lt.t_end)

     ! Perform calculations to update the state
     t = t + t_step
     ret = timestep_calc(t, t_units, state_send)
     if (.not.ret) then
        write (*, &#39;(&quot;other_model(Fortran): Error in timestep &amp;
             &amp;calculation for t = &quot;,F10.5,&quot;.&quot;)&#39;) t
        stop 1
     end if

     ! Synchronize the state
     ret = ygg_rpc_call(timesync, [yggarg(t), yggarg(state_send)], &amp;
          yggarg(state_recv))
     if (.not.ret) then
        write (*, &#39;(&quot;other_model(Fortran): sync failed for t=&quot;,F10.5,&amp;
             &amp;&quot;.&quot;)&#39;) t
        stop 1
     end if
     write (*, &#39;(&quot;other_model(Fortran): t = &quot;,F5.1,&quot; &quot;,A3)&#39;, advance=&quot;no&quot;) &amp;
          t, adjustl(t_units)
     call generic_map_get_keys(state_recv, keys)
     do i = 1, size(keys)
        call generic_map_get(state_recv, keys(i), x)
        write (*, &#39;(SP,&quot;, &quot;,A,&quot; = &quot;,F5.2)&#39;, advance=&quot;no&quot;) &amp;
             trim(keys(i)), x
     end do
     write (*, &#39;(&quot;&quot;)&#39;)

     ! Send output
     msg = copy_generic(state_recv)
     call generic_map_set(msg, &quot;time&quot;, t, t_units)
     ret = ygg_send_var(out, yggarg(msg))
     if (.not.ret) then
        write (*, &#39;(&quot;other_model(Fortran): Failed to send output for &amp;
             &amp;t=&quot;,F10.5,&quot;.&quot;)&#39;) t
        stop 1
     end if
     call free_generic(msg)

  end do

  write (*, &#39;(&quot;Goodbye from Fortran other_model&quot;)&#39;)
  call free_generic(state_send)
  call free_generic(state_recv)

end program main


function timestep_calc(t, t_units, state) result (ret)
  use fygg
  implicit none
  real(kind=8) :: t
  character(len=*) :: t_units
  type(ygggeneric) :: state
  logical :: ret
  ret = .true.
  if (ret) then
     call generic_map_set(state, &quot;carbonAllocation2Roots&quot;, 10.0, &quot;g&quot;)
     call generic_map_set(state, &quot;saturatedConductivity&quot;, 10.0, &quot;cm/day&quot;)
  end if
end function timestep_calc
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!--
	Simulation file for SimRoot version 5. This development version, build July 2007
	Author: Jouke Postma
	Note: 
	
	PLEASE KEEP THIS HEADER UP TO DATE! LIST BELOW WHO YOU ARE, WHEN AND WHAT CHANGES YOU MADE AND WHY. LIST YOUR SOURCE AS MUCH AS POSSIBLE!

	change log: 
	11-july-07 added support for include files. 
	
	
--&gt;
&lt;!--STYLE SHEET SECTION: feel free to attach any stylesheet of your choosing--&gt;
&lt;!--?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;tree-view2.xsl&quot;?--&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;XML/treeview.xsl&quot;?&gt;

&lt;!--SIMULATION MODEL--&gt;
&lt;SimulationModel xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../scripts/XML/SimulaXMLSchema.xsd&quot;&gt;
  
	&lt;SimulaBase name=&quot;soil&quot;&gt;
	&lt;/SimulaBase&gt;	

	
	&lt;SimulaBase name=&quot;plants&quot;&gt;
		&lt;SimulaBase name=&quot;maize&quot; objectGenerator=&quot;seedling&quot;&gt;
			&lt;SimulaConstant name=&quot;plantType&quot; type=&quot;string&quot;&gt;
			&lt;!-- 	H99 w64a 36H56 noRCAinLaterals maize-aerenchyma--&gt; 
				maize-aerenchyma
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantingTime&quot;  unit=&quot;day&quot; type=&quot;time&quot;&gt;
				0
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantPosition&quot; type=&quot;coordinate&quot;&gt;
					0 -2 0
			&lt;/SimulaConstant&gt;
		&lt;/SimulaBase&gt;	
	&lt;/SimulaBase&gt;	

	&lt;!-- &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/simulationControlParameters.xml&quot;/&gt; --&gt;
	&lt;SimulaBase name=&quot;simulationControls&quot;&gt;
		&lt;SimulaBase name=&quot;outputParameters&quot;&gt;
			&lt;SimulaBase name=&quot;defaults&quot;&gt;
			&lt;!-- optional section - if an export module section does not list end/start/interval times than you can specify a default here--&gt;
				&lt;SimulaConstant
					name=&quot;startTime&quot;
					type=&quot;time&quot;&gt; 0.&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;endTime&quot;
					type=&quot;time&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt; 1.&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
			&lt;SimulaBase name=&quot;probeAllObjects&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt;
					1 &lt;!--this does not result in any output, just tries to run the code for debugging purposes--&gt;
				&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt;1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;requestedVariables&quot;
					type=&quot;string&quot;&gt; carbonAllocation2Roots, saturatedWaterContent,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;	
			&lt;SimulaBase name=&quot;table&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;!--SimulaConstant name=&quot;timeInterval&quot; type=&quot;time&quot;&gt; 1.0	&lt;/SimulaConstant--&gt;
				&lt;SimulaConstant
					name=&quot;searchingDepth&quot;
					type=&quot;integer&quot;&gt; 5&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;skipTheseVariables&quot;
					type=&quot;string&quot;&gt; primaryRoot, hypocotyl,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
		&lt;/SimulaBase&gt;
	&lt;/SimulaBase&gt;
	
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplateFullModel.xml&quot;/&gt;
	&lt;!-- SimulaIncludeFile fileName=&quot;environments/Rocksprings/Rocksprings-maize.xml&quot;/--&gt;
	&lt;SimulaIncludeFile fileName=&quot;environments/WageningseBovenBuurt/WageningseBovenBuurt-maize.xml&quot;/&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeGeometry.xml&quot; /&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeDryweight.xml&quot; /&gt;

	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorusBC.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorus3D.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrateBasic.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeWaterModule.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrate3D.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePotassium3D.xml&quot; /--&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/configurationCarbon.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeStress.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootHairs.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeAerenchyma.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootLengthProfile.xml&quot;/&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeLocalNutrientResponses.xml&quot;/--&gt;

	&lt;SimulaBase name=&quot;rootTypeParameters&quot; &gt;
	  &lt;!--SimulaIncludeFile fileName=&quot;plantParameters/Maize/H99/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/W64a/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/36H56/maize.xml&quot;/--&gt;
	  &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/maize.xml&quot;/&gt;
	&lt;/SimulaBase&gt;
&lt;/SimulationModel&gt;


</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">additional_variables</span><span class="p">:</span>
      <span class="nt">osr_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">other_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr</span>
    <span class="nt">timesync</span><span class="p">:</span>
      <span class="nt">inputs</span><span class="p">:</span>  <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">outputs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/osr_model.xml</span>
    <span class="nt">copy_xml_to_osr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">update_interval</span><span class="p">:</span>
      <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fortran</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/other_model.f90</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hr</span>
    <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
      <span class="nt">default_file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model_output.txt</span>
        <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
        <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="matlab-version">
<h2><a class="toc-backref" href="#id5">Matlab Version</a><a class="headerlink" href="#matlab-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">timesync</span><span class="p">(</span>t_step, t_units<span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="n">t_step</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">t_step</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Hello from Matlab other_model: timestep = %f %s\n&#39;</span><span class="p">,</span> <span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">);</span>
  <span class="n">t_step</span> <span class="p">=</span> <span class="n">t_step</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="n">t_units</span><span class="p">);</span>
  <span class="n">t_start</span> <span class="p">=</span> <span class="mf">0.0000000000000001</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="n">t_units</span><span class="p">);</span>
  <span class="n">t_end</span> <span class="p">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">);</span>
  <span class="n">state</span> <span class="p">=</span> <span class="n">containers</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="s">&#39;UniformValues&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="s">&#39;ValueType&#39;</span><span class="p">,</span> <span class="s">&#39;any&#39;</span><span class="p">);</span>
  <span class="n">state</span><span class="p">(</span><span class="s">&#39;carbonAllocation2Roots&#39;</span><span class="p">)</span> <span class="p">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
  <span class="n">state</span><span class="p">(</span><span class="s">&#39;saturatedConductivity&#39;</span><span class="p">)</span> <span class="p">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;cm/day&#39;</span><span class="p">);</span>

  <span class="c">% Set up connections matching yaml</span>
  <span class="c">% Timestep synchonization connection will default to &#39;timesync&#39;</span>
  <span class="n">timesync</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggTimesync&#39;</span><span class="p">,</span> <span class="s">&#39;timesync&#39;</span><span class="p">);</span>
  <span class="n">out</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggOutput&#39;</span><span class="p">,</span> <span class="s">&#39;output&#39;</span><span class="p">);</span>

  <span class="c">% Initialize state and synchronize with other models</span>
  <span class="n">t</span> <span class="p">=</span> <span class="n">t_start</span><span class="p">;</span>
  <span class="p">[</span><span class="n">ret</span><span class="p">,</span> <span class="n">state</span><span class="p">]</span> <span class="p">=</span> <span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;other_model(Matlab): Initial sync failed.&#39;</span><span class="p">);</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="p">[</span><span class="n">t_data</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">]</span> <span class="p">=</span> <span class="n">separateUnits</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;other_model(Matlab): t = %5.1f %-1s&#39;</span><span class="p">,</span> <span class="c">...</span>
	  <span class="n">t_data</span><span class="p">,</span> <span class="n">symunit2str</span><span class="p">(</span><span class="n">t_unit</span><span class="p">));</span>
  <span class="k">for</span> <span class="n">k</span> <span class="p">=</span> <span class="n">keys</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;, %s = %+ 5.2f&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">state</span><span class="p">(</span><span class="n">k</span><span class="p">{</span><span class="mi">1</span><span class="p">}));</span>
  <span class="k">end</span><span class="p">;</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">);</span>

  <span class="c">% Send initial state to output</span>
  <span class="n">msg_keys</span> <span class="p">=</span> <span class="n">keys</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
  <span class="n">msg_keys</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="s">&#39;time&#39;</span><span class="p">;</span>
  <span class="n">msg_vals</span> <span class="p">=</span> <span class="n">values</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
  <span class="n">msg_vals</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_vals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">t</span><span class="p">;</span>
  <span class="n">msg</span> <span class="p">=</span> <span class="n">containers</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">,</span> <span class="n">msg_vals</span><span class="p">,</span> <span class="s">&#39;UniformValues&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
  <span class="n">flag</span> <span class="p">=</span> <span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>

  <span class="c">% Iterate until end</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">t_end</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c">% Perform calculations to update the state</span>
    <span class="n">t</span> <span class="p">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">t_step</span><span class="p">;</span>
    <span class="n">state</span> <span class="p">=</span> <span class="n">containers</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="s">&#39;UniformValues&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="s">&#39;ValueType&#39;</span><span class="p">,</span> <span class="s">&#39;any&#39;</span><span class="p">);</span>
    <span class="n">state</span><span class="p">(</span><span class="s">&#39;carbonAllocation2Roots&#39;</span><span class="p">)</span> <span class="p">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">);</span>
    <span class="n">state</span><span class="p">(</span><span class="s">&#39;saturatedConductivity&#39;</span><span class="p">)</span> <span class="p">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;cm/day&#39;</span><span class="p">);</span>

    <span class="c">% Synchronize the state</span>
    <span class="p">[</span><span class="n">ret</span><span class="p">,</span> <span class="n">state</span><span class="p">]</span> <span class="p">=</span> <span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;other_model(Matlab): sync for t=%f failed.\n&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">));</span>
    <span class="k">end</span><span class="p">;</span>
    <span class="p">[</span><span class="n">t_data</span><span class="p">,</span> <span class="n">t_unit</span><span class="p">]</span> <span class="p">=</span> <span class="n">separateUnits</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;other_model(Matlab): t = %5.1f %-1s&#39;</span><span class="p">,</span> <span class="c">...</span>
            <span class="n">t_data</span><span class="p">,</span> <span class="n">symunit2str</span><span class="p">(</span><span class="n">t_unit</span><span class="p">));</span>
    <span class="k">for</span> <span class="n">k</span> <span class="p">=</span> <span class="n">keys</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
      <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;, %s = %+ 5.2f&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">state</span><span class="p">(</span><span class="n">k</span><span class="p">{</span><span class="mi">1</span><span class="p">}));</span>
    <span class="k">end</span><span class="p">;</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">);</span>

    <span class="c">% Send output</span>
    <span class="n">msg_keys</span> <span class="p">=</span> <span class="n">keys</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
    <span class="n">msg_keys</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="s">&#39;time&#39;</span><span class="p">;</span>
    <span class="n">msg_vals</span> <span class="p">=</span> <span class="n">values</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
    <span class="n">msg_vals</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_vals</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">=</span> <span class="n">t</span><span class="p">;</span>
    <span class="n">msg</span> <span class="p">=</span> <span class="n">containers</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">,</span> <span class="n">msg_vals</span><span class="p">,</span> <span class="s">&#39;UniformValues&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">);</span>
    <span class="n">flag</span> <span class="p">=</span> <span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">flag</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;other_model(Matlab): Failed to send output for t=%s.\n&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">));</span>
    <span class="k">end</span><span class="p">;</span>
  <span class="k">end</span><span class="p">;</span>

  <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Goodbye from Matlab other_model&#39;</span><span class="p">);</span>
  
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!--
	Simulation file for SimRoot version 5. This development version, build July 2007
	Author: Jouke Postma
	Note: 
	
	PLEASE KEEP THIS HEADER UP TO DATE! LIST BELOW WHO YOU ARE, WHEN AND WHAT CHANGES YOU MADE AND WHY. LIST YOUR SOURCE AS MUCH AS POSSIBLE!

	change log: 
	11-july-07 added support for include files. 
	
	
--&gt;
&lt;!--STYLE SHEET SECTION: feel free to attach any stylesheet of your choosing--&gt;
&lt;!--?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;tree-view2.xsl&quot;?--&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;XML/treeview.xsl&quot;?&gt;

&lt;!--SIMULATION MODEL--&gt;
&lt;SimulationModel xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../scripts/XML/SimulaXMLSchema.xsd&quot;&gt;
  
	&lt;SimulaBase name=&quot;soil&quot;&gt;
	&lt;/SimulaBase&gt;	

	
	&lt;SimulaBase name=&quot;plants&quot;&gt;
		&lt;SimulaBase name=&quot;maize&quot; objectGenerator=&quot;seedling&quot;&gt;
			&lt;SimulaConstant name=&quot;plantType&quot; type=&quot;string&quot;&gt;
			&lt;!-- 	H99 w64a 36H56 noRCAinLaterals maize-aerenchyma--&gt; 
				maize-aerenchyma
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantingTime&quot;  unit=&quot;day&quot; type=&quot;time&quot;&gt;
				0
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantPosition&quot; type=&quot;coordinate&quot;&gt;
					0 -2 0
			&lt;/SimulaConstant&gt;
		&lt;/SimulaBase&gt;	
	&lt;/SimulaBase&gt;	

	&lt;!-- &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/simulationControlParameters.xml&quot;/&gt; --&gt;
	&lt;SimulaBase name=&quot;simulationControls&quot;&gt;
		&lt;SimulaBase name=&quot;outputParameters&quot;&gt;
			&lt;SimulaBase name=&quot;defaults&quot;&gt;
			&lt;!-- optional section - if an export module section does not list end/start/interval times than you can specify a default here--&gt;
				&lt;SimulaConstant
					name=&quot;startTime&quot;
					type=&quot;time&quot;&gt; 0.&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;endTime&quot;
					type=&quot;time&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt; 1.&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
			&lt;SimulaBase name=&quot;probeAllObjects&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt;
					1 &lt;!--this does not result in any output, just tries to run the code for debugging purposes--&gt;
				&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt;1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;requestedVariables&quot;
					type=&quot;string&quot;&gt; carbonAllocation2Roots, saturatedWaterContent,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;	
			&lt;SimulaBase name=&quot;table&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;!--SimulaConstant name=&quot;timeInterval&quot; type=&quot;time&quot;&gt; 1.0	&lt;/SimulaConstant--&gt;
				&lt;SimulaConstant
					name=&quot;searchingDepth&quot;
					type=&quot;integer&quot;&gt; 5&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;skipTheseVariables&quot;
					type=&quot;string&quot;&gt; primaryRoot, hypocotyl,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
		&lt;/SimulaBase&gt;
	&lt;/SimulaBase&gt;
	
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplateFullModel.xml&quot;/&gt;
	&lt;!-- SimulaIncludeFile fileName=&quot;environments/Rocksprings/Rocksprings-maize.xml&quot;/--&gt;
	&lt;SimulaIncludeFile fileName=&quot;environments/WageningseBovenBuurt/WageningseBovenBuurt-maize.xml&quot;/&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeGeometry.xml&quot; /&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeDryweight.xml&quot; /&gt;

	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorusBC.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorus3D.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrateBasic.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeWaterModule.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrate3D.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePotassium3D.xml&quot; /--&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/configurationCarbon.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeStress.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootHairs.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeAerenchyma.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootLengthProfile.xml&quot;/&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeLocalNutrientResponses.xml&quot;/--&gt;

	&lt;SimulaBase name=&quot;rootTypeParameters&quot; &gt;
	  &lt;!--SimulaIncludeFile fileName=&quot;plantParameters/Maize/H99/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/W64a/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/36H56/maize.xml&quot;/--&gt;
	  &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/maize.xml&quot;/&gt;
	&lt;/SimulaBase&gt;
&lt;/SimulationModel&gt;


</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">additional_variables</span><span class="p">:</span>
      <span class="nt">osr_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">other_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr</span>
    <span class="nt">timesync</span><span class="p">:</span>
      <span class="nt">inputs</span><span class="p">:</span>  <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">outputs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/osr_model.xml</span>
    <span class="nt">copy_xml_to_osr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">update_interval</span><span class="p">:</span>
      <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">matlab</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/other_model.m</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hr</span>
    <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
      <span class="nt">default_file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model_output.txt</span>
        <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
        <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="python-version">
<h2><a class="toc-backref" href="#id6">Python Version</a><a class="headerlink" href="#python-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">units</span>
<span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">YggTimesync</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Updates the state based on the time where x is a sine wave</span>
<span class="sd">    with period of 10 days and y is a cosine wave with a period of 5 days.</span>

<span class="sd">    Args:</span>
<span class="sd">        t (float): Current time.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Map of state parameters.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">state</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;carbonAllocation2Roots&quot;</span><span class="p">:</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">),</span>
             <span class="s2">&quot;saturatedConductivity&quot;</span><span class="p">:</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="s1">&#39;cm/day&#39;</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">state</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to execute integration.</span>

<span class="sd">    Args:</span>
<span class="sd">        t_step (float): The time step that should be used.</span>
<span class="sd">        t_units (str): Units of the time step.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python other_model: timestep = </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">))</span>
    <span class="n">t_step</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">)</span>
    <span class="n">t_start</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">t_units</span><span class="p">)</span>
    <span class="n">t_end</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">)</span>

    <span class="c1"># Set up connections matching yaml</span>
    <span class="c1"># Timestep synchonization connection will default to &#39;timesync&#39;</span>
    <span class="n">timesync</span> <span class="o">=</span> <span class="n">YggTimesync</span><span class="p">(</span><span class="s1">&#39;timesync&#39;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize state and synchronize with other models</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">t_start</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">timesync</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;other_model(Python): Initial sync failed.&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;other_model(Python): t = </span><span class="si">% 8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;, </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%+ 5.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Send initial state to output</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;other_model(Python): Failed to send &quot;</span>
                           <span class="s2">&quot;initial output for t=</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Iterate until end</span>
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">:</span>

        <span class="c1"># Perform calculations to update the state</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">t_step</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

        <span class="c1"># Synchronize the state</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">timesync</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;other_model(Python): sync for t=</span><span class="si">%f</span><span class="s2"> failed.&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;other_model(Python): t = </span><span class="si">% 8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;, </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%+ 5.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Send output</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;other_model(Python): Failed to send output for t=</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python other_model&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Take time step from the first argument</span>
    <span class="n">main</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!--
	Simulation file for SimRoot version 5. This development version, build July 2007
	Author: Jouke Postma
	Note: 
	
	PLEASE KEEP THIS HEADER UP TO DATE! LIST BELOW WHO YOU ARE, WHEN AND WHAT CHANGES YOU MADE AND WHY. LIST YOUR SOURCE AS MUCH AS POSSIBLE!

	change log: 
	11-july-07 added support for include files. 
	
	
--&gt;
&lt;!--STYLE SHEET SECTION: feel free to attach any stylesheet of your choosing--&gt;
&lt;!--?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;tree-view2.xsl&quot;?--&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;XML/treeview.xsl&quot;?&gt;

&lt;!--SIMULATION MODEL--&gt;
&lt;SimulationModel xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../scripts/XML/SimulaXMLSchema.xsd&quot;&gt;
  
	&lt;SimulaBase name=&quot;soil&quot;&gt;
	&lt;/SimulaBase&gt;	

	
	&lt;SimulaBase name=&quot;plants&quot;&gt;
		&lt;SimulaBase name=&quot;maize&quot; objectGenerator=&quot;seedling&quot;&gt;
			&lt;SimulaConstant name=&quot;plantType&quot; type=&quot;string&quot;&gt;
			&lt;!-- 	H99 w64a 36H56 noRCAinLaterals maize-aerenchyma--&gt; 
				maize-aerenchyma
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantingTime&quot;  unit=&quot;day&quot; type=&quot;time&quot;&gt;
				0
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantPosition&quot; type=&quot;coordinate&quot;&gt;
					0 -2 0
			&lt;/SimulaConstant&gt;
		&lt;/SimulaBase&gt;	
	&lt;/SimulaBase&gt;	

	&lt;!-- &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/simulationControlParameters.xml&quot;/&gt; --&gt;
	&lt;SimulaBase name=&quot;simulationControls&quot;&gt;
		&lt;SimulaBase name=&quot;outputParameters&quot;&gt;
			&lt;SimulaBase name=&quot;defaults&quot;&gt;
			&lt;!-- optional section - if an export module section does not list end/start/interval times than you can specify a default here--&gt;
				&lt;SimulaConstant
					name=&quot;startTime&quot;
					type=&quot;time&quot;&gt; 0.&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;endTime&quot;
					type=&quot;time&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt; 1.&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
			&lt;SimulaBase name=&quot;probeAllObjects&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt;
					1 &lt;!--this does not result in any output, just tries to run the code for debugging purposes--&gt;
				&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt;1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;requestedVariables&quot;
					type=&quot;string&quot;&gt; carbonAllocation2Roots, saturatedWaterContent,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;	
			&lt;SimulaBase name=&quot;table&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;!--SimulaConstant name=&quot;timeInterval&quot; type=&quot;time&quot;&gt; 1.0	&lt;/SimulaConstant--&gt;
				&lt;SimulaConstant
					name=&quot;searchingDepth&quot;
					type=&quot;integer&quot;&gt; 5&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;skipTheseVariables&quot;
					type=&quot;string&quot;&gt; primaryRoot, hypocotyl,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
		&lt;/SimulaBase&gt;
	&lt;/SimulaBase&gt;
	
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplateFullModel.xml&quot;/&gt;
	&lt;!-- SimulaIncludeFile fileName=&quot;environments/Rocksprings/Rocksprings-maize.xml&quot;/--&gt;
	&lt;SimulaIncludeFile fileName=&quot;environments/WageningseBovenBuurt/WageningseBovenBuurt-maize.xml&quot;/&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeGeometry.xml&quot; /&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeDryweight.xml&quot; /&gt;

	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorusBC.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorus3D.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrateBasic.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeWaterModule.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrate3D.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePotassium3D.xml&quot; /--&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/configurationCarbon.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeStress.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootHairs.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeAerenchyma.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootLengthProfile.xml&quot;/&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeLocalNutrientResponses.xml&quot;/--&gt;

	&lt;SimulaBase name=&quot;rootTypeParameters&quot; &gt;
	  &lt;!--SimulaIncludeFile fileName=&quot;plantParameters/Maize/H99/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/W64a/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/36H56/maize.xml&quot;/--&gt;
	  &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/maize.xml&quot;/&gt;
	&lt;/SimulaBase&gt;
&lt;/SimulationModel&gt;


</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">additional_variables</span><span class="p">:</span>
      <span class="nt">osr_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">other_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr</span>
    <span class="nt">timesync</span><span class="p">:</span>
      <span class="nt">inputs</span><span class="p">:</span>  <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">outputs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/osr_model.xml</span>
    <span class="nt">copy_xml_to_osr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">update_interval</span><span class="p">:</span>
      <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/other_model.py</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hr</span>
    <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
      <span class="nt">default_file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model_output.txt</span>
        <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
        <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="r-version">
<h2><a class="toc-backref" href="#id7">R Version</a><a class="headerlink" href="#r-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></div></td><td class="code"><div class="highlight"><pre><span></span>library(yggdrasil)


timestep_calc &lt;- function(t) {
  state = list(carbonAllocation2Roots=units::set_units(10.0, &#39;g&#39;, mode=&quot;standard&quot;),
               saturatedConductivity=units::set_units(10.0, &#39;cm/day&#39;, mode=&quot;standard&quot;))
  return(state)
}

main &lt;- function(t_step, t_units) {

  fprintf(&#39;Hello from R other_model: timestep = %f %s&#39;, t_step, t_units)
  t_step &lt;- units::set_units(t_step, t_units, mode=&quot;standard&quot;)
  t_start &lt;- units::set_units(0.0, t_units, mode=&quot;standard&quot;)
  t_end &lt;- units::set_units(1.0, &#39;day&#39;, mode=&quot;standard&quot;)
  state &lt;- timestep_calc(t_start)

  # Set up connections matching yaml
  # Timestep synchronization connection will default to &#39;timesync&#39;
  timesync &lt;- YggInterface(&#39;YggTimesync&#39;, &#39;timesync&#39;)
  out &lt;- YggInterface(&#39;YggOutput&#39;, &#39;output&#39;)

  # Initialize state and synchronize with other models
  t &lt;- t_start
  c(ret, state) %&lt;-% timesync$call(t, state)
  if (!ret) {
    stop(&#39;other_model(R): Initial sync failed.&#39;)
  }
  fprintf(&#39;other_model(R): t = %5.1f %-1s&#39;,
          units::drop_units(t), units::deparse_unit(t))
  for (k in names(state)) {
    fprintf(&#39;, %s = %+ 5.2f&#39;, k, state[[k]])
  }
  fprintf(&#39;\n&#39;)

  # Send initial state to output
  msg = state
  msg[[&#39;time&#39;]] = t
  flag &lt;- out$send(msg)
  if (!flag) {
    stop(sprintf(&#39;other_model(R): Failed to send initial output for t=%s&#39;, t))
  }

  # Iterate until end
  while (t &lt; t_end) {
        
    # Perform calculations to update the state
    t &lt;- t + t_step
    state &lt;- timestep_calc(t)

    # Synchronize the state
    c(ret, state) %&lt;-% timesync$call(t, state)
    if (!ret) {
      stop(sprintf(&#39;other_model(R): sync for t=%f failed.&#39;, t))
    }
    fprintf(&#39;other_model(R): t = %5.1f %-1s&#39;,
            units::drop_units(t), units::deparse_unit(t))
    for (k in names(state)) {
      fprintf(&#39;, %s = %+ 5.2f&#39;, k, state[[k]])
    }
    fprintf(&#39;\n&#39;)

    # Send output
    msg = state
    msg[[&#39;time&#39;]] = t
    flag &lt;- out$send(msg)
    if (!flag) {
      stop(sprintf(&#39;other_model(R): Failed to send output for t=%s.&#39;, t))
    }
  }

  print(&#39;Goodbye from R other_model&#39;)
  
}


args = commandArgs(trailingOnly=TRUE)
main(as.double(args[[1]]), args[[2]])
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114</pre></div></td><td class="code"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!--
	Simulation file for SimRoot version 5. This development version, build July 2007
	Author: Jouke Postma
	Note: 
	
	PLEASE KEEP THIS HEADER UP TO DATE! LIST BELOW WHO YOU ARE, WHEN AND WHAT CHANGES YOU MADE AND WHY. LIST YOUR SOURCE AS MUCH AS POSSIBLE!

	change log: 
	11-july-07 added support for include files. 
	
	
--&gt;
&lt;!--STYLE SHEET SECTION: feel free to attach any stylesheet of your choosing--&gt;
&lt;!--?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;tree-view2.xsl&quot;?--&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;XML/treeview.xsl&quot;?&gt;

&lt;!--SIMULATION MODEL--&gt;
&lt;SimulationModel xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../scripts/XML/SimulaXMLSchema.xsd&quot;&gt;
  
	&lt;SimulaBase name=&quot;soil&quot;&gt;
	&lt;/SimulaBase&gt;	

	
	&lt;SimulaBase name=&quot;plants&quot;&gt;
		&lt;SimulaBase name=&quot;maize&quot; objectGenerator=&quot;seedling&quot;&gt;
			&lt;SimulaConstant name=&quot;plantType&quot; type=&quot;string&quot;&gt;
			&lt;!-- 	H99 w64a 36H56 noRCAinLaterals maize-aerenchyma--&gt; 
				maize-aerenchyma
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantingTime&quot;  unit=&quot;day&quot; type=&quot;time&quot;&gt;
				0
			&lt;/SimulaConstant&gt;	
			&lt;SimulaConstant name=&quot;plantPosition&quot; type=&quot;coordinate&quot;&gt;
					0 -2 0
			&lt;/SimulaConstant&gt;
		&lt;/SimulaBase&gt;	
	&lt;/SimulaBase&gt;	

	&lt;!-- &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/simulationControlParameters.xml&quot;/&gt; --&gt;
	&lt;SimulaBase name=&quot;simulationControls&quot;&gt;
		&lt;SimulaBase name=&quot;outputParameters&quot;&gt;
			&lt;SimulaBase name=&quot;defaults&quot;&gt;
			&lt;!-- optional section - if an export module section does not list end/start/interval times than you can specify a default here--&gt;
				&lt;SimulaConstant
					name=&quot;startTime&quot;
					type=&quot;time&quot;&gt; 0.&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;endTime&quot;
					type=&quot;time&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt; 1.&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
			&lt;SimulaBase name=&quot;probeAllObjects&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt;
					1 &lt;!--this does not result in any output, just tries to run the code for debugging purposes--&gt;
				&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;timeInterval&quot;
					type=&quot;time&quot;&gt;1&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;requestedVariables&quot;
					type=&quot;string&quot;&gt; carbonAllocation2Roots, saturatedWaterContent,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;	
			&lt;SimulaBase name=&quot;table&quot;&gt;
				&lt;SimulaConstant
					name=&quot;run&quot;
					type=&quot;bool&quot;&gt; 1&lt;/SimulaConstant&gt;
				&lt;!--SimulaConstant name=&quot;timeInterval&quot; type=&quot;time&quot;&gt; 1.0	&lt;/SimulaConstant--&gt;
				&lt;SimulaConstant
					name=&quot;searchingDepth&quot;
					type=&quot;integer&quot;&gt; 5&lt;/SimulaConstant&gt;
				&lt;SimulaConstant
					name=&quot;skipTheseVariables&quot;
					type=&quot;string&quot;&gt; primaryRoot, hypocotyl,
				&lt;/SimulaConstant&gt;
			&lt;/SimulaBase&gt;
		&lt;/SimulaBase&gt;
	&lt;/SimulaBase&gt;
	
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplateFullModel.xml&quot;/&gt;
	&lt;!-- SimulaIncludeFile fileName=&quot;environments/Rocksprings/Rocksprings-maize.xml&quot;/--&gt;
	&lt;SimulaIncludeFile fileName=&quot;environments/WageningseBovenBuurt/WageningseBovenBuurt-maize.xml&quot;/&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeGeometry.xml&quot; /&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeDryweight.xml&quot; /&gt;

	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorusBC.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePhosphorus3D.xml&quot; /--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrateBasic.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeWaterModule.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeNitrate3D.xml&quot;/--&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludePotassium3D.xml&quot; /--&gt;

	&lt;SimulaIncludeFile fileName=&quot;templates/configurationCarbon.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeStress.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootHairs.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeAerenchyma.xml&quot;/&gt;
	&lt;SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeRootLengthProfile.xml&quot;/&gt;
	&lt;!--SimulaIncludeFile fileName=&quot;templates/plantTemplate.IncludeLocalNutrientResponses.xml&quot;/--&gt;

	&lt;SimulaBase name=&quot;rootTypeParameters&quot; &gt;
	  &lt;!--SimulaIncludeFile fileName=&quot;plantParameters/Maize/H99/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/W64a/maize.xml&quot;/&gt;
		&lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/36H56/maize.xml&quot;/--&gt;
	  &lt;SimulaIncludeFile fileName=&quot;plantParameters/Maize/Maize/maize.xml&quot;/&gt;
	&lt;/SimulaBase&gt;
&lt;/SimulationModel&gt;


</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">timesync</span>
    <span class="nt">additional_variables</span><span class="p">:</span>
      <span class="nt">osr_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">other_model</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">osr</span>
    <span class="nt">timesync</span><span class="p">:</span>
      <span class="nt">inputs</span><span class="p">:</span>  <span class="p p-Indicator">[</span><span class="nv">carbonAllocation2Roots</span><span class="p p-Indicator">,</span> <span class="nv">saturatedConductivity</span><span class="p p-Indicator">]</span>
      <span class="nt">outputs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="nv">saturatedWaterContent</span><span class="p p-Indicator">]</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/osr_model.xml</span>
    <span class="nt">copy_xml_to_osr</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">update_interval</span><span class="p">:</span>
      <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">R</span>
    <span class="nt">args</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/other_model.R</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">hr</span>
    <span class="nt">timesync</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output</span>
      <span class="nt">default_file</span><span class="p">:</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">other_model_output.txt</span>
        <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
        <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>