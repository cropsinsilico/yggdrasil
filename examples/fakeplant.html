<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fakeplant &mdash; yggdrasil v1.10.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            yggdrasil
          </a>
              <div class="version">
                v1.10.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc.html">High Performance Computing (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote.html">Running Integrations as Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">yggdrasil</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">fakeplant</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/fakeplant.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="fakeplant">
<span id="fakeplant-rst"></span><h1>fakeplant<a class="headerlink" href="#fakeplant" title="Permalink to this heading">¶</a></h1>
<p>Four models that can be run in isolation or as an integration. Each model approximates a simplified model of a process governing plant growth. When run in isolation each model receives input from a file and sends output to a file. In the larger integration, the canopy model receives input from three files (initial structure, time steps, and some growth parameters. For each time step received, the canopy model also receives a growth rate from the growth model, computes the new structure. and send the structure to the light model. The light model receives the ambient light level from a file, calculates the intensity for each element of the structure, and sends the output to the photosynthesis model. The photosynthesis model receives temperature and CO2 from files, calculates the photosynthesis rate, and sends the result to the growth model. The growth model calculates the growth rate and sends the output to the canopy model.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#mixed-version" id="id2">Mixed Version</a></p></li>
<li><p><a class="reference internal" href="#mixed-w-o-matlab-version" id="id3">Mixed w/o Matlab Version</a></p></li>
<li><p><a class="reference internal" href="#c-version" id="id4">C Version</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id5">C++ Version</a></p></li>
<li><p><a class="reference internal" href="#matlab-version" id="id6">Matlab Version</a></p></li>
<li><p><a class="reference internal" href="#python-version" id="id7">Python Version</a></p></li>
</ul>
</nav>
<section id="mixed-version">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Mixed Version</a><a class="headerlink" href="#mixed-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.hpp&quot;</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos">  4</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kt">void</span><span class="w"> </span><span class="nf">grow_canopy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tstep</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">growth_rate</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">layout</span><span class="p">,</span>
<span class="linenos">  8</span><span class="w">		 </span><span class="kt">int</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">  9</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="linenos"> 10</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 11</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 12</span><span class="w">      </span><span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 13</span><span class="w">      </span><span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 14</span><span class="w">      </span><span class="n">x3</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 16</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="p">}</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="w">		</span>
<span class="linenos"> 21</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 24</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_layout</span><span class="p">(</span><span class="s">&quot;plant_layout&quot;</span><span class="p">);</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="n">YggAsciiArrayInput</span><span class="w"> </span><span class="n">in_struct</span><span class="p">(</span><span class="s">&quot;init_canopy_structure&quot;</span><span class="p">);</span>
<span class="linenos"> 26</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_time</span><span class="p">(</span><span class="s">&quot;time&quot;</span><span class="p">);</span>
<span class="linenos"> 27</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_growth</span><span class="p">(</span><span class="s">&quot;growth_rate&quot;</span><span class="p">);</span>
<span class="linenos"> 28</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">struct_format</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos"> 29</span><span class="w">  </span><span class="n">YggAsciiArrayOutput</span><span class="w"> </span><span class="n">out_struct</span><span class="p">(</span><span class="s">&quot;canopy_structure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">struct_format</span><span class="p">);</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">time_curr</span><span class="p">;</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="n">time_curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="c1">// Malloc arrays for use</span>
<span class="linenos"> 34</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="linenos"> 35</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 39</span><span class="w">    </span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 42</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="c1">// Receive layout and initial structure</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">npatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 47</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_layout</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 49</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error receiving layout.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 50</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos"> 51</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos"> 52</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos"> 54</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: layout = %f, %f, %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span><span class="w">	 </span><span class="n">layout</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 58</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_struct</span><span class="p">.</span><span class="n">recvRealloc</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 59</span><span class="w">			      </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 60</span><span class="w">			      </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 61</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 62</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error receiving structure</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos"> 66</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: %d patches in initial structure:</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos"> 70</span><span class="w">	 </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 71</span><span class="w">	 </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 72</span><span class="w">	 </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="c1">// Send canopy to output and get growth rate for it</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">growth_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">npatch</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_struct</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos"> 77</span><span class="w">			</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 78</span><span class="w">			</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 79</span><span class="w">			</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error sending initial structure to output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 83</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 85</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_growth</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos"> 86</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 87</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Failed to get initial growth rate for patch %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos"> 88</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 89</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos"> 90</span><span class="w">      </span><span class="p">}</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 92</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="c1">// Loop over growth rates calculating new structure</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 96</span><span class="w">    </span><span class="c1">// Check for next time</span>
<span class="linenos"> 97</span><span class="w">    </span><span class="n">time_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_curr</span><span class="p">;</span>
<span class="linenos"> 98</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_time</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">time_curr</span><span class="p">);</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">100</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: No more input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">101</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">102</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">103</span><span class="w">    </span><span class="c1">// Update structure and send to out</span>
<span class="linenos">104</span><span class="w">    </span><span class="n">grow_canopy</span><span class="p">(</span><span class="n">time_curr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">105</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">106</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: patch %d: growth rate = %f --&gt; </span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">107</span><span class="w">	     </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">108</span><span class="w">	     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">109</span><span class="w">	     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">110</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">111</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_struct</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos">112</span><span class="w">			  </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">113</span><span class="w">			  </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">114</span><span class="w">			  </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos">115</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">116</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error sending structure output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">117</span><span class="w">      </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">118</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">120</span><span class="w">    </span><span class="c1">// Receive growth rate for each patch</span>
<span class="linenos">121</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">122</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_growth</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos">123</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">124</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Failed to get growth rate for patch %d during time frame %f to %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">125</span><span class="w">	       </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">time_curr</span><span class="p">);</span>
<span class="linenos">126</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">127</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos">128</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">129</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">130</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">131</span><span class="w">  </span>
<span class="linenos">132</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">133</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">134</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">135</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">136</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos">138</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">growth_rate</span><span class="p">);</span>
<span class="linenos">139</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos">140</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos">141</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">142</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">return_code</span><span class="p">;</span>
<span class="linenos">143</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.h&quot;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kt">double</span><span class="w"> </span><span class="nf">calc_light_intensity</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">,</span><span class="w"> </span>
<span class="linenos"> 8</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z1</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z2</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y3</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">12</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">13</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="p">));</span>
<span class="linenos">16</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ambient_light</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">z1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z3</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="p">;</span>
<span class="linenos">17</span><span class="p">}</span>
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">21</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">yggInput_t</span><span class="w"> </span><span class="n">AmbInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiTableInput</span><span class="p">(</span><span class="s">&quot;ambient_light&quot;</span><span class="p">);</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">yggInput_t</span><span class="w"> </span><span class="n">StructInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiArrayInput</span><span class="p">(</span><span class="s">&quot;canopy_structure&quot;</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">yggOutput_t</span><span class="w"> </span><span class="n">LightOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiTableOutput</span><span class="p">(</span><span class="s">&quot;light_intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">  </span><span class="c1">// Receive Ambient light</span>
<span class="linenos">28</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">;</span>
<span class="linenos">29</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggRecv</span><span class="p">(</span><span class="n">AmbInput</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ambient_light</span><span class="p">);</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">31</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: Error receiving ambient light.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">32</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">34</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: ambient light = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">);</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="w">  </span><span class="c1">// Malloc arrays for use</span>
<span class="linenos">37</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">38</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">39</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">40</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">    </span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">42</span><span class="w">    </span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">44</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">  </span><span class="c1">// Loop over canopy structures</span>
<span class="linenos">47</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">npatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">48</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">light_intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos">49</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">50</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">51</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggRecvRealloc</span><span class="p">(</span><span class="n">StructInput</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos">52</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">53</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">54</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos">55</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">56</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: End of input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">57</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">58</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">59</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">60</span><span class="w">      </span><span class="n">light_intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calc_light_intensity</span><span class="p">(</span><span class="n">ambient_light</span><span class="p">,</span>
<span class="linenos">61</span><span class="w">					     </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">62</span><span class="w">					     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">63</span><span class="w">					     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">64</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: structure = </span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f --&gt; light_intensity = %f</span><span class="se">\n\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">65</span><span class="w">	     </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">light_intensity</span><span class="p">,</span>
<span class="linenos">66</span><span class="w">	     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">67</span><span class="w">	     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">68</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggSend</span><span class="p">(</span><span class="n">LightOutput</span><span class="p">,</span><span class="w"> </span><span class="n">light_intensity</span><span class="p">);</span>
<span class="linenos">69</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">70</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: Error sending light intensity output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">71</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">72</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos">73</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">74</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">75</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">76</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">77</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">78</span>
<span class="linenos">79</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">80</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">81</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">82</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">83</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">84</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos">85</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos">86</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">87</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">return_code</span><span class="p">;</span>
<span class="linenos">88</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">yggdrasil.interface</span> <span class="kn">import</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">calc_photosynthesis_rate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CO2</span><span class="p">,</span> <span class="n">light</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the rate of photosynthesis from environment properties.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="sd">    Args:</span>
<span class="linenos"> 8</span><span class="sd">        T (float): Temperature.</span>
<span class="linenos"> 9</span><span class="sd">        CO2 (float): CO2 concentration.</span>
<span class="linenos">10</span><span class="sd">        light (float): Light intensity.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    Returns:</span>
<span class="linenos">13</span><span class="sd">        float: Photosynthesis rate.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">16</span>    <span class="k">return</span> <span class="n">light</span> <span class="o">*</span> <span class="n">CO2</span> <span class="o">/</span> <span class="n">T</span>
<span class="linenos">17</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="n">in_temp</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">in_co2</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;co2&#39;</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="n">in_light</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;light_intensity&#39;</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">out_photo</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s1">&#39;photosynthesis_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%lf</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">24</span>    
<span class="linenos">25</span>    <span class="c1"># Receive temperature &amp; CO2 concentration of environment</span>
<span class="linenos">26</span>    <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_temp</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">27</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to receive temperature.&quot;</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">T</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">30</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: T = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">T</span><span class="p">)</span>
<span class="linenos">31</span>    <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_co2</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">32</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">33</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to receive CO2 concentration.&quot;</span><span class="p">)</span>
<span class="linenos">34</span>    <span class="n">CO2</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">35</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: CO2 = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">CO2</span><span class="p">)</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># Loop over light intensities</span>
<span class="linenos">38</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">39</span>        <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_light</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">40</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">41</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: No more input.&quot;</span><span class="p">)</span>
<span class="linenos">42</span>            <span class="k">break</span>
<span class="linenos">43</span>        <span class="n">LI</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">44</span>        <span class="n">PR</span> <span class="o">=</span> <span class="n">calc_photosynthesis_rate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CO2</span><span class="p">,</span> <span class="n">LI</span><span class="p">)</span>
<span class="linenos">45</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: light intensity = </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">LI</span>
<span class="linenos">46</span>              <span class="o">+</span> <span class="s2">&quot;--&gt; photosynthesis rate = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PR</span><span class="p">)</span>
<span class="linenos">47</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">out_photo</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">PR</span><span class="p">)</span>
<span class="linenos">48</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">49</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to send output.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggInput&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;photosynthesis_rate&#39;</span><span class="p">);</span>
<span class="linenos"> 2</span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;growth_rate&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;%f\n&#39;</span><span class="p">);</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p">[</span><span class="nb">flag</span><span class="p">,</span><span class="w"> </span><span class="n">prate</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">recv</span><span class="p">();</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="nb">flag</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;growth: No more input.&#39;</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">  </span><span class="n">grate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prate</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="linenos">11</span><span class="w">  </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;growth: photosynthesis rate = %f ---&gt; growth rate = %f\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="linenos">12</span><span class="w">          </span><span class="n">prate</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">grate</span><span class="p">);</span>
<span class="linenos">13</span><span class="w">  </span><span class="nb">flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">grate</span><span class="p">);</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="nb">flag</span><span class="p">)</span>
<span class="linenos">15</span><span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;growth: Error sending growth rate.&#39;</span><span class="p">);</span>
<span class="linenos">16</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">17</span><span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CanopyModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c++</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/canopy.cpp</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plant_layout</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_canopy_structure</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span>
<span class="linenos">10</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LightModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/light.c</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-lm</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ambient_light</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos">10</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PhotosynthesisModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/photosynthesis.py</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/light_intensity.txt</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">10</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">13</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">15</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">temperature</span>
<span class="linenos">16</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">17</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/temperature.txt</span>
<span class="linenos">18</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">20</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">22</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">23</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">24</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">co2</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">26</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/co2.txt</span>
<span class="linenos">27</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">28</span><span class="w">      </span><span class="c1"># datatype:</span>
<span class="linenos">29</span><span class="w">      </span><span class="c1">#   type: array</span>
<span class="linenos">30</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">32</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">34</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">35</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">36</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">37</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Output/photosynthesis_rate.txt</span>
<span class="linenos">39</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x1,y1,z1,x2,y2,z2,x3,y3,z3</span>
<span class="linenos">11</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">12</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">13</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">14</span><span class="w">  </span><span class="c1"># Canopy file input</span>
<span class="linenos">15</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/plant_layout.txt</span>
<span class="linenos">16</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plant_layout</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">18</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/canopy_structure.txt</span>
<span class="linenos">19</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_canopy_structure</span>
<span class="linenos">20</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">21</span><span class="w">    </span><span class="nt">as_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">22</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/time.txt</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span>
<span class="linenos">24</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">25</span><span class="w">  </span><span class="c1"># Light file input</span>
<span class="linenos">26</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/ambient_light.txt</span>
<span class="linenos">27</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ambient_light</span>
<span class="linenos">28</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">29</span><span class="w">  </span><span class="c1"># Photosynthesis file input</span>
<span class="linenos">30</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/temperature.txt</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">temperature</span>
<span class="linenos">32</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">33</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/co2.txt</span>
<span class="linenos">34</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">co2</span>
<span class="linenos">35</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos">2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GrowthModel</span>
<span class="linenos">3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matlab</span>
<span class="linenos">4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/growth.m</span>
<span class="linenos">5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos">6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">7</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
</pre></div>
</div>
</section>
<section id="mixed-w-o-matlab-version">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Mixed w/o Matlab Version</a><a class="headerlink" href="#mixed-w-o-matlab-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.hpp&quot;</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos">  4</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kt">void</span><span class="w"> </span><span class="nf">grow_canopy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tstep</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">growth_rate</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">layout</span><span class="p">,</span>
<span class="linenos">  8</span><span class="w">		 </span><span class="kt">int</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">  9</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="linenos"> 10</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 11</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 12</span><span class="w">      </span><span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 13</span><span class="w">      </span><span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 14</span><span class="w">      </span><span class="n">x3</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 16</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="p">}</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="w">		</span>
<span class="linenos"> 21</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 24</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_layout</span><span class="p">(</span><span class="s">&quot;plant_layout&quot;</span><span class="p">);</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="n">YggAsciiArrayInput</span><span class="w"> </span><span class="n">in_struct</span><span class="p">(</span><span class="s">&quot;init_canopy_structure&quot;</span><span class="p">);</span>
<span class="linenos"> 26</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_time</span><span class="p">(</span><span class="s">&quot;time&quot;</span><span class="p">);</span>
<span class="linenos"> 27</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_growth</span><span class="p">(</span><span class="s">&quot;growth_rate&quot;</span><span class="p">);</span>
<span class="linenos"> 28</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">struct_format</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos"> 29</span><span class="w">  </span><span class="n">YggAsciiArrayOutput</span><span class="w"> </span><span class="n">out_struct</span><span class="p">(</span><span class="s">&quot;canopy_structure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">struct_format</span><span class="p">);</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">time_curr</span><span class="p">;</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="n">time_curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="c1">// Malloc arrays for use</span>
<span class="linenos"> 34</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="linenos"> 35</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 39</span><span class="w">    </span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 42</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="c1">// Receive layout and initial structure</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">npatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 47</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_layout</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 49</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error receiving layout.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 50</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos"> 51</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos"> 52</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos"> 54</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: layout = %f, %f, %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span><span class="w">	 </span><span class="n">layout</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 58</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_struct</span><span class="p">.</span><span class="n">recvRealloc</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 59</span><span class="w">			      </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 60</span><span class="w">			      </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 61</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 62</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error receiving structure</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos"> 66</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: %d patches in initial structure:</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos"> 70</span><span class="w">	 </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 71</span><span class="w">	 </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 72</span><span class="w">	 </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="c1">// Send canopy to output and get growth rate for it</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">growth_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">npatch</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_struct</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos"> 77</span><span class="w">			</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 78</span><span class="w">			</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 79</span><span class="w">			</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error sending initial structure to output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 83</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 85</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_growth</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos"> 86</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 87</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Failed to get initial growth rate for patch %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos"> 88</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 89</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos"> 90</span><span class="w">      </span><span class="p">}</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 92</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="c1">// Loop over growth rates calculating new structure</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 96</span><span class="w">    </span><span class="c1">// Check for next time</span>
<span class="linenos"> 97</span><span class="w">    </span><span class="n">time_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_curr</span><span class="p">;</span>
<span class="linenos"> 98</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_time</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">time_curr</span><span class="p">);</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">100</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: No more input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">101</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">102</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">103</span><span class="w">    </span><span class="c1">// Update structure and send to out</span>
<span class="linenos">104</span><span class="w">    </span><span class="n">grow_canopy</span><span class="p">(</span><span class="n">time_curr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">105</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">106</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: patch %d: growth rate = %f --&gt; </span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">107</span><span class="w">	     </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">108</span><span class="w">	     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">109</span><span class="w">	     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">110</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">111</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_struct</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos">112</span><span class="w">			  </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">113</span><span class="w">			  </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">114</span><span class="w">			  </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos">115</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">116</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error sending structure output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">117</span><span class="w">      </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">118</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">120</span><span class="w">    </span><span class="c1">// Receive growth rate for each patch</span>
<span class="linenos">121</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">122</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_growth</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos">123</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">124</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Failed to get growth rate for patch %d during time frame %f to %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">125</span><span class="w">	       </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">time_curr</span><span class="p">);</span>
<span class="linenos">126</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">127</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos">128</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">129</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">130</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">131</span><span class="w">  </span>
<span class="linenos">132</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">133</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">134</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">135</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">136</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos">138</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">growth_rate</span><span class="p">);</span>
<span class="linenos">139</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos">140</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos">141</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">142</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">return_code</span><span class="p">;</span>
<span class="linenos">143</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.h&quot;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kt">double</span><span class="w"> </span><span class="nf">calc_light_intensity</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">,</span><span class="w"> </span>
<span class="linenos"> 8</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z1</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z2</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y3</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">12</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">13</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="p">));</span>
<span class="linenos">16</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ambient_light</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">z1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z3</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="p">;</span>
<span class="linenos">17</span><span class="p">}</span>
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">21</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">yggInput_t</span><span class="w"> </span><span class="n">AmbInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiTableInput</span><span class="p">(</span><span class="s">&quot;ambient_light&quot;</span><span class="p">);</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">yggInput_t</span><span class="w"> </span><span class="n">StructInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiArrayInput</span><span class="p">(</span><span class="s">&quot;canopy_structure&quot;</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">yggOutput_t</span><span class="w"> </span><span class="n">LightOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiTableOutput</span><span class="p">(</span><span class="s">&quot;light_intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">  </span><span class="c1">// Receive Ambient light</span>
<span class="linenos">28</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">;</span>
<span class="linenos">29</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggRecv</span><span class="p">(</span><span class="n">AmbInput</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ambient_light</span><span class="p">);</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">31</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: Error receiving ambient light.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">32</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">34</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: ambient light = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">);</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="w">  </span><span class="c1">// Malloc arrays for use</span>
<span class="linenos">37</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">38</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">39</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">40</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">    </span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">42</span><span class="w">    </span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">44</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">  </span><span class="c1">// Loop over canopy structures</span>
<span class="linenos">47</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">npatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">48</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">light_intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos">49</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">50</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">51</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggRecvRealloc</span><span class="p">(</span><span class="n">StructInput</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos">52</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">53</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">54</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos">55</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">56</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: End of input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">57</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">58</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">59</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">60</span><span class="w">      </span><span class="n">light_intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calc_light_intensity</span><span class="p">(</span><span class="n">ambient_light</span><span class="p">,</span>
<span class="linenos">61</span><span class="w">					     </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">62</span><span class="w">					     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">63</span><span class="w">					     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">64</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: structure = </span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f --&gt; light_intensity = %f</span><span class="se">\n\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">65</span><span class="w">	     </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">light_intensity</span><span class="p">,</span>
<span class="linenos">66</span><span class="w">	     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">67</span><span class="w">	     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">68</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggSend</span><span class="p">(</span><span class="n">LightOutput</span><span class="p">,</span><span class="w"> </span><span class="n">light_intensity</span><span class="p">);</span>
<span class="linenos">69</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">70</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: Error sending light intensity output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">71</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">72</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos">73</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">74</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">75</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">76</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">77</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">78</span>
<span class="linenos">79</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">80</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">81</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">82</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">83</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">84</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos">85</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos">86</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">87</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">return_code</span><span class="p">;</span>
<span class="linenos">88</span><span class="p">}</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">yggdrasil.interface</span> <span class="kn">import</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">calc_photosynthesis_rate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CO2</span><span class="p">,</span> <span class="n">light</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the rate of photosynthesis from environment properties.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="sd">    Args:</span>
<span class="linenos"> 8</span><span class="sd">        T (float): Temperature.</span>
<span class="linenos"> 9</span><span class="sd">        CO2 (float): CO2 concentration.</span>
<span class="linenos">10</span><span class="sd">        light (float): Light intensity.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    Returns:</span>
<span class="linenos">13</span><span class="sd">        float: Photosynthesis rate.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">16</span>    <span class="k">return</span> <span class="n">light</span> <span class="o">*</span> <span class="n">CO2</span> <span class="o">/</span> <span class="n">T</span>
<span class="linenos">17</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="n">in_temp</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">in_co2</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;co2&#39;</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="n">in_light</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;light_intensity&#39;</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">out_photo</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s1">&#39;photosynthesis_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%lf</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">24</span>    
<span class="linenos">25</span>    <span class="c1"># Receive temperature &amp; CO2 concentration of environment</span>
<span class="linenos">26</span>    <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_temp</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">27</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to receive temperature.&quot;</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">T</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">30</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: T = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">T</span><span class="p">)</span>
<span class="linenos">31</span>    <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_co2</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">32</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">33</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to receive CO2 concentration.&quot;</span><span class="p">)</span>
<span class="linenos">34</span>    <span class="n">CO2</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">35</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: CO2 = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">CO2</span><span class="p">)</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># Loop over light intensities</span>
<span class="linenos">38</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">39</span>        <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_light</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">40</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">41</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: No more input.&quot;</span><span class="p">)</span>
<span class="linenos">42</span>            <span class="k">break</span>
<span class="linenos">43</span>        <span class="n">LI</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">44</span>        <span class="n">PR</span> <span class="o">=</span> <span class="n">calc_photosynthesis_rate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CO2</span><span class="p">,</span> <span class="n">LI</span><span class="p">)</span>
<span class="linenos">45</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: light intensity = </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">LI</span>
<span class="linenos">46</span>              <span class="o">+</span> <span class="s2">&quot;--&gt; photosynthesis rate = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PR</span><span class="p">)</span>
<span class="linenos">47</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">out_photo</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">PR</span><span class="p">)</span>
<span class="linenos">48</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">49</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to send output.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">yggdrasil.interface</span> <span class="kn">import</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">calculate_growth</span><span class="p">(</span><span class="n">photosynthesis_rate</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the plant growth rate from the photosynthesis rate.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="sd">    Args:</span>
<span class="linenos"> 8</span><span class="sd">        photosynthesis_rate (float): Rate of photosynthesis.</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="sd">    Returns:</span>
<span class="linenos">11</span><span class="sd">        float: Growth rate.</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">14</span>    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">photosynthesis_rate</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">18</span>    <span class="nb">input</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;photosynthesis_rate&#39;</span><span class="p">)</span>
<span class="linenos">19</span>    <span class="n">output</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">20</span>    
<span class="linenos">21</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">22</span>        <span class="n">flag</span><span class="p">,</span> <span class="n">prate</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">23</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">24</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;growth: No more input.&#39;</span><span class="p">)</span>
<span class="linenos">25</span>            <span class="k">break</span>
<span class="linenos">26</span>        <span class="n">grate</span> <span class="o">=</span> <span class="n">calculate_growth</span><span class="p">(</span><span class="o">*</span><span class="n">prate</span><span class="p">)</span>
<span class="linenos">27</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;growth: photosynthesis rate = </span><span class="si">%f</span><span class="s1"> ---&gt; growth rate = </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
<span class="linenos">28</span>            <span class="n">prate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grate</span><span class="p">))</span>
<span class="linenos">29</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">grate</span><span class="p">)</span>
<span class="linenos">30</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">31</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;growth: Error sending growth rate.&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CanopyModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c++</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/canopy.cpp</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plant_layout</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_canopy_structure</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span>
<span class="linenos">10</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LightModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/light.c</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-lm</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ambient_light</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos">10</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PhotosynthesisModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/photosynthesis.py</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/light_intensity.txt</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">10</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">13</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">15</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">temperature</span>
<span class="linenos">16</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">17</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/temperature.txt</span>
<span class="linenos">18</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">20</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">22</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">23</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">24</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">co2</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">26</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/co2.txt</span>
<span class="linenos">27</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">28</span><span class="w">      </span><span class="c1"># datatype:</span>
<span class="linenos">29</span><span class="w">      </span><span class="c1">#   type: array</span>
<span class="linenos">30</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">32</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">34</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">35</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">36</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">37</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Output/photosynthesis_rate.txt</span>
<span class="linenos">39</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x1,y1,z1,x2,y2,z2,x3,y3,z3</span>
<span class="linenos">11</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">12</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">13</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">14</span><span class="w">  </span><span class="c1"># Canopy file input</span>
<span class="linenos">15</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/plant_layout.txt</span>
<span class="linenos">16</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plant_layout</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">18</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/canopy_structure.txt</span>
<span class="linenos">19</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_canopy_structure</span>
<span class="linenos">20</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">21</span><span class="w">    </span><span class="nt">as_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">22</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/time.txt</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span>
<span class="linenos">24</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">25</span><span class="w">  </span><span class="c1"># Light file input</span>
<span class="linenos">26</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/ambient_light.txt</span>
<span class="linenos">27</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ambient_light</span>
<span class="linenos">28</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">29</span><span class="w">  </span><span class="c1"># Photosynthesis file input</span>
<span class="linenos">30</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/temperature.txt</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">temperature</span>
<span class="linenos">32</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">33</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/co2.txt</span>
<span class="linenos">34</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">co2</span>
<span class="linenos">35</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos">2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GrowthModel</span>
<span class="linenos">3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos">4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/growth.py</span>
<span class="linenos">5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos">6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">7</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
</pre></div>
</div>
</section>
<section id="c-version">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">C Version</a><a class="headerlink" href="#c-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos"> 2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="linenos"> 3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>
<span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.h&quot;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="kt">double</span><span class="w"> </span><span class="nf">calc_light_intensity</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">,</span><span class="w"> </span>
<span class="linenos"> 8</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z1</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z2</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">			    </span><span class="kt">double</span><span class="w"> </span><span class="n">x3</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">y3</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">z3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">11</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">12</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y3</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">13</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<span class="linenos">14</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="p">));</span>
<span class="linenos">16</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ambient_light</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">z1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">z3</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="p">;</span>
<span class="linenos">17</span><span class="p">}</span>
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">21</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="w">  </span><span class="n">yggInput_t</span><span class="w"> </span><span class="n">AmbInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiTableInput</span><span class="p">(</span><span class="s">&quot;ambient_light&quot;</span><span class="p">);</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">yggInput_t</span><span class="w"> </span><span class="n">StructInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiArrayInput</span><span class="p">(</span><span class="s">&quot;canopy_structure&quot;</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">yggOutput_t</span><span class="w"> </span><span class="n">LightOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggAsciiTableOutput</span><span class="p">(</span><span class="s">&quot;light_intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="w">  </span><span class="c1">// Receive Ambient light</span>
<span class="linenos">28</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">;</span>
<span class="linenos">29</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggRecv</span><span class="p">(</span><span class="n">AmbInput</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">ambient_light</span><span class="p">);</span>
<span class="linenos">30</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">31</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: Error receiving ambient light.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">32</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">33</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">34</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: ambient light = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ambient_light</span><span class="p">);</span>
<span class="linenos">35</span>
<span class="linenos">36</span><span class="w">  </span><span class="c1">// Malloc arrays for use</span>
<span class="linenos">37</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">38</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">39</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos">40</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">    </span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">42</span><span class="w">    </span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">43</span><span class="w">    </span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos">44</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">  </span><span class="c1">// Loop over canopy structures</span>
<span class="linenos">47</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">npatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">48</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">light_intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos">49</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">50</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">51</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggRecvRealloc</span><span class="p">(</span><span class="n">StructInput</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos">52</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">53</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">54</span><span class="w">			 </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos">55</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">56</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: End of input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">57</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">58</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">59</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">60</span><span class="w">      </span><span class="n">light_intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calc_light_intensity</span><span class="p">(</span><span class="n">ambient_light</span><span class="p">,</span>
<span class="linenos">61</span><span class="w">					     </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">62</span><span class="w">					     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">63</span><span class="w">					     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">64</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: structure = </span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f --&gt; light_intensity = %f</span><span class="se">\n\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">65</span><span class="w">	     </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">light_intensity</span><span class="p">,</span>
<span class="linenos">66</span><span class="w">	     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">67</span><span class="w">	     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">68</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggSend</span><span class="p">(</span><span class="n">LightOutput</span><span class="p">,</span><span class="w"> </span><span class="n">light_intensity</span><span class="p">);</span>
<span class="linenos">69</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">70</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;light: Error sending light intensity output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">71</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">72</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos">73</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">74</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">75</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="linenos">76</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">77</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">78</span>
<span class="linenos">79</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">80</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">81</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">82</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">83</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">84</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos">85</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos">86</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">87</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">return_code</span><span class="p">;</span>
<span class="linenos">88</span><span class="p">}</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LightModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/light.c</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-lm</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ambient_light</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos">10</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/ambient_light.txt</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ambient_light</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/canopy_structure.txt</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nt">as_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Output/light_intensity.txt</span>
<span class="linenos">11</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">12</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">C++ Version</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.hpp&quot;</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="linenos">  4</span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kt">void</span><span class="w"> </span><span class="nf">grow_canopy</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">tstep</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">growth_rate</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">layout</span><span class="p">,</span>
<span class="linenos">  8</span><span class="w">		 </span><span class="kt">int</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">  9</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">;</span>
<span class="linenos"> 10</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 11</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 12</span><span class="w">      </span><span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 13</span><span class="w">      </span><span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 14</span><span class="w">      </span><span class="n">x3</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tstep</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 16</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 17</span>
<span class="linenos"> 18</span><span class="p">}</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="w">		</span>
<span class="linenos"> 21</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 22</span>
<span class="linenos"> 23</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 24</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_layout</span><span class="p">(</span><span class="s">&quot;plant_layout&quot;</span><span class="p">);</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="n">YggAsciiArrayInput</span><span class="w"> </span><span class="n">in_struct</span><span class="p">(</span><span class="s">&quot;init_canopy_structure&quot;</span><span class="p">);</span>
<span class="linenos"> 26</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_time</span><span class="p">(</span><span class="s">&quot;time&quot;</span><span class="p">);</span>
<span class="linenos"> 27</span><span class="w">  </span><span class="n">YggInput</span><span class="w"> </span><span class="n">in_growth</span><span class="p">(</span><span class="s">&quot;growth_rate&quot;</span><span class="p">);</span>
<span class="linenos"> 28</span><span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">struct_format</span><span class="p">[</span><span class="mi">200</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\t</span><span class="s">%lf</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="linenos"> 29</span><span class="w">  </span><span class="n">YggAsciiArrayOutput</span><span class="w"> </span><span class="n">out_struct</span><span class="p">(</span><span class="s">&quot;canopy_structure&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">struct_format</span><span class="p">);</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">time_curr</span><span class="p">;</span>
<span class="linenos"> 31</span><span class="w">  </span><span class="n">time_curr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="c1">// Malloc arrays for use</span>
<span class="linenos"> 34</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">layout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="linenos"> 35</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">**</span><span class="n">x3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">**</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">));</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 39</span><span class="w">    </span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 40</span><span class="w">    </span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 42</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="c1">// Receive layout and initial structure</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="kt">int64_t</span><span class="w"> </span><span class="n">npatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 47</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_layout</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 49</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error receiving layout.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 50</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos"> 51</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos"> 52</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos"> 53</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos"> 54</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: layout = %f, %f, %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos"> 57</span><span class="w">	 </span><span class="n">layout</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">layout</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 58</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_struct</span><span class="p">.</span><span class="n">recvRealloc</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 59</span><span class="w">			      </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 60</span><span class="w">			      </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 61</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 62</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error receiving structure</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 63</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos"> 66</span><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: %d patches in initial structure:</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos"> 70</span><span class="w">	 </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 71</span><span class="w">	 </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
<span class="linenos"> 72</span><span class="w">	 </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="c1">// Send canopy to output and get growth rate for it</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="o">*</span><span class="n">growth_rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">double</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">npatch</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_struct</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos"> 77</span><span class="w">			</span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 78</span><span class="w">			</span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos"> 79</span><span class="w">			</span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error sending initial structure to output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 83</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 85</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_growth</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos"> 86</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 87</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Failed to get initial growth rate for patch %d.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos"> 88</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 89</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos"> 90</span><span class="w">      </span><span class="p">}</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 92</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 93</span>
<span class="linenos"> 94</span><span class="w">  </span><span class="c1">// Loop over growth rates calculating new structure</span>
<span class="linenos"> 95</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 96</span><span class="w">    </span><span class="c1">// Check for next time</span>
<span class="linenos"> 97</span><span class="w">    </span><span class="n">time_prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time_curr</span><span class="p">;</span>
<span class="linenos"> 98</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_time</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">time_curr</span><span class="p">);</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">100</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: No more input.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">101</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">102</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">103</span><span class="w">    </span><span class="c1">// Update structure and send to out</span>
<span class="linenos">104</span><span class="w">    </span><span class="n">grow_canopy</span><span class="p">(</span><span class="n">time_curr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">,</span><span class="w"> </span><span class="n">layout</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">105</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">106</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: patch %d: growth rate = %f --&gt; </span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\n\t\t\t\t\t\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f</span><span class="se">\t</span><span class="s">%f...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">107</span><span class="w">	     </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">108</span><span class="w">	     </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
<span class="linenos">109</span><span class="w">	     </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">110</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">111</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out_struct</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">npatch</span><span class="p">,</span>
<span class="linenos">112</span><span class="w">			  </span><span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">113</span><span class="w">			  </span><span class="n">x2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<span class="linenos">114</span><span class="w">			  </span><span class="n">x3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">x3</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="linenos">115</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">116</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Error sending structure output.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">117</span><span class="w">      </span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">118</span><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<span class="linenos">119</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">120</span><span class="w">    </span><span class="c1">// Receive growth rate for each patch</span>
<span class="linenos">121</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">npatch</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">122</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">in_growth</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">growth_rate</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<span class="linenos">123</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">124</span><span class="w">	</span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;canopy: Failed to get growth rate for patch %d during time frame %f to %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
<span class="linenos">125</span><span class="w">	       </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">time_prev</span><span class="p">,</span><span class="w"> </span><span class="n">time_curr</span><span class="p">);</span>
<span class="linenos">126</span><span class="w">	</span><span class="n">return_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">127</span><span class="w">	</span><span class="k">break</span><span class="p">;</span>
<span class="linenos">128</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">129</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">130</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">131</span><span class="w">  </span>
<span class="linenos">132</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">133</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">134</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">135</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="linenos">136</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">137</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">layout</span><span class="p">);</span>
<span class="linenos">138</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">growth_rate</span><span class="p">);</span>
<span class="linenos">139</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
<span class="linenos">140</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x2</span><span class="p">);</span>
<span class="linenos">141</span><span class="w">  </span><span class="n">free</span><span class="p">(</span><span class="n">x3</span><span class="p">);</span>
<span class="linenos">142</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">return_code</span><span class="p">;</span>
<span class="linenos">143</span><span class="p">}</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CanopyModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c++</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/canopy.cpp</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plant_layout</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_canopy_structure</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span>
<span class="linenos">10</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/plant_layout.txt</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plant_layout</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/canopy_structure.txt</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">init_canopy_structure</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="nt">as_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/time.txt</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">time</span>
<span class="linenos">11</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">12</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/growth_rate.txt</span>
<span class="linenos">13</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos">14</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">15</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">canopy_structure</span>
<span class="linenos">16</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Output/canopy_structure.txt</span>
<span class="linenos">17</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">as_array</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">19</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">x1,y1,z1,x2,y2,z2,x3,y3,z3</span>
</pre></div>
</div>
</section>
<section id="matlab-version">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Matlab Version</a><a class="headerlink" href="#matlab-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nb">input</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggInput&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;photosynthesis_rate&#39;</span><span class="p">);</span>
<span class="linenos"> 2</span><span class="n">output</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;growth_rate&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;%f\n&#39;</span><span class="p">);</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="p">[</span><span class="nb">flag</span><span class="p">,</span><span class="w"> </span><span class="n">prate</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">input</span><span class="p">.</span><span class="n">recv</span><span class="p">();</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="nb">flag</span><span class="p">)</span>
<span class="linenos"> 7</span><span class="w">    </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;growth: No more input.&#39;</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="k">break</span><span class="p">;</span>
<span class="linenos"> 9</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">10</span><span class="w">  </span><span class="n">grate</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">prate</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="linenos">11</span><span class="w">  </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;growth: photosynthesis rate = %f ---&gt; growth rate = %f\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="linenos">12</span><span class="w">          </span><span class="n">prate</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="w"> </span><span class="n">grate</span><span class="p">);</span>
<span class="linenos">13</span><span class="w">  </span><span class="nb">flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">output</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">grate</span><span class="p">);</span>
<span class="linenos">14</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="nb">flag</span><span class="p">)</span>
<span class="linenos">15</span><span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;growth: Error sending growth rate.&#39;</span><span class="p">);</span>
<span class="linenos">16</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">17</span><span class="k">end</span><span class="p">;</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos">2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GrowthModel</span>
<span class="linenos">3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matlab</span>
<span class="linenos">4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/growth.m</span>
<span class="linenos">5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos">6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">7</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">8</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos">2</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/photosynthesis_rate.txt</span>
<span class="linenos">3</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">4</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">5</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">input</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
<span class="linenos">6</span><span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Output/growth_rate.txt</span>
<span class="linenos">7</span><span class="w">    </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">8</span><span class="w">    </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">growth_rate</span>
</pre></div>
</div>
</section>
<section id="python-version">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Python Version</a><a class="headerlink" href="#python-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">yggdrasil.interface</span> <span class="kn">import</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">calc_photosynthesis_rate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CO2</span><span class="p">,</span> <span class="n">light</span><span class="p">):</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Calculate the rate of photosynthesis from environment properties.</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="sd">    Args:</span>
<span class="linenos"> 8</span><span class="sd">        T (float): Temperature.</span>
<span class="linenos"> 9</span><span class="sd">        CO2 (float): CO2 concentration.</span>
<span class="linenos">10</span><span class="sd">        light (float): Light intensity.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    Returns:</span>
<span class="linenos">13</span><span class="sd">        float: Photosynthesis rate.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">16</span>    <span class="k">return</span> <span class="n">light</span> <span class="o">*</span> <span class="n">CO2</span> <span class="o">/</span> <span class="n">T</span>
<span class="linenos">17</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">20</span>    <span class="n">in_temp</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;temperature&#39;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">in_co2</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;co2&#39;</span><span class="p">)</span>
<span class="linenos">22</span>    <span class="n">in_light</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s1">&#39;light_intensity&#39;</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">out_photo</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s1">&#39;photosynthesis_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%lf</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">24</span>    
<span class="linenos">25</span>    <span class="c1"># Receive temperature &amp; CO2 concentration of environment</span>
<span class="linenos">26</span>    <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_temp</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">27</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to receive temperature.&quot;</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="n">T</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">30</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: T = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">T</span><span class="p">)</span>
<span class="linenos">31</span>    <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_co2</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">32</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">33</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to receive CO2 concentration.&quot;</span><span class="p">)</span>
<span class="linenos">34</span>    <span class="n">CO2</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">35</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: CO2 = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">CO2</span><span class="p">)</span>
<span class="linenos">36</span>
<span class="linenos">37</span>    <span class="c1"># Loop over light intensities</span>
<span class="linenos">38</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">39</span>        <span class="n">flag</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">in_light</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">40</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">41</span>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: No more input.&quot;</span><span class="p">)</span>
<span class="linenos">42</span>            <span class="k">break</span>
<span class="linenos">43</span>        <span class="n">LI</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">44</span>        <span class="n">PR</span> <span class="o">=</span> <span class="n">calc_photosynthesis_rate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">CO2</span><span class="p">,</span> <span class="n">LI</span><span class="p">)</span>
<span class="linenos">45</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;photosynthesis: light intensity = </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">LI</span>
<span class="linenos">46</span>              <span class="o">+</span> <span class="s2">&quot;--&gt; photosynthesis rate = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PR</span><span class="p">)</span>
<span class="linenos">47</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">out_photo</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">PR</span><span class="p">)</span>
<span class="linenos">48</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">49</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;photosynthesis: Failed to send output.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PhotosynthesisModel</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/photosynthesis.py</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">light_intensity</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/light_intensity.txt</span>
<span class="linenos"> 9</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">10</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">11</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">13</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">15</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">temperature</span>
<span class="linenos">16</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">17</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/temperature.txt</span>
<span class="linenos">18</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">20</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">22</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">23</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">24</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">co2</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">26</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Input/co2.txt</span>
<span class="linenos">27</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">28</span><span class="w">      </span><span class="c1"># datatype:</span>
<span class="linenos">29</span><span class="w">      </span><span class="c1">#   type: array</span>
<span class="linenos">30</span><span class="w">  </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">31</span><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
<span class="linenos">32</span><span class="w">      </span><span class="nt">datatype</span><span class="p">:</span>
<span class="linenos">33</span><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">array</span>
<span class="linenos">34</span><span class="w">        </span><span class="nt">items</span><span class="p">:</span>
<span class="linenos">35</span><span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">number</span>
<span class="linenos">36</span><span class="w">        </span><span class="nt">allowSingular</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">37</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./Output/photosynthesis_rate.txt</span>
<span class="linenos">39</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">field_names</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">photosynthesis_rate</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Meagan Lang, David Raila.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>