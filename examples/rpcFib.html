

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>rpcFib &mdash; yggdrasil v1.6.3+2.g5f7bdedf2.dirty documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html#notes-on-autowrapping-c-c-model-functions">Notes on Autowrapping C/C++ Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>rpcFib</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/rpcFib.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rpcfib">
<span id="rpcfib-rst"></span><h1>rpcFib<a class="headerlink" href="#rpcfib" title="Permalink to this headline">¶</a></h1>
<p>Three models (two clients, one server) run in a client-server, remote procedure call (RPC) communication pattern. The client models (<cite>rpcFibCli</cite> and <cite>rpcFibCliPar</cite>) send requests and receive response to/from the server model <cite>rpcFibSrv</cite>. The <cite>rpcFibCli</cite> model sends &amp; receives requests/responses via the deprecated <cite>rpcCall</cite> method (use <cite>call</cite> instead), while <cite>rpcFibCliPar</cite> uses the separate send/recv methods <cite>rpcSend</cite> and <cite>rpcRecv</cite> (use <cite>send</cite> &amp; <cite>recv</cite> instead). The server model receives requests and send responses. The <cite>rpcFibCli</cite> model also reads text data from and input file and sends each request/response pair to an output file. This example demostrates the RPC pattern through the use of the <cite>client_of</cite> and <cite>is_server</cite> model parameters and the RPC interface classes/functions, including splitting calls into their send/recv components. The models also receive parameters via the command line as specified in the YAML <cite>args</cite> model parameter.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#mixed-version" id="id2">Mixed Version</a></p></li>
<li><p><a class="reference internal" href="#mixed-w-o-matlab-version" id="id3">Mixed w/o Matlab Version</a></p></li>
<li><p><a class="reference internal" href="#c-version" id="id4">C Version</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id5">C++ Version</a></p></li>
<li><p><a class="reference internal" href="#fortran-version" id="id6">Fortran Version</a></p></li>
<li><p><a class="reference internal" href="#matlab-version" id="id7">Matlab Version</a></p></li>
<li><p><a class="reference internal" href="#python-version" id="id8">Python Version</a></p></li>
<li><p><a class="reference internal" href="#r-version" id="id9">R Version</a></p></li>
</ul>
</div>
<div class="section" id="mixed-version">
<h2><a class="toc-backref" href="#id2">Mixed Version</a><a class="headerlink" href="#mixed-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">YggRpcClient</span><span class="p">,</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fibClient</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    
    <span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python rpcFibCli: iterations = </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">iterations</span><span class="p">)</span>

    <span class="c1"># Set up connections matching yaml</span>
    <span class="c1"># RPC client-side connection will be $(server_name)_$(client_name)</span>
    <span class="n">ymlfile</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s2">&quot;yaml_in&quot;</span><span class="p">)</span>
    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s2">&quot;rpcFibSrv_rpcFibCli&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s2">&quot;output_log&quot;</span><span class="p">)</span>

    <span class="c1"># Read entire contents of yaml</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">ycontent</span> <span class="o">=</span> <span class="n">ymlfile</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): RECV ERROR&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCli: yaml has </span><span class="si">%d</span><span class="s1"> lines&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycontent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        
        <span class="c1"># Call the server and receive response</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): fib(-&gt;</span><span class="si">%-2d</span><span class="s1">) ::: &#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">fib</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcCall</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): RPC CALL ERROR&#39;</span><span class="p">)</span>

        <span class="c1"># Log result by sending it to the log connection</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;fib(</span><span class="si">%2d</span><span class="s1">&lt;-) = </span><span class="si">%-2d</span><span class="s1">&lt;-</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): SEND ERROR&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python rpcFibCli&#39;</span><span class="p">)</span>

    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">fibClient</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">rpcFibCliPar</span><span class="p">(</span>iterations<span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="n">iterations</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">iterations</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Hello from Matlab rpcFibCliPar: iterations = %d\n&#39;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>

  <span class="c">% Create RPC connection with serover</span>
  <span class="c">% RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">rpc</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggRpcClient&#39;</span><span class="p">,</span> <span class="s">&#39;rpcFibSrv_rpcFibCliPar&#39;</span><span class="p">,</span> <span class="s">&#39;%d&#39;</span><span class="p">,</span> <span class="s">&#39;%d %d&#39;</span><span class="p">);</span>

  <span class="c">% Send all of the requests to the server</span>
  <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">iterations</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): fib(-&gt;%-2d) ::: \n&#39;</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">int32</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): SEND FAILED&#39;</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c">% Receive responses for all requests that were sent</span>
  <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">iterations</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): fib(-&gt;%-2d) ::: &#39;</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span>
    <span class="p">[</span><span class="n">ret</span><span class="p">,</span> <span class="n">fib</span><span class="p">]</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">recv</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): RECV FAILED&#39;</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): fib(%2d&lt;-) = %-2d&lt;-\n&#39;</span><span class="p">,</span> <span class="n">fib</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">fib</span><span class="p">{</span><span class="mi">2</span><span class="p">});</span>
  <span class="k">end</span>

  <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Goodbye from Matlab rpcFibCliPar&#39;</span><span class="p">);</span>
  
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">float</span> <span class="n">timeSleep</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C rpcFibSrv: sleeptime = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">timeSleep</span><span class="p">);</span>
  
  <span class="c1">// Create server-side rpc conneciton using model name</span>
  <span class="n">yggRpc_t</span> <span class="n">rpc</span> <span class="o">=</span> <span class="n">yggRpcServer</span><span class="p">(</span><span class="s">&quot;rpcFibSrv&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>

  <span class="c1">// Continue receiving requests until error occurs (the connection is closed</span>
  <span class="c1">// by all clients that have connected).</span>
  <span class="kt">int</span> <span class="n">input</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): receiving...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcRecv</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): end of input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Compute fibonacci number</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): &lt;- input %d&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevResult</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevPrev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">idx</span><span class="o">++</span> <span class="o">&lt;</span> <span class="n">input</span><span class="p">){</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">prevResult</span> <span class="o">+</span> <span class="n">prevPrev</span><span class="p">;</span>
      <span class="n">prevPrev</span> <span class="o">=</span> <span class="n">prevResult</span><span class="p">;</span>
      <span class="n">prevResult</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; ::: -&gt;(%2d %2d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>

    <span class="c1">// Sleep and then send response back</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeSleep</span><span class="p">)</span> 
      <span class="n">sleep</span><span class="p">(</span><span class="n">timeSleep</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">rpcSend</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): ERROR sending</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C rpcFibSrv</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PythonModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.py</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_python.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MatlabModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.m</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
 
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.c</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&#39;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="mixed-w-o-matlab-version">
<h2><a class="toc-backref" href="#id3">Mixed w/o Matlab Version</a><a class="headerlink" href="#mixed-w-o-matlab-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">YggRpcClient</span><span class="p">,</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fibClient</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    
    <span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python rpcFibCli: iterations = </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">iterations</span><span class="p">)</span>

    <span class="c1"># Set up connections matching yaml</span>
    <span class="c1"># RPC client-side connection will be $(server_name)_$(client_name)</span>
    <span class="n">ymlfile</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s2">&quot;yaml_in&quot;</span><span class="p">)</span>
    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s2">&quot;rpcFibSrv_rpcFibCli&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s2">&quot;output_log&quot;</span><span class="p">)</span>

    <span class="c1"># Read entire contents of yaml</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">ycontent</span> <span class="o">=</span> <span class="n">ymlfile</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): RECV ERROR&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCli: yaml has </span><span class="si">%d</span><span class="s1"> lines&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycontent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        
        <span class="c1"># Call the server and receive response</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): fib(-&gt;</span><span class="si">%-2d</span><span class="s1">) ::: &#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">fib</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcCall</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): RPC CALL ERROR&#39;</span><span class="p">)</span>

        <span class="c1"># Log result by sending it to the log connection</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;fib(</span><span class="si">%2d</span><span class="s1">&lt;-) = </span><span class="si">%-2d</span><span class="s1">&lt;-</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): SEND ERROR&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python rpcFibCli&#39;</span><span class="p">)</span>

    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">fibClient</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;YggInterface.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">int</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C++ rpcFibCliPar: iterations = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>
  
  <span class="c1">// Create RPC connection with server</span>
  <span class="c1">// RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">YggRpcClient</span> <span class="n">rpc</span><span class="p">(</span><span class="s">&quot;rpcFibSrv_rpcFibCliPar&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>
  
  <span class="c1">// Send all of the requests to the server</span>
  <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP): fib(-&gt;%-2d) ::: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP): SEND FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Receive responses for all requests that were sent</span>
  <span class="kt">int</span> <span class="n">fib</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">fibNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fibNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fib</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP): RECV FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP):  fib(%2d&lt;-) = %-2d&lt;-</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fibNo</span><span class="p">,</span> <span class="n">fib</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C++ rpcFibCliPar</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">float</span> <span class="n">timeSleep</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C rpcFibSrv: sleeptime = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">timeSleep</span><span class="p">);</span>
  
  <span class="c1">// Create server-side rpc conneciton using model name</span>
  <span class="n">yggRpc_t</span> <span class="n">rpc</span> <span class="o">=</span> <span class="n">yggRpcServer</span><span class="p">(</span><span class="s">&quot;rpcFibSrv&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>

  <span class="c1">// Continue receiving requests until error occurs (the connection is closed</span>
  <span class="c1">// by all clients that have connected).</span>
  <span class="kt">int</span> <span class="n">input</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): receiving...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcRecv</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): end of input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Compute fibonacci number</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): &lt;- input %d&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevResult</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevPrev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">idx</span><span class="o">++</span> <span class="o">&lt;</span> <span class="n">input</span><span class="p">){</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">prevResult</span> <span class="o">+</span> <span class="n">prevPrev</span><span class="p">;</span>
      <span class="n">prevPrev</span> <span class="o">=</span> <span class="n">prevResult</span><span class="p">;</span>
      <span class="n">prevResult</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; ::: -&gt;(%2d %2d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>

    <span class="c1">// Sleep and then send response back</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeSleep</span><span class="p">)</span> 
      <span class="n">sleep</span><span class="p">(</span><span class="n">timeSleep</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">rpcSend</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): ERROR sending</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C rpcFibSrv</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PythonModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.py</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_python.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.cpp</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.c</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&#39;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="c-version">
<h2><a class="toc-backref" href="#id4">C Version</a><a class="headerlink" href="#c-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">count_lines</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">substr</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">inc</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">substr</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">str</span><span class="p">;</span> <span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">substr</span><span class="p">));</span> <span class="n">s</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">)</span>
    <span class="n">c</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
   
  <span class="kt">int</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C rpcFibCli: iterations %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>
  
  <span class="c1">// Set up connections matching yaml</span>
  <span class="c1">// RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">yggInput_t</span> <span class="n">ymlfile</span> <span class="o">=</span> <span class="n">yggInput</span><span class="p">(</span><span class="s">&quot;yaml_in&quot;</span><span class="p">);</span>
  <span class="n">yggRpc_t</span> <span class="n">rpc</span> <span class="o">=</span> <span class="n">yggRpcClient</span><span class="p">(</span><span class="s">&quot;rpcFibSrv_rpcFibCli&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>
  <span class="n">yggOutput_t</span> <span class="n">log</span> <span class="o">=</span> <span class="n">yggOutput</span><span class="p">(</span><span class="s">&quot;output_log&quot;</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

  <span class="c1">// Read entire contents of yaml</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ycontent</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">YGG_MSG_MAX</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">ygg_recv</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">ycontent</span><span class="p">,</span> <span class="n">YGG_MSG_MAX</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(C): RECV ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">ycontent</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli: yaml has %d lines</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count_lines</span><span class="p">(</span><span class="n">ycontent</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">ret</span> <span class="o">=</span> <span class="n">ygg_recv</span><span class="p">(</span><span class="n">ymlfile</span><span class="p">,</span> <span class="n">ycontent</span><span class="p">,</span> <span class="n">YGG_MSG_MAX</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">ycontent</span><span class="p">);</span>
  
  <span class="kt">int</span> <span class="n">fib</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">fibNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">logmsg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">YGG_MSG_MAX</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="c1">// Call the server and receive response</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(C): fib(-&gt;%-2d) ::: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcCall</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fibNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fib</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(C): RPC CALL ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
      <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Log result by sending it to the log connection</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">logmsg</span><span class="p">,</span> <span class="s">&quot;fib(%2d&lt;-) = %-2d&lt;-</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fibNo</span><span class="p">,</span> <span class="n">fib</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">logmsg</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ygg_send</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">logmsg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">logmsg</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(C): SEND ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
      <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">free</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C rpcFibCli</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    
<span class="p">}</span>

</pre></div>
</td></tr></table></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">int</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C rpcFibCliPar: iterations = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>
  
  <span class="c1">// Create RPC connection with server</span>
  <span class="c1">// RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">yggRpc_t</span> <span class="n">rpc</span> <span class="o">=</span> <span class="n">yggRpcClient</span><span class="p">(</span><span class="s">&quot;rpcFibSrv_rpcFibCliPar&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>
  
  <span class="c1">// Send all of the requests to the server</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(C): fib(-&gt;%-2d) ::: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcSend</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(C): SEND FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Receive responses for all requests that were sent</span>
  <span class="kt">int</span> <span class="n">fib</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">fibNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcRecv</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fibNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fib</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(C): RECV FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(C):  fib(%2d&lt;-) = %-2d&lt;-</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fibNo</span><span class="p">,</span> <span class="n">fib</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C rpcFibCliPar</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    
<span class="p">}</span>

</pre></div>
</td></tr></table></div>
<div class="highlight-c notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
<span class="cp">#include</span> <span class="cpf">&quot;YggInterface.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">float</span> <span class="n">timeSleep</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C rpcFibSrv: sleeptime = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">timeSleep</span><span class="p">);</span>
  
  <span class="c1">// Create server-side rpc conneciton using model name</span>
  <span class="n">yggRpc_t</span> <span class="n">rpc</span> <span class="o">=</span> <span class="n">yggRpcServer</span><span class="p">(</span><span class="s">&quot;rpcFibSrv&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>

  <span class="c1">// Continue receiving requests until error occurs (the connection is closed</span>
  <span class="c1">// by all clients that have connected).</span>
  <span class="kt">int</span> <span class="n">input</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): receiving...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">rpcRecv</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): end of input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Compute fibonacci number</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): &lt;- input %d&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevResult</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevPrev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">idx</span><span class="o">++</span> <span class="o">&lt;</span> <span class="n">input</span><span class="p">){</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">prevResult</span> <span class="o">+</span> <span class="n">prevPrev</span><span class="p">;</span>
      <span class="n">prevPrev</span> <span class="o">=</span> <span class="n">prevResult</span><span class="p">;</span>
      <span class="n">prevResult</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; ::: -&gt;(%2d %2d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>

    <span class="c1">// Sleep and then send response back</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeSleep</span><span class="p">)</span> 
      <span class="n">sleep</span><span class="p">(</span><span class="n">timeSleep</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">rpcSend</span><span class="p">(</span><span class="n">rpc</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(C): ERROR sending</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C rpcFibSrv</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.c</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_c.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.c</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.c</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&#39;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id5">C++ Version</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;YggInterface.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">count_lines</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">str</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">substr</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">inc</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">substr</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">substr</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">str</span><span class="p">;</span> <span class="p">(</span><span class="n">s</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">substr</span><span class="p">));</span> <span class="n">s</span> <span class="o">+=</span> <span class="n">inc</span><span class="p">)</span>
    <span class="n">c</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
   
  <span class="kt">int</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C++ rpcFibCli: iterations %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>
  
  <span class="c1">// Set up connections matching yaml</span>
  <span class="c1">// RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">YggInput</span> <span class="n">ymlfile</span><span class="p">(</span><span class="s">&quot;yaml_in&quot;</span><span class="p">);</span>
  <span class="n">YggRpcClient</span> <span class="n">rpc</span><span class="p">(</span><span class="s">&quot;rpcFibSrv_rpcFibCli&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>
  <span class="n">YggOutput</span> <span class="n">log</span><span class="p">(</span><span class="s">&quot;output_log&quot;</span><span class="p">);</span>
  
  <span class="c1">// Read entire contents of yaml</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">ycontent</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">YGG_MSG_MAX</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
  <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">ymlfile</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="n">ycontent</span><span class="p">,</span> <span class="n">YGG_MSG_MAX</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(CPP): RECV ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">ycontent</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli: yaml has %d lines</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count_lines</span><span class="p">(</span><span class="n">ycontent</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">ycontent</span><span class="p">);</span>
  
  <span class="kt">int</span> <span class="n">fib</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">fibNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">logmsg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">YGG_MSG_MAX</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="c1">// Call the server and receive response</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(CPP): fib(-&gt;%-2d) ::: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fibNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fib</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(CPP): RPC CALL ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Log result by sending it to the log connection</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">logmsg</span><span class="p">,</span> <span class="s">&quot;fib(%2d&lt;-) = %-2d&lt;-</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fibNo</span><span class="p">,</span> <span class="n">fib</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">log</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">logmsg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">logmsg</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCli(CPP): SEND ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C++ rpcFibCli</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">free</span><span class="p">(</span><span class="n">logmsg</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;YggInterface.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">int</span> <span class="n">iterations</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C++ rpcFibCliPar: iterations = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>
  
  <span class="c1">// Create RPC connection with server</span>
  <span class="c1">// RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">YggRpcClient</span> <span class="n">rpc</span><span class="p">(</span><span class="s">&quot;rpcFibSrv_rpcFibCliPar&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>
  
  <span class="c1">// Send all of the requests to the server</span>
  <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP): fib(-&gt;%-2d) ::: </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP): SEND FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Receive responses for all requests that were sent</span>
  <span class="kt">int</span> <span class="n">fib</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">fibNo</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">iterations</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fibNo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fib</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP): RECV FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibCliPar(CPP):  fib(%2d&lt;-) = %-2d&lt;-</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fibNo</span><span class="p">,</span> <span class="n">fib</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C++ rpcFibCliPar</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-c++ notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;YggInterface.hpp&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>

  <span class="kt">float</span> <span class="n">timeSleep</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C++ rpcFibSrv: sleeptime = %f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">timeSleep</span><span class="p">);</span>
  
  <span class="c1">// Create server-side rpc conneciton using model name</span>
  <span class="n">YggRpcServer</span> <span class="n">rpc</span><span class="p">(</span><span class="s">&quot;rpcFibSrv&quot;</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="s">&quot;%d %d&quot;</span><span class="p">);</span>

  <span class="c1">// Continue receiving requests until error occurs (the connection is closed</span>
  <span class="c1">// by all clients that have connected).</span>
  <span class="kt">int</span> <span class="n">input</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(CPP): receiving...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(CPP): end of input</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Compute fibonacci number</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(CPP): &lt;- input %d&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevResult</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">prevPrev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="n">idx</span><span class="o">++</span> <span class="o">&lt;</span> <span class="n">input</span><span class="p">){</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">prevResult</span> <span class="o">+</span> <span class="n">prevPrev</span><span class="p">;</span>
      <span class="n">prevPrev</span> <span class="o">=</span> <span class="n">prevResult</span><span class="p">;</span>
      <span class="n">prevResult</span> <span class="o">=</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot; ::: -&gt;(%2d %2d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>

    <span class="c1">// Sleep and then send response back</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">timeSleep</span><span class="p">)</span> 
      <span class="n">sleep</span><span class="p">(</span><span class="n">timeSleep</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">flag</span> <span class="o">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;rpcFibSrv(CPP): ERROR sending</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C++ rpcFibSrv</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.cpp</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_cpp.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.cpp</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">GCCModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.cpp</span>
    <span class="p p-Indicator">-</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&#39;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="fortran-version">
<h2><a class="toc-backref" href="#id6">Fortran Version</a><a class="headerlink" href="#fortran-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></div></td><td class="code"><div class="highlight"><pre><span></span>program main
  use fygg

  character(len=32) :: arg
  integer :: iterations
  type(yggcomm) :: ymlfile
  type(yggcomm) :: rpc
  type(yggcomm) :: log
  logical :: ret
  integer, parameter :: msg_len = 2048  ! YGG_MSG_MAX
  character(len=msg_len) :: ycontent
  integer :: fib, fibNo, i, nlines, count_lines
  character(len=msg_len) :: logmsg
  integer :: ycontent_siz, logmsg_siz
  character(len=2) :: fibStr

  call get_command_argument(1, arg)
  read(arg, *) iterations
  write(*, &#39;(&quot;Hello from Fortran rpcFibCli: iterations &quot;,i2)&#39;) iterations

  ! Set up connections matching yaml
  ! RPC client-side connection will be $(server_name)_$(client_name)
  ymlfile = ygg_input(&quot;yaml_in&quot;)
  rpc = ygg_rpc_client(&quot;rpcFibSrv_rpcFibCli&quot;, &quot;%d&quot;, &quot;%d %d&quot;)
  log = ygg_output(&quot;output_log&quot;)

  ! Read entire contents of yaml
  ycontent_siz = len(ycontent)
  ret = ygg_recv(ymlfile, ycontent, ycontent_siz)
  if (.not.ret) then
     write(*, &#39;(&quot;rpcFibCli(F): RECV ERROR&quot;)&#39;)
     stop 1
  end if
  nlines = count_lines(ycontent, new_line(&#39;A&#39;))
  write(*, &#39;(&quot;rpcFibCli: yaml has &quot;,i4,&quot; lines&quot;)&#39;) nlines + 1
  ret = ygg_recv(ymlfile, ycontent, ycontent_siz)

  fib = -1
  fibNo = -1
  do i = 1, iterations

     ! Call the server and receive response
     write(*, &#39;(&quot;rpcFibCli(F): fib(-&gt;&quot;,i2,&quot;) ::: &quot;)&#39;) i
     ret = ygg_rpc_call(rpc, yggarg(i), [yggarg(fibNo), yggarg(fib)])
     if (.not.ret) then
        write(*, &#39;(&quot;rpcFibCli(F): RPC CALL ERROR&quot;)&#39;)
        stop 1
     end if

     ! Log result by sending it to the log connection
     write(fibStr, &#39;(i2)&#39;) fib
     write(logmsg, &#39;(&quot;fib(&quot;,i2,&quot;&lt;-) = &quot;,A,&quot;&lt;-&quot;,A)&#39;) fibNo, &amp;
          adjustl(fibStr), new_line(&#39;A&#39;)
     write(*, &#39;(A)&#39;, advance=&quot;no&quot;) trim(logmsg)
     logmsg_siz = len_trim(logmsg)
     ret = ygg_send(log, logmsg, logmsg_siz)
     if (.not.ret) then
        write(*, &#39;(&quot;rpcFibCli(F): SEND ERROR&quot;)&#39;)
        stop 1
     end if

  end do

  write(*, &#39;(&quot;Goodbye from Fortran rpcFibCli&quot;)&#39;)

end program main

function count_lines(str, substr) result(c)
  implicit none
  character(len=*) :: str
  character(len=*) :: substr
  integer :: c
  integer :: k, inc, idx
  c = 0
  k = 1
  inc = len_trim(substr)
  idx = index(str(k:), substr)
  do while (idx.ne.0)
     c = c + 1
     k = k + inc
     idx = index(str(k:), substr)
  end do
end function count_lines

</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span>program main
  use fygg

  character(len=32) :: arg
  integer :: iterations
  type(yggcomm) :: rpc
  logical :: ret
  integer :: fib, fibNo, i

  call get_command_argument(1, arg)
  read(arg, *) iterations
  write(*, &#39;(&quot;Hello from Fortran rpcFibCliPar: iterations = &quot;,i2)&#39;) &amp;
       iterations

  ! Create RPC connection with server
  ! RPC client-side connection will be $(server_name)_$(client_name)
  rpc = ygg_rpc_client(&quot;rpcFibSrv_rpcFibCliPar&quot;, &quot;%d&quot;, &quot;%d %d&quot;)

  ! Send all of the requests to the server
  do i = 1, iterations
     write(*, &#39;(&quot;rpcFibCliPar(F): fib(-&gt;&quot;,i2,&quot;) ::: &quot;)&#39;) i
     ret = ygg_send_var(rpc, yggarg(i))
     if (.not.ret) then
        write(*, &#39;(&quot;rpcFibCliPar(F): SEND FAILED&quot;)&#39;)
        stop 1
     end if
  end do

  ! Receive responses for all requests that were sent
  fib = -1
  fibNo = -1
  do i = 1, iterations
     ret = ygg_recv_var(rpc, [yggarg(fibNo), yggarg(fib)])
     if (.not.ret) then
        write(*, &#39;(&quot;rpcFibCliPar(F): RECV FAILED&quot;)&#39;)
        stop 1
     end if
     write(*, &#39;(&quot;rpcFibCliPar(F):  fib(&quot;,i2,&quot;&lt;-) = &quot;,i2,&quot;&lt;-&quot;)&#39;) &amp;
          fibNo, fib
  end do

  write(*, &#39;(&quot;Goodbye from Fortran rpcFibCliPar&quot;)&#39;)

end program main
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="highlight"><pre><span></span>program main
  use fygg

  type(yggcomm) :: rpc
  character(len=32) :: arg
  real :: time_sleep
  integer :: input
  integer :: result0, prevResult, prevPrev, idx
  logical :: ret

  call get_command_argument(1, arg)
  read(arg, *) time_sleep
  write(*, &#39;(&quot;Hello from Fortran rpcFibSrv: sleeptime = &quot;,f10.4)&#39;) time_sleep

  ! Create server-side rpc conneciton using model name
  rpc = ygg_rpc_server(&quot;rpcFibSrv&quot;, &quot;%d&quot;, &quot;%d %d&quot;)

  ! Continue receiving requests until error occurs (the connection is
  ! closed by all clients that have connected).
  do while (.true.)
     write(*, &#39;(&quot;rpcFibSrv(F): receiving...&quot;)&#39;)

     ret = ygg_recv_var(rpc, yggarg(input))
     if (.not.ret) then
        write(*, &#39;(&quot;rpcFibSrv(F): end of input&quot;)&#39;)
        exit
     end if

     ! Compute fibonacci number
     result0 = 1
     prevResult = 1
     prevPrev = 0
     idx = 1
     do while (idx.lt.input)
        result0 = prevResult + prevPrev
        prevPrev = prevResult
        prevResult = result0
        idx = idx + 1
     end do
     write(*, &#39;(&quot;rpcFibSrv(F): &lt;- input &quot;,i2,&quot; ::: -&gt;(&quot;,i2,&quot; &quot;,i2,&quot;)&quot;)&#39;) &amp;
          input, input, result0

     ! Sleep and then send response back
     if (time_sleep.gt.0) call fsleep(int(time_sleep))
     ret = ygg_send_var(rpc, [yggarg(input), yggarg(result0)])
     if (.not.ret) then
        write(*, &#39;(&quot;rpcFibSrv(F): ERROR sending&quot;)&#39;)
        exit
     end if

  end do

  write(*, &#39;(&quot;Goodbye from Fortran rpcFibSrv&quot;)&#39;)

end program main
</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FortranModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.f90</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_fortran.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FortranModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.f90</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FortranModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.f90</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&quot;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="matlab-version">
<h2><a class="toc-backref" href="#id7">Matlab Version</a><a class="headerlink" href="#matlab-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">rpcFibCli</span><span class="p">(</span>iterations<span class="p">)</span><span class="w"></span>
<span class="w">  </span>
<span class="w">  </span><span class="n">iterations</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">iterations</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Hello from Matlab rpcFibCli: iterations = %d\n&#39;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>

  <span class="c">% Set up connections matching yaml</span>
  <span class="c">% RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">ymlfile</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggInput&#39;</span><span class="p">,</span> <span class="s">&#39;yaml_in&#39;</span><span class="p">);</span>
  <span class="n">rpc</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggRpcClient&#39;</span><span class="p">,</span> <span class="s">&#39;rpcFibSrv_rpcFibCli&#39;</span><span class="p">,</span> <span class="s">&#39;%d&#39;</span><span class="p">,</span> <span class="s">&#39;%d %d&#39;</span><span class="p">);</span>
  <span class="nb">log</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggOutput&#39;</span><span class="p">,</span> <span class="s">&#39;output_log&#39;</span><span class="p">);</span>

  <span class="c">% Read entire contents of yaml</span>
  <span class="p">[</span><span class="n">ret</span><span class="p">,</span> <span class="n">ycontent</span><span class="p">]</span> <span class="p">=</span> <span class="n">ymlfile</span><span class="p">.</span><span class="n">recv</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
    <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCli(M): RECV ERROR&#39;</span><span class="p">);</span>
  <span class="k">end</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCli: yaml has %d lines\n&#39;</span><span class="p">,</span> <span class="c">...</span>
	  <span class="nb">length</span><span class="p">(</span><span class="n">strsplit</span><span class="p">(</span><span class="n">ycontent</span><span class="p">,</span> <span class="s">&#39;\n&#39;</span><span class="p">,</span> <span class="s">&#39;CollapseDelimiters&#39;</span><span class="p">,</span> <span class="n">false</span><span class="p">)));</span>

  <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">iterations</span>
    
    <span class="c">% Call the server and receive response</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCli(M):  fib(-&gt;%-2d) ::: &#39;</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span>
    <span class="p">[</span><span class="n">ret</span><span class="p">,</span> <span class="n">fib</span><span class="p">]</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">int32</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCli(M): RPC CALL ERROR&#39;</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="c">% Log result by sending it to the log connection</span>
    <span class="n">s</span> <span class="p">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="s">&#39;fib(%2d&lt;-) = %-2d&lt;-\n&#39;</span><span class="p">,</span> <span class="n">fib</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">fib</span><span class="p">{</span><span class="mi">2</span><span class="p">});</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="n">ret</span> <span class="p">=</span> <span class="nb">log</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCli(M): SEND ERROR&#39;</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Goodbye from Matlab rpcFibCli&#39;</span><span class="p">);</span>
  <span class="k">return</span><span class="p">;</span>
  
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">rpcFibCliPar</span><span class="p">(</span>iterations<span class="p">)</span><span class="w"></span>

<span class="w">  </span><span class="n">iterations</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">iterations</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Hello from Matlab rpcFibCliPar: iterations = %d\n&#39;</span><span class="p">,</span> <span class="n">iterations</span><span class="p">);</span>

  <span class="c">% Create RPC connection with serover</span>
  <span class="c">% RPC client-side connection will be $(server_name)_$(client_name)</span>
  <span class="n">rpc</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggRpcClient&#39;</span><span class="p">,</span> <span class="s">&#39;rpcFibSrv_rpcFibCliPar&#39;</span><span class="p">,</span> <span class="s">&#39;%d&#39;</span><span class="p">,</span> <span class="s">&#39;%d %d&#39;</span><span class="p">);</span>

  <span class="c">% Send all of the requests to the server</span>
  <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">iterations</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): fib(-&gt;%-2d) ::: \n&#39;</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span>
    <span class="n">ret</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">int32</span><span class="p">(</span><span class="nb">i</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): SEND FAILED&#39;</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="c">% Receive responses for all requests that were sent</span>
  <span class="k">for</span> <span class="nb">i</span> <span class="p">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">iterations</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): fib(-&gt;%-2d) ::: &#39;</span><span class="p">,</span> <span class="nb">i</span><span class="p">);</span>
    <span class="p">[</span><span class="n">ret</span><span class="p">,</span> <span class="n">fib</span><span class="p">]</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">recv</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): RECV FAILED&#39;</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibCliPar(M): fib(%2d&lt;-) = %-2d&lt;-\n&#39;</span><span class="p">,</span> <span class="n">fib</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">fib</span><span class="p">{</span><span class="mi">2</span><span class="p">});</span>
  <span class="k">end</span>

  <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Goodbye from Matlab rpcFibCliPar&#39;</span><span class="p">);</span>
  
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-matlab notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">rpcFibSrv</span><span class="p">(</span>sleeptime<span class="p">)</span><span class="w"></span>
<span class="w">  </span>
<span class="w">  </span><span class="n">sleeptime</span> <span class="p">=</span> <span class="n">str2num</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">);</span>
  <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;Hello from Matlab rpcFibSrv: sleeptime = %f\n&#39;</span><span class="p">,</span> <span class="n">sleeptime</span><span class="p">);</span>

  <span class="c">% Create server-side rpc conneciton using model name</span>
  <span class="n">rpc</span> <span class="p">=</span> <span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggRpcServer&#39;</span><span class="p">,</span> <span class="s">&#39;rpcFibSrv&#39;</span><span class="p">,</span> <span class="s">&#39;%d&#39;</span><span class="p">,</span> <span class="s">&#39;%d %d&#39;</span><span class="p">);</span>

  <span class="c">% Continue receiving requests until error occurs (the connection is closed</span>
  <span class="c">% by all clients that have connected).</span>
  <span class="k">while</span> <span class="mi">1</span>
    <span class="p">[</span><span class="n">flag</span><span class="p">,</span> <span class="n">input</span><span class="p">]</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">recv</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">flag</span><span class="p">);</span>
      <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibSrv(M): end of input&#39;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="k">end</span>

    <span class="c">% Compute fibonacci number</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39;rpcFibSrv(M): &lt;- input %d&#39;</span><span class="p">,</span> <span class="n">input</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span>
    <span class="n">pprev</span> <span class="p">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">prev</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">result</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">n</span> <span class="p">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">input</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
      <span class="n">result</span> <span class="p">=</span> <span class="n">prev</span> <span class="o">+</span> <span class="n">pprev</span><span class="p">;</span>
      <span class="n">pprev</span> <span class="p">=</span> <span class="n">prev</span><span class="p">;</span>
      <span class="n">prev</span> <span class="p">=</span> <span class="n">result</span><span class="p">;</span>
      <span class="n">n</span> <span class="p">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="s">&#39; ::: -&gt;(%2d %2d)\n&#39;</span><span class="p">,</span> <span class="n">input</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">result</span><span class="p">);</span>

    <span class="c">% Sleep and then send response back</span>
    <span class="n">pause</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">);</span>
    <span class="n">flag</span> <span class="p">=</span> <span class="n">rpc</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">input</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span> <span class="n">int32</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="n">flag</span><span class="p">);</span>
      <span class="n">error</span><span class="p">(</span><span class="s">&#39;rpcFibSrv(M): ERROR sending&#39;</span><span class="p">);</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Goodbye from Matlab rpcFibSrv&#39;</span><span class="p">);</span>

<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MatlabModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.m</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_matlab.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MatlabModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.m</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
 
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MatlabModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.m</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&quot;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="python-version">
<h2><a class="toc-backref" href="#id8">Python Version</a><a class="headerlink" href="#python-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">YggRpcClient</span><span class="p">,</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">fibClient</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    
    <span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python rpcFibCli: iterations = </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">iterations</span><span class="p">)</span>

    <span class="c1"># Set up connections matching yaml</span>
    <span class="c1"># RPC client-side connection will be $(server_name)_$(client_name)</span>
    <span class="n">ymlfile</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s2">&quot;yaml_in&quot;</span><span class="p">)</span>
    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s2">&quot;rpcFibSrv_rpcFibCli&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s2">&quot;output_log&quot;</span><span class="p">)</span>

    <span class="c1"># Read entire contents of yaml</span>
    <span class="n">ret</span><span class="p">,</span> <span class="n">ycontent</span> <span class="o">=</span> <span class="n">ymlfile</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): RECV ERROR&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCli: yaml has </span><span class="si">%d</span><span class="s1"> lines&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">ycontent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        
        <span class="c1"># Call the server and receive response</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): fib(-&gt;</span><span class="si">%-2d</span><span class="s1">) ::: &#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">fib</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcCall</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): RPC CALL ERROR&#39;</span><span class="p">)</span>

        <span class="c1"># Log result by sending it to the log connection</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;fib(</span><span class="si">%2d</span><span class="s1">&lt;-) = </span><span class="si">%-2d</span><span class="s1">&lt;-</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCli(P): SEND ERROR&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python rpcFibCli&#39;</span><span class="p">)</span>

    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">fibClient</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="n">YggRpcClient</span>


<span class="k">def</span> <span class="nf">fibClient</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    
    <span class="n">iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python rpcFibCliPar: iterations = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">iterations</span><span class="p">)</span>

    <span class="c1"># Create RPC connection with server</span>
    <span class="c1"># RPC client-side connection will be $(server_name)_$(client_name)</span>
    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s2">&quot;rpcFibSrv_rpcFibCliPar&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Send all of the requests to the server</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCliPar(P): fib(-&gt;</span><span class="si">%-2d</span><span class="s1">) ::: &#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcSend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCliPar(P): SEND FAILED&#39;</span><span class="p">)</span>

    <span class="c1"># Receive responses for all requests that were sent</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">ret</span><span class="p">,</span> <span class="n">fib</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcRecv</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibCliPar(P): RECV FAILED&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibCliPar(P): fib(</span><span class="si">%2d</span><span class="s1">&lt;-) = </span><span class="si">%-2d</span><span class="s1">&lt;-&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fib</span><span class="p">))</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python rpcFibCliPar&#39;</span><span class="p">)</span>

    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">fibClient</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="n">YggRpcServer</span>
<span class="kn">from</span> <span class="nn">yggdrasil.tools</span> <span class="kn">import</span> <span class="n">sleep</span>


<span class="k">def</span> <span class="nf">fibServer</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>

    <span class="n">sleeptime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python rpcFibSrv: sleeptime = </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sleeptime</span><span class="p">)</span>

    <span class="c1"># Create server-side rpc conneciton using model name</span>
    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcServer</span><span class="p">(</span><span class="s2">&quot;rpcFibSrv&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Continue receiving requests until error occurs (the connection is closed</span>
    <span class="c1"># by all clients that have connected).</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibSrv(P): receiving...&#39;</span><span class="p">)</span>
        <span class="n">retval</span><span class="p">,</span> <span class="n">rpc_in</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcRecv</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibSrv(P): end of input&#39;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="c1"># Compute fibonacci number</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;rpcFibSrv(P): &lt;- input </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rpc_in</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">pprev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">fib_no</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">rpc_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">fib_no</span> <span class="o">&lt;</span> <span class="n">arg</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">+</span> <span class="n">pprev</span>
            <span class="n">pprev</span> <span class="o">=</span> <span class="n">prev</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">fib_no</span> <span class="o">=</span> <span class="n">fib_no</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39; ::: -&gt;(</span><span class="si">%2d</span><span class="s1"> </span><span class="si">%2d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

        <span class="c1"># Sleep and then send response back</span>
        <span class="n">sleep</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sleeptime</span><span class="p">))</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">rpcSend</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;rpcFibSrv(P): ERROR sending&#39;</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python rpcFibSrv&#39;</span><span class="p">)</span>

    
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">fibServer</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PythonModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.py</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_python.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PythonModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.py</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PythonModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.py</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&quot;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="r-version">
<h2><a class="toc-backref" href="#id9">R Version</a><a class="headerlink" href="#r-version" title="Permalink to this headline">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span></span>library(yggdrasil)


fibClient &lt;- function(args) {
    
  iterations &lt;- strtoi(args[[1]])
  fprintf(&#39;Hello from R rpcFibCli: iterations = %d &#39;, iterations)

  # Set up connections matching yaml
  # RPC client-side connection will be $(server_name)_$(client_name)
  ymlfile &lt;- YggInterface(&#39;YggInput&#39;, &quot;yaml_in&quot;)
  rpc &lt;- YggInterface(&#39;YggRpcClient&#39;, &quot;rpcFibSrv_rpcFibCli&quot;, &quot;%d&quot;, &quot;%d %d&quot;)
  log &lt;- YggInterface(&#39;YggOutput&#39;, &quot;output_log&quot;)

  # Read entire contents of yaml
  c(ret, ycontent) %&lt;-% ymlfile$recv()
  if (!ret) {
    stop(&#39;rpcFibCli(R): RECV ERROR&#39;)
  }
  fprintf(&#39;rpcFibCli: yaml has %d lines&#39;, length(strsplit(ycontent, &#39;\n&#39;)))

  for (i in 1:iterations) {
        
    # Call the server and receive response
    fprintf(&#39;rpcFibCli(R): fib(-&gt;%-2d) ::: &#39;, i)
    c(ret, fib) %&lt;-% rpc$call(as.integer(i))
    if (!ret) {
      stop(&#39;rpcFibCli(R): RPC CALL ERROR&#39;)
    }

    # Log result by sending it to the log connection
    s &lt;- sprintf(&#39;fib(%2d&lt;-) = %-2d&lt;-\n&#39;, fib[[1]], fib[[2]])
    print(s)
    ret &lt;- log$send(s)
    if (!ret) {
      stop(&#39;rpcFibCli(R): SEND ERROR&#39;)
    }
  }

  print(&#39;Goodbye from R rpcFibCli&#39;)
}

    
args &lt;- commandArgs(trailingOnly=TRUE)
fibClient(args)
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="highlight"><pre><span></span>library(yggdrasil)


fibClientPar &lt;- function(args) {
    
  iterations &lt;- strtoi(args[[1]])
  fprintf(&#39;Hello from R rpcFibCliPar: iterations = %d &#39;, iterations)
  
  # Create RPC connection with server
  # RPC client-side connection will be $(server_name)_$(client_name)
  rpc &lt;- YggInterface(&#39;YggRpcClient&#39;, &quot;rpcFibSrv_rpcFibCliPar&quot;, &quot;%d&quot;, &quot;%d %d&quot;)

  # Send all of the requests to the server
  for (i in 1:iterations) {
    fprintf(&#39;rpcFibCliPar(R): fib(-&gt;%-2d) ::: &#39;, i)
    ret &lt;- rpc$send(as.integer(i))
    if (!ret) {
      stop(&#39;rpcFibCliPar(R): SEND FAILED&#39;)
    }
  }
  
  # Receive responses for all requests that were sent
  for (i in 1:iterations) {
    c(ret, fib) %&lt;-% rpc$recv()
    if (!ret) {
      stop(&#39;rpcFibCliPar(R): RECV FAILED&#39;)
    }
    fprintf(&#39;rpcFibCliPar(R): fib(%2d&lt;-) = %-2d&lt;-&#39;, fib[[1]], fib[[2]])
  }

  print(&#39;Goodbye from R rpcFibCliPar&#39;)
}


args &lt;- commandArgs(trailingOnly=TRUE)
fibClientPar(args)
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre><span></span>library(yggdrasil)


fibServer &lt;- function(args) {

  sleeptime &lt;- as.double(args[[1]])
  fprintf(&#39;Hello from R rpcFibSrv: sleeptime = %f&#39;, sleeptime)

  # Create server-side rpc conneciton using model name
  rpc &lt;- YggInterface(&#39;YggRpcServer&#39;, &quot;rpcFibSrv&quot;, &quot;%d&quot;, &quot;%d %d&quot;)

  # Continue receiving requests until error occurs (the connection is closed
  # by all clients that have connected).
  while (TRUE) {
    print(&#39;rpcFibSrv(R): receiving...&#39;)
    c(retval, rpc_in) %&lt;-% rpc$recv()
    if (!retval) {
      print(&#39;rpcFibSrv(R): end of input&#39;)
      break
    }

    # Compute fibonacci number
    fprintf(&#39;rpcFibSrv(R): &lt;- input %d&#39;, rpc_in[[1]])
    pprev &lt;- 0
    prev &lt;- 1
    result &lt;- 1
    fib_no &lt;- 1
    arg &lt;- rpc_in[[1]]
    while (fib_no &lt; arg) {
      result &lt;- prev + pprev
      pprev &lt;- prev
      prev &lt;- result
      fib_no &lt;- fib_no + 1
    }
    fprintf(&#39; ::: -&gt;(%2d %2d)&#39;, arg, result)

    # Sleep and then send response back
    Sys.sleep(sleeptime)
    flag &lt;- rpc$send(arg, as.integer(result))
    if (!flag) {
      stop(&#39;rpcFibSrv(R): ERROR sending&#39;)
    }
  }
  print(&#39;Goodbye from R rpcFibSrv&#39;)

}

args = commandArgs(trailingOnly=TRUE)
fibServer(args)
</pre></div>
</td></tr></table></div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCli.R</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var passed as argument for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>

  <span class="nt">outputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileOutputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fibCli.txt</span>
      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>

  <span class="nt">inputs</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml_in</span>
      <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FileInputDriver</span>
      <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCli_r.yml</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibCliPar</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibCliPar.R</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_ITERATIONS</span><span class="nv"> </span><span class="s">}}&quot;</span>   <span class="c1"># env_var for number of loops</span>
  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>  <span class="c1"># Creates an RPC client queue $(client_of)_$(name)</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>

<span class="nt">model</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">rpcFibSrv</span>
  <span class="nt">driver</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RModelDriver</span>
  <span class="nt">args</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/rpcFibSrv.R</span>
    <span class="p p-Indicator">-</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">FIB_SERVER_SLEEP_SECONDS</span><span class="nv"> </span><span class="s">}}&quot;</span>    <span class="c1"># env var - time to sleep before returning</span>
  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC queue called $name</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>