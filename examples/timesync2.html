<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>timesync2 &mdash; yggdrasil v1.9.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            yggdrasil
          </a>
              <div class="version">
                v1.9.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line Interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hpc.html">High Performance Computing (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../remote.html">Running Integrations as Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">Docker Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">yggdrasil</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">timesync2</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/examples/timesync2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="timesync2">
<span id="timesync2-rst"></span><h1>timesync2<a class="headerlink" href="#timesync2" title="Permalink to this heading">¶</a></h1>
<p>Two models, A &amp; B, run simulations over time and exchange data via a timestep synchronization communication pattern. The timesync model <cite>statesync</cite> is explicit in the YAML and allows for specific control of the synchronization (e.g. relationship between variables, interpolation, aggregation). The models compute different variables, have different timesteps, and output data at each time step to a file. This example demonstrates more advanced use of the timesync communication pattern and YAML parameters.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#c-version" id="id2">C Version</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id3">C++ Version</a></p></li>
<li><p><a class="reference internal" href="#fortran-version" id="id4">Fortran Version</a></p></li>
<li><p><a class="reference internal" href="#julia-version" id="id5">Julia Version</a></p></li>
<li><p><a class="reference internal" href="#matlab-version" id="id6">Matlab Version</a></p></li>
<li><p><a class="reference internal" href="#python-version" id="id7">Python Version</a></p></li>
<li><p><a class="reference internal" href="#r-version" id="id8">R Version</a></p></li>
</ul>
</nav>
<section id="c-version">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">C Version</a><a class="headerlink" href="#c-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#define _USE_MATH_DEFINES  </span><span class="c1">// Required to use M_PI with MSVC</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.h&quot;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kt">int</span><span class="w"> </span><span class="nf">timestep_calc</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t_units</span><span class="p">,</span><span class="w"> </span><span class="n">generic_t</span><span class="w"> </span><span class="n">state</span><span class="p">,</span>
<span class="linenos">  8</span><span class="w">		  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">  9</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">x_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Days</span>
<span class="linenos"> 10</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">y_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Days</span>
<span class="linenos"> 11</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">z_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">20.0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Days</span>
<span class="linenos"> 12</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">o_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.5</span><span class="p">;</span><span class="w">  </span><span class="c1">// Days</span>
<span class="linenos"> 13</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 14</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t_units</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;day&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="c1">// No conversion necessary</span>
<span class="linenos"> 16</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t_units</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hr&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 17</span><span class="w">    </span><span class="n">x_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_period</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24.0</span><span class="p">;</span>
<span class="linenos"> 18</span><span class="w">    </span><span class="n">y_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_period</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24.0</span><span class="p">;</span>
<span class="linenos"> 19</span><span class="w">    </span><span class="n">z_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">z_period</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24.0</span><span class="p">;</span>
<span class="linenos"> 20</span><span class="w">    </span><span class="n">o_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">o_period</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24.0</span><span class="p">;</span>
<span class="linenos"> 21</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timestep_calc: Unsupported unit &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 23</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 24</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 27</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">,</span>
<span class="linenos"> 28</span><span class="w">				   </span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_period</span><span class="p">),</span>
<span class="linenos"> 29</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 30</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;y&quot;</span><span class="p">,</span>
<span class="linenos"> 31</span><span class="w">				   </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y_period</span><span class="p">),</span>
<span class="linenos"> 32</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 33</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z1&quot;</span><span class="p">,</span>
<span class="linenos"> 34</span><span class="w">				   </span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">z_period</span><span class="p">),</span>
<span class="linenos"> 35</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 36</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z2&quot;</span><span class="p">,</span>
<span class="linenos"> 37</span><span class="w">				   </span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">z_period</span><span class="p">),</span>
<span class="linenos"> 38</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 39</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p">,</span>
<span class="linenos"> 40</span><span class="w">				   </span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">o_period</span><span class="p">),</span>
<span class="linenos"> 41</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 42</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 43</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;xvar&quot;</span><span class="p">,</span>
<span class="linenos"> 44</span><span class="w">				   </span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_period</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
<span class="linenos"> 45</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 46</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;yvar&quot;</span><span class="p">,</span>
<span class="linenos"> 47</span><span class="w">				   </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y_period</span><span class="p">),</span>
<span class="linenos"> 48</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 49</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;z&quot;</span><span class="p">,</span>
<span class="linenos"> 50</span><span class="w">				   </span><span class="mf">-2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">z_period</span><span class="p">),</span>
<span class="linenos"> 51</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 52</span><span class="w">      </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;b&quot;</span><span class="p">,</span>
<span class="linenos"> 53</span><span class="w">				   </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">o_period</span><span class="p">),</span>
<span class="linenos"> 54</span><span class="w">				   </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="linenos"> 55</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 57</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="linenos"> 58</span><span class="p">}</span>
<span class="linenos"> 59</span>
<span class="linenos"> 60</span>
<span class="linenos"> 61</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 62</span>
<span class="linenos"> 63</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="linenos"> 64</span><span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t_units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos"> 65</span><span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="linenos"> 66</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">exit_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos"> 67</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from C timesync: timestep %f %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_step</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0</span><span class="p">;</span>
<span class="linenos"> 70</span><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">nkeys</span><span class="p">,</span><span class="w"> </span><span class="n">ikey</span><span class="p">;</span>
<span class="linenos"> 71</span><span class="w">  </span><span class="kt">char</span><span class="o">**</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span>
<span class="linenos"> 72</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">t_units</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hr&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 73</span><span class="w">    </span><span class="n">t_end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">24.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t_end</span><span class="p">;</span>
<span class="linenos"> 74</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 75</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="linenos"> 76</span><span class="w">  </span><span class="n">generic_t</span><span class="w"> </span><span class="n">state_send</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_generic_map</span><span class="p">();</span>
<span class="linenos"> 77</span><span class="w">  </span><span class="n">generic_t</span><span class="w"> </span><span class="n">state_recv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">init_generic_map</span><span class="p">();</span>
<span class="linenos"> 78</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">,</span><span class="w"> </span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 80</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Error in initial timestep calculation.&quot;</span><span class="p">);</span>
<span class="linenos"> 81</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 82</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span><span class="w">  </span><span class="c1">// Set up connections matching yaml</span>
<span class="linenos"> 85</span><span class="w">  </span><span class="c1">// Timestep synchronization connection will be &#39;statesync&#39;</span>
<span class="linenos"> 86</span><span class="w">  </span><span class="n">comm_t</span><span class="o">*</span><span class="w"> </span><span class="n">timesync</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggTimesync</span><span class="p">(</span><span class="s">&quot;statesync&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 87</span><span class="w">  </span><span class="n">dtype_t</span><span class="o">*</span><span class="w"> </span><span class="n">out_dtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_dtype_json_object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="linenos"> 88</span><span class="w">  </span><span class="n">comm_t</span><span class="o">*</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggOutputType</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out_dtype</span><span class="p">);</span>
<span class="linenos"> 89</span>
<span class="linenos"> 90</span><span class="w">  </span><span class="c1">// Initialize state and synchronize with other models</span>
<span class="linenos"> 91</span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_start</span><span class="p">;</span>
<span class="linenos"> 92</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpcCall</span><span class="p">(</span><span class="n">timesync</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos"> 93</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 94</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Initial sync failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos"> 95</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 96</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 97</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): t = %5.1f %-3s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="n">nkeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_get_keys</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keys</span><span class="p">);</span>
<span class="linenos"> 99</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ikey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ikey</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nkeys</span><span class="p">;</span><span class="w"> </span><span class="n">ikey</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">100</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, %s = %+ 5.2f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">],</span>
<span class="linenos">101</span><span class="w">	   </span><span class="n">generic_map_get_double</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span><span class="w"> </span><span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">]));</span>
<span class="linenos">102</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">103</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">104</span>
<span class="linenos">105</span><span class="w">  </span><span class="c1">// Send initial state to output</span>
<span class="linenos">106</span><span class="w">  </span><span class="n">generic_t</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy_generic</span><span class="p">(</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos">107</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos">108</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">109</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Failed to set time in initial output map.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">110</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">111</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">112</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggSend</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">113</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">114</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Failed to send initial output for t=%f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="linenos">115</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">116</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">117</span><span class="w">  </span><span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">118</span>
<span class="linenos">119</span><span class="w">  </span><span class="c1">// Iterate until end</span>
<span class="linenos">120</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t_end</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">121</span>
<span class="linenos">122</span><span class="w">    </span><span class="c1">// Perform calculations to update the state</span>
<span class="linenos">123</span><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t_step</span><span class="p">;</span>
<span class="linenos">124</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">,</span><span class="w"> </span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="linenos">125</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">126</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Error in timestep calculation for t = %f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="linenos">127</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">128</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">129</span>
<span class="linenos">130</span><span class="w">    </span><span class="c1">// Synchronize the state</span>
<span class="linenos">131</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rpcCall</span><span class="p">(</span><span class="n">timesync</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos">132</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">133</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): sync for t=%f failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="linenos">134</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">135</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">136</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): t = %5.1f %-3s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos">137</span><span class="w">    </span><span class="n">nkeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_get_keys</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">keys</span><span class="p">);</span>
<span class="linenos">138</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ikey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ikey</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nkeys</span><span class="p">;</span><span class="w"> </span><span class="n">ikey</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">139</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;, %s = %+ 5.2f&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">],</span>
<span class="linenos">140</span><span class="w">	     </span><span class="n">generic_map_get_double</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span><span class="w"> </span><span class="n">keys</span><span class="p">[</span><span class="n">ikey</span><span class="p">]));</span>
<span class="linenos">141</span><span class="w">	</span><span class="p">}</span>
<span class="linenos">142</span><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">143</span>
<span class="linenos">144</span><span class="w">    </span><span class="c1">// Send output</span>
<span class="linenos">145</span><span class="w">    </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">copy_generic</span><span class="p">(</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos">146</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generic_map_set_double</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos">147</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">148</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Failed to set time in output map.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">149</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">150</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">151</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yggSend</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">152</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">153</span><span class="w">      </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;timesync(C): Failed to send output for t=%f.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<span class="linenos">154</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">155</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">156</span><span class="w">    </span><span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">157</span>
<span class="linenos">158</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">159</span>
<span class="linenos">160</span><span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Goodbye from C timesync</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="linenos">161</span><span class="w">  </span><span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state_send</span><span class="p">);</span>
<span class="linenos">162</span><span class="w">  </span><span class="n">destroy_generic</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos">163</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">164</span><span class="w">    </span>
<span class="linenos">165</span><span class="p">}</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.c</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.c</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">C++ Version</a><a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="cp">#define _USE_MATH_DEFINES  </span><span class="c1">// Required to use M_PI with MSVC</span>
<span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;math.h&gt;</span>
<span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;YggInterface.hpp&quot;</span>
<span class="linenos">  5</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span><span class="kt">void</span><span class="w"> </span><span class="nf">timestep_calc</span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">,</span>
<span class="linenos">  8</span><span class="w">		   </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">  9</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x_period</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;days&quot;</span><span class="p">);</span>
<span class="linenos"> 10</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y_period</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;days&quot;</span><span class="p">);</span>
<span class="linenos"> 11</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">z_period</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;days&quot;</span><span class="p">);</span>
<span class="linenos"> 12</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">o_period</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;days&quot;</span><span class="p">);</span>
<span class="linenos"> 13</span><span class="cp">#define SET_(key, val)				\</span>
<span class="linenos"> 14</span><span class="cp">  if (!state.HasMember(key))			\</span>
<span class="linenos"> 15</span><span class="cp">    state.AddMember(key, rapidjson::Value(val).Move(),	\</span>
<span class="linenos"> 16</span><span class="cp">		    state.GetAllocator());		\</span>
<span class="linenos"> 17</span><span class="cp">  else							\</span>
<span class="linenos"> 18</span><span class="cp">    state[key].SetDouble(val)</span>
<span class="linenos"> 19</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 20</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 21</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 22</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;z1&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">z_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 23</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;z2&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">z_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 24</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">o_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 25</span><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;xvar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x_period</span><span class="p">).</span><span class="n">value</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">);</span>
<span class="linenos"> 27</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;yvar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">y_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">-2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">z_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 29</span><span class="w">    </span><span class="n">SET_</span><span class="p">(</span><span class="s">&quot;b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">o_period</span><span class="p">).</span><span class="n">value</span><span class="p">()));</span>
<span class="linenos"> 30</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 31</span><span class="p">}</span>
<span class="linenos"> 32</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">argv</span><span class="p">[])</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 35</span>
<span class="linenos"> 36</span><span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">t_units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="linenos"> 37</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t_step</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 38</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello from C++ timesync: timestep &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t_step</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 39</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t_start</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 40</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t_end</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;days&quot;</span><span class="p">);</span>
<span class="linenos"> 41</span><span class="w">  </span>
<span class="linenos"> 42</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">model</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
<span class="linenos"> 43</span><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="linenos"> 44</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="n">state_send</span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">kObjectType</span><span class="p">);</span>
<span class="linenos"> 45</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="n">state_recv</span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">kObjectType</span><span class="p">);</span>
<span class="linenos"> 46</span><span class="w">  </span><span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span><span class="w"> </span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="linenos"> 47</span>
<span class="linenos"> 48</span><span class="w">  </span><span class="c1">// Set up connections matching yaml</span>
<span class="linenos"> 49</span><span class="w">  </span><span class="c1">// Timestep synchronization connection will be &#39;statesync&#39;</span>
<span class="linenos"> 50</span><span class="w">  </span><span class="n">YggTimesync</span><span class="w"> </span><span class="n">timesync</span><span class="p">(</span><span class="s">&quot;statesync&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 51</span><span class="w">  </span><span class="n">dtype_t</span><span class="o">*</span><span class="w"> </span><span class="n">out_dtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_dtype_json_object</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<span class="linenos"> 52</span><span class="w">  </span><span class="n">YggOutput</span><span class="w"> </span><span class="n">out</span><span class="p">(</span><span class="s">&quot;output&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">out_dtype</span><span class="p">);</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span><span class="w">  </span><span class="c1">// Initialize state and synchronize with other models</span>
<span class="linenos"> 55</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">units</span><span class="o">::</span><span class="n">Quantity</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t_start</span><span class="p">;</span>
<span class="linenos"> 56</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos"> 57</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 58</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;timesync(C++): Initial sync failed.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 60</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 61</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;timesync(C++): t = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos"> 62</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">MemberIterator</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_recv</span><span class="p">.</span><span class="n">MemberBegin</span><span class="p">();</span>
<span class="linenos"> 63</span><span class="w">       </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">state_recv</span><span class="p">.</span><span class="n">MemberEnd</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 64</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">GetString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span>
<span class="linenos"> 65</span><span class="w">      </span><span class="s">&quot; = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">GetDouble</span><span class="p">();</span>
<span class="linenos"> 66</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 67</span>
<span class="linenos"> 68</span><span class="w">  </span><span class="c1">// Send initial state to output</span>
<span class="linenos"> 69</span><span class="w">  </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Document</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="linenos"> 70</span><span class="w">  </span><span class="n">msg</span><span class="p">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">GetAllocator</span><span class="p">());</span>
<span class="linenos"> 71</span><span class="w">  </span><span class="n">msg</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Value</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="n">Move</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">GetAllocator</span><span class="p">());</span>
<span class="linenos"> 72</span><span class="w">  </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos"> 73</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 74</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;timesync(C++): Failed to send initial output for t=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span>
<span class="linenos"> 75</span><span class="w">      </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 76</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 77</span><span class="w">  </span><span class="p">}</span>
<span class="linenos"> 78</span>
<span class="linenos"> 79</span><span class="w">  </span><span class="c1">// Iterate until end</span>
<span class="linenos"> 80</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">t_end</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span><span class="w">    </span><span class="c1">// Perform calculations to update the state</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t_step</span><span class="p">;</span>
<span class="linenos"> 84</span><span class="w">    </span><span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span><span class="w">    </span><span class="c1">// Synchronize the state</span>
<span class="linenos"> 87</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state_send</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">state_recv</span><span class="p">);</span>
<span class="linenos"> 88</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 89</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;timesync(C++): sync for t=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; failed&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 90</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos"> 91</span><span class="w">    </span><span class="p">}</span>
<span class="linenos"> 92</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;timesync(C++): t = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos"> 93</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Value</span><span class="o">::</span><span class="n">MemberIterator</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">state_recv</span><span class="p">.</span><span class="n">MemberBegin</span><span class="p">();</span>
<span class="linenos"> 94</span><span class="w">	 </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">state_recv</span><span class="p">.</span><span class="n">MemberEnd</span><span class="p">();</span><span class="w"> </span><span class="n">it</span><span class="o">++</span><span class="p">)</span>
<span class="linenos"> 95</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">.</span><span class="n">GetString</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span>
<span class="linenos"> 96</span><span class="w">	</span><span class="s">&quot; = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">GetDouble</span><span class="p">();</span>
<span class="linenos"> 97</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos"> 98</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="c1">// Send output</span>
<span class="linenos">100</span><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">state_recv</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">GetAllocator</span><span class="p">());</span>
<span class="linenos">101</span><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="n">AddMember</span><span class="p">(</span><span class="s">&quot;time&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rapidjson</span><span class="o">::</span><span class="n">Value</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="n">Move</span><span class="p">(),</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="n">GetAllocator</span><span class="p">());</span>
<span class="linenos">102</span><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">103</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">104</span><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;timesync(C++): Failed to send output for t=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">105</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">106</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">107</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">108</span>
<span class="linenos">109</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Goodbye from C++ timesync&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="linenos">110</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="linenos">111</span><span class="w">    </span>
<span class="linenos">112</span><span class="p">}</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c++</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.cpp</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c++</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.cpp</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
<section id="fortran-version">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Fortran Version</a><a class="headerlink" href="#fortran-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span>program main
<span class="linenos">  2</span>  use fygg
<span class="linenos">  3</span>
<span class="linenos">  4</span>  ! Declare resulting variables and create buffer for received message
<span class="linenos">  5</span>  logical :: timestep_calc
<span class="linenos">  6</span>  logical :: ret = .true.
<span class="linenos">  7</span>  type(yggcomm) :: timesync, out
<span class="linenos">  8</span>  character(len=32) :: arg
<span class="linenos">  9</span>  character(len=0), dimension(0) :: dtype_keys
<span class="linenos"> 10</span>  type(yggdtype), dimension(0) :: dtype_vals
<span class="linenos"> 11</span>  type(yggdtype) :: out_dtype
<span class="linenos"> 12</span>  real(kind=8) :: t_step, t_start, t_end, t
<span class="linenos"> 13</span>  character(len=32) :: t_units, model
<span class="linenos"> 14</span>  character(len=20), dimension(:), pointer :: keys
<span class="linenos"> 15</span>  type(ygggeneric) :: state_send, state_recv, msg
<span class="linenos"> 16</span>  real(kind=8), pointer :: x
<span class="linenos"> 17</span>  integer :: i
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>  call get_command_argument(1, arg)
<span class="linenos"> 20</span>  read(arg, *) t_step
<span class="linenos"> 21</span>  call get_command_argument(2, arg)
<span class="linenos"> 22</span>  read(arg, *) t_units
<span class="linenos"> 23</span>  call get_command_argument(3, arg)
<span class="linenos"> 24</span>  read(arg, *) model
<span class="linenos"> 25</span>  write (*, &#39;(&quot;Hello from Fortran timesync: timestep &quot;,F10.5,&quot; &quot;,A3,&amp;
<span class="linenos"> 26</span>       &amp;&quot; (model = &quot;,A,&quot;)&quot;)&#39;) t_step, trim(t_units), trim(model)
<span class="linenos"> 27</span>  t_start = 0.0
<span class="linenos"> 28</span>  t_end = 5.0
<span class="linenos"> 29</span>  if (t_units.eq.&quot;hr&quot;) then
<span class="linenos"> 30</span>     t_end = 24.0 * t_end
<span class="linenos"> 31</span>  end if
<span class="linenos"> 32</span>  state_send = init_generic_map()
<span class="linenos"> 33</span>  state_recv = init_generic_map()
<span class="linenos"> 34</span>  ret = timestep_calc(t_start, t_units, state_send, model)
<span class="linenos"> 35</span>  if (.not.ret) then
<span class="linenos"> 36</span>     write (*, &#39;(&quot;timesync(Fortran): Error in initial timestep &amp;
<span class="linenos"> 37</span>          &amp;calculation.&quot;)&#39;)
<span class="linenos"> 38</span>  end if
<span class="linenos"> 39</span>
<span class="linenos"> 40</span>  ! Set up connections matching yaml
<span class="linenos"> 41</span>  ! Timestep synchronization connection will be &#39;statesync&#39;
<span class="linenos"> 42</span>  timesync = ygg_timesync(&quot;statesync&quot;, t_units)
<span class="linenos"> 43</span>  out_dtype = create_dtype_json_object(0, dtype_keys, dtype_vals, .true.)
<span class="linenos"> 44</span>  out = ygg_output_type(&quot;output&quot;, out_dtype)
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>  ! Initialize state and synchronize with other models
<span class="linenos"> 47</span>  t = t_start
<span class="linenos"> 48</span>  ret = ygg_rpc_call(timesync, [yggarg(t), yggarg(state_send)], &amp;
<span class="linenos"> 49</span>       yggarg(state_recv))
<span class="linenos"> 50</span>  if (.not.ret) then
<span class="linenos"> 51</span>     write (*, &#39;(&quot;timesync(Fortran): Initial sync failed.&quot;)&#39;)
<span class="linenos"> 52</span>     stop 1
<span class="linenos"> 53</span>  end if
<span class="linenos"> 54</span>  write (*, &#39;(&quot;timesync(Fortran): t = &quot;,F5.1,&quot; &quot;,A3)&#39;, advance=&quot;no&quot;) &amp;
<span class="linenos"> 55</span>       t, adjustl(t_units)
<span class="linenos"> 56</span>  call generic_map_get_keys(state_recv, keys)
<span class="linenos"> 57</span>  do i = 1, size(keys)
<span class="linenos"> 58</span>     call generic_map_get(state_recv, trim(keys(i)), x)
<span class="linenos"> 59</span>     write (*, &#39;(SP,&quot;, &quot;,A,&quot; = &quot;,F5.2)&#39;, advance=&quot;no&quot;) &amp;
<span class="linenos"> 60</span>          trim(keys(i)), x
<span class="linenos"> 61</span>  end do
<span class="linenos"> 62</span>  write (*, &#39;(&quot;&quot;)&#39;)
<span class="linenos"> 63</span>
<span class="linenos"> 64</span>  ! Send initial state to output
<span class="linenos"> 65</span>  msg = copy_generic(state_recv)
<span class="linenos"> 66</span>  call generic_map_set(msg, &quot;time&quot;, t, t_units)
<span class="linenos"> 67</span>  ret = ygg_send_var(out, yggarg(msg))
<span class="linenos"> 68</span>  if (.not.ret) then
<span class="linenos"> 69</span>     write (*, &#39;(&quot;timesync(Fortran): Failed to send initial output &amp;
<span class="linenos"> 70</span>          &amp;for t=&quot;,F10.5,&quot;.&quot;)&#39;) t
<span class="linenos"> 71</span>     stop 1
<span class="linenos"> 72</span>  end if
<span class="linenos"> 73</span>  call free_generic(msg)
<span class="linenos"> 74</span>
<span class="linenos"> 75</span>  ! Iterate until end
<span class="linenos"> 76</span>  do while (t.lt.t_end)
<span class="linenos"> 77</span>
<span class="linenos"> 78</span>     ! Perform calculations to update the state
<span class="linenos"> 79</span>     t = t + t_step
<span class="linenos"> 80</span>     ret = timestep_calc(t, t_units, state_send, model)
<span class="linenos"> 81</span>     if (.not.ret) then
<span class="linenos"> 82</span>        write (*, &#39;(&quot;timesync(Fortran): Error in timestep &amp;
<span class="linenos"> 83</span>             &amp;calculation for t = &quot;,F10.5,&quot;.&quot;)&#39;) t
<span class="linenos"> 84</span>        stop 1
<span class="linenos"> 85</span>     end if
<span class="linenos"> 86</span>
<span class="linenos"> 87</span>     ! Synchronize the state
<span class="linenos"> 88</span>     ret = ygg_rpc_call(timesync, [yggarg(t), yggarg(state_send)], &amp;
<span class="linenos"> 89</span>          yggarg(state_recv))
<span class="linenos"> 90</span>     if (.not.ret) then
<span class="linenos"> 91</span>        write (*, &#39;(&quot;timesync(Fortran): sync failed for t=&quot;,F10.5,&amp;
<span class="linenos"> 92</span>             &amp;&quot;.&quot;)&#39;) t
<span class="linenos"> 93</span>        stop 1
<span class="linenos"> 94</span>     end if
<span class="linenos"> 95</span>     write (*, &#39;(&quot;timesync(Fortran): t = &quot;,F5.1,&quot; &quot;,A3)&#39;, advance=&quot;no&quot;) &amp;
<span class="linenos"> 96</span>          t, adjustl(t_units)
<span class="linenos"> 97</span>     call generic_map_get_keys(state_recv, keys)
<span class="linenos"> 98</span>     do i = 1, size(keys)
<span class="linenos"> 99</span>        call generic_map_get(state_recv, keys(i), x)
<span class="linenos">100</span>        write (*, &#39;(SP,&quot;, &quot;,A,&quot; = &quot;,F5.2)&#39;, advance=&quot;no&quot;) &amp;
<span class="linenos">101</span>             trim(keys(i)), x
<span class="linenos">102</span>     end do
<span class="linenos">103</span>     write (*, &#39;(&quot;&quot;)&#39;)
<span class="linenos">104</span>
<span class="linenos">105</span>     ! Send output
<span class="linenos">106</span>     msg = copy_generic(state_recv)
<span class="linenos">107</span>     call generic_map_set(msg, &quot;time&quot;, t, t_units)
<span class="linenos">108</span>     ret = ygg_send_var(out, yggarg(msg))
<span class="linenos">109</span>     if (.not.ret) then
<span class="linenos">110</span>        write (*, &#39;(&quot;timesync(Fortran): Failed to send output for &amp;
<span class="linenos">111</span>             &amp;t=&quot;,F10.5,&quot;.&quot;)&#39;) t
<span class="linenos">112</span>        stop 1
<span class="linenos">113</span>     end if
<span class="linenos">114</span>     call free_generic(msg)
<span class="linenos">115</span>
<span class="linenos">116</span>  end do
<span class="linenos">117</span>
<span class="linenos">118</span>  write (*, &#39;(&quot;Goodbye from Fortran timesync&quot;)&#39;)
<span class="linenos">119</span>  call free_generic(state_send)
<span class="linenos">120</span>  call free_generic(state_recv)
<span class="linenos">121</span>
<span class="linenos">122</span>end program main
<span class="linenos">123</span>
<span class="linenos">124</span>
<span class="linenos">125</span>function timestep_calc(t, t_units, state, model) result (ret)
<span class="linenos">126</span>  use fygg
<span class="linenos">127</span>  implicit none
<span class="linenos">128</span>  real(kind=8) :: t
<span class="linenos">129</span>  character(len=*) :: t_units
<span class="linenos">130</span>  type(ygggeneric) :: state
<span class="linenos">131</span>  character(len=*) :: model
<span class="linenos">132</span>  logical :: ret
<span class="linenos">133</span>  real(kind=8) :: x_period = 10.0  ! Days
<span class="linenos">134</span>  real(kind=8) :: y_period = 5.0   ! Days
<span class="linenos">135</span>  real(kind=8) :: z_period = 20.0  ! Days
<span class="linenos">136</span>  real(kind=8) :: o_period = 2.5   ! Days
<span class="linenos">137</span>  ret = .true.
<span class="linenos">138</span>  if (t_units.eq.&quot;day&quot;) then
<span class="linenos">139</span>     ! No conversion necessary
<span class="linenos">140</span>  else if (t_units.eq.&quot;hr&quot;) then
<span class="linenos">141</span>     x_period = x_period * 24.0
<span class="linenos">142</span>     y_period = y_period * 24.0
<span class="linenos">143</span>     z_period = z_period * 24.0
<span class="linenos">144</span>     o_period = o_period * 24.0
<span class="linenos">145</span>  else
<span class="linenos">146</span>     write (*, &#39;(&quot;timestep_calc: Unsupported unit &#39;&#39;&quot;,A,&quot;&#39;&#39;&quot;)&#39;) t_units
<span class="linenos">147</span>     ret = .false.
<span class="linenos">148</span>  end if
<span class="linenos">149</span>  if (ret) then
<span class="linenos">150</span>     if (model.eq.&quot;A&quot;) then
<span class="linenos">151</span>        call generic_map_set(state, &quot;x&quot;, &amp;
<span class="linenos">152</span>             sin(2.0 * PI_8 * t / x_period))
<span class="linenos">153</span>        call generic_map_set(state, &quot;y&quot;, &amp;
<span class="linenos">154</span>             cos(2.0 * PI_8 * t / y_period))
<span class="linenos">155</span>        call generic_map_set(state, &quot;z1&quot;, &amp;
<span class="linenos">156</span>             -cos(2.0 * PI_8 * t / z_period))
<span class="linenos">157</span>        call generic_map_set(state, &quot;z2&quot;, &amp;
<span class="linenos">158</span>             -cos(2.0 * PI_8 * t / z_period))
<span class="linenos">159</span>        call generic_map_set(state, &quot;a&quot;, &amp;
<span class="linenos">160</span>             sin(2.0 * PI_8 * t / o_period))
<span class="linenos">161</span>     else
<span class="linenos">162</span>        call generic_map_set(state, &quot;xvar&quot;, &amp;
<span class="linenos">163</span>             sin(2.0 * PI_8 * t / x_period))
<span class="linenos">164</span>        call generic_map_set(state, &quot;yvar&quot;, &amp;
<span class="linenos">165</span>             cos(2.0 * PI_8 * t / y_period))
<span class="linenos">166</span>        call generic_map_set(state, &quot;z&quot;, &amp;
<span class="linenos">167</span>             -2.0 * cos(2.0 * PI_8 * t / z_period))
<span class="linenos">168</span>        call generic_map_set(state, &quot;b&quot;, &amp;
<span class="linenos">169</span>             cos(2.0 * PI_8 * t / o_period))
<span class="linenos">170</span>     end if
<span class="linenos">171</span>  end if
<span class="linenos">172</span>end function timestep_calc
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fortran</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.f90</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fortran</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.f90</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
<section id="julia-version">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Julia Version</a><a class="headerlink" href="#julia-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>using Yggdrasil
<span class="linenos"> 2</span>using Unitful
<span class="linenos"> 3</span>using Printf
<span class="linenos"> 4</span>
<span class="linenos"> 5</span>function timestep_calc(t::Unitful.Quantity, model::String)
<span class="linenos"> 6</span>  state = Dict()
<span class="linenos"> 7</span>  if (model == &quot;A&quot;)
<span class="linenos"> 8</span>    state[&quot;x&quot;] = sin(2.0 * t / Unitful.Quantity(10.0, u&quot;d&quot;))
<span class="linenos"> 9</span>    state[&quot;y&quot;] = cos(2.0 * t / Unitful.Quantity(5.0, u&quot;d&quot;))
<span class="linenos">10</span>    state[&quot;z1&quot;] = -cos(2.0 * t / Unitful.Quantity(20.0, u&quot;d&quot;))
<span class="linenos">11</span>    state[&quot;z2&quot;] = -cos(2.0 * t / Unitful.Quantity(20.0, u&quot;d&quot;))
<span class="linenos">12</span>    state[&quot;a&quot;] = sin(2.0 * t / Unitful.Quantity(2.5, u&quot;d&quot;))
<span class="linenos">13</span>  else
<span class="linenos">14</span>    state[&quot;xvar&quot;] = sin(2.0 * t / Unitful.Quantity(10.0, u&quot;d&quot;))
<span class="linenos">15</span>    state[&quot;yvar&quot;] = cos(2.0 * t / Unitful.Quantity(5.0, u&quot;d&quot;))
<span class="linenos">16</span>    state[&quot;z&quot;] = -2.0 * cos(2.0 * t / Unitful.Quantity(20.0, u&quot;d&quot;))
<span class="linenos">17</span>    state[&quot;b&quot;] = cos(2.0 * t / Unitful.Quantity(2.5, u&quot;d&quot;))
<span class="linenos">18</span>  end
<span class="linenos">19</span>  return state
<span class="linenos">20</span>end
<span class="linenos">21</span>
<span class="linenos">22</span>function main(t_step::Float64, t_units::String, model::String)
<span class="linenos">23</span>
<span class="linenos">24</span>  @printf(&quot;Hello from Julia timesync: timestep = %f %s\n&quot;, t_step, t_units)
<span class="linenos">25</span>  t_step = Unitful.Quantity(t_step, Unitful.uparse(t_units))
<span class="linenos">26</span>  t_start = Unitful.Quantity(0.0, Unitful.uparse(t_units))
<span class="linenos">27</span>  t_end = Unitful.Quantity(1.0, u&quot;d&quot;)
<span class="linenos">28</span>  state = timestep_calc(t_start, model)
<span class="linenos">29</span>
<span class="linenos">30</span>  # Set up connections matching yaml
<span class="linenos">31</span>  # Timestep synchronization connection will default to &#39;timesync&#39;
<span class="linenos">32</span>  timesync = Yggdrasil.YggInterface(&quot;YggTimesync&quot;, &quot;statesync&quot;)
<span class="linenos">33</span>  out = Yggdrasil.YggInterface(&quot;YggOutput&quot;, &quot;output&quot;)
<span class="linenos">34</span>
<span class="linenos">35</span>  # Initialize state and synchronize with other models
<span class="linenos">36</span>  t = t_start
<span class="linenos">37</span>  ret, state = timesync.call(t, state)
<span class="linenos">38</span>  if (!ret)
<span class="linenos">39</span>    error(&quot;timesync(Julia): Initial sync failed.&quot;)
<span class="linenos">40</span>  end
<span class="linenos">41</span>  @printf(&quot;timesync(Julia): t = %s&quot;, t)
<span class="linenos">42</span>  for (k, v) in state
<span class="linenos">43</span>    @printf(&quot;, %s = %s&quot;, k, v)
<span class="linenos">44</span>  end
<span class="linenos">45</span>  @printf(&quot;\n&quot;)
<span class="linenos">46</span>
<span class="linenos">47</span>  # Send initial state to output
<span class="linenos">48</span>  msg = state
<span class="linenos">49</span>  msg[&quot;time&quot;] = t
<span class="linenos">50</span>  flag = out.send(msg)
<span class="linenos">51</span>  if (!flag)
<span class="linenos">52</span>    error(@sprintf(&quot;timesync(Julia): Failed to send initial output for t=%s\n&quot;, t))
<span class="linenos">53</span>  end
<span class="linenos">54</span>
<span class="linenos">55</span>  # Iterate until end
<span class="linenos">56</span>  while (t &lt; t_end)
<span class="linenos">57</span>
<span class="linenos">58</span>    # Perform calculations to update the state
<span class="linenos">59</span>    t = t + t_step
<span class="linenos">60</span>    state = timestep_calc(t, model)
<span class="linenos">61</span>
<span class="linenos">62</span>    # Synchronize the state
<span class="linenos">63</span>    ret, state = timesync.call(t, state)
<span class="linenos">64</span>    if (!ret)
<span class="linenos">65</span>      error(@sprintf(&quot;timesync(Julia): sync for t=%s failed.&quot;, t))
<span class="linenos">66</span>    end
<span class="linenos">67</span>    @printf(&quot;timesync(Julia): t = %s&quot;, t)
<span class="linenos">68</span>    for (k, v) in state
<span class="linenos">69</span>      @printf(&quot;, %s = %s&quot;, k, v)
<span class="linenos">70</span>    end
<span class="linenos">71</span>    @printf(&quot;\n&quot;)
<span class="linenos">72</span>
<span class="linenos">73</span>    # Send output
<span class="linenos">74</span>    msg = state
<span class="linenos">75</span>    msg[&quot;time&quot;] = t
<span class="linenos">76</span>    flag = out.send(msg)
<span class="linenos">77</span>    if (!flag)
<span class="linenos">78</span>      error(@sprintf(&quot;timesync(Julia): Failed to send output for t=%s.&quot;, t))
<span class="linenos">79</span>    end
<span class="linenos">80</span>
<span class="linenos">81</span>  end
<span class="linenos">82</span>
<span class="linenos">83</span>  println(&quot;Goodbye from Julia timesync&quot;)
<span class="linenos">84</span>
<span class="linenos">85</span>end
<span class="linenos">86</span>
<span class="linenos">87</span>main(parse(Float64, ARGS[1]), ARGS[2], ARGS[3])
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">julia</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.jl</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">julia</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.jl</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">d</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
<section id="matlab-version">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Matlab Version</a><a class="headerlink" href="#matlab-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">function</span><span class="w"> </span><span class="nf">timesync</span><span class="p">(</span>t_step, t_units, model<span class="p">)</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="n">t_step</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">str2num</span><span class="p">(</span><span class="n">t_step</span><span class="p">);</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;Hello from Matlab timesync: timestep = %f %s\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">t_step</span><span class="p">,</span><span class="w"> </span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="n">t_step</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t_step</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 6</span><span class="w">  </span><span class="n">t_start</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.0000000000000001</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="n">t_units</span><span class="p">);</span>
<span class="linenos"> 7</span><span class="w">  </span><span class="n">t_end</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">5.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">  </span><span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="linenos"> 9</span><span class="w">    </span>
<span class="linenos">10</span><span class="w">  </span><span class="c">% Set up connections matching yaml</span>
<span class="linenos">11</span><span class="w">  </span><span class="c">% Timestep synchronization connection will be &#39;statesync&#39;</span>
<span class="linenos">12</span><span class="w">  </span><span class="n">timesync</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggTimesync&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;statesync&#39;</span><span class="p">);</span>
<span class="linenos">13</span><span class="w">  </span><span class="n">out</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">YggInterface</span><span class="p">(</span><span class="s">&#39;YggOutput&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;output&#39;</span><span class="p">);</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="w">  </span><span class="c">% Initialize state and synchronize with other models</span>
<span class="linenos">16</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t_start</span><span class="p">;</span>
<span class="linenos">17</span><span class="w">  </span><span class="p">[</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span>
<span class="linenos">18</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
<span class="linenos">19</span><span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;timesync(Matlab): Initial sync failed.&#39;</span><span class="p">);</span>
<span class="linenos">20</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">21</span><span class="w">  </span><span class="p">[</span><span class="n">t_data</span><span class="p">,</span><span class="w"> </span><span class="n">t_unit</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">separateUnits</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="linenos">22</span><span class="w">  </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;timesync(Matlab): t = %5.1f %-1s&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="linenos">23</span><span class="w">          </span><span class="n">t_data</span><span class="p">,</span><span class="w"> </span><span class="n">symunit2str</span><span class="p">(</span><span class="n">t_unit</span><span class="p">));</span>
<span class="linenos">24</span><span class="w">  </span><span class="n">state_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">keys</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">25</span><span class="w">  </span><span class="n">state_vals</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">26</span><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">state_keys</span><span class="p">)</span>
<span class="linenos">27</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;, %s = %+ 5.2f&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">state_keys</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span><span class="w"> </span><span class="n">state_vals</span><span class="p">{</span><span class="nb">i</span><span class="p">});</span>
<span class="linenos">28</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">29</span><span class="w">  </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">);</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="w">  </span><span class="c">% Send initial state to output</span>
<span class="linenos">32</span><span class="w">  </span><span class="n">msg_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">keys</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">33</span><span class="w">  </span><span class="n">msg_keys</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;time&#39;</span><span class="p">;</span>
<span class="linenos">34</span><span class="w">  </span><span class="n">msg_vals</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">35</span><span class="w">  </span><span class="n">msg_vals</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_vals</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos">36</span><span class="w">  </span><span class="n">msg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">containers.Map</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">,</span><span class="w"> </span><span class="n">msg_vals</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;UniformValues&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="linenos">37</span><span class="w">  </span><span class="nb">flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="w">  </span><span class="c">% Iterate until end</span>
<span class="linenos">40</span><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">simplify</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="n">t_end</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="w">    </span><span class="c">% Perform calculations to update the state</span>
<span class="linenos">43</span><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t_step</span><span class="p">;</span>
<span class="linenos">44</span><span class="w">    </span><span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">);</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">    </span><span class="c">% Synchronize the state</span>
<span class="linenos">47</span><span class="w">    </span><span class="p">[</span><span class="n">ret</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">timesync</span><span class="p">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span>
<span class="linenos">48</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="n">ret</span><span class="p">);</span>
<span class="linenos">49</span><span class="w">      </span><span class="nb">error</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;timesync(Matlab): sync for t=%f failed.\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">));</span>
<span class="linenos">50</span><span class="w">    </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">51</span><span class="w">    </span><span class="p">[</span><span class="n">t_data</span><span class="p">,</span><span class="w"> </span><span class="n">t_unit</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">separateUnits</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
<span class="linenos">52</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;timesync(Matlab): t = %5.1f %-1s&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="linenos">53</span><span class="w">            </span><span class="n">t_data</span><span class="p">,</span><span class="w"> </span><span class="n">symunit2str</span><span class="p">(</span><span class="n">t_unit</span><span class="p">));</span>
<span class="linenos">54</span><span class="w">    </span><span class="n">state_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">keys</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">55</span><span class="w">    </span><span class="n">state_vals</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">56</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nb">i</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">length</span><span class="p">(</span><span class="n">state_keys</span><span class="p">)</span>
<span class="linenos">57</span><span class="w">      </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;, %s = %+ 5.2f&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">state_keys</span><span class="p">{</span><span class="nb">i</span><span class="p">},</span><span class="w"> </span><span class="n">state_vals</span><span class="p">{</span><span class="nb">i</span><span class="p">});</span>
<span class="linenos">58</span><span class="w">    </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">59</span><span class="w">    </span><span class="nb">fprintf</span><span class="p">(</span><span class="s">&#39;\n&#39;</span><span class="p">);</span>
<span class="linenos">60</span>
<span class="linenos">61</span><span class="w">    </span><span class="c">% Send output</span>
<span class="linenos">62</span><span class="w">    </span><span class="n">msg_keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">keys</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">63</span><span class="w">    </span><span class="n">msg_keys</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;time&#39;</span><span class="p">;</span>
<span class="linenos">64</span><span class="w">    </span><span class="n">msg_vals</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">values</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="linenos">65</span><span class="w">    </span><span class="n">msg_vals</span><span class="p">{</span><span class="nb">length</span><span class="p">(</span><span class="n">msg_vals</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<span class="linenos">66</span><span class="w">    </span><span class="n">msg</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">containers.Map</span><span class="p">(</span><span class="n">msg_keys</span><span class="p">,</span><span class="w"> </span><span class="n">msg_vals</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;UniformValues&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<span class="linenos">67</span><span class="w">    </span><span class="nb">flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="linenos">68</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">~</span><span class="nb">flag</span><span class="p">);</span>
<span class="linenos">69</span><span class="w">      </span><span class="nb">error</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;timesync(Matlab): Failed to send output for t=%s.\n&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">));</span>
<span class="linenos">70</span><span class="w">    </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">71</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">72</span>
<span class="linenos">73</span><span class="w">  </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Goodbye from Matlab timesync&#39;</span><span class="p">);</span>
<span class="linenos">74</span><span class="w">  </span>
<span class="linenos">75</span><span class="k">end</span>
<span class="linenos">76</span>
<span class="linenos">77</span>
<span class="linenos">78</span><span class="k">function</span><span class="w"> </span>state<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">timestep_calc</span><span class="p">(</span>t, model<span class="p">)</span>
<span class="linenos">79</span><span class="w">  </span><span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">containers.Map</span><span class="p">(</span><span class="s">&#39;UniformValues&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;ValueType&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;any&#39;</span><span class="p">);</span>
<span class="linenos">80</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;A&#39;</span><span class="p">)</span>
<span class="linenos">81</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">82</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">83</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;z1&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">20.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">84</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;z2&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="nb">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">20.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">85</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">2.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">86</span><span class="w">  </span><span class="k">else</span>
<span class="linenos">87</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;xvar&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">10.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<span class="linenos">88</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;yvar&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">5.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">89</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;z&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">20.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">90</span><span class="w">    </span><span class="n">state</span><span class="p">(</span><span class="s">&#39;b&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cos</span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">pi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">2.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">str2symunit</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)));</span>
<span class="linenos">91</span><span class="w">  </span><span class="k">end</span><span class="p">;</span>
<span class="linenos">92</span><span class="k">end</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matlab</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.m</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">matlab</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.m</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
<section id="python-version">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Python Version</a><a class="headerlink" href="#python-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos">  2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos">  3</span><span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">units</span>
<span class="linenos">  4</span><span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos">  5</span>    <span class="n">YggTimesync</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>
<span class="linenos">  6</span>
<span class="linenos">  7</span>
<span class="linenos">  8</span><span class="k">def</span> <span class="nf">xvar2x</span><span class="p">(</span><span class="n">xvar</span><span class="p">):</span>
<span class="linenos">  9</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert xvar to x.&quot;&quot;&quot;</span>
<span class="linenos"> 10</span>    <span class="n">x</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">xvar</span>
<span class="linenos"> 11</span>    <span class="k">return</span> <span class="n">x</span>
<span class="linenos"> 12</span>
<span class="linenos"> 13</span>
<span class="linenos"> 14</span><span class="k">def</span> <span class="nf">x2xvar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="linenos"> 15</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert x to xvar.&quot;&quot;&quot;</span>
<span class="linenos"> 16</span>    <span class="n">xvar</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="mi">2</span>
<span class="linenos"> 17</span>    <span class="k">return</span> <span class="n">xvar</span>
<span class="linenos"> 18</span>
<span class="linenos"> 19</span>
<span class="linenos"> 20</span><span class="k">def</span> <span class="nf">xagg</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
<span class="linenos"> 21</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Aggregate x variables.&quot;&quot;&quot;</span>
<span class="linenos"> 22</span>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>
<span class="linenos"> 23</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="k">def</span> <span class="nf">merge_z</span><span class="p">(</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">):</span>
<span class="linenos"> 26</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Merge the z1 and z2 variables.&quot;&quot;&quot;</span>
<span class="linenos"> 27</span>    <span class="k">return</span> <span class="n">z1</span> <span class="o">+</span> <span class="n">z2</span>
<span class="linenos"> 28</span>
<span class="linenos"> 29</span>
<span class="linenos"> 30</span><span class="k">def</span> <span class="nf">split_z</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
<span class="linenos"> 31</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Split z into z1 and z2 variables.&quot;&quot;&quot;</span>
<span class="linenos"> 32</span>    <span class="k">return</span> <span class="p">(</span><span class="n">z</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">z</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="linenos"> 33</span>
<span class="linenos"> 34</span>
<span class="linenos"> 35</span><span class="k">def</span> <span class="nf">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="linenos"> 36</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Updates the state based on the time where x is a sine wave</span>
<span class="linenos"> 37</span><span class="sd">    with period of 10 days and y is a cosine wave with a period of 5 days.</span>
<span class="linenos"> 38</span><span class="sd">    If model is &#39;A&#39;, the forth state variable will be &#39;a&#39;, a sine</span>
<span class="linenos"> 39</span><span class="sd">    with a period of 2.5 days. If model is &#39;B&#39;, the forth state</span>
<span class="linenos"> 40</span><span class="sd">    variable will be &#39;b&#39;, a cosine with a period of 2.5 days.</span>
<span class="linenos"> 41</span>
<span class="linenos"> 42</span><span class="sd">    Args:</span>
<span class="linenos"> 43</span><span class="sd">        t (float): Current time.</span>
<span class="linenos"> 44</span><span class="sd">        model (str): Identifier for the model (A or B).</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span><span class="sd">    Returns:</span>
<span class="linenos"> 47</span><span class="sd">        dict: Map of state parameters.</span>
<span class="linenos"> 48</span>
<span class="linenos"> 49</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 50</span>    <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
<span class="linenos"> 51</span>        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 52</span>            <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)),</span>
<span class="linenos"> 53</span>            <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)),</span>
<span class="linenos"> 54</span>            <span class="s1">&#39;z1&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)),</span>
<span class="linenos"> 55</span>            <span class="s1">&#39;z2&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)),</span>
<span class="linenos"> 56</span>            <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">))}</span>
<span class="linenos"> 57</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 58</span>        <span class="n">state</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos"> 59</span>            <span class="s1">&#39;xvar&#39;</span><span class="p">:</span> <span class="n">x2xvar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">))),</span>
<span class="linenos"> 60</span>            <span class="s1">&#39;yvar&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)),</span>
<span class="linenos"> 61</span>            <span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)),</span>
<span class="linenos"> 62</span>            <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">))}</span>
<span class="linenos"> 63</span>    <span class="k">return</span> <span class="n">state</span>
<span class="linenos"> 64</span>
<span class="linenos"> 65</span>
<span class="linenos"> 66</span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="linenos"> 67</span><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to execute integration.</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span><span class="sd">    Args:</span>
<span class="linenos"> 70</span><span class="sd">        t_step (float): The time step that should be used.</span>
<span class="linenos"> 71</span><span class="sd">        t_units (str): Units of the time step.</span>
<span class="linenos"> 72</span><span class="sd">        model (str): Identifier for the model (A or B).</span>
<span class="linenos"> 73</span>
<span class="linenos"> 74</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos"> 75</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python timesync: timestep = </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">))</span>
<span class="linenos"> 76</span>    <span class="n">t_step</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="n">t_step</span><span class="p">,</span> <span class="n">t_units</span><span class="p">)</span>
<span class="linenos"> 77</span>    <span class="n">t_start</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">t_units</span><span class="p">)</span>
<span class="linenos"> 78</span>    <span class="n">t_end</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span>
<span class="linenos"> 79</span>    <span class="n">state</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="linenos"> 80</span>
<span class="linenos"> 81</span>    <span class="c1"># Set up connections matching yaml</span>
<span class="linenos"> 82</span>    <span class="c1"># Timestep synchronization connection will be &#39;statesync&#39;</span>
<span class="linenos"> 83</span>    <span class="n">timesync</span> <span class="o">=</span> <span class="n">YggTimesync</span><span class="p">(</span><span class="s2">&quot;statesync&quot;</span><span class="p">)</span>
<span class="linenos"> 84</span>    <span class="n">out</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>    <span class="c1"># Initialize state and synchronize with other models</span>
<span class="linenos"> 87</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">t_start</span>
<span class="linenos"> 88</span>    <span class="n">ret</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">timesync</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="linenos"> 89</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos"> 90</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;timesync(Python): Initial sync failed.&quot;</span><span class="p">)</span>
<span class="linenos"> 91</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;timesync(Python): t = </span><span class="si">% 8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos"> 92</span>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos"> 93</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%+ 5.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos"> 94</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos"> 95</span>
<span class="linenos"> 96</span>    <span class="c1"># Send initial state to output</span>
<span class="linenos"> 97</span>    <span class="n">flag</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">))</span>
<span class="linenos"> 98</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos"> 99</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;timesync(Python): Failed to send &quot;</span>
<span class="linenos">100</span>                           <span class="s2">&quot;initial output for t=</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
<span class="linenos">101</span>    
<span class="linenos">102</span>    <span class="c1"># Iterate until end</span>
<span class="linenos">103</span>    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">:</span>
<span class="linenos">104</span>
<span class="linenos">105</span>        <span class="c1"># Perform calculations to update the state</span>
<span class="linenos">106</span>        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">t_step</span>
<span class="linenos">107</span>        <span class="n">state</span> <span class="o">=</span> <span class="n">timestep_calc</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="linenos">108</span>
<span class="linenos">109</span>        <span class="c1"># Synchronize the state</span>
<span class="linenos">110</span>        <span class="n">ret</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">timesync</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
<span class="linenos">111</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos">112</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;timesync(Python): sync for t=</span><span class="si">%f</span><span class="s2"> failed.&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
<span class="linenos">113</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;timesync(Python): t = </span><span class="si">% 8s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">114</span>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<span class="linenos">115</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, </span><span class="si">%s</span><span class="s1"> = </span><span class="si">%+ 5.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">116</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">117</span>
<span class="linenos">118</span>        <span class="c1"># Send output</span>
<span class="linenos">119</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">))</span>
<span class="linenos">120</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">121</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;timesync(Python): Failed to send output for t=</span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
<span class="linenos">122</span>
<span class="linenos">123</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python timesync&#39;</span><span class="p">)</span>
<span class="linenos">124</span>
<span class="linenos">125</span>
<span class="linenos">126</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">127</span>    <span class="c1"># Take time step from the first argument</span>
<span class="linenos">128</span>    <span class="n">main</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
<section id="r-version">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">R Version</a><a class="headerlink" href="#r-version" title="Permalink to this heading">¶</a></h2>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span>library(yggdrasil)
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>timestep_calc &lt;- function(t, model) {
<span class="linenos"> 5</span>  state = list()
<span class="linenos"> 6</span>  if (model == &#39;A&#39;) {
<span class="linenos"> 7</span>    state[[&#39;x&#39;]] = sinpi(2.0 * t / units::set_units(10.0, &#39;day&#39;, mode=&quot;standard&quot;))
<span class="linenos"> 8</span>    state[[&#39;y&#39;]] = cospi(2.0 * t / units::set_units(5.0, &#39;day&#39;, mode=&quot;standard&quot;))
<span class="linenos"> 9</span>    state[[&#39;z1&#39;]] = -cospi(2.0 * t / units::set_units(20.0, &#39;day&#39;, mode=&quot;standard&quot;))
<span class="linenos">10</span>    state[[&#39;z2&#39;]] = -cospi(2.0 * t / units::set_units(20.0, &#39;day&#39;, mode=&quot;standard&quot;))
<span class="linenos">11</span>    state[[&#39;a&#39;]] = sinpi(2.0 * t / units::set_units(2.5, &#39;day&#39;, model=&quot;standard&quot;))
<span class="linenos">12</span>  } else {
<span class="linenos">13</span>    state[[&#39;xvar&#39;]] = sinpi(2.0 * t / units::set_units(10.0, &#39;day&#39;, mode=&quot;standard&quot;)) / 2.0
<span class="linenos">14</span>    state[[&#39;yvar&#39;]] = cospi(2.0 * t / units::set_units(5.0, &#39;day&#39;, mode=&quot;standard&quot;))
<span class="linenos">15</span>    state[[&#39;z&#39;]] = -2.0 * cospi(2.0 * t / units::set_units(20.0, &#39;day&#39;, mode=&quot;standard&quot;))
<span class="linenos">16</span>    state[[&#39;b&#39;]] = cospi(2.0 * t / units::set_units(2.5, &#39;day&#39;, model=&quot;standard&quot;))
<span class="linenos">17</span>  }
<span class="linenos">18</span>  return(state)
<span class="linenos">19</span>}
<span class="linenos">20</span>
<span class="linenos">21</span>main &lt;- function(t_step, t_units, model) {
<span class="linenos">22</span>
<span class="linenos">23</span>  fprintf(&#39;Hello from R timesync: timestep = %f %s&#39;, t_step, t_units)
<span class="linenos">24</span>  t_step &lt;- units::set_units(t_step, t_units, mode=&quot;standard&quot;)
<span class="linenos">25</span>  t_start &lt;- units::set_units(0.0, t_units, mode=&quot;standard&quot;)
<span class="linenos">26</span>  t_end &lt;- units::set_units(5.0, &#39;day&#39;, mode=&quot;standard&quot;)
<span class="linenos">27</span>  state &lt;- timestep_calc(t_start, model)
<span class="linenos">28</span>
<span class="linenos">29</span>  # Set up connections matching yaml
<span class="linenos">30</span>  # Timestep synchronization connection will be &#39;statesync&#39;
<span class="linenos">31</span>  timesync &lt;- YggInterface(&#39;YggTimesync&#39;, &#39;statesync&#39;)
<span class="linenos">32</span>  out &lt;- YggInterface(&#39;YggOutput&#39;, &#39;output&#39;)
<span class="linenos">33</span>
<span class="linenos">34</span>  # Initialize state and synchronize with other models
<span class="linenos">35</span>  t &lt;- t_start
<span class="linenos">36</span>  c(ret, state) %&lt;-% timesync$call(t, state)
<span class="linenos">37</span>  if (!ret) {
<span class="linenos">38</span>    stop(&#39;timesync(R): Initial sync failed.&#39;)
<span class="linenos">39</span>  }
<span class="linenos">40</span>  fprintf(&#39;timesync(R): t = %5.1f %-1s&#39;,
<span class="linenos">41</span>          units::drop_units(t), units::deparse_unit(t))
<span class="linenos">42</span>  for (key in names(state)) {
<span class="linenos">43</span>    fprintf(&#39;, %s = %+ 5.2f&#39;, key, state[[key]])
<span class="linenos">44</span>  }
<span class="linenos">45</span>  fprintf(&#39;\n&#39;)
<span class="linenos">46</span>
<span class="linenos">47</span>  # Send initial state to output
<span class="linenos">48</span>  msg = state
<span class="linenos">49</span>  msg[[&#39;time&#39;]] = t
<span class="linenos">50</span>  flag &lt;- out$send(msg)
<span class="linenos">51</span>  if (!flag) {
<span class="linenos">52</span>    stop(sprintf(&#39;timesync(R): Failed to send initial output for t=%s&#39;, t))
<span class="linenos">53</span>  }
<span class="linenos">54</span>
<span class="linenos">55</span>  # Iterate until end
<span class="linenos">56</span>  while (t &lt; t_end) {
<span class="linenos">57</span>        
<span class="linenos">58</span>    # Perform calculations to update the state
<span class="linenos">59</span>    t &lt;- t + t_step
<span class="linenos">60</span>    state &lt;- timestep_calc(t, model)
<span class="linenos">61</span>
<span class="linenos">62</span>    # Synchronize the state
<span class="linenos">63</span>    c(ret, state) %&lt;-% timesync$call(t, state)
<span class="linenos">64</span>    if (!ret) {
<span class="linenos">65</span>      stop(sprintf(&#39;timesync(R): sync for t=%f failed.&#39;, t))
<span class="linenos">66</span>    }
<span class="linenos">67</span>    fprintf(&#39;timesync(R): t = %5.1f %-1s&#39;,
<span class="linenos">68</span>            units::drop_units(t), units::deparse_unit(t))
<span class="linenos">69</span>    for (key in names(state)) {
<span class="linenos">70</span>      fprintf(&#39;, %s = %+ 5.2f&#39;, key, state[[key]])
<span class="linenos">71</span>    }
<span class="linenos">72</span>    fprintf(&#39;\n&#39;)
<span class="linenos">73</span>
<span class="linenos">74</span>    # Send output
<span class="linenos">75</span>    msg = state
<span class="linenos">76</span>    msg[[&#39;time&#39;]] = t
<span class="linenos">77</span>    flag &lt;- out$send(msg)
<span class="linenos">78</span>    if (!flag) {
<span class="linenos">79</span>      stop(sprintf(&#39;timesync(R): Failed to send output for t=%s.&#39;, t))
<span class="linenos">80</span>    }
<span class="linenos">81</span>  }
<span class="linenos">82</span>
<span class="linenos">83</span>  print(&#39;Goodbye from R timesync&#39;)
<span class="linenos">84</span>  
<span class="linenos">85</span>}
<span class="linenos">86</span>
<span class="linenos">87</span>
<span class="linenos">88</span>args = commandArgs(trailingOnly=TRUE)
<span class="linenos">89</span>main(as.double(args[[1]]), args[[2]], args[[3]])
</pre></div>
</div>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">timesync</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nt">synonyms</span><span class="p">:</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos"> 8</span><span class="w">        </span><span class="nt">x</span><span class="p">:</span>
<span class="linenos"> 9</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">xvar</span>
<span class="linenos">10</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xvar2x</span>
<span class="linenos">11</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:x2xvar</span>
<span class="linenos">12</span><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yvar</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span>
<span class="linenos">14</span><span class="w">        </span><span class="nt">z</span><span class="p">:</span>
<span class="linenos">15</span><span class="w">          </span><span class="nt">alt</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">z1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">z2</span><span class="p p-Indicator">]</span>
<span class="linenos">16</span><span class="w">          </span><span class="nt">alt2base</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:merge_z</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">base2alt</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:split_z</span>
<span class="linenos">18</span><span class="w">    </span><span class="nt">interpolation</span><span class="p">:</span>
<span class="linenos">19</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">krogh</span>
<span class="linenos">20</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span>
<span class="linenos">21</span><span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spline</span>
<span class="linenos">22</span><span class="w">        </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="linenos">23</span><span class="w">    </span><span class="nt">aggregation</span><span class="p">:</span>
<span class="linenos">24</span><span class="w">      </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.py:xagg</span>
<span class="linenos">25</span><span class="w">      </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sum</span>
<span class="linenos">26</span><span class="w">    </span><span class="nt">additional_variables</span><span class="p">:</span>
<span class="linenos">27</span><span class="w">      </span><span class="nt">modelA</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">b</span><span class="p p-Indicator">]</span>
<span class="linenos">28</span><span class="w">      </span><span class="nt">modelB</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">a</span><span class="p p-Indicator">]</span>
<span class="linenos">29</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA</span>
<span class="linenos">30</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">R</span>
<span class="linenos">31</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">32</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.R</span>
<span class="linenos">33</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w">  </span><span class="c1"># Pass the timestep in hours</span>
<span class="linenos">34</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hr</span>
<span class="linenos">35</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">A</span>
<span class="linenos">36</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">37</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">38</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">39</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">40</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelA_output.txt</span>
<span class="linenos">41</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">42</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
<span class="linenos">43</span><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB</span>
<span class="linenos">44</span><span class="w">    </span><span class="nt">language</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">R</span>
<span class="linenos">45</span><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
<span class="linenos">46</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src/timesync.R</span>
<span class="linenos">47</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w">  </span><span class="c1"># Pass the timestep in days</span>
<span class="linenos">48</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">day</span>
<span class="linenos">49</span><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">B</span>
<span class="linenos">50</span><span class="w">    </span><span class="nt">timesync</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">statesync</span>
<span class="linenos">51</span><span class="w">    </span><span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">52</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">output</span>
<span class="linenos">53</span><span class="w">      </span><span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">54</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">modelB_output.txt</span>
<span class="linenos">55</span><span class="w">        </span><span class="nt">in_temp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">56</span><span class="w">        </span><span class="nt">filetype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">table</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Meagan Lang, David Raila.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>