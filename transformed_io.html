

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Transformed I/O &mdash; yggdrasil v1.6.3+1.g5570f65a0.dirty documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Timestep Synchronization" href="timesync_io.html" />
    <link rel="prev" title="Conditional I/O" href="conditional_io.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="autowrap.html#notes-on-autowrapping-c-c-model-functions">Notes on Autowrapping C/C++ Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Transformed I/O</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#transformed-output">Transformed Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transform-options">Transform Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-transform-options">General Transform Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#transform-types">Transform Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="#type-specific-transform-options">Type Specific Transform Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Transformed I/O</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/transformed_io.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="transformed-i-o">
<span id="transformed-io-rst"></span><h1>Transformed I/O<a class="headerlink" href="#transformed-i-o" title="Permalink to this headline">¶</a></h1>
<p>In addition to I/O <a class="reference internal" href="examples/conditional_io.html#conditional-io-rst"><span class="std std-ref">filters</span></a>, yggdrasil also provides methods for specifying transformations that should be performed on input/output received/returned by a model. In addition to type specific operations (e.g. mapping field names, selecting columns), yggdrasil also supports generic transformations via arbitrary Python statements and/or Python functions.</p>
<div class="section" id="transformed-output">
<h2>Transformed Output<a class="headerlink" href="#transformed-output" title="Permalink to this headline">¶</a></h2>
<p>In the example below, the output from model A is passed to both model B and C, however model B and C expect slightly different forms of the varaible, which as output by model A, is a rate with units of g/s. In the case of model B, it expects an input value in the form of a rate multiplied by 10 to account for accumulation across 10 producers. In the case of Model C, it expects an input value in the form of a rate density, requiring the value returned by model A to be normalized by an area.</p>
<p>Model Code:</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">modelA_function</span><span class="p">(</span><span class="n">in_val</span><span class="p">):</span>
    <span class="n">out_val</span> <span class="o">=</span> <span class="n">in_val</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;modelA_function(</span><span class="si">%s</span><span class="s2">) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">in_val</span><span class="p">,</span> <span class="n">out_val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out_val</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">modelB_function</span><span class="p">(</span><span class="n">in_val</span><span class="p">):</span>
    <span class="n">out_val</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">in_val</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;modelB_function(</span><span class="si">%s</span><span class="s2">) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">in_val</span><span class="p">,</span> <span class="n">out_val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">in_val</span><span class="p">,</span> <span class="n">out_val</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">units</span>


<span class="k">def</span> <span class="nf">modelC_function</span><span class="p">(</span><span class="n">in_val</span><span class="p">):</span>
    <span class="n">out_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">in_val</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;modelC_function(</span><span class="si">%s</span><span class="s2">) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">in_val</span><span class="p">,</span> <span class="n">out_val</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">in_val</span><span class="p">,</span> <span class="n">out_val</span>


<span class="k">def</span> <span class="nf">transform_function</span><span class="p">(</span><span class="n">in_val</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">in_val</span> <span class="o">/</span> <span class="n">units</span><span class="o">.</span><span class="n">add_units</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;cm**2&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>(<a class="reference external" href="examples/transformed_io.html">Example in other languages</a>)</p>
<p>To instruct yggdrasil to transform output from model A into the forms expected by models B &amp; C, the YAML should containg a connection to both models with the <code class="docutils literal notranslate"><span class="pre">transform</span></code> parameter added to both.</p>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nt">models</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelA</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
    <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/transformed_io_modelA.py</span>
    <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modelA_function</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelB</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
    <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/transformed_io_modelB.py</span>
    <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modelB_function</span>

  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelC</span>
    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
    <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/transformed_io_modelC.py</span>
    <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">modelC_function</span>

<span class="nt">connections</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Input/input.txt</span>  <span class="c1"># Connection between file and model A input</span>
    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelA:input</span>
    <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelA:output</span>  <span class="c1"># Connection between model A output &amp; model B input</span>
    <span class="nt">outputs</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelB:input</span>
        <span class="nt">transform</span><span class="p">:</span>
          <span class="nt">statement</span><span class="p">:</span> <span class="s">&quot;%x%*5&quot;</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelC:input</span>
        <span class="nt">transform</span><span class="p">:</span>
          <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/transformed_io_modelC.py:transform_function</span>
  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelB:output</span>  <span class="c1"># Connection between model B, function 1 output and file</span>
    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./outputB.txt</span>
    <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
    <span class="nt">field_names</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">InputMassRate,OuputMassRate</span>
    <span class="nt">field_units</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">g/s,g/s</span>
    <span class="nt">format_str</span><span class="p">:</span> <span class="s">&quot;%.1lf\t%.1lf\n&quot;</span>
  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python_modelC:output</span>  <span class="c1"># Connection between model C, function 1 output and file</span>
    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./outputC.txt</span>
    <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">table</span>
    <span class="nt">field_names</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">InputMassRate,OuputMassRateDensity</span>
    <span class="nt">field_units</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">g/(s*(cm**2)),g/(s*(cm**2))</span>
    <span class="nt">format_str</span><span class="p">:</span> <span class="s">&quot;%.1lf\t%.1lf\n&quot;</span>
</pre></div>
</td></tr></table></div>
<p>(<a class="reference external" href="examples/transformed_io.html">Example in other languages</a>)</p>
<p><code class="docutils literal notranslate"><span class="pre">transform</span></code> values are maps with parameters specifying how the input/output should be transformed before being receieved/returned by a model. In the above example, the transform for model B uses a Python expression (the <code class="docutils literal notranslate"><span class="pre">statement</span></code> parameter) in terms of <code class="docutils literal notranslate"><span class="pre">%x%</span></code> which stands in for the variable being based by the comm. Alternately, the transform for model C uses a reference to a Python function. <code class="docutils literal notranslate"><span class="pre">function</span></code> values take the form <code class="docutils literal notranslate"><span class="pre">&lt;filename&gt;:&lt;function</span> <span class="pre">name&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">filename</span></code> is the full path to the location of a Python source file containing the desired function that should be used to transform the received data and <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">name</span></code> is the name of the desired function. Functions used in such cases should take a single argument (the variable or tuple of variables being passed by the connection), and return the transformed value. The path to the file containing the function can be absolute or relative to the directory containing the yaml file.</p>
<p>Additional <code class="docutils literal notranslate"><span class="pre">transform</span></code> parameter options are provided below.</p>
</div>
<div class="section" id="transform-options">
<h2>Transform Options<a class="headerlink" href="#transform-options" title="Permalink to this headline">¶</a></h2>
<div class="section" id="general-transform-options">
<h3>General Transform Options<a class="headerlink" href="#general-transform-options" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default" id="schema-table-transform-general-rst">
<colgroup>
<col style="width: 15%" />
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>initial_state</p></td>
<td><p>object</p></td>
<td></td>
<td><p>Dictionary of initial state variables that should be set when the transform is
created.</p></td>
</tr>
<tr class="row-odd"><td><p>original_datatype</p></td>
<td><p>schema</p></td>
<td></td>
<td><p>Datatype associated with expected messages. Defaults to None.</p></td>
</tr>
<tr class="row-even"><td><p>transformtype</p></td>
<td></td>
<td></td>
<td><p>(Options described <a class="reference internal" href="#schema-table-transform-subtype-rst"><span class="std std-ref">here</span></a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="transform-types">
<h3>Transform Types<a class="headerlink" href="#transform-types" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default" id="schema-table-transform-subtype-rst">
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Transformtype</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>array</p></td>
</tr>
<tr class="row-odd"><td><p>direct</p></td>
</tr>
<tr class="row-even"><td><p>filter</p></td>
</tr>
<tr class="row-odd"><td><p>function</p></td>
</tr>
<tr class="row-even"><td><p>iterate</p></td>
</tr>
<tr class="row-odd"><td><p>map_fields</p></td>
</tr>
<tr class="row-even"><td><p>pandas</p></td>
</tr>
<tr class="row-odd"><td><p>select_fields</p></td>
</tr>
<tr class="row-even"><td><p>statement</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="type-specific-transform-options">
<h3>Type Specific Transform Options<a class="headerlink" href="#type-specific-transform-options" title="Permalink to this headline">¶</a></h3>
<table class="docutils align-default" id="schema-table-transform-specific-rst">
<colgroup>
<col style="width: 12%" />
<col style="width: 6%" />
<col style="width: 61%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Valid For ‘Transformtype’ Of</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>field_names</p></td>
<td><p>array</p></td>
<td></td>
<td><p>[‘array’, ‘pandas’]</p></td>
</tr>
<tr class="row-odd"><td><p>filter</p></td>
<td></td>
<td></td>
<td><p>[‘filter’]</p></td>
</tr>
<tr class="row-even"><td><p>function</p></td>
<td><p>function</p></td>
<td><p>The handle for a callable Python object (e.g. function) that should be used to
transform messages or a string of the form “&lt;function file&gt;:&lt;function name&gt;”
identifying a function where “&lt;function file&gt;” is the module or Python file
containing the function and “&lt;function name&gt;” is the name of the function. The
function should take the message as input and return the transformed message.</p></td>
<td><p>[‘function’]</p></td>
</tr>
<tr class="row-odd"><td><p>map</p></td>
<td><p>object</p></td>
<td><p>A mapping from original field name to new field names.</p></td>
<td><p>[‘map_fields’]</p></td>
</tr>
<tr class="row-even"><td><p>original_order</p></td>
<td><p>array</p></td>
<td><p>The original order of fields that should be used for selecting from
lists/tuples.</p></td>
<td><p>[‘select_fields’]</p></td>
</tr>
<tr class="row-odd"><td><p>selected</p></td>
<td><p>array</p></td>
<td><p>A list of fields that should be selected.</p></td>
<td><p>[‘select_fields’]</p></td>
</tr>
<tr class="row-even"><td><p>single_as_scalar</p></td>
<td><p>boolean</p></td>
<td><p>If True and only a single field is selected, the transformed messages will be
scalars rather than arrays with single elements. Defaults to False.</p></td>
<td><p>[‘select_fields’]</p></td>
</tr>
<tr class="row-odd"><td><p>statement</p></td>
<td><p>string</p></td>
<td><p>Python statement in terms of the message as represented by the string “%x%” that
should evaluate to the transformed message. The statement should only use a
limited set of builtins and the math library (See yggdrasil.tools.safe_eval). If
more complex relationships are required, use the FunctionTransform class.</p></td>
<td><p>[‘statement’]</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="timesync_io.html" class="btn btn-neutral float-right" title="Timestep Synchronization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="conditional_io.html" class="btn btn-neutral float-left" title="Conditional I/O" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>