

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Server/Client I/O &mdash; yggdrasil v1.6.3 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Autowrapping Model Functions" href="autowrap.html" />
    <link rel="prev" title="Formatted I/O" href="formatted_io.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Server/Client I/O</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#one-server-one-client">One Server, One Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-existing-inputs-outputs">Using Existing Inputs/Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#one-server-two-clients">One Server, Two Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="#two-servers-two-clients">Two Servers, Two Clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrapped-function-server">Wrapped Function Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="autowrap.html#notes-on-autowrapping-c-c-model-functions">Notes on Autowrapping C/C++ Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Server/Client I/O</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/server_client_io.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="server-client-i-o">
<span id="server-client-io-rst"></span><h1>Server/Client I/O<a class="headerlink" href="#server-client-i-o" title="Permalink to this headline">¶</a></h1>
<p>Often you will want to call one model from another like a functions. This
would required sending the input variable(s) to the model being called and
then sending the output variables(s) back to the calling model. We refer to
this as a Remote Procedure Call (RPC). The model being called can be considered
a server providing its calculations as a service to the client (the calling model).
The yggdrasil provides options for treating models as server and clients.</p>
<div class="section" id="one-server-one-client">
<h2>One Server, One Client<a class="headerlink" href="#one-server-one-client" title="Permalink to this headline">¶</a></h2>
<p>In the example below, the “server” model computes the nth number in the
Fibonacci sequence and the “client” model calls the server to get a certain
portion of the Fibonacci sequences and then writes it to a log. The server
will continue processing requests until all clients connected to it have
disconnected.</p>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggRpcServer</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">get_fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the nth number of the Fibonacci sequence.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="sd">    Args:</span>
<span class="linenos"> 9</span><span class="sd">        n (int): Index of the Fibonacci number in the Fibonacci sequence that</span>
<span class="linenos">10</span><span class="sd">            should be returned.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    Returns:</span>
<span class="linenos">13</span><span class="sd">        int: The nth Fibonacci number.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">16</span>    <span class="n">pprev</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">17</span>    <span class="n">prev</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">18</span>    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">19</span>    <span class="n">fib_no</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">20</span>    <span class="k">while</span> <span class="n">fib_no</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos">21</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">+</span> <span class="n">pprev</span>
<span class="linenos">22</span>        <span class="n">pprev</span> <span class="o">=</span> <span class="n">prev</span>
<span class="linenos">23</span>        <span class="n">prev</span> <span class="o">=</span> <span class="n">result</span>
<span class="linenos">24</span>        <span class="n">fib_no</span> <span class="o">=</span> <span class="n">fib_no</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">25</span>    <span class="k">return</span> <span class="n">result</span>
<span class="linenos">26</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">29</span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to execute server communication and computation in a loop.&quot;&quot;&quot;</span>
<span class="linenos">30</span>
<span class="linenos">31</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python server!&#39;</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="c1"># Get parameters</span>
<span class="linenos">34</span>    <span class="n">inp</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">)</span>
<span class="linenos">35</span>    <span class="n">retval</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">36</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
<span class="linenos">37</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;server: ERROR receiving parameters&#39;</span><span class="p">)</span>
<span class="linenos">38</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: Parameters = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="p">)</span>
<span class="linenos">39</span>
<span class="linenos">40</span>    <span class="c1"># Create server-side rpc conneciton using model name</span>
<span class="linenos">41</span>    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcServer</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="c1"># Continue receiving requests until the connection is closed when all</span>
<span class="linenos">44</span>    <span class="c1"># clients have disconnected.</span>
<span class="linenos">45</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">46</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: receiving...&#39;</span><span class="p">)</span>
<span class="linenos">47</span>        <span class="n">retval</span><span class="p">,</span> <span class="n">rpc_in</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">48</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
<span class="linenos">49</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: end of input&#39;</span><span class="p">)</span>
<span class="linenos">50</span>            <span class="k">break</span>
<span class="linenos">51</span>
<span class="linenos">52</span>        <span class="c1"># Compute fibonacci number</span>
<span class="linenos">53</span>        <span class="n">n</span> <span class="o">=</span> <span class="n">rpc_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">54</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: Received request for Fibonacci number </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
<span class="linenos">55</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">get_fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="linenos">56</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: Sending response for Fibonacci number </span><span class="si">%d</span><span class="s1">: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
<span class="linenos">57</span>
<span class="linenos">58</span>        <span class="c1"># Send response back</span>
<span class="linenos">59</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="linenos">60</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">61</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;server: ERROR sending&#39;</span><span class="p">)</span>
<span class="linenos">62</span>
<span class="linenos">63</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python server&#39;</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    
<span class="linenos">66</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">67</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 4</span>    <span class="n">YggRpcClient</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
<span class="linenos"> 8</span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to execute client communication with server that computes</span>
<span class="linenos"> 9</span><span class="sd">    numbers in the Fibonacci sequence.</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="sd">    Args:</span>
<span class="linenos">12</span><span class="sd">        iterations (int): The number of Fibonacci numbers to log.</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">15</span>
<span class="linenos">16</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python client: iterations = </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">iterations</span><span class="p">)</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="c1"># Set up connections matching yaml</span>
<span class="linenos">19</span>    <span class="c1"># RPC client-side connection will be $(server_name)_$(client_name)</span>
<span class="linenos">20</span>    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s2">&quot;server_client&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">21</span>    <span class="n">log</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s2">&quot;output_log&quot;</span><span class="p">,</span> <span class="s1">&#39;fib(</span><span class="si">%-2d</span><span class="s1">) = </span><span class="si">%-2d</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="c1"># Iterate over Fibonacci sequence</span>
<span class="linenos">24</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">25</span>        
<span class="linenos">26</span>        <span class="c1"># Call the server and receive response</span>
<span class="linenos">27</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;client(Python): Calling fib(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
<span class="linenos">28</span>        <span class="n">ret</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="linenos">29</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos">30</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;client(Python): RPC CALL ERROR&#39;</span><span class="p">)</span>
<span class="linenos">31</span>        <span class="n">fib</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">32</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;client(Python): Response fib(</span><span class="si">%d</span><span class="s1">) = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">fib</span><span class="p">))</span>
<span class="linenos">33</span>
<span class="linenos">34</span>        <span class="c1"># Log result by sending it to the log connection</span>
<span class="linenos">35</span>        <span class="n">ret</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fib</span><span class="p">)</span>
<span class="linenos">36</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos">37</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;client(Python): SEND ERROR&#39;</span><span class="p">)</span>
<span class="linenos">38</span>
<span class="linenos">39</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python client&#39;</span><span class="p">)</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    
<span class="linenos">42</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">43</span>    <span class="c1"># Take number of iterations from the first argument</span>
<span class="linenos">44</span>    <span class="n">main</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson1.html">Example in other languages</a>)</p>
<p>The interface server-side API call (YggRpcServer for Python),
requires 3 input variables: the name of the server channel (this will be
the name of the server model), a format string for input to the server model,
and a format string for output from the server model. The client-side API call
(YggRpcClient for Python), also requires 3 input variables: the name of the
client channel (this is the name of the server model joined with the name of
the client model by an underscore, <code class="docutils literal notranslate"><span class="pre">&lt;server&gt;_&lt;client&gt;</span></code>, a format string for
input to the server model, and a format string for output form the server
model. The last two arguments (the format strings) to both the server and
client API calls should be the same.</p>
<p>In the server model YAML, the key/value pair <code class="docutils literal notranslate"><span class="pre">is_server:</span> <span class="pre">True</span></code> needs
to be added to the model entry to indicate that the model will be called
as a server and requires a set of RPC channels. In the client model YAML,
the key/value pair <code class="docutils literal notranslate"><span class="pre">client_of:</span> <span class="pre">&lt;server_model_name&gt;</span></code> is required to indicate
that the model will act as a client of the <code class="docutils literal notranslate"><span class="pre">&lt;server_model_name&gt;</span></code> model.</p>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 4</span>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="linenos"> 5</span>  <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 6</span>  <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/server.py</span>
<span class="linenos"> 7</span>  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC server queue called &quot;server&quot;</span>
<span class="linenos"> 8</span>  <span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 9</span>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">params</span>
<span class="linenos">10</span>    <span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">11</span>      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Input/server_params.txt</span>
<span class="linenos">12</span>      <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ascii</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 4</span>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client</span>
<span class="linenos"> 5</span>  <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 6</span>  <span class="nt">args</span><span class="p">:</span>
<span class="linenos"> 7</span>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/client.py</span>
<span class="linenos"> 8</span>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>  <span class="c1"># Pass the number of iterations that should be performed</span>
<span class="linenos"> 9</span>  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>  <span class="c1"># Creates an RPC client queue &quot;server_client&quot;</span>
<span class="linenos">10</span>  <span class="nt">outputs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos">13</span>  <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log</span>
<span class="linenos">14</span>  <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client_output.txt</span>
<span class="linenos">15</span>  <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson1.html">Example in other languages</a>)</p>
<p>In addition to the RPC API call, the example server also has an input <code class="docutils literal notranslate"><span class="pre">params</span></code>.
Models acting as servers can have as many inputs/outputs as desired in addition to
the RPC connections. While the example input is not used to modify the output
in this example, such a comm could be used to initialize a model with
parameters and/or initial conditions.</p>
</div>
<div class="section" id="using-existing-inputs-outputs">
<h2>Using Existing Inputs/Outputs<a class="headerlink" href="#using-existing-inputs-outputs" title="Permalink to this headline">¶</a></h2>
<p>Models that have already been integrated via yggdrasil can also be turned
into servers without modifying the code. Instead of passing a boolean to
the <code class="docutils literal notranslate"><span class="pre">is_server</span></code> parameter, such models can provide a mapping with <code class="docutils literal notranslate"><span class="pre">input</span></code>
and <code class="docutils literal notranslate"><span class="pre">output</span></code> parameters that explicitly outline which of a existing model’s
inputs/outputs should be used for the RPC call. Receive/send calls to named
input/output channels will then behave as receive/send calls on a server
interface comm.</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Example source code and YAML of server replacing an existing input/output</p>
</div>
</div>
<div class="section" id="one-server-two-clients">
<h2>One Server, Two Clients<a class="headerlink" href="#one-server-two-clients" title="Permalink to this headline">¶</a></h2>
<p>There is no limit on the number of clients that can connect to a single
server. In the example below, the server is the same as above. The client
code is also essentially the same except that it has been modified to take
a <code class="docutils literal notranslate"><span class="pre">client_index</span></code> variable that provides information to differentiates
between two clients using the same source code.</p>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="n">YggInput</span><span class="p">,</span> <span class="n">YggRpcServer</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="k">def</span> <span class="nf">get_fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos"> 6</span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compute the nth number of the Fibonacci sequence.</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="sd">    Args:</span>
<span class="linenos"> 9</span><span class="sd">        n (int): Index of the Fibonacci number in the Fibonacci sequence that</span>
<span class="linenos">10</span><span class="sd">            should be returned.</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="sd">    Returns:</span>
<span class="linenos">13</span><span class="sd">        int: The nth Fibonacci number.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">16</span>    <span class="n">pprev</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">17</span>    <span class="n">prev</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">18</span>    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">19</span>    <span class="n">fib_no</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">20</span>    <span class="k">while</span> <span class="n">fib_no</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos">21</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">+</span> <span class="n">pprev</span>
<span class="linenos">22</span>        <span class="n">pprev</span> <span class="o">=</span> <span class="n">prev</span>
<span class="linenos">23</span>        <span class="n">prev</span> <span class="o">=</span> <span class="n">result</span>
<span class="linenos">24</span>        <span class="n">fib_no</span> <span class="o">=</span> <span class="n">fib_no</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos">25</span>    <span class="k">return</span> <span class="n">result</span>
<span class="linenos">26</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="linenos">29</span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to execute server communication and computation in a loop.&quot;&quot;&quot;</span>
<span class="linenos">30</span>
<span class="linenos">31</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python server!&#39;</span><span class="p">)</span>
<span class="linenos">32</span>
<span class="linenos">33</span>    <span class="c1"># Get parameters</span>
<span class="linenos">34</span>    <span class="n">inp</span> <span class="o">=</span> <span class="n">YggInput</span><span class="p">(</span><span class="s2">&quot;params&quot;</span><span class="p">)</span>
<span class="linenos">35</span>    <span class="n">retval</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">36</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
<span class="linenos">37</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;server: ERROR receiving parameters&#39;</span><span class="p">)</span>
<span class="linenos">38</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: Parameters = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">params</span><span class="p">)</span>
<span class="linenos">39</span>
<span class="linenos">40</span>    <span class="c1"># Create server-side rpc conneciton using model name</span>
<span class="linenos">41</span>    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcServer</span><span class="p">(</span><span class="s2">&quot;server&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    <span class="c1"># Continue receiving requests until the connection is closed when all</span>
<span class="linenos">44</span>    <span class="c1"># clients have disconnected.</span>
<span class="linenos">45</span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos">46</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: receiving...&#39;</span><span class="p">)</span>
<span class="linenos">47</span>        <span class="n">retval</span><span class="p">,</span> <span class="n">rpc_in</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
<span class="linenos">48</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
<span class="linenos">49</span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: end of input&#39;</span><span class="p">)</span>
<span class="linenos">50</span>            <span class="k">break</span>
<span class="linenos">51</span>
<span class="linenos">52</span>        <span class="c1"># Compute fibonacci number</span>
<span class="linenos">53</span>        <span class="n">n</span> <span class="o">=</span> <span class="n">rpc_in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">54</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: Received request for Fibonacci number </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
<span class="linenos">55</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">get_fibonacci</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="linenos">56</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;server: Sending response for Fibonacci number </span><span class="si">%d</span><span class="s1">: </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
<span class="linenos">57</span>
<span class="linenos">58</span>        <span class="c1"># Send response back</span>
<span class="linenos">59</span>        <span class="n">flag</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
<span class="linenos">60</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
<span class="linenos">61</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;server: ERROR sending&#39;</span><span class="p">)</span>
<span class="linenos">62</span>
<span class="linenos">63</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python server&#39;</span><span class="p">)</span>
<span class="linenos">64</span>
<span class="linenos">65</span>    
<span class="linenos">66</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">67</span>    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">yggdrasil.interface.YggInterface</span> <span class="kn">import</span> <span class="p">(</span>
<span class="linenos"> 4</span>    <span class="n">YggRpcClient</span><span class="p">,</span> <span class="n">YggOutput</span><span class="p">)</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">client_index</span><span class="p">):</span>
<span class="linenos"> 8</span>    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to execute client communication with server that computes</span>
<span class="linenos"> 9</span><span class="sd">    numbers in the Fibonacci sequence.</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="sd">    Args:</span>
<span class="linenos">12</span><span class="sd">        iterations (int): The number of Fibonacci numbers to log.</span>
<span class="linenos">13</span><span class="sd">        client_index (int): Index of the client in total list of clients.</span>
<span class="linenos">14</span>
<span class="linenos">15</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">16</span>
<span class="linenos">17</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello from Python client</span><span class="si">%d</span><span class="s1">: iterations = </span><span class="si">%d</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">client_index</span><span class="p">,</span>
<span class="linenos">18</span>                                                            <span class="n">iterations</span><span class="p">))</span>
<span class="linenos">19</span>
<span class="linenos">20</span>    <span class="c1"># Set up connections matching yaml</span>
<span class="linenos">21</span>    <span class="c1"># RPC client-side connection will be $(server_name)_$(client_name)</span>
<span class="linenos">22</span>    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s2">&quot;server_client</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">client_index</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">log</span> <span class="o">=</span> <span class="n">YggOutput</span><span class="p">(</span><span class="s2">&quot;output_log</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">client_index</span><span class="p">,</span> <span class="s1">&#39;fib(</span><span class="si">%-2d</span><span class="s1">) = </span><span class="si">%-2d</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">24</span>
<span class="linenos">25</span>    <span class="c1"># Iterate over Fibonacci sequence</span>
<span class="linenos">26</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">27</span>        
<span class="linenos">28</span>        <span class="c1"># Call the server and receive response</span>
<span class="linenos">29</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;client</span><span class="si">%d</span><span class="s1">(Python): Calling fib(</span><span class="si">%d</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">client_index</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
<span class="linenos">30</span>        <span class="n">ret</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<span class="linenos">31</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos">32</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;client</span><span class="si">%d</span><span class="s1">(Python): RPC CALL ERROR&#39;</span> <span class="o">%</span> <span class="n">client_index</span><span class="p">)</span>
<span class="linenos">33</span>        <span class="n">fib</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos">34</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;client</span><span class="si">%d</span><span class="s1">(Python): Response fib(</span><span class="si">%d</span><span class="s1">) = </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">client_index</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">fib</span><span class="p">))</span>
<span class="linenos">35</span>
<span class="linenos">36</span>        <span class="c1"># Log result by sending it to the log connection</span>
<span class="linenos">37</span>        <span class="n">ret</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">fib</span><span class="p">)</span>
<span class="linenos">38</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos">39</span>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;client</span><span class="si">%d</span><span class="s1">(Python): SEND ERROR&#39;</span> <span class="o">%</span> <span class="n">client_index</span><span class="p">)</span>
<span class="linenos">40</span>
<span class="linenos">41</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Goodbye from Python client</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">client_index</span><span class="p">)</span>
<span class="linenos">42</span>
<span class="linenos">43</span>    
<span class="linenos">44</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="linenos">45</span>    <span class="c1"># Take number of iterations from the first argument and the</span>
<span class="linenos">46</span>    <span class="c1"># client index from the second</span>
<span class="linenos">47</span>    <span class="n">main</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson2.html">Example in other languages</a>)</p>
<p>The server YAML is the same as above. The client YAML now has entries for
two models which are both clients of the server model and call the same
source code.</p>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 4</span>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="linenos"> 5</span>  <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 6</span>  <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/server.py</span>
<span class="linenos"> 7</span>  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC server queue called &quot;server&quot;</span>
<span class="linenos"> 8</span>  <span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 9</span>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">params</span>
<span class="linenos">10</span>    <span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">11</span>      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Input/server_params.txt</span>
<span class="linenos">12</span>      <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ascii</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span>  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client1</span>
<span class="linenos"> 5</span>    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 6</span>    <span class="nt">args</span><span class="p">:</span>
<span class="linenos"> 7</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/client.py</span>
<span class="linenos"> 8</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>  <span class="c1"># Pass the number of iterations that should be performed</span>
<span class="linenos"> 9</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>  <span class="c1"># Pass index of the client</span>
<span class="linenos">10</span>    <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>  <span class="c1"># Creates an RPC client queue &quot;server_client&quot;</span>
<span class="linenos">11</span>    <span class="nt">outputs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log1</span>
<span class="linenos">12</span>  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client2</span>
<span class="linenos">13</span>    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos">14</span>    <span class="nt">args</span><span class="p">:</span>
<span class="linenos">15</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/client.py</span>
<span class="linenos">16</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>  <span class="c1"># Pass the number of iterations that should be performed</span>
<span class="linenos">17</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>  <span class="c1"># Pass index of the client</span>
<span class="linenos">18</span>    <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>  <span class="c1"># Creates an RPC client queue &quot;server_client&quot;</span>
<span class="linenos">19</span>    <span class="nt">outputs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log2</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos">22</span>  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log1</span>
<span class="linenos">23</span>    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client_output1.txt</span>
<span class="linenos">24</span>    <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">25</span>  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log2</span>
<span class="linenos">26</span>    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client_output2.txt</span>
<span class="linenos">27</span>    <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson2.html">Example in other languages</a>)</p>
<p>During runtime, request messages from both clients will be routed to the
server model which will process the requests in the order they are received.</p>
</div>
<div class="section" id="two-servers-two-clients">
<h2>Two Servers, Two Clients<a class="headerlink" href="#two-servers-two-clients" title="Permalink to this headline">¶</a></h2>
<p>There is also no limit on the number of copies of a server model that can be
used to responsd to RPC requests from the clients. In the example below, the
server and clients are the same as above, but 2 copies of the server model
are run as specified by the model <code class="docutils literal notranslate"><span class="pre">copies</span></code> parameter in the server YAML.</p>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 4</span>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="linenos"> 5</span>  <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 6</span>  <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/server.py</span>
<span class="linenos"> 7</span>  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>  <span class="c1"># Creates a RPC server queue called &quot;server&quot;</span>
<span class="linenos"> 8</span>  <span class="nt">copies</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="linenos"> 9</span>  <span class="nt">inputs</span><span class="p">:</span>
<span class="linenos">10</span>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">params</span>
<span class="linenos">11</span>    <span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">12</span>      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Input/server_params.txt</span>
<span class="linenos">13</span>      <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ascii</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nn">---</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="nt">models</span><span class="p">:</span>
<span class="linenos"> 4</span>  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client1</span>
<span class="linenos"> 5</span>    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 6</span>    <span class="nt">args</span><span class="p">:</span>
<span class="linenos"> 7</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/client.py</span>
<span class="linenos"> 8</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">3</span>  <span class="c1"># Pass the number of iterations that should be performed</span>
<span class="linenos"> 9</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1</span>  <span class="c1"># Pass index of the client</span>
<span class="linenos">10</span>    <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>  <span class="c1"># Creates an RPC client queue &quot;server_client&quot;</span>
<span class="linenos">11</span>    <span class="nt">outputs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log1</span>
<span class="linenos">12</span>  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client2</span>
<span class="linenos">13</span>    <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos">14</span>    <span class="nt">args</span><span class="p">:</span>
<span class="linenos">15</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./src/client.py</span>
<span class="linenos">16</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">5</span>  <span class="c1"># Pass the number of iterations that should be performed</span>
<span class="linenos">17</span>      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">2</span>  <span class="c1"># Pass index of the client</span>
<span class="linenos">18</span>    <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>  <span class="c1"># Creates an RPC client queue &quot;server_client&quot;</span>
<span class="linenos">19</span>    <span class="nt">outputs</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log2</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="nt">connections</span><span class="p">:</span>
<span class="linenos">22</span>  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log1</span>
<span class="linenos">23</span>    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client_output1.txt</span>
<span class="linenos">24</span>    <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="linenos">25</span>  <span class="p p-Indicator">-</span> <span class="nt">input</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">output_log2</span>
<span class="linenos">26</span>    <span class="nt">output</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client_output2.txt</span>
<span class="linenos">27</span>    <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson2b.html">Example in other languages</a>)</p>
<p>This allow client requests to be returned twice as fast, but precludes any
use of an internal state by the server model as there is no way for a client
to be sure that the same server model is responding to its requests and only
its requests.</p>
</div>
<div class="section" id="wrapped-function-server">
<h2>Wrapped Function Server<a class="headerlink" href="#wrapped-function-server" title="Permalink to this headline">¶</a></h2>
<p>Models that are created by letting yggdrasil automatically
<a class="reference internal" href="autowrap.html#autowrap-rst"><span class="std std-ref">wrap a function</span></a> can also act as servers and/or clients.
In the example below, the model acting as a server
is a very simple function that takes a string as an input and returns the
same string and the client is a function that takes a string as an input,
calls the server models with the input string and returns the response.</p>
<p>When a client model is autowrapped from a function, additional care must be
taken so that the client RPC comm can be reused during each call to the
model. In interpreted models (Python, R, MATLAB), this is done by passing the
keyword <code class="docutils literal notranslate"><span class="pre">global_scope</span></code> to the RPC client interface initialization function
(<code class="docutils literal notranslate"><span class="pre">YggRpcClient</span></code> in Python). In compiled models (C, C++, Fortran), this is
done by framing RPC client interface initialization calls with the
<code class="docutils literal notranslate"><span class="pre">WITH_GLOBAL_SCOPE</span></code> macro (see the language specific versions of this
example for specifics).</p>
<p>Model Code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="n">in_buf</span><span class="p">):</span>
<span class="linenos">2</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;server(Python): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">in_buf</span><span class="p">)</span>
<span class="linenos">3</span>    <span class="n">out_buf</span> <span class="o">=</span> <span class="n">in_buf</span>
<span class="linenos">4</span>    <span class="k">return</span> <span class="n">out_buf</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">yggdrasil.languages.Python.YggInterface</span> <span class="kn">import</span> <span class="n">YggRpcClient</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">model_function</span><span class="p">(</span><span class="n">in_buf</span><span class="p">):</span>
<span class="linenos"> 5</span>    <span class="c1"># The global_scope keyword is required to ensure that the comm persists</span>
<span class="linenos"> 6</span>    <span class="c1"># between function calls</span>
<span class="linenos"> 7</span>    <span class="n">rpc</span> <span class="o">=</span> <span class="n">YggRpcClient</span><span class="p">(</span><span class="s1">&#39;server_client&#39;</span><span class="p">,</span> <span class="n">global_scope</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos"> 8</span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;client(Python): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">in_buf</span><span class="p">)</span>
<span class="linenos"> 9</span>    <span class="n">ret</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">rpc</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">in_buf</span><span class="p">)</span>
<span class="linenos">10</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span>
<span class="linenos">11</span>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;client(Python): RPC CALL ERROR&#39;</span><span class="p">)</span>
<span class="linenos">12</span>    <span class="n">out_buf</span> <span class="o">=</span> <span class="n">result</span>
<span class="linenos">13</span>    <span class="k">return</span> <span class="n">out_buf</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson3.html">Example in other languages</a>)</p>
<p>The RPC connection between the server and the client is controlled by the
same <code class="docutils literal notranslate"><span class="pre">is_server</span></code> and <code class="docutils literal notranslate"><span class="pre">client_of</span></code> YAML parameters as before.</p>
<p>Model YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos">2</span>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="linenos">3</span>  <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos">4</span>  <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/server.py</span>
<span class="linenos">5</span>  <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">model_function</span>
<span class="linenos">6</span>  <span class="nt">is_server</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">True</span>
</pre></div>
</div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="nt">model</span><span class="p">:</span>
<span class="linenos"> 2</span>  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">client</span>
<span class="linenos"> 3</span>  <span class="nt">language</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python</span>
<span class="linenos"> 4</span>  <span class="nt">args</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./src/client.py</span>
<span class="linenos"> 5</span>  <span class="nt">function</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">model_function</span>
<span class="linenos"> 6</span>  <span class="nt">client_of</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">server</span>
<span class="linenos"> 7</span>  <span class="nt">inputs</span><span class="p">:</span>
<span class="linenos"> 8</span>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">in_buf</span>
<span class="linenos"> 9</span>    <span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">10</span>      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Input/input.txt</span>
<span class="linenos">11</span>      <span class="nt">filetype</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ascii</span>
<span class="linenos">12</span>  <span class="nt">outputs</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">out_buf</span>
<span class="linenos">14</span>    <span class="nt">default_file</span><span class="p">:</span>
<span class="linenos">15</span>      <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./client_output.txt</span>
<span class="linenos">16</span>      <span class="nt">in_temp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>(<a class="reference external" href="examples/rpc_lesson3.html">Example in other languages</a>)</p>
<p>By default, all inputs to a wrapped server function will be used in
the RPC call. However if only some of the inputs should be passed in by the
RPC calls, they can be specified explicitly by providing the <code class="docutils literal notranslate"><span class="pre">is_server</span></code>
parameter with a map that contains <code class="docutils literal notranslate"><span class="pre">input</span></code> and <code class="docutils literal notranslate"><span class="pre">output</span></code> parameters that
map to the names of function input/output variables (as in the case of
using existing input/output channels above).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="autowrap.html" class="btn btn-neutral float-right" title="Autowrapping Model Functions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="formatted_io.html" class="btn btn-neutral float-left" title="Formatted I/O" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>