<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Docker Containers &mdash; yggdrasil v1.8.5 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="C-Style Format Strings" href="c_format_strings.html" />
    <link rel="prev" title="Running Integrations as Services" href="remote.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            yggdrasil
          </a>
              <div class="version">
                v1.8.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="hpc.html">High Performance Computing (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="remote.html">Running Integrations as Services</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Docker Containers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#release-images">Release Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#executable-images">Executable Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#service-images">Service Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#development-images">Development Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-new-images">Building New Images</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">yggdrasil</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Docker Containers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/docker.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="docker-containers">
<span id="docker-rst"></span><h1>Docker Containers<a class="headerlink" href="#docker-containers" title="Permalink to this heading">¶</a></h1>
<p>For convenience, yggdrasil provides <a class="reference external" href="https://www.docker.com/">Docker</a> images and tools for building Docker images. To get started using these images, you will need to do a few things first.</p>
<ol class="arabic simple">
<li><p><strong>Download and install docker</strong> from <a class="reference external" href="https://docs.docker.com/get-docker/">here</a>.</p></li>
<li><p><strong>Sign-up for DockerHub</strong> <a class="reference external" href="https://hub.docker.com/">here</a>, start docker, and sign-in using your docker hub credentials (either via the desktop app or the <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/login/">command line</a>).</p></li>
</ol>
<section id="release-images">
<h2>Release Images<a class="headerlink" href="#release-images" title="Permalink to this heading">¶</a></h2>
<p>For each tagged release of yggdrasil, a Docker image will be published to the <code class="docutils literal notranslate"><span class="pre">cropsinsilico/yggdrasil</span></code> <a class="reference external" href="https://hub.docker.com/repository/docker/cropsinsilico/yggdrasil">DockerHub repository</a>.</p>
<p>After installing Docker, you can pull the latest release image by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker pull cropsinsilico/yggdrasil
</pre></div>
</div>
<p>or if you need a specific version, <code class="docutils literal notranslate"><span class="pre">[VER]</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker pull cropsinsilico/yggdrasil:v[VER]
</pre></div>
</div>
<p>You can then run the image as an interactive container:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run -it cropsinsilico/yggdrasil
</pre></div>
</div>
<p>If you pulled a specific version, include the version tag in the run command (e.g. <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-it</span> <span class="pre">cropsinsilico/yggdrasil:v[VER]</span></code>).</p>
<p>This will start a container using the image and will open a command prompt with container access. You can run yggdrasil commands from this prompt. If you would like to run an integration that uses models from your local machine, you will need to mount the model directory as a volume when you launch the container. For example, if you have a model contained in the directory <code class="docutils literal notranslate"><span class="pre">/path/to/model</span></code>, then you can mount the model as a volume in the container under the directory <code class="docutils literal notranslate"><span class="pre">/model_vol</span></code> via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run -it --volume=/path/to/model:/model_vol cropsinsilico/yggdrasil
</pre></div>
</div>
<p>You will then be able to access the model from inside the container and can run integrations using that model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the directory being mounted is not in the directory that the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code> command is being issued from, the path will need to be absolute.</p>
</div>
</section>
<section id="executable-images">
<h2>Executable Images<a class="headerlink" href="#executable-images" title="Permalink to this heading">¶</a></h2>
<p>In addition to release images, an executable image will be published for each tagged release of yggdrasil. Executable images will be published to the <code class="docutils literal notranslate"><span class="pre">cropsinsilico/yggdrasil-executable</span></code> <a class="reference external" href="https://hub.docker.com/repository/docker/cropsinsilico/yggdrasil-executable">DockerHub repository</a> and can be pulled via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$  docker pull cropsinsilico/yggdrasil-executable
</pre></div>
</div>
<p>Executable images are different than the release images in that they are meant to be treated as an executable and can be used to run integrations using yggdrasil without opening the container command line. Running the image without any arguments will display the help for the <code class="docutils literal notranslate"><span class="pre">yggrun</span></code> CLI.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run -it cropsinsilico/yggdrasil-executable
</pre></div>
</div>
<p>YAML specification files (and any other <code class="docutils literal notranslate"><span class="pre">yggrun</span></code> flags) can be passed to this command to run an integration. If they are not located in a Git repository (see <a class="reference internal" href="getting_started.html#git-models-rst"><span class="std std-ref">this discussion</span></a> for a discussion of using repo-base models), then they must be added to the container via a mounted volume and the path provided to the command should be relative to the directory that the volume is mounted at in the container.</p>
<p>For example, if you want to use a YAML, <code class="docutils literal notranslate"><span class="pre">/path/to/model/model.yml</span></code> that uses models in the <code class="docutils literal notranslate"><span class="pre">/path/to/model/</span></code> directory, you would add the directory containing the YAML as a volume and call the executable with YAML as input as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run -it --volume=/path/to/model/:/model_vol cropsinsilico/yggdrasil-executable /model_vol/model.yml
</pre></div>
</div>
<p>For convenience, you can also download/copy the Python script located <a class="reference external" href="https://github.com/cropsinsilico/yggdrasil/blob/main/utils/run_docker.py">here</a>, which allows you to just specify the paths to the YAMLs and any other <code class="docutils literal notranslate"><span class="pre">yggrun</span></code> options (it will set the volumes based on the directories containing the YAMLs). The above example would then be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python run_docker.py /model_vol/model.yml
</pre></div>
</div>
<p>In addition, this script allows the paths to the YAMLs to be relative rather than absolute and, if passed the <code class="docutils literal notranslate"><span class="pre">--pull-docker-image</span></code> flag, it can pull the latest executable image before running it.</p>
</section>
<section id="service-images">
<span id="service-docker-rst"></span><h2>Service Images<a class="headerlink" href="#service-images" title="Permalink to this heading">¶</a></h2>
<p>yggdrasil also provides images that run yggdrasil’s <a class="reference internal" href="remote.html#remote-rst"><span class="std std-ref">integration service manager</span></a> as a web application. As the service images do not contain any services by default, these images are best used as bases for building your own Docker image that copies in a file containing a mapping of integrations that should be exposed as services and those directories containing models.</p>
<p>For example, if you have a services file <code class="docutils literal notranslate"><span class="pre">services.yml</span></code> that defines two integrations.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">foo</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">foo/model.yml</span>
<span class="nt">bar</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bar/modelA.yml</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">oth/modelB.yml</span>
</pre></div>
</div>
<p>Then the Dockerfile that will be able to run those services is</p>
<div class="highlight-docker notranslate"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="w"> </span><span class="s">cropsinsilico/yggdrasil-service:v1.8.0</span>
<span class="k">COPY</span><span class="w"> </span>services.yml<span class="w"> </span>.
<span class="k">COPY</span><span class="w"> </span>foo<span class="w"> </span>./foo
<span class="k">COPY</span><span class="w"> </span>bar<span class="w"> </span>./bar
<span class="k">COPY</span><span class="w"> </span>oth<span class="w"> </span>./oth
</pre></div>
</div>
<p>After building, the new Docker image (e.g. <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span> <span class="pre">-t</span> <span class="pre">my-yggdrasil-service</span> <span class="pre">.</span></code>), the app is started by running the image, taking care to set the port that will be used by the app via an environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker run --env PORT=5000 my-yggdrasil-service
</pre></div>
</div>
<p>The port that should be used in production will be determined by the host machine (e.g. a port exposed on a cloud resource). Such derived Docker images are also suitable for deployment via the <a class="reference external" href="https://www.heroku.com/">Heroku</a> platform (see <a class="reference external" href="https://devcenter.heroku.com/articles/container-registry-and-runtime">this</a> tutorial on registering Docker images with Heroku).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The yggdrasil service manager application automatically looks for a <code class="docutils literal notranslate"><span class="pre">services.yml</span></code> file in the <code class="docutils literal notranslate"><span class="pre">WORKDIR</span></code> for the container at startup. If you put the file in another location or give it another name, you will need to set the <code class="docutils literal notranslate"><span class="pre">INTEGRATION_SERVICES</span></code> environment variable for the container to the file’s path.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For security, YAML files located in remote Git repositories will not be allowed as part of integrations that the service manager runs; such repositories should be cloned in the Docker image instead.</p>
</div>
</section>
<section id="development-images">
<h2>Development Images<a class="headerlink" href="#development-images" title="Permalink to this heading">¶</a></h2>
<p>Occasionally during development it may be necessary for the yggdrasil team to create images for specific commits. These will be published to the <code class="docutils literal notranslate"><span class="pre">cropsinsilico/yggdrasil-dev</span></code> <a class="reference external" href="https://hub.docker.com/repository/docker/cropsinsilico/yggdrasil-dev">DockerHub repository</a>. If you know that such an image exists for a commit with the ID string <code class="docutils literal notranslate"><span class="pre">[COMMIT]</span></code>, you can pull it via:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ docker pull cropsinsilico/yggdrasil-dev:[COMMIT]
</pre></div>
</div>
<p>Such images operate in the same fashion as the release images described above and can be run in the same manner.</p>
</section>
<section id="building-new-images">
<h2>Building New Images<a class="headerlink" href="#building-new-images" title="Permalink to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">utils/build_docker.py</span></code> from the yggdrasil repository can be used to build/push new Docker images.</p>
<p>To build a new Docker image containing the tagged release, <code class="docutils literal notranslate"><span class="pre">RELEASE</span></code>, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python utils/build_docker.py --release RELEASE
</pre></div>
</div>
<p>To build a new Docker image containing commit, <code class="docutils literal notranslate"><span class="pre">COMMIT</span></code>, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python utils/build_docker.py --commit COMMIT
</pre></div>
</div>
<p>If you add the <code class="docutils literal notranslate"><span class="pre">--push</span></code> flag to either of these commands, the image will be pushed to DockerHub after it is built. If you add the <code class="docutils literal notranslate"><span class="pre">executable</span></code> argument, the image will be built such that it exposes the yggdrasil CLI and can be used as an executable image in the way described above. If you add the <code class="docutils literal notranslate"><span class="pre">service</span></code> argument, a service image with the specified release/commit will be built.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="remote.html" class="btn btn-neutral float-left" title="Running Integrations as Services" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="c_format_strings.html" class="btn btn-neutral float-right" title="C-Style Format Strings" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Meagan Lang, David Raila.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>