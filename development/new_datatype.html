

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Defining New Datatypes &mdash; yggdrasil v1.6.3+1.g5570f65a0.dirty documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="TODO" href="todo.html" />
    <link rel="prev" title="Adding Support for a New Language" href="new_language.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autowrap.html#notes-on-autowrapping-c-c-model-functions">Notes on Autowrapping C/C++ Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Development</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="general.html">General Development Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="release.html">Release Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="new_language.html">Adding Support for a New Language</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Defining New Datatypes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-defined-datatypes">JSON Defined Datatypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-defined-datatypes">Class Defined Datatypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-defined-properties">Class Defined Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="todo.html">TODO</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Development</a> &raquo;</li>
        
      <li>Defining New Datatypes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/development/new_datatype.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="defining-new-datatypes">
<span id="new-datatype-rst"></span><h1>Defining New Datatypes<a class="headerlink" href="#defining-new-datatypes" title="Permalink to this headline">¶</a></h1>
<p>yggdrasil supports two methods for defining new datatypes, either by
creating an alias for a complex datatype expressed in terms of the existing
datatypes (as described <a class="reference internal" href="../advanced/datatypes.html#datatypes-rst"><span class="std std-ref">here</span></a>) or through a Python class.
Reguardless of the method used, the datatype will automatically be registered
and added to the metaschema.</p>
<div class="section" id="json-defined-datatypes">
<h2>JSON Defined Datatypes<a class="headerlink" href="#json-defined-datatypes" title="Permalink to this headline">¶</a></h2>
<p>To define a datatype in terms of the existing datatypes, developers can save
the schema defining the datatype to a .json file in the
yggdrasil/metaschema/datatypes/schemas directory. yggdrasil automatically
loads schemas found in that directory and creates metaschema type classes from
them. The created class’s name will be based on the ‘title’ field listed in
the schema. Schemas must have, at minimum, values for the ‘title’, ‘description’,
and ‘type’ metaschema properties and must be a valid schema (i.e. can be
validated using the <a class="reference internal" href="../advanced/metaschema.html#metaschema-rst"><span class="std std-ref">metaschema</span></a>.</p>
</div>
<div class="section" id="class-defined-datatypes">
<h2>Class Defined Datatypes<a class="headerlink" href="#class-defined-datatypes" title="Permalink to this headline">¶</a></h2>
<p>Class defined data types should subclass the
<a class="reference internal" href="../yggdrasil.metaschema.datatypes.html#yggdrasil.metaschema.datatypes.MetaschemaType.MetaschemaType" title="yggdrasil.metaschema.datatypes.MetaschemaType.MetaschemaType"><code class="xref py py-class docutils literal notranslate"><span class="pre">yggdrasil.metaschema.datatypes.MetaschemaType.MetaschemaType</span></code></a> base.
The file containing the class definitions should reside in the
‘yggdrasil/metaschema/datatypes/’ directory.</p>
<p>At a minimum, classes for types defined in
such a manner must override the following method:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encode_data</span></code>: Takes as input an object for encoding and a type definition
and returns the encoded object which is of a type that is encodable by the
standard JSON library.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">decode_data</span></code>: The reverse of <code class="docutils literal notranslate"><span class="pre">encode_data</span></code>. Takes as input an encoded
object and the associated type definitions and returns the decoded object.</p></li>
</ul>
<p>In addition, the behavior of types defined using classes are also
controlled by the following class attributes:</p>
<table class="docutils align-default" id="class-table-metaschematype-classattr-rst">
<colgroup>
<col style="width: 18%" />
<col style="width: 67%" />
<col style="width: 7%" />
<col style="width: 8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>description</p></td>
<td><p>A short description of the type.</p></td>
<td><p>X</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-odd"><td><p>name</p></td>
<td><p>Name of the type for use in YAML files &amp; form options.</p></td>
<td><p>X</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-even"><td><p>cross_language_support</p></td>
<td><p>If True, this indicates the types should be serializable across most (if not
all) of the supported languages. If False, this type is not required to be
serializable except to/from Python. Defaults to True.</p></td>
<td></td>
<td><p>bool</p></td>
</tr>
<tr class="row-odd"><td><p>definition_properties</p></td>
<td><p>Type properties that are required for YAML or form entries specifying the type.
These will also be used to validate type definitions. These properties will be
added to those from the parent type class unless inherit_properties is False.
Defaults to [‘type’].</p></td>
<td></td>
<td><p>list</p></td>
</tr>
<tr class="row-even"><td><p>extract_properties</p></td>
<td><p>Properties that will be extracted from the metadata of a message to construct
the type definition. These properties will be added to those from the parent
class unless inherit_properties is False. Defaults to [‘type’, ‘title’].</p></td>
<td></td>
<td><p>list</p></td>
</tr>
<tr class="row-odd"><td><p>inherit_properties</p></td>
<td><p>If True, a type class’s properties will be a combination of the parent class’s
properties and those explicitly defined in the child class. If False, a type
class’s properties will only be those explicitly defined in the child class. If
a list of property attributes, only properties specified by those attributes
will be inherited from the parent class.</p></td>
<td></td>
<td><p>bool, list</p></td>
</tr>
<tr class="row-even"><td><p>is_fixed</p></td>
<td><p>True if the type is a fixed version of another type. See FixedMetaschemaType for
details.</p></td>
<td></td>
<td><p>bool</p></td>
</tr>
<tr class="row-odd"><td><p>loaded_schema_file</p></td>
<td><p>The path to the file the schema for the type was loaded from if it was loaded.</p></td>
<td></td>
<td><p>str, None</p></td>
</tr>
<tr class="row-even"><td><p>metadata_properties</p></td>
<td><p>Type properties that are required for deserializing instances of the type that
have been serialized. These properties will be added to those from the parent
class unless inherit_properties is False. Defaults to [‘type’].</p></td>
<td></td>
<td><p>list</p></td>
</tr>
<tr class="row-odd"><td><p>properties</p></td>
<td><p>List of JSON schema properties that this type uses. These properties will be
added to those form the paretn type class unless inherit_properties is False.
Defaults to [‘type’, ‘title’].</p></td>
<td></td>
<td><p>list</p></td>
</tr>
<tr class="row-even"><td><p>python_types</p></td>
<td><p>List of python types that this type encompasses. [REQUIRED].</p></td>
<td></td>
<td><p>list</p></td>
</tr>
<tr class="row-odd"><td><p>schema_file</p></td>
<td><p>If set, the class’s schema is loaded from the specified file at registration and
moved to the loaded_schema_file class attribute. Defaults to None.</p></td>
<td></td>
<td><p>str, None</p></td>
</tr>
<tr class="row-even"><td><p>specificity</p></td>
<td><p>Specificity of the type. Types with larger values are more specific while types
with smaller values are more general. Base types have a specificity of 0. More
specific types are checked first before more general ones.</p></td>
<td></td>
<td><p>int</p></td>
</tr>
</tbody>
</table>
<p>For class defined data types, developers should also develop tests for the
new data types using
<a class="reference internal" href="../yggdrasil.metaschema.datatypes.tests.html#yggdrasil.metaschema.datatypes.tests.test_MetaschemaType.TestMetaschemaType" title="yggdrasil.metaschema.datatypes.tests.test_MetaschemaType.TestMetaschemaType"><code class="xref py py-class docutils literal notranslate"><span class="pre">yggdrasil.metaschema.datatypes.tests.test_MetaschemaType.TestMetaschemaType</span></code></a>
as a base class. Generally, developers should be able to control the testing of
their class by specifying values for the following class attributes:</p>
</div>
<div class="section" id="class-defined-properties">
<h2>Class Defined Properties<a class="headerlink" href="#class-defined-properties" title="Permalink to this headline">¶</a></h2>
<p>yggdrasil also supports the addition of new metaschema properties by subclassing
the <a class="reference internal" href="../yggdrasil.metaschema.properties.html#yggdrasil.metaschema.properties.MetaschemaProperty.MetaschemaProperty" title="yggdrasil.metaschema.properties.MetaschemaProperty.MetaschemaProperty"><code class="xref py py-class docutils literal notranslate"><span class="pre">yggdrasil.metaschema.properties.MetaschemaProperty.MetaschemaProperty</span></code></a>
The file containing the class definitions should reside in the
‘yggdrasil/metaschema/properties/’ directory.</p>
<p>At a minimum, classes for properties defined in
such a manner must override the following method:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">encode</span></code>: Takes as input an object for encoding and a type definition
and returns the value for the property describing the object.</p></li>
</ul>
<p>In addition, the behavior of properties are also
controlled by the following class attributes:</p>
<table class="docutils align-default" id="class-table-metaschemaproperty-classattr-rst">
<colgroup>
<col style="width: 12%" />
<col style="width: 77%" />
<col style="width: 8%" />
<col style="width: 4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Option</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Required</p></th>
<th class="head"><p>Type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>name</p></td>
<td><p>Name of the property.</p></td>
<td><p>X</p></td>
<td><p>str</p></td>
</tr>
<tr class="row-odd"><td><p>schema</p></td>
<td><p>JSON schema describing valid values for the property.</p></td>
<td><p>X</p></td>
<td><p>dict</p></td>
</tr>
<tr class="row-even"><td><p>python_types</p></td>
<td><p>Python types of instances that the property is valid for. [AUTOMATED]</p></td>
<td></td>
<td><p>list</p></td>
</tr>
<tr class="row-odd"><td><p>types</p></td>
<td><p>Types of instances that the property is valid for. [AUTOMATED]</p></td>
<td></td>
<td><p>list</p></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="todo.html" class="btn btn-neutral float-right" title="TODO" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="new_language.html" class="btn btn-neutral float-left" title="Adding Support for a New Language" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>