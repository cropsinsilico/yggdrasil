<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>yggdrasil.drivers.CompiledModelDriver &mdash; yggdrasil v1.8.2 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> yggdrasil
          </a>
              <div class="version">
                v1.8.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command Line Interface (CLI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hpc.html">High Performance Computing (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../remote.html">Running Integrations as Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docker.html">Docker Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">yggdrasil</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
          <li><a href="../drivers.html">yggdrasil.drivers</a> &raquo;</li>
      <li>yggdrasil.drivers.CompiledModelDriver</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for yggdrasil.drivers.CompiledModelDriver</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">six</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">platform</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">scanf</span>
<span class="kn">from</span> <span class="nn">yggdrasil.drivers.ModelDriver</span> <span class="kn">import</span> <span class="n">ModelDriver</span><span class="p">,</span> <span class="n">remove_products</span>
<span class="kn">from</span> <span class="nn">yggdrasil.components</span> <span class="kn">import</span> <span class="n">import_component</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">_compiler_registry</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">_linker_registry</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">_archiver_registry</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<span class="n">_default_libtype</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
<span class="n">_conda_prefix</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_conda_prefix</span><span class="p">()</span>
<span class="n">_venv_prefix</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_venv_prefix</span><span class="p">()</span>
<span class="n">_system_suffix</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="k">if</span> <span class="n">_conda_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">_system_suffix</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">_conda_prefix</span><span class="p">)</span>
<span class="k">if</span> <span class="n">_venv_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">_system_suffix</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">_venv_prefix</span><span class="p">)</span>
<span class="n">_buildfile_locks_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
<span class="n">_buildfile_locks</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="LockedFile"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LockedFile">[docs]</a><span class="k">class</span> <span class="nc">LockedFile</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for locking files during compilation.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">when_to_lock</span><span class="o">=</span><span class="s2">&quot;init&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">when_to_lock</span> <span class="o">=</span> <span class="n">when_to_lock</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;str: Message form.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;fname&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;when_to_lock&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">when_to_lock</span><span class="p">}</span></div>


<div class="viewcode-block" id="get_compatible_tool"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.get_compatible_tool">[docs]</a><span class="k">def</span> <span class="nf">get_compatible_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a compatible compilation tool that can be used in</span>
<span class="sd">    conjunction with the one provided based on the registry of</span>
<span class="sd">    compilation toolsets.</span>

<span class="sd">    Args:</span>
<span class="sd">        tool (CompilationToolBase, str): Compilation tool or name of</span>
<span class="sd">            a compilation tool to get compatible counterpart to.</span>
<span class="sd">        tooltype (str): Type of compilation tool that should be</span>
<span class="sd">            returned.</span>
<span class="sd">        language (str): Language that compilation tool should handle.</span>
<span class="sd">        default (CompilationToolBase, optional): Default tool that</span>
<span class="sd">            should be returned if not compatible tool can be located.</span>
<span class="sd">            Defaults to False and an error will be raised if a tool</span>
<span class="sd">            cannot be located.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CompilationToolBase: Compatible compilation tool class.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">tooltype</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">default</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Could not locate </span><span class="si">%s</span><span class="s2"> for </span><span class="si">%s</span><span class="s2"> language &quot;</span>
                              <span class="s2">&quot;associated with a tool named </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">tool</span><span class="p">))</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">out</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>  <span class="c1"># pragma: debug</span>
        <span class="k">return</span> <span class="n">tool</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">tooltype</span> <span class="o">==</span> <span class="n">tooltype</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">language</span> <span class="ow">in</span> <span class="n">tool</span><span class="o">.</span><span class="n">languages</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tool</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">get_compilation_tool_registry</span><span class="p">(</span><span class="n">tooltype</span><span class="p">)[</span><span class="s1">&#39;by_toolset&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tool</span><span class="o">.</span><span class="n">compatible_toolsets</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ix</span><span class="o">.</span><span class="n">is_installed</span><span class="p">():</span>
                    <span class="n">reg</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">language</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ix</span><span class="p">]</span>
                    <span class="k">return</span> <span class="n">ix</span>
    <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;Could not locate </span><span class="si">%s</span><span class="s2"> for </span><span class="si">%s</span><span class="s2"> language &quot;</span>
                      <span class="s2">&quot;that is compatible with the </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">)</span>
                     <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">tool</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span>
                        <span class="n">tool</span><span class="o">.</span><span class="n">tooltype</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_compilation_tool_registry"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.get_compilation_tool_registry">[docs]</a><span class="k">def</span> <span class="nf">get_compilation_tool_registry</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">init_languages</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the registry containing compilation tools of the specified type.</span>

<span class="sd">    Args:</span>
<span class="sd">        tooltype (str): Type of tool. Valid values include &#39;compiler&#39;, &#39;linker&#39;,</span>
<span class="sd">            and &#39;archiver&#39;.</span>
<span class="sd">        init_languages (list, optional): List of languages that should be</span>
<span class="sd">            imported prior to returning the registry, thereby populating the</span>
<span class="sd">            compilation tools for that language. Defaults to None and is</span>
<span class="sd">            ignored.</span>

<span class="sd">    Returns:</span>
<span class="sd">        collections.OrderedDict: Registry for specified type.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tooltype is not a valid value (i.e. &#39;compiler&#39;, &#39;linker&#39;,</span>
<span class="sd">            or &#39;archiver&#39;).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tooltype</span> <span class="o">==</span> <span class="s1">&#39;compiler&#39;</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">_compiler_registry</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">_compiler_registry</span>
    <span class="k">elif</span> <span class="n">tooltype</span> <span class="o">==</span> <span class="s1">&#39;linker&#39;</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">_linker_registry</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">_linker_registry</span>
    <span class="k">elif</span> <span class="n">tooltype</span> <span class="o">==</span> <span class="s1">&#39;archiver&#39;</span><span class="p">:</span>
        <span class="k">global</span> <span class="n">_archiver_registry</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">_archiver_registry</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;tooltype &#39;</span><span class="si">%s</span><span class="s2">&#39; is not supported. This keyword must &quot;</span>
                          <span class="s2">&quot;be one of &#39;compiler&#39;, &#39;linker&#39;, or &#39;archiver&#39;.&quot;</span><span class="p">)</span>
                         <span class="o">%</span> <span class="n">tooltype</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_languages</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">init_languages</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;by_language&#39;</span><span class="p">,</span> <span class="p">{}):</span>
                <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">reg</span></div>


<div class="viewcode-block" id="find_compilation_tool"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.find_compilation_tool">[docs]</a><span class="k">def</span> <span class="nf">find_compilation_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">language</span><span class="p">,</span> <span class="n">allow_failure</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">dont_check_installation</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the prioritized class for a compilation tool of a certain type</span>
<span class="sd">    that can handle the specified language.</span>

<span class="sd">    Args:</span>
<span class="sd">        tooltype (str): Type of tool. Valid values include &#39;compiler&#39;, &#39;linker&#39;,</span>
<span class="sd">            and &#39;archiver&#39;.</span>
<span class="sd">        allow_failure (bool, optional): If True and a tool cannot be located,</span>
<span class="sd">            None will be returned. Otherwise, an error will be raised if a tool</span>
<span class="sd">            cannot be located. Defaults to False.</span>
<span class="sd">        dont_check_installation (bool, optional): If True, the first tool</span>
<span class="sd">            in the registry will be returned even if it is not installed.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Name of the determined tool type.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If a tool cannot be located for the specified language on</span>
<span class="sd">            the current platform and allow_failure is False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">get_compilation_tool_registry</span><span class="p">(</span><span class="n">tooltype</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;by_language&#39;</span><span class="p">,</span> <span class="p">{})</span>
    <span class="k">for</span> <span class="n">kname</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">reg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">dont_check_installation</span>
             <span class="ow">or</span> <span class="p">((</span><span class="n">platform</span><span class="o">.</span><span class="n">_platform</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">platforms</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span><span class="o">.</span><span class="n">is_installed</span><span class="p">()))):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">kname</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">allow_failure</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not locate a </span><span class="si">%s</span><span class="s2"> tool.&quot;</span> <span class="o">%</span> <span class="n">tooltype</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="get_compilation_tool"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.get_compilation_tool">[docs]</a><span class="k">def</span> <span class="nf">get_compilation_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the class providing information about a compilation tool.</span>

<span class="sd">    Args:</span>
<span class="sd">        tooltype (str): Type of tool. Valid values include &#39;compiler&#39;, &#39;linker&#39;,</span>
<span class="sd">            and &#39;archiver&#39;.</span>
<span class="sd">        name (str): Name or path to the desired compilation tool.</span>
<span class="sd">        default (object, optional): Value that should be returned if a tool</span>
<span class="sd">            cannot be located. If False, an error will be raised. Defaults to</span>
<span class="sd">            False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CompilationToolBase: Class providing access to the specified tool.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If a tool with the provided name cannot be located.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">names_to_try</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">name</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>
        <span class="n">names_to_try</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names_to_try</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">get_compilation_tool_registry</span><span class="p">(</span><span class="n">tooltype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names_to_try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">reg</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not locate a </span><span class="si">%s</span><span class="s2"> tool with name &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">CompilationToolMeta</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">toolname</span> <span class="o">!=</span> <span class="n">name</span><span class="p">)</span>
         <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">or</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">name</span><span class="p">)))):</span>
        <span class="n">out</span><span class="o">.</span><span class="n">executable</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">out</span></div>


<span class="c1"># TODO: Cannot currently make compilation tools components because</span>
<span class="c1"># of circular imports</span>
<div class="viewcode-block" id="CompilationToolMeta"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolMeta">[docs]</a><span class="k">class</span> <span class="nc">CompilationToolMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Meta class for registering compilers.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">):</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">meta</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;Base&#39;</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_dont_register</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">cls</span>
            <span class="k">assert</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;is_build_tool&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">languages</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">build_language</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">languages</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">languages</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">languages</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;The name &#39;</span><span class="si">%s</span><span class="s2">&#39; for class </span><span class="si">%s</span><span class="s2"> is also in &quot;</span>
                                  <span class="s2">&quot;its list of aliases: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aliases</span><span class="p">))</span>
            <span class="c1"># Register by toolname &amp; language</span>
            <span class="n">reg</span> <span class="o">=</span> <span class="n">get_compilation_tool_registry</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;by_language&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">:</span>
                <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;by_toolset&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">:</span>
                <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_toolset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">]</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aliases</span><span class="p">:</span>
                <span class="c1"># Register by toolname</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">reg</span><span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">cls</span><span class="p">)):</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> toolname &#39;</span><span class="si">%s</span><span class="s2">&#39; already registered &quot;</span>
                         <span class="s2">&quot;(class = </span><span class="si">%s</span><span class="s2">, existing = </span><span class="si">%s</span><span class="s2">).&quot;</span><span class="p">)</span>
                        <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">x</span><span class="p">,</span> <span class="bp">cls</span><span class="p">,</span> <span class="n">reg</span><span class="p">[</span><span class="n">x</span><span class="p">]))</span>
                <span class="n">reg</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
                <span class="c1"># Register by language</span>
                <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span>
                    <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_language&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_language&#39;</span><span class="p">][</span><span class="n">lang</span><span class="p">]:</span>  <span class="c1"># pragma: debug</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> toolname &#39;</span><span class="si">%s</span><span class="s2">&#39; already registered for &quot;</span>
                                          <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> language.&quot;</span><span class="p">)</span>
                                         <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">x</span><span class="p">,</span> <span class="n">lang</span><span class="p">))</span>
                    <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_language&#39;</span><span class="p">][</span><span class="n">lang</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span>
                <span class="c1"># Register by toolset</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compatible_toolsets</span><span class="p">:</span>
                    <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_toolset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
                    <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span>
                        <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_toolset&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lang</span><span class="p">,</span> <span class="p">[])</span>
                        <span class="n">reg</span><span class="p">[</span><span class="s1">&#39;by_toolset&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="n">lang</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span></div>


<div class="viewcode-block" id="CompilationToolBase"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase">[docs]</a><span class="nd">@six</span><span class="o">.</span><span class="n">add_metaclass</span><span class="p">(</span><span class="n">CompilationToolMeta</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">CompilationToolBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for compilation command line tools.</span>

<span class="sd">    Class Attributes:</span>
<span class="sd">        toolname (str): Tool name used for registration and as a default for the</span>
<span class="sd">            executable. [REQUIRED]</span>
<span class="sd">        aliases (list): Alternative names that the tool might have.</span>
<span class="sd">        tooltype (str): Tool type. One of &#39;compiler&#39;, &#39;linker&#39;, or &#39;archiver&#39;.</span>
<span class="sd">            [AUTOMATED]</span>
<span class="sd">        languages (list): Programming languages that this tool can be used on.</span>
<span class="sd">            [REQUIRED]</span>
<span class="sd">        platforms (list): Platforms that the tool is available on. Defaults to</span>
<span class="sd">            [&#39;Windows&#39;, &#39;MacOS&#39;, &#39;Linux&#39;].</span>
<span class="sd">        default_executable (str): The default tool executable command if</span>
<span class="sd">            different than the toolname.</span>
<span class="sd">        default_executable_env (str): Environment variable where the executable</span>
<span class="sd">            command might be stored.</span>
<span class="sd">        default_flags (list): Default flags that should be used when calling the</span>
<span class="sd">            tool (e.g. for verbose output or enhanced warnings).</span>
<span class="sd">        default_flags_env (str): Environment variable where default flags for</span>
<span class="sd">            the tools might be stored.</span>
<span class="sd">        output_key (str): Option key indicating the output file name.</span>
<span class="sd">        output_first (bool): If True, the output key (and its value) are put in</span>
<span class="sd">            front of the other flags.</span>
<span class="sd">        flag_options (collections.OrderedDict): Mappings between keyword</span>
<span class="sd">            arguments passed to get_flags and command line tool flags. Keys</span>
<span class="sd">            indicate the keyword argument that will be processed in Python</span>
<span class="sd">            and values are the string used with the tool on the command line to</span>
<span class="sd">            indicate the desired flag. Flags that contain &#39;%s&#39; will be formatted</span>
<span class="sd">            with values passed to get_flags as the designated keyword argument.</span>
<span class="sd">            Flags that do not contain &#39;%s&#39; will assumed to act on the following</span>
<span class="sd">            argument. If the value passed to get_flags under the designated</span>
<span class="sd">            keyword argument is not a boolean, it will be appended to the flag</span>
<span class="sd">            list following the corresponding flag. If the value is a boolean and</span>
<span class="sd">            it is True, only the flag will be added to the list of flags. The</span>
<span class="sd">            order of entries indicates the order the flags should be added to</span>
<span class="sd">            the list.</span>
<span class="sd">        search_path_envvar (list): Environment variables containing a list of paths</span>
<span class="sd">            to search for library files. Either search_path_envvar or</span>
<span class="sd">            search_path_flags must be set. [REQUIRED]</span>
<span class="sd">        search_path_env (list): Paths relative to the env prefix that should</span>
<span class="sd">            be searched if the VIRTUAL_ENV or CONDA_PREFIX environment</span>
<span class="sd">            variable is set.</span>
<span class="sd">        search_path_flags (list): Flags that should be passed to the tool</span>
<span class="sd">            executable in order to locate the search path. Either search_path_envvar</span>
<span class="sd">            or search_path_flags must be set. [REQUIRED]</span>
<span class="sd">        search_regex_begin (str): Search string indicating where the set of</span>
<span class="sd">            paths begins in the output from running the tool executable with the</span>
<span class="sd">            search_path_flags. If None, the search is performed from the very</span>
<span class="sd">            beginning of the output.</span>
<span class="sd">        search_regex_end (str): Search string indicating where the set of</span>
<span class="sd">            paths ends in the output from running the tool executable with the</span>
<span class="sd">            search_path_flags. If None, the search is performed to the very end</span>
<span class="sd">            of the output.</span>
<span class="sd">        search_regex (list): Regex strings that should be used to locate paths</span>
<span class="sd">            in the output from running the tool executable with the</span>
<span class="sd">            search_path_flags.</span>
<span class="sd">        product_exts (list): List of extensions that will be added to the</span>
<span class="sd">            output file&#39;s base to get a list of products that might be produced</span>
<span class="sd">            by calling the compilation tool.</span>
<span class="sd">        product_files (list): List of file basenames that will be joined with</span>
<span class="sd">            the directory containing each output to get a list of products that</span>
<span class="sd">            might be produced by calling the compilation tool.</span>
<span class="sd">        remove_product_exts (list): List of extensions or directories matching</span>
<span class="sd">            entries in product_exts and product_files that should be removed</span>
<span class="sd">            during cleanup. Be careful when adding files to this list.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_schema_type</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_schema_subtype_key</span> <span class="o">=</span> <span class="s1">&#39;toolname&#39;</span>
    <span class="n">_schema_required</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_schema_properties</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;executable&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                          <span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">}}}</span>
    <span class="n">_dont_register</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">toolname</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">aliases</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tooltype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">languages</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">platforms</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Windows&#39;</span><span class="p">,</span> <span class="s1">&#39;MacOS&#39;</span><span class="p">,</span> <span class="s1">&#39;Linux&#39;</span><span class="p">]</span>  <span class="c1"># all by default</span>
    <span class="n">default_executable</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_executable_env</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_flags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">default_flags_env</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">output_key</span> <span class="o">=</span> <span class="s1">&#39;-o&#39;</span>
    <span class="n">output_first</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">flag_options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">search_path_envvar</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_path_env</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_path_flags</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_regex_begin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_regex_end</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_regex</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;([^</span><span class="se">\n</span><span class="s1">]+)&#39;</span><span class="p">]</span>
    <span class="n">version_flags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;--version&#39;</span><span class="p">]</span>
    <span class="n">product_exts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">product_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">source_product_exts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">remove_product_exts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_gnu</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">toolset</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">compatible_toolsets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">is_build_tool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">tool_suffix_format</span> <span class="o">=</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">x&#39;</span>
    <span class="n">_language_ext</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># only update once per class</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;executable&#39;</span><span class="p">,</span> <span class="s1">&#39;flags&#39;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unused keyword arguments: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompilationToolBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="CompilationToolBase.before_registration"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.before_registration">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Operations that should be performed to modify class attributes prior</span>
<span class="sd">        to registration including things like platform dependent properties and</span>
<span class="sd">        checking environment variables for default settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Registering unnamed compilation tool.&quot;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">is_gnu</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolset</span> <span class="o">==</span> <span class="s1">&#39;gnu&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolset</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compatible_toolsets</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">compatible_toolsets</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolset</span><span class="p">]</span> <span class="o">+</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compatible_toolsets</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_schema_type</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span>
        <span class="n">attr_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;default_executable&#39;</span><span class="p">,</span> <span class="s1">&#39;default_flags&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">attr_list</span><span class="p">:</span>
            <span class="c1"># Copy so that list modification is not propagated to subclasses</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="p">[])))</span>
        <span class="c1"># Set attributes based on environment variables</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">env_matches_tool</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">default_executable_env</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
                <span class="s1">&#39;ccache &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Set default_executable to name</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span>
        <span class="c1"># Add executable extension</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.exe&#39;</span><span class="p">):</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span> <span class="o">+=</span> <span class="s1">&#39;.exe&#39;</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_language_ext"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_language_ext">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_language_ext</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the extensions associated with the language that this tool can</span>
<span class="sd">        handle.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Language file extensions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_language_ext</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_language_ext</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">:</span>
                <span class="n">new_ext</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">get_language_ext</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">new_ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_language_ext</span> <span class="o">+=</span> <span class="n">new_ext</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_language_ext</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_tool_suffix"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_tool_suffix">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_tool_suffix</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the string that should be added to tool products based on the</span>
<span class="sd">        tool used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Suffix that should be added to tool products to indicate the</span>
<span class="sd">                tool used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tool_suffix_format</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tool_suffix_format</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tool_suffix_format</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_alternate_class"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_alternate_class">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_alternate_class</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return an alternate class to use if the provided toolname</span>
<span class="sd">        dosn&#39;t match the current tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            toolname (str, optional): Name of compilation tool that</span>
<span class="sd">                should be used. Defaults to None and the current</span>
<span class="sd">                toolname is assumed.</span>
<span class="sd">            language (str, optional): Language that alternate class</span>
<span class="sd">                should support. Defaults to None and the current</span>
<span class="sd">                language will be assumed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompilationToolBase: The compilation tool that corresponds</span>
<span class="sd">                to the provided toolname.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">language</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Ensures that a compatible tool will be returned</span>
                <span class="n">toolname</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span>
            <span class="n">lang_drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">lang_drv</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">((</span><span class="n">toolname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">toolname</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">)</span>
              <span class="ow">and</span> <span class="p">(</span><span class="n">toolname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aliases</span><span class="p">)):</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span></div>
            
<div class="viewcode-block" id="CompilationToolBase.set_env"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.set_env">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_env</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set environment variables required for compilation.</span>

<span class="sd">        Args:</span>
<span class="sd">            existing (dict, optional): Existing dictionary of environment</span>
<span class="sd">                variables that new variables should be added to. Defaults</span>
<span class="sd">                to a copy of os.environ.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Environment variables for the model process.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">existing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">existing</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">existing</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">env_matches_tool</span><span class="p">():</span>
            <span class="n">env</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_flags_env&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">env</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ienv</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
                    <span class="n">existing</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">ienv</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">existing</span></div>

<div class="viewcode-block" id="CompilationToolBase.write_wrappers"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.write_wrappers">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_wrappers</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write any wrappers needed to compile and/or run a model.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments are ignored (only included to</span>
<span class="sd">               allow cascade from child classes).</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Full paths to any created wrappers.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[]</span></div>
        
<div class="viewcode-block" id="CompilationToolBase.file2base"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.file2base">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">file2base</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine basename from path.</span>

<span class="sd">        Args:</span>
<span class="sd">            fname (str): Full or partial path to file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: File name without extension.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.dll&#39;</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.append_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.append_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">append_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Append one ore more flag(s) to a list of flags based on a key value/set.</span>

<span class="sd">        Args:</span>
<span class="sd">            out (list): Existing list that the new flag should be appended to.</span>
<span class="sd">            key (str): String identifying the type of flag. See create_flag for</span>
<span class="sd">                additional details.</span>
<span class="sd">            value (object): Value that should be set in the flag. If a list,</span>
<span class="sd">                multiple flags are added, one for each item in the list.</span>
<span class="sd">            prepend (bool, optional): If True, new flags are prepended to the</span>
<span class="sd">                front of the list rather than the end. Defaults to False. This</span>
<span class="sd">                keyword argument is ignoerd if position is provided.</span>
<span class="sd">            position (int, optional): If not None, this is the position that</span>
<span class="sd">                the new elements should be added to the existing flags. Positive</span>
<span class="sd">                positions indicate indexes into the existing list of flags.</span>
<span class="sd">                Negative are relative to the end of the existing list such that</span>
<span class="sd">                -1 is the same as just appending the new flags to the end of the</span>
<span class="sd">                list. Defaults to None and prepend takes precedence.</span>
<span class="sd">            no_duplicates (bool, optional): If True, the new flags being added</span>
<span class="sd">                will be checked against the existing ones to ensure that there</span>
<span class="sd">                are not duplicates. If False, the new flags are added</span>
<span class="sd">                reguardless of the existing flags. Defaults to False.</span>
<span class="sd">            allow_duplicate_values (bool, optional): If True, the same</span>
<span class="sd">                key can be added with the same value more than once.</span>
<span class="sd">                Otherwise, only the first instance of the value is added.</span>
<span class="sd">                Defaults to False.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If there are unexpected keyword arguments.</span>
<span class="sd">            ValueError: If no_duplicates is True and the existing list of flags</span>
<span class="sd">                already contains a flag matching the provided flag key.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Access class level flag option definitions</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s1">&#39;key&#39;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="c1"># Loop over list</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;allow_duplicate_values&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_value</span><span class="p">:</span>
                        <span class="n">new_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">new_value</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">append_flags</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Unpack keyword arguments</span>
        <span class="n">prepend</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;prepend&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">no_duplicates</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;no_duplicates&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">allow_duplicate_values</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;allow_duplicate_values&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected keyword arguments: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Create flags and check for duplicates</span>
        <span class="n">new_flags</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_flag</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">no_duplicates</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">scanf</span><span class="o">.</span><span class="n">scanf</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Flag for key </span><span class="si">%s</span><span class="s2"> already exists: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                                     <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
        <span class="c1"># Check for exact matches</span>
        <span class="k">if</span> <span class="n">new_flags</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">allow_duplicate_values</span><span class="p">):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">nnew</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_flags</span><span class="p">)</span>
            <span class="n">nout</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">nout</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">new_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">:]:</span>
                    <span class="k">break</span>
                <span class="n">ibeg</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new_flags</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">iend</span> <span class="o">=</span> <span class="n">ibeg</span> <span class="o">+</span> <span class="n">nnew</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">iend</span> <span class="o">&lt;</span> <span class="n">nout</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="n">ibeg</span><span class="p">:</span><span class="n">iend</span><span class="p">]</span> <span class="o">==</span> <span class="n">new_flags</span><span class="p">):</span>
                    <span class="k">return</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="n">iend</span>
        <span class="c1"># Determine location where flags should be added &amp; add them</span>
        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">prepend</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_flags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">new_flags</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">new_flags</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompilationToolBase.create_flag"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.create_flag">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create_flag</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create a flag from a key/value set.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): String identifying the type of flag. If key contains &#39;%s&#39;,</span>
<span class="sd">                it is assumed that the flag will be produced by formatting the</span>
<span class="sd">                value according to key. If key dosn&#39;t contain &#39;%s&#39;, it is assumed</span>
<span class="sd">                that key indicates that value is the following item and they</span>
<span class="sd">                both will be returned. If key is an empty string, then the value</span>
<span class="sd">                is assumed to constitute the entire flag.</span>
<span class="sd">            value (object): Value that should be set in the flag. If a list,</span>
<span class="sd">                multiple flags are returned, one for each item in the list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Items representing the flag.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">create_flag</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="o">%</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.is_installed"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.is_installed">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_installed</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if this tool is installed by looking for the executable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the tool is installed, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exec_path</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_executable</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">exec_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompilationToolBase.env_matches_tool"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.env_matches_tool">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">env_matches_tool</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if the executable pointed to by any environment</span>
<span class="sd">        variable matches this compilation tool.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the environment variable matches, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tool_base</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">aliases</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">envi_base</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tool_base</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">tool_base</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">default_executable_env</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">envi_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span>
                <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">default_executable_env</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;ccache &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PATHEXT&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">tool_base</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATHEXT&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tool_base</span><span class="p">]</span>
            <span class="n">envi_base</span> <span class="o">=</span> <span class="n">envi_base</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATHEXT&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">regex_literal</span> <span class="o">=</span> <span class="s1">&#39;-+*$%#@!^&amp;()</span><span class="si">{}</span><span class="s1">[]&lt;&gt;,.;:&#39;</span>
        <span class="n">regex_pathsep</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:[\-\_\.0-9])&#39;</span>
        <span class="k">if</span> <span class="n">tool_base</span> <span class="ow">and</span> <span class="n">envi_base</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tool_base</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">regex_literal</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">k</span><span class="p">)</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;(?:(?:^)|</span><span class="si">%s</span><span class="s1">)</span><span class="si">%s</span><span class="s1">(?:(?:$)|</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">regex_pathsep</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span>
                                                         <span class="n">regex_pathsep</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">envi_base</span><span class="p">):</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="c1"># out = envi_base.endswith(tuple(tool_base))</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_env_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_env_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_env_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a list of flags stored in the environment variables.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Flags for the tool.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">env_matches_tool</span><span class="p">():</span>
            <span class="n">env</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_flags_env&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">env</span> <span class="o">=</span> <span class="p">[</span><span class="n">env</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">ienv</span> <span class="ow">in</span> <span class="n">env</span><span class="p">:</span>
                    <span class="n">new_val</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ienv</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">new_val</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">output_first</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">unused_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">dont_skip_env_defaults</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remove_flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a list of flags for the tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            flags (list, optional): User defined flags that should be included.</span>
<span class="sd">                Defaults to empty list.</span>
<span class="sd">            outfile (str, optional): If provided, it is appended to the end of</span>
<span class="sd">                the flags following the cls.output_key flag to indicate that</span>
<span class="sd">                this is the name of the output file. Defaults to None and is</span>
<span class="sd">                ignored.</span>
<span class="sd">            output_first (bool, optional): If True, output flag(s) will be</span>
<span class="sd">                placed at the front of the returned flags. If False, they are</span>
<span class="sd">                placed at the end. Defaults to None and is set by</span>
<span class="sd">                cls.output_first.</span>
<span class="sd">            unused_kwargs (dict, optional): Existing dictionary that unused</span>
<span class="sd">                keyword arguments should be added to. Defaults to None and is</span>
<span class="sd">                ignored.</span>
<span class="sd">            skip_defaults (bool, optional): If True, the default flags will</span>
<span class="sd">                not be added. Defaults to False.</span>
<span class="sd">            dont_skip_env_defaults (bool, optional): If skip_defaults is True,</span>
<span class="sd">                and this keyword is True, the flags from the environment</span>
<span class="sd">                variable will be added. Defaults to False.</span>
<span class="sd">            remove_flags (list, optional): List of flags to remove. Defaults</span>
<span class="sd">                to None and is ignored.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored and added to</span>
<span class="sd">                unused_kwargs if provided.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Flags for the tool.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_flags&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">output_first</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output_first</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">output_first</span>
        <span class="c1"># Add default &amp; user defined flags</span>
        <span class="k">if</span> <span class="n">skip_defaults</span><span class="p">:</span>
            <span class="c1"># Include flags set by the environment (this is especially</span>
            <span class="c1"># important when using the Conda compilers</span>
            <span class="k">if</span> <span class="n">dont_skip_env_defaults</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_env_flags</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_flags</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_flags</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">new_flags</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_env_flags</span><span class="p">()</span>
                          <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_flags</span><span class="p">]</span>
            <span class="c1"># It is on the user to make sure there are not conflicting</span>
            <span class="c1"># flags when an error is thrown</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">new_flags</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># Add class defined flags</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">append_flags</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="c1"># Add output file</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">outfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">output_key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">append_flags</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">output_key</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span>
                             <span class="n">prepend</span><span class="o">=</span><span class="n">output_first</span><span class="p">,</span> <span class="n">no_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Handle unused keyword argumetns</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unused_kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">unused_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">remove_flags</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">remove_flags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_executable"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_executable">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_executable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">full_path</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the executable that should be used to call this tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            full_path (bool, optional): If True the full path to the executable</span>
<span class="sd">                file will be returned. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of (or path to) the tool executable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;executable&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">yggdrasil.config</span> <span class="kn">import</span> <span class="n">ygg_cfg</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_executable</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">ygg_cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                  <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_executable&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span>
                                  <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Executable not set for </span><span class="si">%s</span><span class="s2"> &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span>
                                      <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">full_path</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_env_prefixes"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_env_prefixes">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_env_prefixes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the virtualenv/conda path prefixes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Virtualenv/conda path prefixes. Empty list will be</span>
<span class="sd">                returned if virtualenv/conda are not active.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_env_prefixes</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="CompilationToolBase.get_search_path"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_search_path">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_search_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">env_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the paths searched by the tool for external library files.</span>

<span class="sd">        Args:</span>
<span class="sd">            env_only (bool, optional): If True, only the search paths as</span>
<span class="sd">                indicated by a virtualenv/conda environment are returned.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            libtype (str, optional): Library type being searched for.</span>
<span class="sd">                Defaults to None.</span>
<span class="sd">            cfg (YggConfigParser, optional): Configuration object currently</span>
<span class="sd">                being updated. Defaults to the global configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: List of paths that the tools will search.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cfg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">yggdrasil.config</span> <span class="kn">import</span> <span class="n">ygg_cfg</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="n">ygg_cfg</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_envvar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;get_search_path method not implemented for &quot;</span>
                                      <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> tool &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">))</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Add path based on executable</span>
        <span class="n">exec_file</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_executable</span><span class="p">(</span><span class="n">full_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">exec_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">prefix</span><span class="p">,</span> <span class="n">exec_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">exec_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">exec_dir</span> <span class="o">==</span> <span class="s1">&#39;bin&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;include&#39;</span><span class="p">:</span>
                    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;include&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;lib&#39;</span>
                <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
        <span class="c1"># Get search paths from environment variable</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_envvar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">env_only</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_envvar</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">ienv</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">search_path_envvar</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ienv</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)</span>
        <span class="c1"># Get flags based on path</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_flags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">env_only</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_flags</span><span class="p">,</span> <span class="n">skip_flags</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">allow_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Split on beginning &amp; ending regexes if they exist</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">search_regex_begin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_regex_begin</span><span class="p">,</span> <span class="n">output</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">search_regex_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_regex_end</span><span class="p">,</span> <span class="n">output</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Search for paths</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">search_regex</span><span class="p">:</span>
                <span class="n">paths</span> <span class="o">+=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
        <span class="c1"># Get search paths from the virtualenv/conda environment</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">iprefix</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_env_prefixes</span><span class="p">():</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">search_path_env</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">ienv</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">search_path_env</span><span class="p">:</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">iprefix</span><span class="p">,</span> <span class="n">ienv</span><span class="p">))</span>
        <span class="c1"># Get libtype specific search paths</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="n">base_paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">vcpkg_dir</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;vcpkg_dir&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">vcpkg_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">vcpkg_dir</span><span class="p">):</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;vcpkg_dir is not valid: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span>
                                       <span class="o">%</span> <span class="n">vcpkg_dir</span><span class="p">)</span>
                <span class="n">typ2dir</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;include&#39;</span><span class="p">:</span> <span class="s1">&#39;include&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;shared&#39;</span><span class="p">:</span> <span class="s1">&#39;bin&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;static&#39;</span><span class="p">:</span> <span class="s1">&#39;lib&#39;</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_64bit</span><span class="p">:</span>
                    <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;x64-windows&#39;</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                    <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;x86-windows&#39;</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Not yet tested on 32bit Python&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">libtype</span> <span class="ow">in</span> <span class="n">typ2dir</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">vcpkg_dir</span><span class="p">):</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vcpkg_dir</span><span class="p">,</span> <span class="s1">&#39;installed&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span>
                                              <span class="n">typ2dir</span><span class="p">[</span><span class="n">libtype</span><span class="p">]))</span>
                    <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">paths</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ChocolateyInstall&#39;</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">base_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ChocolateyInstall&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_paths</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/usr&#39;</span><span class="p">,</span> <span class="s1">&#39;local&#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_mac</span><span class="p">:</span>
            <span class="n">macos_sdkroot</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;macos_sdkroot&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">base_paths</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s1">&#39;/Library/Developer/CommandLineTools/usr&#39;</span><span class="p">,</span>
                <span class="c1"># XCode &gt;= 12</span>
                <span class="s1">&#39;/Applications/Xcode.app/Contents/Developer/&#39;</span>
                <span class="s1">&#39;Toolchains/XcodeDefault.xctoolchain/usr&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">macos_sdkroot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">base_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">macos_sdkroot</span><span class="p">,</span> <span class="s1">&#39;usr&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="s1">&#39;Platforms&#39;</span> <span class="ow">in</span> <span class="n">macos_sdkroot</span><span class="p">:</span>
                    <span class="n">base_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                            <span class="n">macos_sdkroot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/Platforms&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="s1">&#39;Toolchains/XcodeDefault.xctoolchain/usr&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;include&#39;</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;include&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="s1">&#39;lib&#39;</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">base_paths</span><span class="p">:</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">suffix</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_mac</span><span class="p">:</span>
            <span class="c1"># Check homebrew llvm</span>
            <span class="c1"># paths.append(&#39;/usr/local/Cellar/llvm/&#39;)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="n">macos_sdkroot</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/Platforms&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;Platforms&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(((</span><span class="s1">&#39;AppleTV&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;iPhoneOS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
                     <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;WatchOS&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">))):</span>
                    <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">paths</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s2">&quot;/usr/local/Cellar/llvm/&quot;</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_executable_command"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_executable_command">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_executable_command</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">skip_flags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unused_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">use_ccache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the command required to run the tool using the specified</span>
<span class="sd">        arguments and options.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list): The arguments that should be passed to the tool. If</span>
<span class="sd">                skip_flags is False, these are treated as input files that will</span>
<span class="sd">                be used by the tool.</span>
<span class="sd">            skip_flags (bool, optional): If True, args is assumed to include</span>
<span class="sd">                any necessary flags. If False, args are assumed to the files</span>
<span class="sd">                that the tool is called on and flags are determined from them.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            unused_kwargs (dict, optional): Existing Python dictionary that</span>
<span class="sd">                unused keyword arguments will be added to. Defaults to None and</span>
<span class="sd">                is initialized to an empty dict.</span>
<span class="sd">            use_ccache (bool, optional): If True, ccache will be added to</span>
<span class="sd">                the compilation executable. Defaults to False.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored and stored in</span>
<span class="sd">                unused_kwargs if provided.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Output to stdout from the command execution.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">library_flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;library_flags&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">unused_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unused_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Get flags</span>
        <span class="k">if</span> <span class="n">skip_flags</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">library_flags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">unused_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="n">unused_kwargs</span><span class="o">=</span><span class="n">unused_kwargs</span><span class="p">,</span>
                                  <span class="n">skip_library_libs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">library_flags</span><span class="o">=</span><span class="n">library_flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Form command</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">flags</span> <span class="o">+</span> <span class="n">args</span> <span class="o">+</span> <span class="n">library_flags</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">)):</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_executable</span><span class="p">()]</span> <span class="o">+</span> <span class="n">cmd</span>
        <span class="k">if</span> <span class="n">use_ccache</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s1">&#39;ccache&#39;</span><span class="p">):</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ccache&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cmd</span>
        <span class="c1"># Pop library flags so it is not an unused_kwarg in cases of non-linking</span>
        <span class="c1"># compiler command</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;library_flags&#39;</span><span class="p">,</span> <span class="s1">&#39;skip_library_libs&#39;</span><span class="p">]:</span>
            <span class="n">unused_kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">cmd</span></div>

<div class="viewcode-block" id="CompilationToolBase.remove_products"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.remove_products">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">remove_products</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Remove products produced during compilation.</span>

<span class="sd">        Args:</span>
<span class="sd">            src (list): Input arguments to compilation call that was used to</span>
<span class="sd">                generate the output file (usually one or more source files).</span>
<span class="sd">            new (str): The full path to the primary product of the compilation</span>
<span class="sd">                call (usually an object, executable, or library).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">append_product</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
        <span class="n">source_products</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_source_products</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
        <span class="n">remove_products</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">source_products</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompilationToolBase.get_source_products"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.get_source_products">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_source_products</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">products</span><span class="p">,</span> <span class="n">source_products</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the list of products that should be removed without checking</span>
<span class="sd">        for source files based on cls.remove_product_exts.</span>

<span class="sd">        Args:</span>
<span class="sd">            products (list): List of products that should be checked against</span>
<span class="sd">                cls.remove_product_exts.</span>
<span class="sd">            source_products (list, optional): Existing list of products that</span>
<span class="sd">                new source_products should be added to. Defaults to [].</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Products that should be removed without checking for source</span>
<span class="sd">                files.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">remove_ext</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">remove_product_exts</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">remove_ext</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">source_products</span><span class="p">):</span>
                <span class="n">source_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">source_products</span></div>

<div class="viewcode-block" id="CompilationToolBase.append_product"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.append_product">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">append_product</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">products</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">new_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">dont_append_src</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Append a product to the specified list along with additional values</span>
<span class="sd">        indicated by cls.product_exts.</span>

<span class="sd">        Args:</span>
<span class="sd">            products (list): List of of existing products that new product</span>
<span class="sd">                should be appended to.</span>
<span class="sd">            src (list): Input arguments to compilation call that was used to</span>
<span class="sd">                generate the output file (usually one or more source files).</span>
<span class="sd">            new (str): New product that should be appended to the list.</span>
<span class="sd">            new_dir (str, optional): Directory that should be used as base when</span>
<span class="sd">                adding files listed in cls.product_files. Defaults to</span>
<span class="sd">                os.path.dirname(new).</span>
<span class="sd">            dont_append_src (bool, optional): If True and src is in the list of</span>
<span class="sd">                products, it will be removed. Defaults to False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="c1"># Add products based on extensions</span>
        <span class="n">new_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">new</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">product_exts</span><span class="p">:</span>
            <span class="n">inew</span> <span class="o">=</span> <span class="n">new_base</span> <span class="o">+</span> <span class="n">ext</span>
            <span class="k">if</span> <span class="n">inew</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inew</span><span class="p">)</span>
        <span class="c1"># Add products based on directory</span>
        <span class="k">if</span> <span class="n">new_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">product_files</span><span class="p">:</span>
            <span class="n">inew</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new_dir</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">inew</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inew</span><span class="p">)</span>
        <span class="c1"># Make sure the source is not in the product list</span>
        <span class="k">if</span> <span class="n">dont_append_src</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">isrc</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isrc</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                    <span class="n">products</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">isrc</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompilationToolBase.call"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilationToolBase.call">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_flags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">products</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">allow_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Call the tool with the provided arguments. If the first argument</span>
<span class="sd">        resembles the name of the tool executable, the executable will not be</span>
<span class="sd">        added.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list): The arguments that should be passed to the tool.</span>
<span class="sd">            language (str, optional): Language of tool that should be used. If</span>
<span class="sd">                different than the languages supported by the current tool,</span>
<span class="sd">                the correct tool is used instead. Defaults to None and is</span>
<span class="sd">                ignored.</span>
<span class="sd">            toolname (str, optional): Name of compilation tool that should be</span>
<span class="sd">                used. Defaults to None and the default tool for the language</span>
<span class="sd">                will be used.</span>
<span class="sd">            skip_flags (bool, optional): If True, args is assumed to include</span>
<span class="sd">                any necessary flags. If False, args are assumed to the files</span>
<span class="sd">                that the tool is called on and flags are determined from them.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            dry_run (bool, optional): If True, the tool won&#39;t be called, but</span>
<span class="sd">                the products will be updated. Defautls to False.</span>
<span class="sd">            out (str, optional): Full path to output file that should be created.</span>
<span class="sd">                If None, the path will be determined from the path to the first</span>
<span class="sd">                argument provided. Defaults to None. This keyword argument will</span>
<span class="sd">                be ignored if skip_flags is True.</span>
<span class="sd">            overwrite (bool, optional): If True, the existing compile file will</span>
<span class="sd">                be overwritten. Otherwise, it will be kept and this function</span>
<span class="sd">                will return without recompiling the source file.</span>
<span class="sd">            products (list, optional): Existing Python list that additional</span>
<span class="sd">                products produced by the compilation should be appended to.</span>
<span class="sd">                Defaults to None and is ignored.</span>
<span class="sd">            allow_error (bool, optional): If True and there is an error when</span>
<span class="sd">                call the executable, it will be ignored. If False, errors will</span>
<span class="sd">                result in an exception being raised. Defaults to False.</span>
<span class="sd">            working_dir (str, optional): Working directory where tool should be</span>
<span class="sd">                called from. This will also be used to construct the path for</span>
<span class="sd">                the output file. Defaults to None and is ignored.</span>
<span class="sd">            additional_args (list, optional): Additional arguments that should</span>
<span class="sd">                be appended to args before continuing. Defaults to None and is</span>
<span class="sd">                ignored.</span>
<span class="sd">            suffix (str, optional): Suffix that should be added to the</span>
<span class="sd">                output file (before the extension). Defaults to &quot;&quot;.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to</span>
<span class="sd">                cls.get_executable_command. and tools.popen_nobuffer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Output to stdout from the command execution if skip_flags is</span>
<span class="sd">                True, produced file otherwise.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If there is an error when running the command and</span>
<span class="sd">                allow_error is False.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call from another tool if the language dosn&#39;t match</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_language&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_alternate_class</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span>
                                      <span class="n">language</span><span class="o">=</span><span class="n">language</span><span class="p">)</span>
        <span class="c1"># Add additional arguments</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">]</span>
        <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">additional_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">args</span> <span class="o">+</span> <span class="n">additional_args</span>
        <span class="c1"># Process arguments only valid if skip_flags is False</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_flags</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">products</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Get output file</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">working_dir</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span>
                                          <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(((</span><span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;clean&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>
                   <span class="ow">and</span> <span class="p">(</span><span class="n">working_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">))):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">out</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>  <span class="c1"># Don&#39;t remove source files</span>
            <span class="c1"># Check for file</span>
            <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dry_run</span><span class="p">):</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">remove_products</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Product not removed: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dry_run</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out</span><span class="p">)):</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">append_product</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">out</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;outfile&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="c1"># Get command</span>
        <span class="n">unused_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;unused_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_executable_command</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">skip_flags</span><span class="o">=</span><span class="n">skip_flags</span><span class="p">,</span>
                                         <span class="n">unused_kwargs</span><span class="o">=</span><span class="n">unused_kwargs</span><span class="p">,</span>
                                         <span class="n">cwd</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Return if dry run, adding potential output to product</span>
        <span class="k">if</span> <span class="n">dry_run</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skip_flags</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;clean&#39;</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">append_product</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">out</span>
        <span class="c1"># Run command</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_flags</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;env&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_kwargs</span><span class="p">):</span>
                <span class="n">unused_kwargs</span><span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">set_env</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Command: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
            <span class="n">proc</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">popen_nobuffer</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs</span><span class="p">)</span>
            <span class="n">output</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">allow_error</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Command &#39;</span><span class="si">%s</span><span class="s2">&#39; failed with code </span><span class="si">%d</span><span class="s2">:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">.&quot;</span>
                                   <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span><span class="p">,</span> <span class="n">output</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">output</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">tools</span><span class="o">.</span><span class="n">print_encoded</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_error</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Could not call command &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span>
                                   <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Unexpected call error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span>
        <span class="c1"># Check for output</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_flags</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="o">!=</span> <span class="s1">&#39;clean&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out</span><span class="p">)):</span>  <span class="c1"># pragma: debug</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">output</span><span class="p">))</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">((</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> tool, </span><span class="si">%s</span><span class="s2">, failed to produce &quot;</span>
                                        <span class="s2">&quot;result &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                                       <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> produced </span><span class="si">%s</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">append_product</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">return</span> <span class="n">output</span></div></div>


<div class="viewcode-block" id="CompilerBase"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase">[docs]</a><span class="k">class</span> <span class="nc">CompilerBase</span><span class="p">(</span><span class="n">CompilationToolBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for compilers.</span>

<span class="sd">    Args:</span>
<span class="sd">        linker (str, optional): Name of the linker that should be used for</span>
<span class="sd">            linking compiled objects. Defaults to None if not provided and</span>
<span class="sd">            default_linker will be used.</span>
<span class="sd">        archiver (str, optional): Name of the archiver that should be used for</span>
<span class="sd">            combining compiled objects into a static library. Defaults to None</span>
<span class="sd">            if not provided and default_archiver will be used.</span>
<span class="sd">        linker_flags (list, optional): Flags that should be used when linking</span>
<span class="sd">            compiled objects. Defaults to default_linker_flags if not provided.</span>
<span class="sd">        archiver_flags (list, optional): Flags that should be used for combining</span>
<span class="sd">            compiled objects into a static library. Defaults to</span>
<span class="sd">            default_archiver_flags if not provided.</span>

<span class="sd">    Class Attributes:</span>
<span class="sd">        compile_only_flag (str): Flag that should prepended to compiler/linker</span>
<span class="sd">            combination tool arguments to indicate that only compilation should</span>
<span class="sd">            be performed.</span>
<span class="sd">        default_linker (str): Name of linker that should be used after compiling</span>
<span class="sd">            with this compiler. If not set, it is assumed that this compiler is</span>
<span class="sd">            also a linker.</span>
<span class="sd">        default_archiver (str): Name of archiver that should be used to create</span>
<span class="sd">            a static library after compiling with this compiler. If not set,</span>
<span class="sd">            it is assumed that this compiler is also a linker.</span>
<span class="sd">        default_linker_flags (list): Flags that should be used with the linker</span>
<span class="sd">            if no other flags are provided.</span>
<span class="sd">        default_archiver_flags (list): Flags that should be used with the</span>
<span class="sd">            archiver if no other flags are provided.</span>
<span class="sd">        linker_switch (str): Flag to indicate beginning of flags that should be</span>
<span class="sd">            passed to the linker from a call to a compiler/linker combination</span>
<span class="sd">            tools (e.g. /link on Windows).</span>
<span class="sd">        object_ext (str): Extension that should be used for object files.</span>
<span class="sd">        is_linker (bool): If True, the tool also serves as a linker and a</span>
<span class="sd">            separate linker class will be automatically generating from the</span>
<span class="sd">            linker_attributes dictionary. This will be set to True if</span>
<span class="sd">            no_separate_linking is True.</span>
<span class="sd">        no_separate_linking (bool): If True, the tool severs as linker but</span>
<span class="sd">            cannot be called for just compilation or linking alone.</span>
<span class="sd">        linker_attributes (dict): Attributes that should be added to the linker</span>
<span class="sd">            class created for this tool if is_linker is True.</span>
<span class="sd">        linker_base_classes (tuple): Base classes that should be used to create</span>
<span class="sd">            the default linker from the compiler tool. If None, (LinkerBase, )</span>
<span class="sd">            is used if no_separate_linking is False and (DummyLinkerBase, )</span>
<span class="sd">            is used if no_separate_linking is True.</span>
<span class="sd">        combine_with_linker (bool): If True, the compiler and linker flags can</span>
<span class="sd">            be combined and passed to the compiler executable to perform both</span>
<span class="sd">            operations in succession. If False, the compilation and linking</span>
<span class="sd">            steps must be performed separately. If None, this is determined by</span>
<span class="sd">            checking if the compiler and linker names match.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tooltype</span> <span class="o">=</span> <span class="s1">&#39;compiler&#39;</span>
    <span class="n">flag_options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;definitions&#39;</span><span class="p">,</span> <span class="s1">&#39;-D</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">),</span>
                                <span class="p">(</span><span class="s1">&#39;include_dirs&#39;</span><span class="p">,</span> <span class="s1">&#39;-I</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)])</span>
    <span class="n">compile_only_flag</span> <span class="o">=</span> <span class="s1">&#39;-c&#39;</span>
    <span class="n">default_linker</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_archiver</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_linker_flags</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_archiver_flags</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">linker_switch</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">object_ext</span> <span class="o">=</span> <span class="s1">&#39;.o&#39;</span>
    <span class="n">is_linker</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Most compiler&#39;s also perform linking</span>
    <span class="n">no_separate_linking</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">linker_attributes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">linker_base_classes</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">combine_with_linker</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_path_env</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="s1">&#39;linker_flags&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver_flags&#39;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompilerBase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="CompilerBase.before_registration"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.before_registration">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Operations that should be performed to modify class attributes prior</span>
<span class="sd">        to registration including things like platform dependent properties and</span>
<span class="sd">        checking environment variables for default settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CompilationToolBase</span><span class="o">.</span><span class="n">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_gnu</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">object_ext</span> <span class="o">=</span> <span class="s1">&#39;.obj&#39;</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">search_path_env</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">no_separate_linking</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">is_linker</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">compile_only_flag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_linker</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;dont_create_linker&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_linker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">default_linker</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span>
            <span class="n">copy_attr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="s1">&#39;aliases&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span><span class="p">,</span> <span class="s1">&#39;platforms&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;default_executable&#39;</span><span class="p">,</span> <span class="s1">&#39;default_executable_env&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;toolset&#39;</span><span class="p">]</span>
            <span class="c1"># &#39;product_exts&#39;, &#39;product_files&#39;]</span>
            <span class="n">linker_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Linker&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;Compiler&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">linker_attr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">linker_attributes</span><span class="p">)</span>
            <span class="n">linker_attr</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_linker</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">copy_attr</span><span class="p">:</span>
                <span class="n">linker_attr</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
            <span class="n">linker_base_cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">linker_base_classes</span>
            <span class="k">if</span> <span class="n">linker_base_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">no_separate_linking</span><span class="p">:</span>
                    <span class="n">linker_base_cls</span> <span class="o">=</span> <span class="p">(</span><span class="n">DummyLinkerBase</span><span class="p">,</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">linker_base_cls</span> <span class="o">=</span> <span class="p">(</span><span class="n">LinkerBase</span><span class="p">,</span> <span class="p">)</span>
            <span class="n">linker_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">linker_name</span><span class="p">,</span> <span class="n">linker_base_cls</span><span class="p">,</span> <span class="n">linker_attr</span><span class="p">)</span>
            <span class="nb">globals</span><span class="p">()[</span><span class="n">linker_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">linker_cls</span>
            <span class="k">del</span> <span class="n">linker_cls</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">combine_with_linker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">combine_with_linker</span> <span class="o">=</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">toolname</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_linker</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompilerBase.linker"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.linker">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">linker</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the associated linker class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompilationToolBase: Linker class associated with this compiler.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">linker</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_linker&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_linker</span><span class="p">)</span>
        <span class="n">linker_flags</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_linker_flags&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_linker_flags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">linker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">linker</span> <span class="o">=</span> <span class="n">find_compilation_tool</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">linker</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="n">linker</span><span class="p">)(</span><span class="n">flags</span><span class="o">=</span><span class="n">linker_flags</span><span class="p">,</span>
                                                         <span class="n">executable</span><span class="o">=</span><span class="n">linker</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">is_installed</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">linker</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilerBase.archiver"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.archiver">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">archiver</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the associated archiver class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ArchiverToolBase: Archiver class associated with this compiler.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">archiver</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_archiver&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_archiver</span><span class="p">)</span>
        <span class="n">archiver_flags</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_archiver_flags&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">default_archiver_flags</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">archiver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">archiver</span> <span class="o">=</span> <span class="n">find_compilation_tool</span><span class="p">(</span><span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">archiver</span>
        <span class="k">if</span> <span class="n">archiver</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="n">archiver</span><span class="p">)(</span><span class="n">flags</span><span class="o">=</span><span class="n">archiver_flags</span><span class="p">,</span>
                                                             <span class="n">executable</span><span class="o">=</span><span class="n">archiver</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">is_installed</span><span class="p">():</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">get_compatible_tool</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">languages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilerBase.get_library_tool"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.get_library_tool">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_library_tool</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the tool that should be used based on the provided</span>
<span class="sd">        arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            libtype (str, optional): Library type that should be created by the</span>
<span class="sd">                linker/archiver. If &#39;static&#39;, the archiver is returned. If</span>
<span class="sd">                &#39;shared&#39; or any other value, the linker is returned. Defaults to</span>
<span class="sd">                None.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompilationToolBase: Linker/archiver that should be used.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">archiver</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">linker</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tool</span></div>

<div class="viewcode-block" id="CompilerBase.get_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.get_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_linker_switch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">libtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logging_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a list of compiler flags.</span>

<span class="sd">        Args:</span>
<span class="sd">            dont_link (bool, optional): If True, the command will result in a</span>
<span class="sd">                linkable object file rather than an executable or library.</span>
<span class="sd">                Defaults to True if cls.no_separate_linking is True or libtype</span>
<span class="sd">                is &#39;object&#39; and False otherwise.</span>
<span class="sd">            add_linker_switch (bool, optional): If True, the linker_switch flag</span>
<span class="sd">                will be added to the flags even if dont_link is True as long</span>
<span class="sd">                as the flag is not None. Defaults to False.</span>
<span class="sd">            libtype (str, optional): Library type that should be created by the</span>
<span class="sd">                linker/archiver. Defaults to None.</span>
<span class="sd">            logging_level (int, optional): Logging level that should be passed</span>
<span class="sd">                as a definition to the C compiler. Defaults to None and will be</span>
<span class="sd">                ignored.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method and get_linker_flags if dont_link is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Compiler flags.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If dont_link is False and cls.combine_with_linker is</span>
<span class="sd">                False.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Turn off linking if it is part of the compilation call</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">no_separate_linking</span><span class="p">:</span>
            <span class="n">dont_link</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Set dont_link based on libtype</span>
        <span class="k">if</span> <span class="n">dont_link</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                <span class="n">dont_link</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dont_link</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Add flag that model is yggdrasil</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_build_tool</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;definitions&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;definitions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;WITH_YGGDRASIL&#39;</span><span class="p">)</span>
        <span class="c1"># Add logging level as a definition</span>
        <span class="k">if</span> <span class="n">logging_level</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;definitions&#39;</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;definitions&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;YGG_DEBUG=</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">logging_level</span><span class="p">)</span>
        <span class="c1"># Call parent class</span>
        <span class="n">outfile_link</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dont_link</span><span class="p">:</span>
            <span class="n">outfile_link</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;outfile&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompilerBase</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Add flags for compilation only or provided output file</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">dont_link</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">compile_only_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
             <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_defaults&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)))):</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compile_only_flag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">compile_only_flag</span><span class="p">)</span>
        <span class="c1"># Add linker switch</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dont_link</span><span class="p">)</span> <span class="ow">or</span> <span class="n">add_linker_switch</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">linker_switch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">linker_switch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">linker_switch</span><span class="p">)</span>
        <span class="c1"># Add linker flags</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dont_link</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">combine_with_linker</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot combine linker and compiler flags.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;The returned flags will contain linker flags that &#39;</span>
                         <span class="s1">&#39;may need to follow the list of source files.&#39;</span><span class="p">)</span>
            <span class="n">unused_kwargs_comp</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;unused_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">unused_kwargs_link</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_library_tool</span><span class="p">(</span><span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">,</span> <span class="o">**</span><span class="n">unused_kwargs_comp</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">tool</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="n">outfile</span><span class="o">=</span><span class="n">outfile_link</span><span class="p">,</span>
                                  <span class="n">unused_kwargs</span><span class="o">=</span><span class="n">unused_kwargs_link</span><span class="p">,</span>
                                  <span class="o">**</span><span class="n">unused_kwargs_comp</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">unused_kwargs_comp</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">unused_kwargs_link</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">unused_kwargs_comp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilerBase.get_output_file"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.get_output_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_output_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">libtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_src_ext</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">no_tool_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the appropriate output file that will result when</span>
<span class="sd">        compiling a given source file.</span>

<span class="sd">        Args:</span>
<span class="sd">            src (str): Source file being compiled that name base will be taken</span>
<span class="sd">                from.</span>
<span class="sd">            dont_link (bool, optional): If True, the result assumes that the</span>
<span class="sd">                source is just compiled and not linked. If False, the result</span>
<span class="sd">                will be the final result after linking. Defaults to None and</span>
<span class="sd">                will be set to True if libtype is &#39;object&#39; and False otherwise.</span>
<span class="sd">            working_dir (str, optional): Working directory where output file</span>
<span class="sd">                should be located. Defaults to None and is ignored.</span>
<span class="sd">            libtype (str, optional): Library type that should be created by the</span>
<span class="sd">                linker/archiver. Defaults to None.</span>
<span class="sd">            no_src_ext (bool, optional): If True, the source extension will not</span>
<span class="sd">                be added to the object file name. Defaults to False. Ignored if</span>
<span class="sd">                dont_link is False.</span>
<span class="sd">            no_tool_suffix (bool, optional): If True, the tool suffix will not</span>
<span class="sd">                be added to the object file name. Defaults to False.</span>
<span class="sd">            suffix (str, optional): Suffix that should be added to the</span>
<span class="sd">                output file (before the extension). Defaults to &quot;&quot;.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored unless dont_link</span>
<span class="sd">                is False; then they are passed to the linker&#39;s get_output_file</span>
<span class="sd">                method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to file that will be produced.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get intermediate file</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">no_separate_linking</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">src</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;suffix&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">suffix</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">isrc</span> <span class="ow">in</span> <span class="n">src</span><span class="p">:</span>
                    <span class="n">obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">isrc</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                   <span class="n">working_dir</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span>
                                                   <span class="n">no_src_ext</span><span class="o">=</span><span class="n">no_src_ext</span><span class="p">,</span>
                                                   <span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">src_base</span><span class="p">,</span> <span class="n">src_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">no_tool_suffix</span><span class="p">:</span>
                    <span class="n">suffix</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool_suffix</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">no_src_ext</span> <span class="ow">or</span> <span class="n">src_base</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">src_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src_base</span><span class="p">,</span> <span class="n">suffix</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">object_ext</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">src_base</span><span class="p">,</span> <span class="n">src_ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                         <span class="n">suffix</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">object_ext</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">working_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">obj</span><span class="p">))</span>
        <span class="c1"># Pass to linker unless dont_link is True</span>
        <span class="k">if</span> <span class="n">dont_link</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">no_separate_linking</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_library_tool</span><span class="p">(</span><span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompilerBase.call"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompilerBase.call">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_flags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">libtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">additional_objs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Call the tool with the provided arguments. If the first argument</span>
<span class="sd">        resembles the name of the tool executable, the executable will not be</span>
<span class="sd">        added.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list): The arguments that should be passed to the tool.</span>
<span class="sd">            dont_link (bool, optional): If True, the command will result in a</span>
<span class="sd">                linkable object file rather than an executable or library.</span>
<span class="sd">                Defaults to True if cls.no_separate_linking is True or libtype</span>
<span class="sd">                is &#39;object&#39; and False otherwise.</span>
<span class="sd">            skip_flags (bool, optional): If True, args is assumed to include</span>
<span class="sd">                any necessary flags. If False, args are assumed to the files</span>
<span class="sd">                that the tool is called on and flags are determined from them.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            out (str, optional): Full path to output file that should be created.</span>
<span class="sd">                If None, the path will be determined from the path to the first</span>
<span class="sd">                arguments provided. Defaults to None. This keyword argument will</span>
<span class="sd">                be ignored if skip_flags is True.</span>
<span class="sd">            libtype (str, optional): Library type that should be created by the</span>
<span class="sd">                linker/archiver. Defaults to None.</span>
<span class="sd">            additional_objs (list, optional): Additional linkable object files</span>
<span class="sd">                that should be supplied to the linker/archiver if dont_link is</span>
<span class="sd">                False. Defaults to None and is ignored.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method and the associated linker/archiver&#39;s call method</span>
<span class="sd">                if dont_link is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Output to stdout from the command execution if skip_flags is</span>
<span class="sd">                True, produced file otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Must be called before the class is used to get the linker</span>
        <span class="c1"># tools so that correct compiler is used as a base.</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_alternate_class</span><span class="p">(</span>
            <span class="n">toolname</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
            <span class="n">language</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="c1"># Turn off linking if it is part of the compilation call</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">no_separate_linking</span><span class="p">:</span>
            <span class="n">dont_link</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Set dont_link based on libtype</span>
        <span class="k">if</span> <span class="n">dont_link</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                <span class="n">dont_link</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dont_link</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Get appropriate tool</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dont_link</span> <span class="ow">or</span> <span class="n">skip_flags</span><span class="p">):</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_library_tool</span><span class="p">(</span><span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Handle list of sources</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_flags</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">dont_link</span><span class="p">:</span>
                <span class="n">out_comp</span> <span class="o">=</span> <span class="n">out</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out_comp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">out_comp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out_comp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out_comp</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">out_comp</span> <span class="o">=</span> <span class="p">[</span><span class="n">out_comp</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_comp</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot compile </span><span class="si">%d</span><span class="s2"> sources into </span><span class="si">%d</span><span class="s2"> objects.&quot;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">out_comp</span><span class="p">)))</span>
            <span class="c1"># Compile each source</span>
            <span class="n">kwargs_link</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dont_link</span><span class="p">:</span>
                <span class="n">kwargs_link</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">extract_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linker_language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">obj_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">isrc</span><span class="p">,</span> <span class="n">iout</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">out_comp</span><span class="p">):</span>
                <span class="n">iobj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">isrc</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">iout</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">obj_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">iobj</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dont_link</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">obj_list</span>
            <span class="c1"># Link/archive</span>
            <span class="k">return</span> <span class="n">tool</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">obj_list</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_objs</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs_link</span><span class="p">)</span>
        <span class="c1"># Call without linking/archiving</span>
        <span class="k">if</span> <span class="n">skip_flags</span> <span class="ow">or</span> <span class="n">dont_link</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_flags</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dont_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dont_link</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linker_language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompilerBase</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">skip_flags</span><span class="o">=</span><span class="n">skip_flags</span><span class="p">,</span>
                                                 <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs_link</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">extract_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">tooltype</span> <span class="o">!=</span> <span class="s1">&#39;linker&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;linker_language&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                <span class="n">kwargs_link</span><span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">tooltype</span> <span class="o">+</span> <span class="s1">&#39;_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span>
                    <span class="s1">&#39;linker_language&#39;</span><span class="p">)</span>
            <span class="n">out_comp</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompilerBase</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                     <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tool</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">out_comp</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">additional_args</span><span class="o">=</span><span class="n">additional_objs</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs_link</span><span class="p">)</span></div></div>

        
<div class="viewcode-block" id="LinkerBase"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase">[docs]</a><span class="k">class</span> <span class="nc">LinkerBase</span><span class="p">(</span><span class="n">CompilationToolBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for linkers.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        shared_library_flag (str): Flag that should be prepended to the linker</span>
<span class="sd">            tool arguments to indicate that a shared/dynamic library should be</span>
<span class="sd">            produced instead of an executable.</span>
<span class="sd">        library_name_key (str): Option key indicating the name of a library</span>
<span class="sd">            that should be linked against.</span>
<span class="sd">        library_directory_key (str): Option key indicating a directory that</span>
<span class="sd">            should be included in the linker search path for libraries.</span>
<span class="sd">        library_prefix (str): Prefix that should be added to library paths.</span>
<span class="sd">        library_ext (str): Extension that should be used for shared libraries.</span>
<span class="sd">        executable_ext (str): Extension that should be used for executables.</span>
<span class="sd">        output_first_library (bool): If True, the output key (and its value) are</span>
<span class="sd">            put in front of the other flags when building a library. A value of</span>
<span class="sd">            None causes the output_first attribute to be used (unless explicitly</span>
<span class="sd">            set in the method call).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tooltype</span> <span class="o">=</span> <span class="s1">&#39;linker&#39;</span>
    <span class="n">flag_options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;library_libs&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;-l</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;allow_duplicate_values&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
        <span class="p">(</span><span class="s1">&#39;library_libs_nonstd&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;-l:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="s1">&#39;allow_duplicate_values&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
        <span class="p">(</span><span class="s1">&#39;library_dirs&#39;</span><span class="p">,</span> <span class="s1">&#39;-L</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)])</span>
    <span class="n">shared_library_flag</span> <span class="o">=</span> <span class="s1">&#39;-shared&#39;</span>
    <span class="n">library_prefix</span> <span class="o">=</span> <span class="s1">&#39;lib&#39;</span>
    <span class="n">library_ext</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># depends on the OS</span>
    <span class="n">executable_ext</span> <span class="o">=</span> <span class="s1">&#39;.out&#39;</span>
    <span class="n">output_first_library</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">search_path_env</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">]</span>
    <span class="n">all_library_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.so&#39;</span><span class="p">,</span> <span class="s1">&#39;.a&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="LinkerBase.before_registration"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase.before_registration">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Operations that should be performed to modify class attributes prior</span>
<span class="sd">        to registration including things like platform dependent properties and</span>
<span class="sd">        checking environment variables for default settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">CompilationToolBase</span><span class="o">.</span><span class="n">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="c1"># TODO: Use &#39;cyg&#39; prefix on cygwin?</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">library_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span> <span class="o">=</span> <span class="s1">&#39;.dll&#39;</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">executable_ext</span> <span class="o">=</span> <span class="s1">&#39;.exe&#39;</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">search_path_env</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="s1">&#39;DLLs&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">),</span> <span class="s1">&#39;Library&#39;</span><span class="p">]</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">all_library_ext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.dll&#39;</span><span class="p">,</span> <span class="s1">&#39;.lib&#39;</span><span class="p">,</span> <span class="s1">&#39;.dll.a&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_mac</span><span class="p">:</span>
            <span class="c1"># TODO: Dynamic library by default on windows?</span>
            <span class="c1"># cls.shared_library_flag = &#39;-dynamiclib&#39;</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span> <span class="o">=</span> <span class="s1">&#39;.dylib&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span> <span class="o">=</span> <span class="s1">&#39;.so&#39;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">all_library_ext</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">all_library_ext</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">all_library_ext</span> <span class="o">+</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span><span class="p">]</span></div>

<div class="viewcode-block" id="LinkerBase.is_standard_libname"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase.is_standard_libname">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_standard_libname</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">libname</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if the provided file name conforms to the standards</span>
<span class="sd">        expected by this linker.</span>

<span class="sd">        Args:</span>
<span class="sd">            libname (str): Library file name to check.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the name conforms, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">toolset</span> <span class="o">==</span> <span class="s1">&#39;msvc&#39;</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Pass all libraries w/ ext</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">libname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">library_prefix</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">libname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">all_library_ext</span><span class="p">)))</span></div>

<div class="viewcode-block" id="LinkerBase.libpath2libname"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase.libpath2libname">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">libpath2libname</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">libpath</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the library name from the library path.</span>

<span class="sd">        Args:</span>
<span class="sd">            libpath (str): Full or partial path to library.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            str: Library name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">file2base</span><span class="p">(</span><span class="n">libpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">library_prefix</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">library_prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="LinkerBase.extract_kwargs"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase.extract_kwargs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">extract_kwargs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">add_kws_link</span><span class="o">=</span><span class="p">[],</span>
                       <span class="n">add_kws_both</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extract linker kwargs, leaving behind just compiler kwargs.</span>

<span class="sd">        Args:</span>
<span class="sd">            kwargs (dict): Keyword arguments passed to the compiler that should</span>
<span class="sd">                be sorted into kwargs used by either the compiler or linker or</span>
<span class="sd">                both. Keywords that are not used by the compiler will be removed</span>
<span class="sd">                from this dictionary.</span>
<span class="sd">            compiler (CompilerBase, optional): Compiler tool that linker kwargs</span>
<span class="sd">                are being extracted in order to call. Defaults to None and is</span>
<span class="sd">                ignored.</span>
<span class="sd">            add_kws_link (list, optional): Addition keywords that should be</span>
<span class="sd">                added to the list of those reserved for the linker. Defaults to</span>
<span class="sd">                [].</span>
<span class="sd">            add_kws_both (list, optional): Additional keywords that should be</span>
<span class="sd">                added to the list of those that are valid for both the linker</span>
<span class="sd">                and compiler. Defaults to [].</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Keyword arguments that should be passed to the linker.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kws_link</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;build_library&#39;</span><span class="p">,</span> <span class="s1">&#39;skip_library_libs&#39;</span><span class="p">,</span> <span class="s1">&#39;use_library_path&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_flags&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_language&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span><span class="p">,</span>
                    <span class="s1">&#39;libraries&#39;</span><span class="p">,</span> <span class="s1">&#39;library_dirs&#39;</span><span class="p">,</span> <span class="s1">&#39;library_libs&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;library_libs_nonstd&#39;</span><span class="p">,</span> <span class="s1">&#39;library_flags&#39;</span><span class="p">]</span>
        <span class="n">kws_both</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;overwrite&#39;</span><span class="p">,</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="s1">&#39;allow_error&#39;</span><span class="p">,</span> <span class="s1">&#39;dry_run&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;working_dir&#39;</span><span class="p">,</span> <span class="s1">&#39;env&#39;</span><span class="p">]</span>
        <span class="n">kws_link</span> <span class="o">+=</span> <span class="n">add_kws_link</span>
        <span class="n">kws_both</span> <span class="o">+=</span> <span class="n">add_kws_both</span>
        <span class="n">kwargs_link</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Add kwargs from flag_options</span>
        <span class="n">flag_options_comp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">compiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flag_options_comp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">compiler</span><span class="o">.</span><span class="n">flag_options</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kws_link</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="n">kws_both</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">flag_options_comp</span><span class="p">:</span>
                <span class="n">kws_both</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kws_link</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="c1"># Move kwargs unique to linker</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kws_link</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs_link</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="c1"># Copy kwargs that should be passed to both compiler &amp; linker</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kws_both</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs_link</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">kwargs_link</span></div>

<div class="viewcode-block" id="LinkerBase.get_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase.get_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">build_library</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_library_libs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">use_library_path</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a list of linker flags.</span>

<span class="sd">        Args:</span>
<span class="sd">            libraries (list, optional): Full paths to libraries that should be</span>
<span class="sd">                linked against. Defaults to an empty list.</span>
<span class="sd">            library_dirs (list, optional): Directories that should be searched</span>
<span class="sd">                for libraries. Defaults to an empty list.</span>
<span class="sd">            library_libs (list, optional): Names of libraries that should be</span>
<span class="sd">                linked against. Defaults to an empty list.</span>
<span class="sd">            library_libs_nonstd (list, optional): Names of libraries</span>
<span class="sd">                w/ non-standard naming conventions that should be linked</span>
<span class="sd">                against. Defaults to an empty list.</span>
<span class="sd">            library_flags (list, optional): Existing list that library flags</span>
<span class="sd">                should be appended to instead of the returned flags if</span>
<span class="sd">                skip_library_libs is True. Defaults to [].</span>
<span class="sd">            build_library (bool, optional): If True, a shared library is built.</span>
<span class="sd">                If False, an executable is created. Defaults to False.</span>
<span class="sd">            skip_library_libs (bool, optional): If True, the library_libs will</span>
<span class="sd">                not be added to the returned flags. Instead, any additional</span>
<span class="sd">                required library flags will be appended to the provided</span>
<span class="sd">                library_flags list which should then be added to the compilation</span>
<span class="sd">                command by the user in the appropriate location. Defaults to</span>
<span class="sd">                False.</span>
<span class="sd">            use_library_path (bool, optional): If True, the included libraries</span>
<span class="sd">                will be added to the output list as complete paths rather than</span>
<span class="sd">                as separate flags for library and library search directory.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Linker flags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Add output_first keyword argument for libraries</span>
        <span class="k">if</span> <span class="n">build_library</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;output_first&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">output_first_library</span><span class="p">)</span>
        <span class="c1"># Copy/Pop so that empty default dosn&#39;t get appended to and then</span>
        <span class="c1"># call the parent class&#39;s method</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;libraries&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">library_dirs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;library_dirs&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">library_libs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;library_libs&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">library_libs_nonstd</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;library_libs_nonstd&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">library_rpath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;library_rpath&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">library_flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;library_flags&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="c1"># Get list of libraries</span>
        <span class="n">dest_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">use_library_path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skip_library_libs</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">use_library_path</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
                     <span class="ow">or</span> <span class="p">(</span><span class="n">use_library_path</span> <span class="o">==</span> <span class="s1">&#39;library_flags&#39;</span><span class="p">))):</span>
                    <span class="n">dest_flags</span> <span class="o">=</span> <span class="n">library_flags</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dest_flags</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">use_library_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dest_flags</span> <span class="o">=</span> <span class="n">flags</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">libraries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_library_path</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dest_flags</span><span class="p">:</span>
                    <span class="n">dest_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x_d</span><span class="p">,</span> <span class="n">x_f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">x_d</span> <span class="ow">and</span> <span class="p">(</span><span class="n">x_d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">library_dirs</span><span class="p">):</span>
                    <span class="n">library_dirs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_d</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_standard_libname</span><span class="p">(</span><span class="n">x_f</span><span class="p">):</span>
                    <span class="n">library_libs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">libpath2libname</span><span class="p">(</span><span class="n">x_f</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">library_libs_nonstd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_f</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(((</span><span class="bp">cls</span><span class="o">.</span><span class="n">tooltype</span> <span class="o">==</span> <span class="s1">&#39;linker&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x_f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span><span class="p">)</span>
                     <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;library_rpath&#39;</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">))):</span>
                    <span class="k">if</span> <span class="n">x_d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">library_rpath</span><span class="p">:</span>
                        <span class="n">library_rpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_d</span><span class="p">)</span>
        <span class="c1"># Add libraries to library_flags instead of flags so they can be</span>
        <span class="c1"># used elsewhere</span>
        <span class="k">if</span> <span class="n">skip_library_libs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">library_libs</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">append_flags</span><span class="p">(</span><span class="n">library_flags</span><span class="p">,</span>
                                 <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">[</span><span class="s1">&#39;library_libs&#39;</span><span class="p">],</span>
                                 <span class="n">library_libs</span><span class="p">)</span>
                <span class="n">library_libs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">library_libs_nonstd</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">append_flags</span><span class="p">(</span><span class="n">library_flags</span><span class="p">,</span>
                                 <span class="bp">cls</span><span class="o">.</span><span class="n">flag_options</span><span class="p">[</span><span class="s1">&#39;library_libs_nonstd&#39;</span><span class="p">],</span>
                                 <span class="n">library_libs_nonstd</span><span class="p">)</span>
                <span class="n">library_libs_nonstd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Call parent class</span>
        <span class="k">if</span> <span class="n">library_dirs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;library_dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">library_dirs</span>
        <span class="k">if</span> <span class="n">library_libs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;library_libs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">library_libs</span>
        <span class="k">if</span> <span class="n">library_libs_nonstd</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;library_libs_nonstd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">library_libs_nonstd</span>
        <span class="k">if</span> <span class="n">library_rpath</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;library_rpath&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">library_rpath</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LinkerBase</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Add flag specifying the shared library</span>
        <span class="k">if</span> <span class="n">build_library</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">shared_library_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">shared_library_flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
    
<div class="viewcode-block" id="LinkerBase.get_output_file"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.LinkerBase.get_output_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_output_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">build_library</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">no_tool_suffix</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the appropriate output file that will result when linking</span>
<span class="sd">        a given object file.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (str): Object file being linked that name base will be taken</span>
<span class="sd">                from.</span>
<span class="sd">            build_library (bool, optional): If True, a shared library path is</span>
<span class="sd">                returned. If False, an executable file name is returned.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            working_dir (str, optional): Working directory where output file</span>
<span class="sd">                should be located. Defaults to None and is ignored.</span>
<span class="sd">            suffix (str, optional): Suffix that should be added to the</span>
<span class="sd">                output file (before the extension). Defaults to &quot;&quot;.</span>
<span class="sd">            no_tool_suffix (bool, optional): If True, the tool suffix will not</span>
<span class="sd">                be added to the object file name. Defaults to False.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to file that will be produced.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">build_library</span><span class="o">=</span><span class="n">build_library</span><span class="p">,</span>
                                        <span class="n">working_dir</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span>
                                        <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">build_library</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">library_prefix</span>
            <span class="n">out_ext</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">out_ext</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">executable_ext</span>
        <span class="n">obj_dir</span><span class="p">,</span> <span class="n">obj_base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">no_tool_suffix</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool_suffix</span><span class="p">()</span>
        <span class="n">out_base</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span>
                                 <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">obj_base</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                 <span class="n">suffix</span><span class="p">,</span> <span class="n">out_ext</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj_dir</span><span class="p">,</span> <span class="n">out_base</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">out</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">working_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span></div></div>
    
    
<div class="viewcode-block" id="ArchiverBase"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.ArchiverBase">[docs]</a><span class="k">class</span> <span class="nc">ArchiverBase</span><span class="p">(</span><span class="n">LinkerBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for archivers.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        static_library_flag (str): Flag that should be prepended to the archiver</span>
<span class="sd">            tool arguments to indicated that a static library should be produced.</span>
<span class="sd">        library_name_key (str): Option key indicating the name of a library</span>
<span class="sd">            that should be linked against.</span>
<span class="sd">        library_directory_key (str): Option key indicating a directory that</span>
<span class="sd">            should be included in the linker search path for libraries.</span>
<span class="sd">        library_prefix (str): Prefix that should be added to library paths.</span>
<span class="sd">        library_ext (str): Extension that should be used for static libraries.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">tooltype</span> <span class="o">=</span> <span class="s1">&#39;archiver&#39;</span>
    <span class="n">flag_options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">static_library_flag</span> <span class="o">=</span> <span class="s1">&#39;-static&#39;</span>
    <span class="n">library_ext</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># depends on the OS</span>

<div class="viewcode-block" id="ArchiverBase.before_registration"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.ArchiverBase.before_registration">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Operations that should be performed to modify class attributes prior</span>
<span class="sd">        to registration including things like platform dependent properties and</span>
<span class="sd">        checking environment variables for default settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">LinkerBase</span><span class="o">.</span><span class="n">before_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="c1"># Delete attributes that are linker specific</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;shared_library_flag&#39;</span><span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span> <span class="o">=</span> <span class="s1">&#39;.lib&#39;</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">search_path_env</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">),</span>
                                   <span class="s1">&#39;Library&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">library_ext</span> <span class="o">=</span> <span class="s1">&#39;.a&#39;</span></div>

<div class="viewcode-block" id="ArchiverBase.get_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.ArchiverBase.get_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a list of flags for this archiver tool.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Archiver flags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Call super class of parent class which handles defaults and user</span>
        <span class="c1"># defined options without adding any library info</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">extract_kwargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">LinkerBase</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Add flag specifying the static library</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">static_library_flag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">static_library_flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="ArchiverBase.get_output_file"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.ArchiverBase.get_output_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_output_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the appropriate output file that will result when linking</span>
<span class="sd">        a given object file.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (str): Object file being linked that name base will be taken</span>
<span class="sd">                from.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to file that will be produced.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;build_library&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ArchiverBase</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>

    
<div class="viewcode-block" id="BuildToolBase"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.BuildToolBase">[docs]</a><span class="k">class</span> <span class="nc">BuildToolBase</span><span class="p">(</span><span class="n">CompilerBase</span><span class="p">):</span>  <span class="c1"># pragma: in progress</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for build tools which are used to coordinate compilation.</span>

<span class="sd">    Args:</span>
<span class="sd">        buildfile (str, optional): File containing information about the build.</span>
<span class="sd">            Defaults to default_buildfile class attribute, if set.</span>
<span class="sd">        builddir (str, optional): Directory where build files should be placed.</span>
<span class="sd">            Defaults to directory where build is called.</span>
<span class="sd">        sourcedir (str, optional): Directory where source files are stored.</span>
<span class="sd">            Defaults to directory where build is called.</span>
<span class="sd">        target (str, optional): Build target. If not provided, build will be</span>
<span class="sd">            created without a target.</span>

<span class="sd">    Class Attributes:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tooltype</span> <span class="o">=</span> <span class="s1">&#39;buildtool&#39;</span>
    <span class="n">flag_options</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="n">default_buildfile</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_schema_properties</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;buildfile&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
        <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
        <span class="s1">&#39;sourcedir&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
        <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">}}</span></div>
    

<div class="viewcode-block" id="DummyLinkerBase"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.DummyLinkerBase">[docs]</a><span class="k">class</span> <span class="nc">DummyLinkerBase</span><span class="p">(</span><span class="n">LinkerBase</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for a dummy linker in the case that the linking step cannot</span>
<span class="sd">    be split into a separate call.&quot;&quot;&quot;</span>

    <span class="n">toolname</span> <span class="o">=</span> <span class="s1">&#39;dummy&#39;</span>
    <span class="n">is_dummy</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="DummyLinkerBase.get_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.DummyLinkerBase.get_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pragma: debug</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Raises an error to ward off getting flags for the dummy linker.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;DummyLinker&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="DummyLinkerBase.call"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.DummyLinkerBase.call">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  <span class="c1"># pragma: debug</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Raises an error to ward off calling the dummy linker.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;DummyLinker&quot;</span><span class="p">)</span></div></div>
        

<div class="viewcode-block" id="CompiledModelDriver"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver">[docs]</a><span class="k">class</span> <span class="nc">CompiledModelDriver</span><span class="p">(</span><span class="n">ModelDriver</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Base class for models written in compiled languages.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Driver name.</span>
<span class="sd">        args (str or list): The model executable and any arguments that should</span>
<span class="sd">            be passed to the model executable.</span>
<span class="sd">        source_files (list, optional): Source files that should be compiled</span>
<span class="sd">            into an executable. Defaults to an empty list and the driver will</span>
<span class="sd">            search for a source file based on the model executable (the first</span>
<span class="sd">            model argument).</span>
<span class="sd">        compiler (str, optional): Command or path to executable that should be</span>
<span class="sd">            used to compile the model. If not provided, the compiler will be</span>
<span class="sd">            determined based on configuration options for the language (if</span>
<span class="sd">            present) and the registered compilers that are available on the</span>
<span class="sd">            current operating system.</span>
<span class="sd">        compiler_flags (list, optional): Flags that should be passed to the</span>
<span class="sd">            compiler during compilation. If nto provided, the compiler flags</span>
<span class="sd">            will be determined based on configuration options for the language</span>
<span class="sd">            (if present), the compiler defaults, and the default_compiler_flags</span>
<span class="sd">            class attribute.</span>
<span class="sd">        linker (str, optional): Command or path to executable that should be</span>
<span class="sd">            used to link the model. If not provided, the linker will be</span>
<span class="sd">            determined based on configuration options for the language (if</span>
<span class="sd">            present) and the registered linkers that are available on the</span>
<span class="sd">            current operating system</span>
<span class="sd">        linker_flags (list, optional): Flags that should be passed to the</span>
<span class="sd">            linker during compilation. If nto provided, the linker flags</span>
<span class="sd">            will be determined based on configuration options for the language</span>
<span class="sd">            (if present), the linker defaults, and the default_linker_flags</span>
<span class="sd">            class attribute.</span>
<span class="sd">        **kwargs: Additional keyword arguments are passed to parent class.</span>

<span class="sd">    Class Attributes:</span>
<span class="sd">        default_compiler (str): Name of compiler that will be used if not</span>
<span class="sd">            set explictly by instance or config file.</span>
<span class="sd">        default_compiler_flags (list): Flags that should be passed to the</span>
<span class="sd">            compiler by default for this language.</span>
<span class="sd">        default_linker (str): Name of linker that will be used if not</span>
<span class="sd">            set explictly by instance or config file</span>
<span class="sd">        default_linker_flags (list): Flags that should be passed to the</span>
<span class="sd">            linker by default for this language.</span>
<span class="sd">        allow_parallel_build (bool): If True, a file can be compiled by</span>
<span class="sd">            two processes simultaneously. If False, it cannot and an</span>
<span class="sd">            MPI barrier will be used to prevent simultaneous compilation.</span>
<span class="sd">            Defaults to False.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        source_files (list): Source files.</span>
<span class="sd">        compiler (str): Name or path to the compiler that should be used.</span>
<span class="sd">        compiler_flags (list): Compiler flags.</span>
<span class="sd">        linker (str): Name or path to the linker that should be used.</span>
<span class="sd">        linker_flags (list): Linker flags.</span>
<span class="sd">        compiler_tool (CompilerBase): Compiler tool that will be used.</span>
<span class="sd">        linker_tool (LinkerBase): Linker tool that will be used.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_schema_properties</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;source_files&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                         <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[]},</span>
        <span class="s1">&#39;compiler&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
        <span class="s1">&#39;compiler_flags&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                           <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[]},</span>
        <span class="s1">&#39;linker&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
        <span class="s1">&#39;linker_flags&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span>
                         <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[]}}</span>
    <span class="n">executable_type</span> <span class="o">=</span> <span class="s1">&#39;compiler&#39;</span>
    <span class="n">default_compiler</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_compiler_flags</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_linker</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_linker_flags</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_archiver</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">default_archiver_flags</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_config_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]</span>
    <span class="n">_config_attr_map</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="s1">&#39;default_compiler&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;compiler&#39;</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="s1">&#39;default_compiler_flags&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;compiler_flags&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="s1">&#39;default_linker&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;linker&#39;</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="s1">&#39;default_linker_flags&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;linker_flags&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="s1">&#39;default_archiver&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;archiver&#39;</span><span class="p">},</span>
                        <span class="p">{</span><span class="s1">&#39;attr&#39;</span><span class="p">:</span> <span class="s1">&#39;default_archiver_flags&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="s1">&#39;archiver_flags&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">}]</span>
    <span class="n">is_build_tool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">allow_parallel_build</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">locked_buildfile</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">skip_compile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Compile</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_compile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_model</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)</span>
            <span class="k">assert</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Compiled </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)</span>

<div class="viewcode-block" id="CompiledModelDriver.after_registration"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.after_registration">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">after_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Operations that should be performed to modify class attributes after</span>
<span class="sd">        registration. For compiled languages this includes selecting the</span>
<span class="sd">        default compiler. The order of precedence is the config file &#39;compiler&#39;</span>
<span class="sd">        option for the language, followed by the environment variable set by</span>
<span class="sd">        _compiler_env, followed by the existing class attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ModelDriver</span><span class="o">.</span><span class="n">after_registration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">libtype</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">libtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">libtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;windows_import&#39;</span><span class="p">:</span>
                    <span class="n">libtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;shared&#39;</span><span class="p">,</span> <span class="s1">&#39;static&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">libtype</span> <span class="o">=</span> <span class="p">[</span><span class="n">libtype</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">libtype</span><span class="p">:</span>
                    <span class="n">libfile</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                                          <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">libfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">libfile</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>
            <span class="c1"># Set default linker/archiver based on compiler</span>
            <span class="n">default_tool_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default_tool_name</span><span class="p">:</span>
                <span class="n">default_tool</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">,</span>
                                                    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(((</span><span class="n">default_tool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                     <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">default_tool</span><span class="o">.</span><span class="n">is_installed</span><span class="p">()))):</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">tools</span><span class="o">.</span><span class="n">is_subprocess</span><span class="p">():</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="s1">&#39;Default </span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) not installed. &#39;</span>
                                      <span class="s1">&#39;Attempting to locate an alternative .&#39;</span><span class="p">)</span>
                                     <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">))</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.parse_arguments"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.parse_arguments">[docs]</a>    <span class="k">def</span> <span class="nf">parse_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sort model arguments to determine which one is the executable</span>
<span class="sd">        and which ones are arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list): List of arguments provided.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set defaults from attributes</span>
        <span class="k">for</span> <span class="n">k0</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_flags&#39;</span> <span class="o">%</span> <span class="n">k0</span><span class="p">]:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">))</span>
        <span class="c1"># Set tools so that they are cached</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_build_tool</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;archiver&#39;</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tool&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tool&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
        <span class="c1"># Ensure source files are absolute paths</span>
        <span class="n">source_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>
            <span class="n">source_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span> <span class="o">=</span> <span class="n">source_files</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">parse_arguments</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Handle case where provided argument is source and not executable</span>
        <span class="c1"># and case where provided argument is executable, but source files are</span>
        <span class="c1"># not specified</span>
        <span class="n">model_ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">model_is_source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_source_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_is_source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_file</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_function_file</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_src</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_src</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_ext</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_file</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">executable_ext</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Assert that model file is not source code in any of the</span>
                <span class="c1"># registered languages</span>
                <span class="k">if</span> <span class="p">(((</span><span class="n">model_ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_language_ext</span><span class="p">())</span>
                     <span class="ow">and</span> <span class="p">(</span><span class="n">model_ext</span> <span class="o">!=</span> <span class="s1">&#39;.exe&#39;</span><span class="p">))):</span>  <span class="c1"># pragma: debug</span>
                    <span class="kn">from</span> <span class="nn">yggdrasil.components</span> <span class="kn">import</span> <span class="n">import_component</span>
                    <span class="kn">from</span> <span class="nn">yggdrasil.schema</span> <span class="kn">import</span> <span class="n">get_schema</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">get_schema</span><span class="p">()[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">v_name</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">classes</span><span class="p">:</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">v_name</span><span class="p">)</span>
                        <span class="k">if</span> <span class="p">(((</span><span class="n">v</span><span class="o">.</span><span class="n">language_ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                             <span class="ow">and</span> <span class="p">(</span><span class="n">model_ext</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">language_ext</span><span class="p">))):</span>
                            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                                <span class="p">(</span><span class="s2">&quot;Extension &#39;</span><span class="si">%s</span><span class="s2">&#39; indicates that the &quot;</span>
                                 <span class="s2">&quot;model language is &#39;</span><span class="si">%s</span><span class="s2">&#39;, not &#39;</span><span class="si">%s</span><span class="s2">&#39; &quot;</span>
                                 <span class="s2">&quot;as specified.&quot;</span><span class="p">)</span>
                                <span class="o">%</span> <span class="p">(</span><span class="n">model_ext</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">language_ext</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># Add source file based on the model file</span>
                <span class="c1"># model_is_source = True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_src</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                  <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">language_ext</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_src</span><span class="p">)</span>
        <span class="c1"># Add intermediate files and executable by doing a dry run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_target_language</span><span class="p">()</span>  <span class="c1"># Required by make and cmake</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">products</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_is_source</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_is_source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Determined model file: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_file</span> <span class="o">=</span> <span class="n">out</span>
        <span class="c1"># Adjust products</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_source_products</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">,</span> <span class="n">source_products</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source_products</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;source_files: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_files</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;model_file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)</span>
        <span class="c1"># Add the buildfile_lock and pass the file</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_parallel_build</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_buildfile_lock</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_mpi</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span><span class="o">.</span><span class="n">message</span><span class="p">,</span>
                              <span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_tags</span><span class="p">[</span><span class="s1">&#39;BUILDFILE&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_buildfile_lock"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_buildfile_lock">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_buildfile_lock</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get a lock for a buildfile to prevent simultaneous access,</span>
<span class="sd">        creating one as necessary.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Build file.</span>
<span class="sd">            context (threading.Context): Threading context.</span>
<span class="sd">            instance (ModelDriver): Driver instance that should be used.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the FileLock</span>
<span class="sd">                initialization.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FileLock: Lock for the buildfile.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_buildfile_locks</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">locked_buildfile</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">context</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">context</span>
        <span class="k">with</span> <span class="n">_buildfile_locks_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_buildfile_locks</span><span class="p">:</span>
                <span class="n">_buildfile_locks</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="o">=</span> <span class="n">LockedFile</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_buildfile_locks</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span></div>

<div class="viewcode-block" id="CompiledModelDriver.buildfile_locked"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.buildfile_locked">[docs]</a>    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span> <span class="nf">buildfile_locked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Context manager for locked build file.&quot;&quot;&quot;</span>
        <span class="n">dry_run</span> <span class="o">=</span> <span class="p">(</span><span class="n">dry_run</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_parallel_build</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">recv_mpi</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_tags</span><span class="p">[</span><span class="s1">&#39;LOCK_BUILDFILE&#39;</span><span class="p">])</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpi_rank</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">send_mpi</span><span class="p">(</span><span class="s1">&#39;UNLOCK_BUILDFILE&#39;</span><span class="p">,</span>
                                  <span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_tags</span><span class="p">[</span><span class="s1">&#39;UNLOCK_BUILDFILE&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="CompiledModelDriver.mpi_partner_init"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.mpi_partner_init">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">mpi_partner_init</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Actions initializing an MPIPartnerModel.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">allow_parallel_build</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_mpi</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_tags</span><span class="p">[</span><span class="s1">&#39;BUILDFILE&#39;</span><span class="p">])</span>
            <span class="n">message</span><span class="p">[</span><span class="s1">&#39;context&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_buildfile_lock</span><span class="p">(</span><span class="o">**</span><span class="n">message</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span><span class="o">.</span><span class="n">when_to_lock</span> <span class="o">==</span> <span class="s1">&#39;init&#39;</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">partner_buildfile_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.mpi_partner_cleanup"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.mpi_partner_cleanup">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">mpi_partner_cleanup</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Actions cleaning up an MPIPartnerModel.&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">mpi_partner_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(((</span><span class="ow">not</span> <span class="bp">cls</span><span class="o">.</span><span class="n">allow_parallel_build</span><span class="p">)</span>
             <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span><span class="o">.</span><span class="n">when_to_lock</span> <span class="o">==</span> <span class="s1">&#39;cleanup&#39;</span><span class="p">))):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">partner_buildfile_lock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.partner_buildfile_lock"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.partner_buildfile_lock">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">partner_buildfile_lock</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Actions completing buildfile lock on MPIPartnerModels.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_lock</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_mpi</span><span class="p">(</span><span class="s1">&#39;LOCK_BUILDFILE&#39;</span><span class="p">,</span>
                          <span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_tags</span><span class="p">[</span><span class="s1">&#39;LOCK_BUILDFILE&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recv_mpi</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_mpi_tags</span><span class="p">[</span><span class="s1">&#39;UNLOCK_BUILDFILE&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="CompiledModelDriver.set_target_language"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.set_target_language">[docs]</a>    <span class="k">def</span> <span class="nf">set_target_language</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Set the language of the target being compiled (usually the same</span>
<span class="sd">        as the language associated with this driver.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of language.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">language</span></div>

<div class="viewcode-block" id="CompiledModelDriver.identify_source_files"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.identify_source_files">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">identify_source_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">source_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the source file based on model arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list, optional): Arguments provided.</span>
<span class="sd">            working_dir (str, optional): Working directory.</span>
<span class="sd">            source_files (list, optional): Source files in the model.</span>
<span class="sd">            **kwargs: Additional keyword arguments are ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Source files.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source_files</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">source_files</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">working_dir</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">src</span><span class="p">)):</span>
                    <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">working_dir</span><span class="p">,</span> <span class="n">src</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">identify_source_files</span><span class="p">(</span>
                <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">working_dir</span><span class="o">=</span><span class="n">working_dir</span><span class="p">,</span>
                <span class="n">source_files</span><span class="o">=</span><span class="n">source_files</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.write_wrappers"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.write_wrappers">[docs]</a>    <span class="k">def</span> <span class="nf">write_wrappers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write any wrappers needed to compile and/or run a model.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments are passed to the parent class&#39;s method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Full paths to any created wrappers.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">write_wrappers</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;logging_level&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric_logging_level</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schema_properties</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write_wrappers</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.model_command"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.model_command">[docs]</a>    <span class="k">def</span> <span class="nf">model_command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the command that should be used to run the model.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Any commands/arguments needed to run the model from the</span>
<span class="sd">                command line.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="n">model_exec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">model_exec</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">model_exec</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_args</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_available_tools"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_available_tools">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_available_tools</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Return the registry of compilation tools for this language.</span>

<span class="sd">        Args:</span>
<span class="sd">            tooltype (str): Name of tool type that should be returned. Values</span>
<span class="sd">                include &#39;compiler&#39;, &#39;linker&#39;, or &#39;archiver&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Registry of tools for this language.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">reg</span> <span class="o">=</span> <span class="n">get_compilation_tool_registry</span><span class="p">(</span><span class="n">tooltype</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;by_language&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">reg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="p">{}))</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_tool_static"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_tool_static">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_tool_static</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;tool&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the class associated with the specified compilation tool for</span>
<span class="sd">        this language.</span>

<span class="sd">        Args:</span>
<span class="sd">            cls (class, instance): Compiled driver class or instance of</span>
<span class="sd">                compiled driver class to get tool for.</span>
<span class="sd">            tooltype (str): Type of compilation tool that should be returned.</span>
<span class="sd">            toolname (str, optional): Name of the tool that should be</span>
<span class="sd">                returned. Defaults to None and the tool name associated</span>
<span class="sd">                with the provided class/instance will be used.</span>
<span class="sd">            return_prop (str, optional): Value that should be returned. If</span>
<span class="sd">                &#39;tool&#39;, the tool is returned. If &#39;name&#39;, the tool name is</span>
<span class="sd">                returned. If &#39;flags&#39;, the tool flags are returned. Defaults to</span>
<span class="sd">                &#39;tool&#39;.</span>
<span class="sd">            default (object, optiona): Tool that should be returned if one cannot</span>
<span class="sd">                be identified. If False, an error will be raised when a tool</span>
<span class="sd">                cannot be located. Defaults to False.</span>
<span class="sd">            language (str, optional): Language of tools that should be</span>
<span class="sd">                returned. Defaults to None if not provided.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompilationToolBase: Class providing an interface to the specified</span>
<span class="sd">                compilation tool.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotImplementedError: If a tool is not specified.</span>
<span class="sd">            ValueError: If return_prop is not &#39;tool&#39;, &#39;name&#39;, or &#39;flags&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">language</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">):</span>
            <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span>
                                <span class="n">return_prop</span><span class="o">=</span><span class="n">return_prop</span><span class="p">,</span>
                                <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_tool&#39;</span> <span class="o">%</span> <span class="n">tooltype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">toolname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">toolname</span> <span class="o">!=</span> <span class="n">out</span><span class="o">.</span><span class="n">toolname</span><span class="p">)):</span>
            <span class="c1"># Associate linker &amp; archiver with compiler so that it can be</span>
            <span class="c1"># used to retrieve them</span>
            <span class="c1"># Get tool name by checking:</span>
            <span class="c1">#   1. The tooltype attribute</span>
            <span class="c1">#   2. The default tooltype attribute</span>
            <span class="c1">#   3. The default argument (if one is provided).</span>
            <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toolname</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toolname</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tooltype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toolname</span> <span class="o">=</span> <span class="n">find_compilation_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                                                 <span class="n">allow_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not set for language &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span>
                                              <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not set for language &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">default</span>
            <span class="k">if</span> <span class="n">return_prop</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">toolname</span>
            <span class="c1"># Get flags</span>
            <span class="n">tool_flags</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_flags&#39;</span> <span class="o">%</span> <span class="n">tooltype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tool_flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tool_flags</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">_flags&#39;</span> <span class="o">%</span> <span class="n">tooltype</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_prop</span> <span class="o">==</span> <span class="s1">&#39;flags&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tool_flags</span>
            <span class="c1"># Get tool</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="n">tool_flags</span><span class="p">}</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;executable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                                               <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_executable&#39;</span> <span class="o">%</span> <span class="n">toolname</span><span class="p">,</span>
                                               <span class="n">toolname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tooltype</span> <span class="o">==</span> <span class="s1">&#39;compiler&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">linker</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span>
                        <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                    <span class="n">linker_flags</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span>
                        <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                    <span class="n">archiver</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span>
                        <span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                    <span class="n">archiver_flags</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span>
                        <span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;flags&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">get_compatible_tool</span><span class="p">(</span><span class="n">toolname</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                                      <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tooltype</span> <span class="o">!=</span> <span class="s1">&#39;compiler&#39;</span><span class="p">):</span>
                <span class="n">out_comp</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span>
                                        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">out_comp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">out_comp</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">)()</span>
                    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="c1"># Github Actions images now include GNU compilers by default</span>
                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not set for language &#39;</span><span class="si">%s</span><span class="s2">&#39; (toolname=</span><span class="si">%s</span><span class="s2">).&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">toolname</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> not set for language &#39;</span><span class="si">%s</span><span class="s2">&#39; (toolname=</span><span class="si">%s</span><span class="s2">).&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">toolname</span><span class="p">))</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Returns correct property given the tool</span>
        <span class="k">if</span> <span class="n">return_prop</span> <span class="o">==</span> <span class="s1">&#39;tool&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">elif</span> <span class="n">return_prop</span> <span class="o">==</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">toolname</span>
        <span class="k">elif</span> <span class="n">return_prop</span> <span class="o">==</span> <span class="s1">&#39;flags&#39;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">flags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid return_prop: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">return_prop</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_tool_instance"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_tool_instance">[docs]</a>    <span class="k">def</span> <span class="nf">get_tool_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get tool from a driver instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Arguments are passed to the get_tool_static method.</span>
<span class="sd">            **kwargs: Keyword arguments are passed to the get_tool_static method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompilationToolBase: Class providing an interface to the specified</span>
<span class="sd">                compilation tool.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CompiledModelDriver</span><span class="o">.</span><span class="n">get_tool_static</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.get_tool"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_tool">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_tool</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get tool from a driver class.</span>

<span class="sd">        Args:</span>
<span class="sd">            *args: Arguments are passed to the get_tool_static method.</span>
<span class="sd">            **kwargs: Keyword arguments are passed to the get_tool_static method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CompilationToolBase: Class providing an interface to the specified</span>
<span class="sd">                compilation tool.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CompiledModelDriver</span><span class="o">.</span><span class="n">get_tool_static</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_external_libraries"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_external_libraries">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_external_libraries</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">no_comm_libs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the external libraries that are required based on the</span>
<span class="sd">        default comm.</span>

<span class="sd">        Args:</span>
<span class="sd">            no_comm_libs (bool, optional): If True, libraries for the installed</span>
<span class="sd">                comms are not included in the returned list. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: The names of external libraries required by the interface</span>
<span class="sd">                library, including the dependency libraries for the installed</span>
<span class="sd">                comm libraries.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;external_dependencies&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">no_comm_libs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_comm_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;libraries&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_comm_installed</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">out</span> <span class="o">+=</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;libraries&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_dependency_info"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_dependency_info">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dependency_info</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the dictionary of information associated with a</span>
<span class="sd">        dependency.</span>

<span class="sd">        Args:</span>
<span class="sd">            dep (str): Name of internal or external dependency.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            default (dict, optional): Information dictionary that should</span>
<span class="sd">                be returned if dep cannot be located. Defaults to None</span>
<span class="sd">                and an error will be raised if dep cannot be found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dependency info.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dep_lang</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">dep</span>
            <span class="k">if</span> <span class="n">dep_lang</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">dep_lang</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="s1">&#39;compiler_specific&#39;</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="c1"># tool = cls.get_tool(&#39;compiler&#39;, toolname=toolname)</span>
                <span class="c1"># out = tool.internal_libraries[dep]</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Renable the above code to allow &quot;</span>
                                   <span class="s2">&quot;for compiler specific libraries.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;Could not determine information for &quot;</span>
                           <span class="s2">&quot;dependency &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dep</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_dependency_source"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_dependency_source">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dependency_source</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the path to the library source files (or header files) for a</span>
<span class="sd">        dependency.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            dep (str): Name of internal or external dependency or full path</span>
<span class="sd">                to the library.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            default (str, optional): Default that should be used if a value</span>
<span class="sd">                cannot be determined form internal/external dependencies or</span>
<span class="sd">                if dep is not a valid file. Defaults to None and is ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to the library source file. For header only libraries</span>
<span class="sd">                this will be the header location.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dep_lang</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">dep</span>
            <span class="k">if</span> <span class="n">dep_lang</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">dep_lang</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_dependency_source</span><span class="p">(</span>
                    <span class="n">dep</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">:</span>
            <span class="n">dep_info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">out_dir</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dep_lang</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dep_lang</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                    <span class="n">dep_drv</span> <span class="o">=</span> <span class="bp">cls</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dep_drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">dep_lang</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">dep</span> <span class="o">+</span> <span class="n">dep_drv</span><span class="o">.</span><span class="n">language_ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">out_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">out</span><span class="p">)))):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out_dir</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">:</span>
            <span class="n">dep_lang</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="s1">&#39;include&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dep</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">dep</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not determine source location for &quot;</span>
                                 <span class="s2">&quot;dependency &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_dependency_object"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_dependency_object">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dependency_object</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the location of an object file for a dependency.</span>

<span class="sd">        Args:</span>
<span class="sd">            dep (str): Name of internal or external dependency or full path</span>
<span class="sd">                to the object file.</span>
<span class="sd">            default (str, optional): Default that should be used if a value</span>
<span class="sd">                cannot be determined form internal/external dependencies or</span>
<span class="sd">                if dep is not a valid file. Defaults to None and is ignored.</span>
<span class="sd">            commtype (str, optional): If provided, this is the communication</span>
<span class="sd">                type that should be used for the model and flags for just that</span>
<span class="sd">                comm type will be included. If None, flags for all installed</span>
<span class="sd">                comm types will be included. Default to None. This keyword is</span>
<span class="sd">                only used in the names of internal libraries.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to the object file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dep_lang</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">dep</span>
            <span class="k">if</span> <span class="n">dep_lang</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">dep_lang</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_dependency_object</span><span class="p">(</span>
                    <span class="n">dep</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_source</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_internal_suffix</span><span class="p">(</span><span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">)</span>
            <span class="n">dep_info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
            <span class="n">dep_lang</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">dep_lang</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span>
                <span class="n">src</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dep</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">dep</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not determine object file path for &quot;</span>
                                 <span class="s2">&quot;dependency &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_dependency_library"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_dependency_library">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dependency_library</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">commtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the library location for a dependency.</span>

<span class="sd">        Args:</span>
<span class="sd">            dep (str): Name of internal or external dependency or full path</span>
<span class="sd">                to the library.</span>
<span class="sd">            default (str, optional): Default that should be used if a value</span>
<span class="sd">                cannot be determined form internal/external dependencies or</span>
<span class="sd">                if dep is not a valid file. Defaults to None and is ignored.</span>
<span class="sd">            libtype (str, optional): Library type that should be returned.</span>
<span class="sd">                Valid values are &#39;static&#39; and &#39;shared&#39;. Defaults to None and</span>
<span class="sd">                will be set on the dependency&#39;s libtype (if it has one) or</span>
<span class="sd">                the _default_libtype parameter (if it doesn&#39;t).</span>
<span class="sd">            commtype (str, optional): If provided, this is the communication</span>
<span class="sd">                type that should be used for the model and flags for just that</span>
<span class="sd">                comm type will be included. If None, flags for all installed</span>
<span class="sd">                comm types will be included. Default to None. This keyword is</span>
<span class="sd">                only used in the names of internal libraries.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to the library file. For header only libraries,</span>
<span class="sd">                an empty string will be returned.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If libtype is not &#39;static&#39; or &#39;shared&#39;.</span>
<span class="sd">            ValueError: If the path to the library cannot be determined for the</span>
<span class="sd">                specified dependency and default is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dep_lang</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">dep</span>
            <span class="k">if</span> <span class="n">dep_lang</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">dep_lang</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_dependency_library</span><span class="p">(</span>
                    <span class="n">dep</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">,</span>
                    <span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="n">libclass</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">libinfo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">:</span>
            <span class="n">libclass</span> <span class="o">=</span> <span class="s1">&#39;internal&#39;</span>
            <span class="n">libinfo</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">:</span>
            <span class="n">libclass</span> <span class="o">=</span> <span class="s1">&#39;external&#39;</span>
            <span class="n">libinfo</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span>
        <span class="n">toolname</span> <span class="o">=</span> <span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
        <span class="c1"># Get default libtype and return if header_only library</span>
        <span class="k">if</span> <span class="n">libtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">libtype</span> <span class="o">=</span> <span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="n">_default_libtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;header_only&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># Do substitution when windows_import specified</span>
        <span class="k">if</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;windows_import&#39;</span><span class="p">:</span>
            <span class="n">libtype</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
        <span class="c1"># Check that libtype is valid</span>
        <span class="n">libtype_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">libtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">libtype_list</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;libtype must be one of </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">libtype_list</span><span class="p">)</span>
        <span class="c1"># Determine output</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">libclass</span> <span class="o">==</span> <span class="s1">&#39;external&#39;</span><span class="p">:</span>
            <span class="n">dep_lang</span> <span class="o">=</span> <span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">libtype</span> <span class="ow">in</span> <span class="n">libinfo</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">libinfo</span><span class="p">[</span><span class="n">libtype</span><span class="p">]):</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">libinfo</span><span class="p">[</span><span class="n">libtype</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dep</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">libtype</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dep</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">libtype</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dep</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">libtype</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">libtype_found</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">libtype_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dep</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                        <span class="n">libtype_found</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">libtype_found</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;A &#39;</span><span class="si">{</span><span class="n">libtype</span><span class="si">}</span><span class="s2">&#39; library could not be &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;located for dependency &#39;</span><span class="si">{</span><span class="n">dep</span><span class="si">}</span><span class="s2">&#39;, but &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;one or more libraries of types &quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">libtype_found</span><span class="si">}</span><span class="s2"> were found.&quot;</span><span class="p">)</span>
            <span class="c1"># TODO: CLEANUP</span>
            <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span> <span class="ow">and</span> <span class="n">out</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.lib&#39;</span><span class="p">):</span>  <span class="c1"># pragma: windows</span>
                <span class="k">if</span> <span class="n">tool</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">dep_lang</span><span class="p">,</span>
                                        <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tool</span><span class="o">.</span><span class="n">is_gnu</span><span class="p">:</span>
                    <span class="n">dll</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_library</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="s1">&#39;shared&#39;</span><span class="p">,</span>
                                                     <span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">,</span>
                                                     <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">dll2a</span><span class="p">(</span><span class="n">dll</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">libclass</span> <span class="o">==</span> <span class="s1">&#39;internal&#39;</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_source</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_internal_suffix</span><span class="p">(</span><span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">)</span>
            <span class="n">dep_lang</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">dep_lang</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">import_lib</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;windows_import&#39;</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">))):</span>
                <span class="c1"># Name import lib using dll</span>
                <span class="n">import_lib</span> <span class="o">=</span> <span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">toolname</span> <span class="o">==</span> <span class="s1">&#39;cl&#39;</span><span class="p">)</span>
                <span class="n">libtype</span> <span class="o">=</span> <span class="s1">&#39;shared&#39;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">,</span> <span class="n">no_src_ext</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">build_library</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">suffix</span><span class="o">=</span><span class="n">suffix</span><span class="p">,</span>
                                       <span class="n">working_dir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">import_lib</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">out</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.lib&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dep</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">dep</span>
        <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not determine library path for &quot;</span>
                                 <span class="s2">&quot;dependency &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_dependency_include_dirs"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_dependency_include_dirs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dependency_include_dirs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the include directories for a dependency.</span>

<span class="sd">        Args:</span>
<span class="sd">            dep (str): Name of internal or external dependency or full path</span>
<span class="sd">                to the library.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            default (str, optional): Default that should be used if a value</span>
<span class="sd">                cannot be determined form internal/external dependencies or</span>
<span class="sd">                if dep is not a valid file. Defaults to None and is ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Full paths to the directories containing the dependency&#39;s</span>
<span class="sd">                header(s).</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If the include directory cannot be determined for the</span>
<span class="sd">                specified dependency and default is None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dep_lang</span><span class="p">,</span> <span class="n">dep</span> <span class="o">=</span> <span class="n">dep</span>
            <span class="k">if</span> <span class="n">dep_lang</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">dep_lang</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_dependency_include_dirs</span><span class="p">(</span>
                    <span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">:</span>
            <span class="n">dep_info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;directory&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">src</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">]</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include_dirs&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">elif</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">:</span>
            <span class="n">dep_lang</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">dep</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_include&#39;</span> <span class="o">%</span> <span class="n">dep</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dep</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not determine include directory for &quot;</span>
                                 <span class="s2">&quot;dependency &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">default</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">out</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_dependency_order"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_dependency_order">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_dependency_order</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">deps</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the correct dependency order, including any dependencies for</span>
<span class="sd">        the direct dependencies.</span>

<span class="sd">        Args:</span>
<span class="sd">            deps (list): Dependencies in order.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Dependency order.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span><span class="n">deps</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">:</span>
            <span class="n">new_deps</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">d_lang</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">d_lang</span> <span class="o">==</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
                    <span class="n">drv</span> <span class="o">=</span> <span class="bp">cls</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">d_lang</span><span class="p">)</span>
                <span class="n">sub_deps</span> <span class="o">=</span> <span class="p">[(</span><span class="n">d_lang</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                            <span class="n">drv</span><span class="o">.</span><span class="n">get_dependency_order</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dep_info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{})</span>
                <span class="n">toolname</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
                <span class="n">sub_deps</span> <span class="o">=</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;internal_dependencies&#39;</span><span class="p">,</span> <span class="p">[])</span>
                <span class="n">sub_deps</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_order</span><span class="p">(</span><span class="n">sub_deps</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">min_dep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sub_d</span> <span class="ow">in</span> <span class="n">sub_deps</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">sub_d</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">min_dep</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_dep</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sub_d</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_deps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_d</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">dpos</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">dpos</span> <span class="o">&lt;=</span> <span class="n">min_dep</span><span class="p">)</span>
                <span class="n">min_dep</span> <span class="o">=</span> <span class="n">dpos</span>
            <span class="k">elif</span> <span class="n">d</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_deps</span><span class="p">:</span>
                <span class="n">new_deps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:</span><span class="n">min_dep</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_deps</span> <span class="o">+</span> <span class="n">out</span><span class="p">[</span><span class="n">min_dep</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_compiler_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_compiler_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_compiler_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the flags required by the current compiler.</span>

<span class="sd">        Args:</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            compiler (CompilerBase, optional): Compilation tool class for the</span>
<span class="sd">                compiler that should be used. Defaults to None and is set</span>
<span class="sd">                based on toolname.</span>
<span class="sd">            **kwargs: Keyword arguments are passed to cls.update_compiler_kwargs</span>
<span class="sd">                first and then the compiler&#39;s get_flags method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Flags for the compiler.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">compiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">compiler</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">update_compiler_kwargs</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_linker_flags"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_linker_flags">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_linker_flags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the flags required by the current linker.</span>

<span class="sd">        Args:</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            **kwargs: Keyword arguments are passed to cls.update_linker_kwargs</span>
<span class="sd">                first and then the linker&#39;s get_flags method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Flags for the linker.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
            <span class="n">tooltype</span> <span class="o">=</span> <span class="s1">&#39;archiver&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tooltype</span> <span class="o">=</span> <span class="s1">&#39;linker&#39;</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tool</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;No </span><span class="si">%s</span><span class="s2"> tool for language </span><span class="si">%s</span><span class="s2">.&quot;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">))</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">update_linker_kwargs</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tool</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.update_compiler_kwargs"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.update_compiler_kwargs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update_compiler_kwargs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">for_api</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">for_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">commtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">include_dirs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                               <span class="n">definitions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_interface_flags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update keyword arguments supplied to the compiler get_flags method</span>
<span class="sd">        for various options.</span>

<span class="sd">        Args:</span>
<span class="sd">            dont_link (bool, optional): If True, the command will result in a</span>
<span class="sd">                linkable object file rather than an executable. Defaults to</span>
<span class="sd">                False.</span>
<span class="sd">            for_api (bool, optional): If True, flags are added that are required</span>
<span class="sd">                for compiling internal api libraries in this language. This</span>
<span class="sd">                includes external communication libraries. Defaults to False.</span>
<span class="sd">            for_model (bool, optional): If True, flags are added that are</span>
<span class="sd">                required for including the interface library. Defaults to False.</span>
<span class="sd">            commtype (str, optional): If provided, this is the communication</span>
<span class="sd">                type that should be used for the model and flags for just that</span>
<span class="sd">                comm type will be included. If None, flags for all installed</span>
<span class="sd">                comm types will be included. Default to None. This keyword is</span>
<span class="sd">                only used if for_model is True.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            include_dirs (list, optional): If provided, each list element will</span>
<span class="sd">                be added as an included directory flag. Defaults to None and</span>
<span class="sd">                is initialized as an empty list.</span>
<span class="sd">            definitions (list, optional): If provided, each list element will be</span>
<span class="sd">                added as a defintion. Defaults to None and is initialized to an</span>
<span class="sd">                empty list.</span>
<span class="sd">            skip_interface_flags (bool, optional): If True, interface flags will</span>
<span class="sd">                not be added. Defaults to False.</span>
<span class="sd">            internal_dependencies (list, optional): If provided, a list of names</span>
<span class="sd">                of internal libraries that are required or linkable object files</span>
<span class="sd">                for dependencies. Defaults to an empty list.</span>
<span class="sd">            external_dependencies (list, optional): If provided, a list of names</span>
<span class="sd">                of external libraries that are required or linkable object files</span>
<span class="sd">                for dependencies. Defaults to an empty list.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the compiler</span>
<span class="sd">                class&#39;s &#39;get_flags&#39; method and get_linker_flags if dont_link is</span>
<span class="sd">                False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Keyword arguments for a get_flags method providing compiler</span>
<span class="sd">                flags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">include_dirs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_dirs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">definitions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">definitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">internal_dependencies</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;internal_dependencies&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">external_dependencies</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;external_dependencies&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># Communication specific compilation flags</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">for_model</span> <span class="ow">or</span> <span class="n">for_api</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_interface_flags</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_installed_comm</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">):</span>
                <span class="n">definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">INSTALLED&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_comm_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libraries&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">external_dependencies</span><span class="p">:</span>
                        <span class="n">external_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">commtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">commtype</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_default_comm</span><span class="p">()</span>
            <span class="n">definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">DEF&#39;</span> <span class="o">%</span> <span class="n">commtype</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="c1"># Add interface as internal_dependency for models and expand</span>
        <span class="c1"># dependencies to get entire chain including sub-dependencies and so on</span>
        <span class="k">if</span> <span class="n">for_model</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_interface_flags</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(((</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">internal_dependencies</span><span class="p">))):</span>
                <span class="n">internal_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_external_libraries</span><span class="p">(</span><span class="n">no_comm_libs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">external_dependencies</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_library_installed</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">external_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">all_internal_dependencies</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_order</span><span class="p">(</span>
            <span class="n">internal_dependencies</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="c1"># Add internal libraries as objects for api</span>
        <span class="n">additional_objs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;additional_objs&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">internal_dependencies</span><span class="p">:</span>
            <span class="n">libinfo</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                <span class="n">additional_objs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_object</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">libinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span>
                                                               <span class="n">toolname</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">additional_objs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;additional_objs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_objs</span>
        <span class="c1"># Add directories for internal/external dependencies</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">all_internal_dependencies</span> <span class="o">+</span> <span class="n">external_dependencies</span><span class="p">:</span>
            <span class="n">include_dirs</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_include_dirs</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="c1"># Add flags for included directories</span>
        <span class="k">if</span> <span class="n">directory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_dirs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
        <span class="c1"># Update kwargs</span>
        <span class="k">if</span> <span class="n">include_dirs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;include_dirs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">include_dirs</span>
        <span class="k">if</span> <span class="n">definitions</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;definitions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">definitions</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dont_link&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">libtype</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">libtype</span> <span class="o">!=</span> <span class="s1">&#39;object&#39;</span><span class="p">:</span>
                <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">update_linker_kwargs</span><span class="p">(</span>
                    <span class="n">for_api</span><span class="o">=</span><span class="n">for_api</span><span class="p">,</span> <span class="n">for_model</span><span class="o">=</span><span class="n">for_model</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">,</span>
                    <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="n">skip_interface_flags</span><span class="o">=</span><span class="n">skip_interface_flags</span><span class="p">,</span>
                    <span class="n">internal_dependencies</span><span class="o">=</span><span class="n">internal_dependencies</span><span class="p">,</span>
                    <span class="n">external_dependencies</span><span class="o">=</span><span class="n">external_dependencies</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">libtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libtype</span>
        <span class="k">return</span> <span class="n">kwargs</span></div>

<div class="viewcode-block" id="CompiledModelDriver.update_linker_kwargs"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.update_linker_kwargs">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">update_linker_kwargs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">for_api</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">for_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">,</span>
                             <span class="n">skip_interface_flags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">use_library_path_internal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update keyword arguments supplied to the linker/archiver get_flags</span>
<span class="sd">        method for various options.</span>

<span class="sd">        Args:</span>
<span class="sd">            for_api (bool, optional): If True, flags are added that are required</span>
<span class="sd">                for linking internal api libraries in this language. This</span>
<span class="sd">                includes external communication libraries. Defaults to False.</span>
<span class="sd">            for_model (bool, optional): If True, flags are added that are</span>
<span class="sd">                required for including the interface library. Defaults to False.</span>
<span class="sd">            commtype (str, optional): If provided, this is the communication</span>
<span class="sd">                type that should be used for the model and flags for just that</span>
<span class="sd">                comm type will be included. If None, flags for all installed</span>
<span class="sd">                comm types will be included. Default to None. This keyword is</span>
<span class="sd">                only used if for_model is True.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            libtype (str, optional): Library type that should be created by the</span>
<span class="sd">                linker/archiver. Valid values are &#39;static&#39;, &#39;shared&#39;, or</span>
<span class="sd">                &#39;object&#39;. Defaults to &#39;object&#39;.</span>
<span class="sd">            skip_interface_flags (bool, optional): If True, interface flags will</span>
<span class="sd">                not be added. Defaults to False.</span>
<span class="sd">            libraries (list, optional): Full paths to libraries that should be</span>
<span class="sd">                linked against. Defaults to an empty list.</span>
<span class="sd">            internal_dependencies (list, optional): If provided, a list of names</span>
<span class="sd">                of internal libraries that are required or linkable object files</span>
<span class="sd">                for dependencies. Defaults to an empty list.</span>
<span class="sd">            external_dependencies (list, optional): If provided, a list of names</span>
<span class="sd">                of external libraries that are required or linkable object files</span>
<span class="sd">                for dependencies. Defaults to an empty list.</span>
<span class="sd">            use_library_path_internal (bool, optional): If True, internal</span>
<span class="sd">                dependencies are included as full paths. Defaults to False.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the linker</span>
<span class="sd">                (or archiver if static is True) &#39;get_flags&#39; method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Keyword arguments for a get_flags method providing linker/</span>
<span class="sd">                archiver flags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Set default toolname</span>
        <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s2">&quot;compiler&quot;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="c1"># Copy/Pop so that empty default dosn&#39;t get appended to</span>
        <span class="n">libraries</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;libraries&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">internal_dependencies</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;internal_dependencies&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">external_dependencies</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;external_dependencies&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># Communication specific compilation flags</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">for_model</span> <span class="ow">or</span> <span class="n">for_api</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_interface_flags</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_installed_comm</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">supported_comm_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libraries&#39;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">external_dependencies</span><span class="p">:</span>
                        <span class="n">external_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># Add interface as internal_dependency for models</span>
        <span class="k">if</span> <span class="n">for_model</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">skip_interface_flags</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(((</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">internal_dependencies</span><span class="p">))):</span>
                <span class="n">internal_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_order</span><span class="p">([</span><span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span><span class="p">],</span>
                                                    <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">internal_dependencies</span><span class="p">:</span>
                        <span class="n">dep_info</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">]:</span>
                            <span class="n">internal_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_external_libraries</span><span class="p">(</span><span class="n">no_comm_libs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">external_dependencies</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_library_installed</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                    <span class="n">external_dependencies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="c1"># Add flags for internal/external depenencies</span>
        <span class="n">all_dep</span> <span class="o">=</span> <span class="n">internal_dependencies</span> <span class="o">+</span> <span class="n">external_dependencies</span>
        <span class="k">for</span> <span class="n">dep</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_order</span><span class="p">(</span><span class="n">all_dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">):</span>
            <span class="n">dep_lib</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_library</span><span class="p">(</span>
                <span class="n">dep</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="n">commtype</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dep_lib</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(((</span><span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dry_run&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
                     <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dep_lib</span><span class="p">)))):</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">if</span> <span class="n">dep</span> <span class="ow">in</span> <span class="n">internal_dependencies</span><span class="p">:</span>
                        <span class="c1"># If this is called recursively, verify that dep_lib is produced</span>
                        <span class="c1"># by compiling dep.</span>
                        <span class="bp">cls</span><span class="o">.</span><span class="n">compile_dependencies</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">dep_lib</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                            <span class="p">(</span><span class="s2">&quot;Library for </span><span class="si">%s</span><span class="s2"> dependency does not &quot;</span>
                             <span class="s2">&quot;exist: &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">dep_lib</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">use_library_path_internal</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dep</span> <span class="ow">in</span> <span class="n">internal_dependencies</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;skip_library_libs&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">use_library_path_internal</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
                            <span class="n">libkey</span> <span class="o">=</span> <span class="s1">&#39;library_flags&#39;</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">libkey</span> <span class="o">=</span> <span class="n">use_library_path_internal</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">libkey</span> <span class="o">=</span> <span class="s1">&#39;flags&#39;</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">libkey</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">libkey</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep_lib</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">libraries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dep_lib</span><span class="p">)</span>
        <span class="c1"># Update kwargs</span>
        <span class="k">if</span> <span class="n">libraries</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libraries&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">libraries</span>
        <span class="k">if</span> <span class="n">libtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">]:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;build_library&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">kwargs</span></div>

<div class="viewcode-block" id="CompiledModelDriver.language_executable"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.language_executable">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">language_executable</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Command required to compile/run a model written in this language</span>
<span class="sd">        from the command line.</span>

<span class="sd">        Args:</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of (or path to) compiler/interpreter executable required</span>
<span class="sd">                to run the compiler/interpreter from the command line.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span><span class="o">.</span><span class="n">get_executable</span><span class="p">()</span></div>

<div class="viewcode-block" id="CompiledModelDriver.language_version"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.language_version">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">language_version</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the version of this language.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments are passed to cls.run_executable.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Version of compiler/interpreter for this language.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="s1">&#39;tool_version&#39;</span><span class="p">):</span>  <span class="c1"># pragma: windows</span>
            <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">tool_version</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;version_flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">version_flags</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;skip_flags&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">language_version</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.run_model"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.run_model">[docs]</a>    <span class="k">def</span> <span class="nf">run_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Run the model. Unless overridden, the model will be run using</span>
<span class="sd">        run_executable.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Keyword arguments are passed to run_executable.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exec_type</span><span class="o">=</span><span class="s1">&#39;direct&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">run_model</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.executable_command"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.executable_command">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">executable_command</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">exec_type</span><span class="o">=</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compose a command for running a program using the compiler for this</span>
<span class="sd">        language and the provied arguments. If not already present, the</span>
<span class="sd">        compiler command and compiler flags are prepended to the provided</span>
<span class="sd">        arguments.</span>

<span class="sd">        Args:</span>
<span class="sd">            args (list): The program that returned command should run and any</span>
<span class="sd">                arguments that should be provided to it. For the compiler, this</span>
<span class="sd">                means the source files, for the linker, this means the object</span>
<span class="sd">                files.</span>
<span class="sd">            exec_type (str, optional): Type of executable command that will be</span>
<span class="sd">                returned. If &#39;compiler&#39;, a command using the compiler is</span>
<span class="sd">                returned, if &#39;linker&#39;, a command using the linker is returned,</span>
<span class="sd">                and if &#39;direct&#39;, the raw args being provided are returned.</span>
<span class="sd">                Defaults to &#39;compiler&#39;.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to either</span>
<span class="sd">                get_linker_flags or get_compiler_flags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: Arguments composing the command required to run the program</span>
<span class="sd">                from the command line using the compiler for this language.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If exec_type is not &#39;compiler&#39;, &#39;linker&#39;, or &#39;direct&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">exec_type</span> <span class="o">==</span> <span class="s1">&#39;direct&#39;</span><span class="p">:</span>
            <span class="n">unused_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;unused_kwargs&#39;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">unused_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">args</span>
        <span class="k">elif</span> <span class="n">exec_type</span> <span class="o">==</span> <span class="s1">&#39;linker&#39;</span><span class="p">:</span>
            <span class="n">exec_cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">exec_type</span> <span class="o">==</span> <span class="s1">&#39;compiler&#39;</span><span class="p">:</span>
            <span class="n">exec_cls</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid exec_type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">exec_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exec_cls</span><span class="o">.</span><span class="n">get_executable_command</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="CompiledModelDriver.is_library_installed"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.is_library_installed">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_library_installed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">lib</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if a dependency is installed by check for the appropriate</span>
<span class="sd">        config options setting the path to the library files.</span>

<span class="sd">        Args:</span>
<span class="sd">            lib (str): Name of the library that should be checked.</span>
<span class="sd">            cfg (CisConfigParser, optional): Config class that should be checked.</span>
<span class="sd">                Defaults to yggdrasil.config.ygg_cfg if not provided.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the library is installed, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lib</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">lib_lang</span><span class="p">,</span> <span class="n">lib</span> <span class="o">=</span> <span class="n">lib</span>
            <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">lib_lang</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">is_library_installed</span><span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cfg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cfg</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cfg</span>
        <span class="n">out</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">lib</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">:</span>
            <span class="n">src</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_source</span><span class="p">(</span><span class="n">lib</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
        <span class="n">dep_lang</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">lib</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lib_typ</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">lib</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">lib_typ</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">break</span>
            <span class="n">lib_opt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lib</span><span class="p">,</span> <span class="n">lib_typ</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">dep_lang</span><span class="p">,</span> <span class="n">lib_opt</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.is_configured"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.is_configured">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_configured</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if the appropriate configuration has been performed (e.g.</span>
<span class="sd">        installation of supporting libraries etc.)</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the language has been configured.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">is_configured</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_external_libraries</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">break</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_library_installed</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.is_tool_installed"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.is_tool_installed">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_tool_installed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">tooltype</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if a compilation tool of a certain is installed for</span>
<span class="sd">        this language.</span>

<span class="sd">        Args:</span>
<span class="sd">            tooltype (str): Type of tool to check for. Supported values include</span>
<span class="sd">                &#39;compiler&#39;, &#39;linker&#39;, &amp; &#39;archiver&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if a tool of the specified type is installed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_build_tool</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tooltype</span> <span class="o">!=</span> <span class="s1">&#39;compiler&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tooltype</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="CompiledModelDriver.is_language_installed"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.is_language_installed">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">is_language_installed</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine if the interpreter/compiler for the associated programming</span>
<span class="sd">        language is installed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the language interpreter/compiler is installed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">is_language_installed</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">break</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_tool_installed</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.configure"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.configure">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add configuration options for this language.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg (CisConfigParser): Config class that options should be set for.</span>
<span class="sd">            **kwargs: Additional keyword arguments are used to set tool</span>
<span class="sd">                configuration options (e.g. &#39;compiler&#39;).</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: Section, option, description tuples for options that could not</span>
<span class="sd">                be set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_section</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)):</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">add_section</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>  <span class="c1"># pragma: debug</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected configuration option: &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="n">vtool</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vtool</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="n">reg</span> <span class="o">=</span> <span class="n">get_compilation_tool_registry</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">kreg</span><span class="p">,</span> <span class="n">vreg</span> <span class="ow">in</span> <span class="n">reg</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">kreg</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">vtool</span> <span class="o">=</span> <span class="n">vreg</span>
                        <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">vtool</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not locate a </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> tool &#39;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&#39;.&quot;</span><span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">vtool</span><span class="o">.</span><span class="n">toolname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">vtool</span><span class="o">.</span><span class="n">toolname</span><span class="si">}</span><span class="s1">_executable&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="c1"># Call __func__ to avoid direct invoking of class which dosn&#39;t exist</span>
        <span class="c1"># in after_registration where this is called</span>
        <span class="k">return</span> <span class="n">ModelDriver</span><span class="o">.</span><span class="n">configure</span><span class="o">.</span><span class="vm">__func__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.configure_executable_type"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.configure_executable_type">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">configure_executable_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add configuration options specific in the executable type</span>
<span class="sd">        before the libraries are configured.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg (CisConfigParser): Config class that options should be set for.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: Section, option, description tuples for options that could not</span>
<span class="sd">                be set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">configure_executable_type</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">linker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">archiver</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>
            <span class="c1"># Set default linker/archiver based on compiler</span>
            <span class="n">default_tool_name</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(((</span><span class="n">default_tool_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">compiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]))):</span>
                <span class="n">default_tool_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Check default tool to make sure it is installed</span>
            <span class="k">if</span> <span class="n">default_tool_name</span><span class="p">:</span>
                <span class="n">default_tool</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">default_tool</span><span class="o">.</span><span class="n">is_installed</span><span class="p">():</span>  <span class="c1"># pragma: debug</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">((</span><span class="s1">&#39;Default </span><span class="si">%s</span><span class="s1"> for </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">) not installed. &#39;</span>
                                  <span class="s1">&#39;Attempting to locate an alternative .&#39;</span><span class="p">)</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">))</span>
                    <span class="n">default_tool_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># Determine compilation tools based on language/platform</span>
            <span class="k">if</span> <span class="n">default_tool_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="n">default_tool_name</span> <span class="o">=</span> <span class="n">find_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span>
                                                          <span class="n">allow_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># Set default tool attribute &amp; record compiler tool if set</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default_tool_name</span><span class="p">:</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;compiler&#39;</span><span class="p">:</span>
                    <span class="n">compiler</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;linker&#39;</span><span class="p">:</span>
                    <span class="n">linker</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;archiver&#39;</span><span class="p">:</span>
                    <span class="n">archiver</span> <span class="o">=</span> <span class="n">get_compilation_tool</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">default_tool_name</span><span class="p">)</span>
        <span class="c1"># Check for missing library names</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">libtype</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">libtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">libtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">archiver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">v</span><span class="p">[</span><span class="n">libtype</span><span class="p">]</span> <span class="o">=</span> <span class="n">archiver</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">no_tool_suffix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;shared&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">linker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">v</span><span class="p">[</span><span class="n">libtype</span><span class="p">]</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">no_tool_suffix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                        <span class="n">build_library</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">libtype</span> <span class="o">==</span> <span class="s1">&#39;windows_import&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">archiver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;static&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">archiver</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">no_tool_suffix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">linker</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;shared&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
                        <span class="n">v</span><span class="p">[</span><span class="s1">&#39;shared&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">no_tool_suffix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                             <span class="n">build_library</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.configure_library"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.configure_library">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">configure_library</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add configuration options for an external library.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg (YggConfigParser): Config class that options should be set for.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: Section, option, description tuples for options that could not</span>
<span class="sd">                be set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">k_lang</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="s1">&#39;language&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;include&#39;</span><span class="p">]:</span>
                <span class="n">desc_end</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> headers&#39;</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">]:</span>
                <span class="n">desc_end</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1"> library&#39;</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: completion</span>
                <span class="n">desc_end</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;The full path to the directory containing </span><span class="si">{</span><span class="n">desc_end</span><span class="si">}</span><span class="s1">.&#39;</span>
            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">has_option</span><span class="p">(</span><span class="n">k_lang</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">fname</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">fname</span><span class="p">)</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="n">search_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
                <span class="c1"># Search the compiler/linker&#39;s search path, then the</span>
                <span class="c1"># PATH environment variable.</span>
                <span class="n">tool</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;include&#39;</span><span class="p">:</span>
                        <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">language</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;shared&#39;</span><span class="p">:</span>
                        <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">language</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: completion</span>
                        <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">language</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">pass</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">tool</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">search_list</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">get_search_path</span><span class="p">(</span><span class="n">libtype</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="n">cfg</span><span class="p">)</span>
                    <span class="c1"># On windows search for both gnu and msvc library</span>
                    <span class="c1"># naming conventions</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Searching for base: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
                        <span class="n">ext_sets</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;.dll&#39;</span><span class="p">,</span> <span class="s1">&#39;.dll.a&#39;</span><span class="p">),</span>
                                    <span class="p">(</span><span class="s1">&#39;.lib&#39;</span><span class="p">,</span> <span class="p">))</span>
                        <span class="k">for</span> <span class="n">exts</span> <span class="ow">in</span> <span class="n">ext_sets</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">fname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">exts</span><span class="p">):</span>
                                <span class="n">base</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="n">base</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">))</span>
                                <span class="n">fname</span> <span class="o">=</span> <span class="p">[]</span>
                                <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">exts</span><span class="p">:</span>
                                    <span class="n">fname</span> <span class="o">+=</span> <span class="p">[</span><span class="n">base</span> <span class="o">+</span> <span class="n">ext</span><span class="p">,</span>
                                              <span class="s1">&#39;lib&#39;</span> <span class="o">+</span> <span class="n">base</span> <span class="o">+</span> <span class="n">ext</span><span class="p">]</span>
                                <span class="k">break</span>
                    <span class="n">fpath</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">locate_file</span><span class="p">(</span>
                        <span class="n">fname</span><span class="p">,</span> <span class="n">directory_list</span><span class="o">=</span><span class="n">search_list</span><span class="p">,</span>
                        <span class="n">environment_variable</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fpath</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Located </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fpath</span><span class="p">))</span>
                <span class="c1"># if (t in [&#39;static&#39;]) and platform._is_mac:</span>
                <span class="c1">#     fpath_orig = fpath</span>
                <span class="c1">#     fpath = &#39;_s&#39;.join(os.path.splitext(fpath))</span>
                <span class="c1">#     logger.info(&#39;Using symbolic link: %s&#39; % fpath)</span>
                <span class="c1">#     if not os.path.isfile(fpath):</span>
                <span class="c1">#         os.symlink(fpath_orig, fpath)</span>
                <span class="n">cfg</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">k_lang</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">fpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Could not locate </span><span class="si">%s</span><span class="s1"> (search_list = </span><span class="se">\n\t</span><span class="si">%s</span><span class="s1">)&#39;</span>
                            <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">search_list</span><span class="p">)))</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k_lang</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">desc</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.configure_libraries"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.configure_libraries">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">configure_libraries</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Add configuration options for external libraries in this language.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg (CisConfigParser): Config class that options should be set for.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            list: Section, option, description tuples for options that could not</span>
<span class="sd">                be set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">ModelDriver</span><span class="o">.</span><span class="n">configure_libraries</span><span class="o">.</span><span class="vm">__func__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
        <span class="n">base_language_libraries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">base_languages</span><span class="p">:</span>
            <span class="n">base_cls</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">base_language_libraries</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">base_cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="c1"># Search for external libraries</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">external_libraries</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">base_language_libraries</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">configure_library</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.set_env_compiler"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.set_env_compiler">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">set_env_compiler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">compiler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get environment variables that should be set for the compilation</span>
<span class="sd">        process.</span>

<span class="sd">        Args:</span>
<span class="sd">            compiler (CompilerBase, optional): Compiler that set_env shoudl</span>
<span class="sd">                be called for. If not provided, the default compiler for</span>
<span class="sd">                this language will be used.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Environment variables for the model process.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">compiler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">compiler</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">compiler</span><span class="o">.</span><span class="n">set_env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.set_env"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.set_env">[docs]</a>    <span class="k">def</span> <span class="nf">set_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">for_compile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compile_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get environment variables that should be set for the model process.</span>

<span class="sd">        Args:</span>
<span class="sd">            for_compile (bool, optional): If True, environment variables are set</span>
<span class="sd">                that are necessary for compiling. Defaults to False.</span>
<span class="sd">            compile_kwargs (dict, optional): Keyword arguments that should be</span>
<span class="sd">                passed to the compiler&#39;s set_env method. Defaults to empty dict.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class&#39;s method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Environment variables for the model process.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">toolname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">set_env</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">for_compile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">compile_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">compile_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">compiler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_env_compiler</span><span class="p">(</span>
                <span class="n">compiler</span><span class="o">=</span><span class="n">compiler</span><span class="p">,</span> <span class="n">existing</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
                <span class="n">logging_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">numeric_logging_level</span><span class="p">,</span>
                <span class="o">**</span><span class="n">compile_kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.compile_dependencies_instance"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.compile_dependencies_instance">[docs]</a>    <span class="k">def</span> <span class="nf">compile_dependencies_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compile dependencies specifically for this instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">compile_dependencies</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="CompiledModelDriver.compile_dependencies"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.compile_dependencies">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">compile_dependencies</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compile any required internal libraries, including the interface.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dep</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">interface_library</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">base_libraries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">base_languages</span><span class="p">:</span>
            <span class="n">toolname</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">compiler</span><span class="o">.</span><span class="n">toolset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">toolname</span> <span class="o">=</span> <span class="n">get_compatible_tool</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">toolname</span>
            <span class="n">base_cls</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">base_libraries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">base_cls</span><span class="o">.</span><span class="n">interface_library</span><span class="p">)</span>
            <span class="n">base_cls</span><span class="o">.</span><span class="n">compile_dependencies</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_installed</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dep</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_libraries</span><span class="p">):</span>
            <span class="n">dep_order</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_order</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dep_order</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="n">ikw</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                               <span class="n">toolname</span><span class="o">=</span><span class="n">get_compatible_tool</span><span class="p">(</span><span class="n">compiler</span><span class="p">,</span> <span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">call_compiler</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">ikw</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">call_compiler</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.cleanup_dependencies"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.cleanup_dependencies">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">cleanup_dependencies</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">products</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Cleanup dependencies.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">products</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">products</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dry_run&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">compiler</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;toolname&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                                <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">compiler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">suffix</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_internal_suffix</span><span class="p">(</span><span class="n">commtype</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;commtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">suffix</span> <span class="o">+=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">get_tool_suffix</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">compile_dependencies</span><span class="p">(</span><span class="n">products</span><span class="o">=</span><span class="n">products</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                <span class="k">pass</span>
            <span class="n">new_products</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">products</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">new_products</span> <span class="o">+=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">products</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>
            <span class="n">products</span> <span class="o">+=</span> <span class="n">new_products</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">cleanup_dependencies</span><span class="p">(</span>
            <span class="n">products</span><span class="o">=</span><span class="n">products</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div>

<div class="viewcode-block" id="CompiledModelDriver.compile_model"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.compile_model">[docs]</a>    <span class="k">def</span> <span class="nf">compile_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">skip_interface_flags</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compile model executable(s).</span>

<span class="sd">        Args:</span>
<span class="sd">            source_files (list, optional): Source files that will be compiled.</span>
<span class="sd">                Defaults to None and is set to the source_files attribute.</span>
<span class="sd">            skip_interface_flags (bool, optional): If True, interface flags will</span>
<span class="sd">                not be added. This includes the logger flag specifying the</span>
<span class="sd">                current logging level. Defaults to False.</span>
<span class="sd">            **kwargs: Keyword arguments are passed on to the call_compiler</span>
<span class="sd">                method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Compiled model file path.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dont_lock_buildfile</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;dont_lock_buildfile&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                               <span class="ow">or</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dry_run&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">buildfile_locked</span><span class="p">(</span><span class="n">dry_run</span><span class="o">=</span><span class="n">dont_lock_buildfile</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">source_files</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">source_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_files</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_interface_flags</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;logging_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numeric_logging_level</span>
            <span class="n">default_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model_file</span><span class="p">,</span>
                                  <span class="n">compiler_flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">compiler_flags</span><span class="p">,</span>
                                  <span class="n">for_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">skip_interface_flags</span><span class="o">=</span><span class="n">skip_interface_flags</span><span class="p">,</span>
                                  <span class="n">overwrite</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">overwrite</span><span class="p">,</span>
                                  <span class="n">working_dir</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">working_dir</span><span class="p">,</span>
                                  <span class="n">products</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">,</span>
                                  <span class="n">toolname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_tool_instance</span><span class="p">(</span>
                                      <span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">),</span>
                                  <span class="n">suffix</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dont_link&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">default_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">linker_flags</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">linker_flags</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">default_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;overwrite&#39;</span><span class="p">]))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Result already exists: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s1">&#39;env&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_env</span><span class="p">(</span><span class="n">for_compile</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                             <span class="n">toolname</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;toolname&#39;</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dry_run&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">compile_dependencies_instance</span><span class="p">(</span>
                        <span class="n">toolname</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;toolname&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_compiler</span><span class="p">(</span><span class="n">source_files</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cleanup_products</span><span class="p">()</span>
                <span class="k">raise</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">restore_files</span><span class="p">()</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_internal_suffix"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_internal_suffix">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_internal_suffix</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">commtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Determine the suffix that should be used for internal libraries.</span>

<span class="sd">        Args:</span>
<span class="sd">            commtype (str, optional): If provided, this is the communication</span>
<span class="sd">                type that should be used for the model. If None, the</span>
<span class="sd">                default comm is used.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Suffix that should be added to internal libraries to</span>
<span class="sd">                differentiate between different dependencies.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_system_suffix</span></div>

<div class="viewcode-block" id="CompiledModelDriver.call_compiler"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.call_compiler">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">call_compiler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dont_build</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compile a source file into an executable or linkable object file,</span>
<span class="sd">        checking for errors.</span>

<span class="sd">        Args:</span>
<span class="sd">            src (str): Full path to source file.</span>
<span class="sd">            out (str, optional): Full path to the output object file that should</span>
<span class="sd">                be created. Defaults to None and is created from the provided</span>
<span class="sd">                source file.</span>
<span class="sd">            flags (list, optional): Compilation flags. Defaults to []. If</span>
<span class="sd">                compiler_flags is present, flags is replaced by compiler_flags.</span>
<span class="sd">            compiler_flags (list, optional): Alternative to flags. Ignored</span>
<span class="sd">                if not provided.</span>
<span class="sd">            dont_link (bool, optional): If True, the command will result in a</span>
<span class="sd">                linkable object file rather than an executable. Defaults to</span>
<span class="sd">                False.</span>
<span class="sd">            dont_build (bool, optional): If True, cmake configuration/generation</span>
<span class="sd">                will be run, but the project will not be built. Defaults to</span>
<span class="sd">                None. If provided, this overrides dont_link.</span>
<span class="sd">            overwrite (bool, optional): If True, the existing compile file will</span>
<span class="sd">                be overwritten. Otherwise, it will be kept and this function</span>
<span class="sd">                will return without recompiling the source file.</span>
<span class="sd">            language (str, optional): Language that should be used to compile</span>
<span class="sd">                the files. Defaults to None and the language of the current</span>
<span class="sd">                driver is used.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            products (list, optional): Existing Python list that additional</span>
<span class="sd">                products produced by the compilation should be appended to.</span>
<span class="sd">                Defaults to None and is ignored.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to run_executable.</span>
<span class="sd">                and call_linker if dont_link is False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to compiled source.</span>

<span class="sd">        Raises:</span>
<span class="sd">            RuntimeError: If there is an error in calling the compiler.</span>
<span class="sd">            RuntimeError: If the compilation command dosn&#39;t yield the specified</span>
<span class="sd">                output file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dont_build</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dont_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dont_build</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;compiler_language&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;env&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dry_run&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;env&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">set_env_compiler</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="c1"># Compile using another driver if the language dosn&#39;t match</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">language</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">):</span>
            <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">call_compiler</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Handle internal library</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">src</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">internal_libraries</span><span class="p">):</span>
            <span class="n">dep</span> <span class="o">=</span> <span class="n">src</span>
            <span class="c1"># Compile an internal library using class defined options</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_info</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;directory&#39;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;working_dir&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;toolname&#39;</span><span class="p">:</span>
                    <span class="n">toolname</span> <span class="o">=</span> <span class="n">v</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">src</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">src</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">src</span><span class="p">)):</span>
                <span class="n">src</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_source</span><span class="p">(</span><span class="n">dep</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;for_api&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="n">_default_libtype</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;windows_import&#39;</span><span class="p">:</span>
                <span class="c1"># Compile dynamic library</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;shared&#39;</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;header_only&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">src</span>
            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="s1">&#39;shared&#39;</span><span class="p">]:</span>
                <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
                    <span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_dependency_library</span><span class="p">(</span>
                        <span class="n">dep</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">],</span>
                        <span class="n">commtype</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;commtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">))</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;libtype&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;linker_language&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">):</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;archiver_language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linker_language&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;suffix&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;suffix&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_internal_suffix</span><span class="p">(</span>
                <span class="n">commtype</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;commtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">call_compiler</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Compile using the compiler after updating the flags</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">update_compiler_kwargs</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.call_linker"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.call_linker">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">call_linker</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">language</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Link several object files to create an executable or library (shared</span>
<span class="sd">        or static), checking for errors.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (list): Object files that should be linked.</span>
<span class="sd">            language (str, optional): Language that should be used to link</span>
<span class="sd">                the files. Defaults to None and the language of the current</span>
<span class="sd">                driver is used.</span>
<span class="sd">            toolname (str, optional): Name of compiler tool that should be used.</span>
<span class="sd">                Defaults to None and the default compiler for the language will</span>
<span class="sd">                be used.</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to run_executable.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full path to compiled source.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">language</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linker_language&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
        <span class="n">toolname</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linker_toolname&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="p">)</span>
        <span class="c1"># Link using another driver if the language dosn&#39;t match</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">language</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">language</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language</span><span class="p">):</span>
            <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">language</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">drv</span><span class="o">.</span><span class="n">call_linker</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Determine tool that should be used</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;libtype&#39;</span><span class="p">,</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;static&#39;</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;archiver&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tool</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">)</span>
        <span class="c1"># Compile using the tool after updating the flags</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">update_linker_kwargs</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">toolname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tool</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="CompiledModelDriver.get_testing_options"><a class="viewcode-back" href="../../../yggdrasil.drivers.html#yggdrasil.drivers.CompiledModelDriver.CompiledModelDriver.get_testing_options">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_testing_options</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Method to return a dictionary of testing options for this class.</span>

<span class="sd">        Args:</span>
<span class="sd">            **kwargs: Additional keyword arguments are passed to the parent</span>
<span class="sd">                class.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Dictionary of variables to use for testing. Key/value pairs:</span>
<span class="sd">                kwargs (dict): Keyword arguments for driver instance.</span>
<span class="sd">                deps (list): Dependencies to install.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CompiledModelDriver</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_testing_options</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">is_installed</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;is_build_tool&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)):</span>
            <span class="n">compiler</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;compiler&#39;</span><span class="p">)</span>
            <span class="n">linker</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s1">&#39;linker&#39;</span><span class="p">)</span>
            <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="s1">&#39;scripts&#39;</span><span class="p">)</span>
            <span class="n">include_flag</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">create_flag</span><span class="p">(</span><span class="s1">&#39;include_dirs&#39;</span><span class="p">,</span> <span class="n">script_dir</span><span class="p">)</span>
            <span class="n">library_flag</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">create_flag</span><span class="p">(</span><span class="s1">&#39;library_dirs&#39;</span><span class="p">,</span> <span class="n">script_dir</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;kwargs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">compiler_flags</span><span class="o">=</span><span class="n">include_flag</span><span class="p">,</span>
                                 <span class="n">linker_flags</span><span class="o">=</span><span class="n">library_flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Meagan Lang, David Raila.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>