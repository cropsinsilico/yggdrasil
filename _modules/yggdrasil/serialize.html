

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>yggdrasil.serialize &mdash; yggdrasil v1.6.3+6.gf38abc9d3.dirty documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.6.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../yggdrasil.html">yggdrasil</a> &raquo;</li>
        
      <li>yggdrasil.serialize</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for yggdrasil.serialize</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">io</span> <span class="k">as</span> <span class="nn">sio</span>
<span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="k">import</span> <span class="n">platform</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">scanf</span><span class="p">,</span> <span class="n">tools</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">astropy.io</span> <span class="k">import</span> <span class="n">ascii</span> <span class="k">as</span> <span class="n">apy_ascii</span>
    <span class="kn">from</span> <span class="nn">astropy.table</span> <span class="k">import</span> <span class="n">Table</span> <span class="k">as</span> <span class="n">apy_Table</span>
    <span class="n">_use_astropy</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
    <span class="n">apy_ascii</span><span class="p">,</span> <span class="n">apy_Table</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="c1"># print(&quot;astropy is not installed, reading/writing as an array will be &quot;</span>
    <span class="c1">#       + &quot;disabled. astropy can be installed using &#39;pip install astropy&#39;.&quot;)</span>
    <span class="n">_use_astropy</span> <span class="o">=</span> <span class="kc">False</span>


<span class="n">_fmt_char</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%&#39;</span>
<span class="n">_default_comment</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;# &#39;</span>
<span class="n">_default_delimiter</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
<span class="n">_default_newline</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">_fmt_char_str</span> <span class="o">=</span> <span class="n">_fmt_char</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">_default_comment_str</span> <span class="o">=</span> <span class="n">_default_comment</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">_default_delimiter_str</span> <span class="o">=</span> <span class="n">_default_delimiter</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="n">_default_newline_str</span> <span class="o">=</span> <span class="n">_default_newline</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="extract_formats"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.extract_formats">[docs]</a><span class="k">def</span> <span class="nf">extract_formats</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Locate format codes within a format string.</span>

<span class="sd">    Args:</span>
<span class="sd">        fmt_str (str, bytes): Format string.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of identified format codes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fmt_regex</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;%(?:</span><span class="se">\\</span><span class="s2">d+</span><span class="se">\\</span><span class="s2">$)?[+-]?(?:[ 0]|</span><span class="se">\&#39;</span><span class="s2">.</span><span class="si">{1}</span><span class="s2">)?-?</span><span class="se">\\</span><span class="s2">d*(?:</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+)?&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;[lhjztL]*(?:64)?[bcdeEufFgGosxXi]&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;(?:%(?:</span><span class="se">\\</span><span class="s2">d+</span><span class="se">\\</span><span class="s2">$)?[+-](?:[ 0]|</span><span class="se">\&#39;</span><span class="s2">.</span><span class="si">{1}</span><span class="s2">)?-?</span><span class="se">\\</span><span class="s2">d*(?:</span><span class="se">\\</span><span class="s2">.</span><span class="se">\\</span><span class="s2">d+)?&quot;</span>
        <span class="o">+</span> <span class="s2">&quot;[lhjztL]*[eEfFgG]j)?&quot;</span><span class="p">)</span>
    <span class="n">as_bytes</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">as_bytes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">fmt_str</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">fmt_regex</span><span class="p">,</span> <span class="n">fmt_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">as_bytes</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>
    

<div class="viewcode-block" id="nptype2cformat"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.nptype2cformat">[docs]</a><span class="k">def</span> <span class="nf">nptype2cformat</span><span class="p">(</span><span class="n">nptype</span><span class="p">,</span> <span class="n">asbytes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a numpy data type to a c format string.</span>

<span class="sd">    Args:</span>
<span class="sd">        nptype (str or numpy.dtype): Numpy data type that should be converted.</span>
<span class="sd">        asbytes (bool, optional): If True, the returned format codes will be</span>
<span class="sd">            in bytes format (str for Python 2, bytes for Python 3). Defaults to</span>
<span class="sd">            False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str, list: Corresponding c format specification string or list of</span>
<span class="sd">            format strings for complex types..</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If nptype is not a string or numpy.dtype.</span>
<span class="sd">        ValueError: If a matching format string cannot be determined.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nptype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">nptype</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nptype</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">nptype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a string or a numpy.dtype&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">nptype2cformat</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">asbytes</span><span class="o">=</span><span class="n">asbytes</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="k">if</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;float_&quot;</span><span class="p">,</span> <span class="s2">&quot;float16&quot;</span><span class="p">,</span> <span class="s2">&quot;float32&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">]]:</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%g</span><span class="s2">&quot;</span>  <span class="c1"># Ensures readability</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;complex_&quot;</span><span class="p">,</span> <span class="s2">&quot;complex64&quot;</span><span class="p">,</span> <span class="s2">&quot;complex128&quot;</span><span class="p">]]:</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%g%+g</span><span class="s2">j&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int8&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%hhd&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;short&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%hd</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;intc&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;int_&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%ld</span><span class="s2">&quot;</span>
    <span class="c1"># elif t == np.dtype(&quot;int64&quot;):</span>
    <span class="c1">#     if platform._is_win:</span>
    <span class="c1">#         cfmt = &quot;%l64d&quot;</span>
    <span class="c1">#     else:  # pragma: no cover</span>
    <span class="c1">#         cfmt = &quot;%ld&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;longlong&quot;</span><span class="p">):</span>
        <span class="c1"># On windows C long is 32bit and long long is 64bit</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%l64d&quot;</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%lld&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%hhu&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;ushort&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%hu</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;uintc&quot;</span><span class="p">):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%u</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;uint64&quot;</span><span class="p">):</span>  <span class="c1"># Platform dependent</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%l64u&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%lu</span><span class="s2">&quot;</span>
    <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;ulonglong&quot;</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
        <span class="c1"># On windows C unsigned long is 32bit and unsigned long long is 64bit</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%l64u&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%llu&quot;</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
    <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cfmt</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;s&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No format specification string for dtype </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
    <span class="c1"># Short and long specifiers not supported by python scanf</span>
    <span class="c1"># cfmt = cfmt.replace(&quot;h&quot;, &quot;&quot;)</span>
    <span class="c1"># cfmt = cfmt.replace(&quot;l&quot;, &quot;&quot;)</span>
    <span class="k">if</span> <span class="n">asbytes</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="n">cfmt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cfmt</span></div>


<div class="viewcode-block" id="cformat2nptype"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.cformat2nptype">[docs]</a><span class="k">def</span> <span class="nf">cformat2nptype</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a c format string to a numpy data type.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfmt (str, bytes): c format that should be translated.</span>
<span class="sd">        names (list, optional): Names that should be assigned to fields in the</span>
<span class="sd">            format string if there is more than one. If not provided, names</span>
<span class="sd">            are generated based on the order of the format codes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.dtype: Corresponding numpy data type.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: if cfmt is not a string.</span>
<span class="sd">        ValueError: If the c format does not begin with &#39;%&#39;.</span>
<span class="sd">        ValueError: If the c format does not contain type info.</span>
<span class="sd">        ValueError: If the c format cannot be translated to a numpy datatype.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: this may fail on 32bit systems where C long types are 32 bit</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a string, bytes string, or list, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="nb">type</span><span class="p">(</span><span class="n">cfmt</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="n">cfmt</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">cfmt</span><span class="p">)</span>
        <span class="n">fmt_list</span> <span class="o">=</span> <span class="n">extract_formats</span><span class="p">(</span><span class="n">cfmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not locate any format codes in the &quot;</span>
                             <span class="o">+</span> <span class="s2">&quot;provided format string (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">cfmt</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fmt_list</span> <span class="o">=</span> <span class="n">cfmt</span>
    <span class="n">nfmt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt_list</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nfmt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cfmt_str</span> <span class="o">=</span> <span class="n">fmt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dtype_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cformat2nptype</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fmt_list</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nfmt</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nfmt</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of names does not match the number of fields.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="n">dtype_list</span><span class="p">))</span>
        <span class="c1"># out = np.dtype([(n, d) for n, d in zip(names, dtype_list)])</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;j&#39;</span><span class="p">]:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;complex128&#39;</span>
    <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">]:</span>
        <span class="c1"># if &#39;hh&#39; in cfmt_str:</span>
        <span class="c1">#     out = &#39;float8&#39;</span>
        <span class="c1"># elif cfmt_str[-2] == &#39;h&#39;:</span>
        <span class="c1">#     out = &#39;float16&#39;</span>
        <span class="c1"># elif &#39;ll&#39; in cfmt_str:</span>
        <span class="c1">#     out = &#39;longfloat&#39;</span>
        <span class="c1"># elif cfmt_str[-2] == &#39;l&#39;:</span>
        <span class="c1">#     out = &#39;double&#39;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     out = &#39;single&#39;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;float64&#39;</span>
    <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;hh&#39;</span> <span class="ow">in</span> <span class="n">cfmt_str</span><span class="p">:</span>  <span class="c1"># short short, single char</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;int8&#39;</span>
        <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>  <span class="c1"># short</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;short&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;ll&#39;</span> <span class="ow">in</span> <span class="n">cfmt_str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;l64&#39;</span> <span class="ow">in</span> <span class="n">cfmt_str</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;longlong&#39;</span>  <span class="c1"># long long</span>
        <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;int_&#39;</span>  <span class="c1"># long (broken in python)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;intc&#39;</span>  <span class="c1"># int, platform dependent</span>
    <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s1">&#39;hh&#39;</span> <span class="ow">in</span> <span class="n">cfmt_str</span><span class="p">:</span>  <span class="c1"># short short, single char</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span>
        <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>  <span class="c1"># short</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;ushort&#39;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;ll&#39;</span> <span class="ow">in</span> <span class="n">cfmt_str</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;l64&#39;</span> <span class="ow">in</span> <span class="n">cfmt_str</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;ulonglong&#39;</span>  <span class="c1"># long long</span>
        <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;uint64&#39;</span>  <span class="c1"># long (broken in python)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;uintc&#39;</span>  <span class="c1"># int, platform dependent</span>
    <span class="k">elif</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">]:</span>
        <span class="n">lstr</span> <span class="o">=</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">lstr</span><span class="p">:</span>
            <span class="n">lint</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lstr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lint</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">lsiz</span> <span class="o">=</span> <span class="n">lint</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;S1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">itemsize</span>
        <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">lsiz</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not find match for format str </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">cfmt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


<div class="viewcode-block" id="cformat2pyscanf"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.cformat2pyscanf">[docs]</a><span class="k">def</span> <span class="nf">cformat2pyscanf</span><span class="p">(</span><span class="n">cfmt</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a c format specification string to a version that the</span>
<span class="sd">    python scanf module can use.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfmt (str, bytes, list): C format specification string or list of format</span>
<span class="sd">            strings.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str, bytes, list: Version of cfmt or list of cfmts that can be parsed by</span>
<span class="sd">            scanf.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If cfmt is not a bytes/str/list.</span>
<span class="sd">        ValueError: If there are not an format codes in the format string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input must be a string, bytes string, or list, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                        <span class="nb">type</span><span class="p">(</span><span class="n">cfmt</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">cformat2pyscanf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">cfmt</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cfmt</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">as_bytes</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">cfmt_out</span> <span class="o">=</span> <span class="n">cfmt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">as_bytes</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">cfmt_out</span> <span class="o">=</span> <span class="n">cfmt</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">fmt_list</span> <span class="o">=</span> <span class="n">extract_formats</span><span class="p">(</span><span class="n">cfmt_out</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmt_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Could not locate any format codes in the &quot;</span>
                         <span class="o">+</span> <span class="s2">&quot;provided format string (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">cfmt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">cfmt_str</span> <span class="ow">in</span> <span class="n">fmt_list</span><span class="p">:</span>
        <span class="c1"># Hacky, but necessary to handle concatenation of a single byte</span>
        <span class="k">if</span> <span class="n">cfmt_str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">cfmt_str</span>
        <span class="c1"># if cfmt_str[-1] == &#39;j&#39;:</span>
        <span class="c1">#     # Handle complex format specifier</span>
        <span class="c1">#     out = &#39;%g%+gj&#39;</span>
        <span class="c1"># else:</span>
        <span class="c1">#     out += cfmt_str[-1]</span>
        <span class="c1">#     out = out.replace(&#39;h&#39;, &#39;&#39;)</span>
        <span class="c1">#     out = out.replace(&#39;l&#39;, &#39;&#39;)</span>
        <span class="c1">#     out = out.replace(&#39;64&#39;, &#39;&#39;)</span>
        <span class="n">cfmt_out</span> <span class="o">=</span> <span class="n">cfmt_out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cfmt_str</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">as_bytes</span><span class="p">:</span>
        <span class="n">cfmt_out</span> <span class="o">=</span> <span class="n">cfmt_out</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cfmt_out</span></div>


<div class="viewcode-block" id="format_message"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.format_message">[docs]</a><span class="k">def</span> <span class="nf">format_message</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt_str</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Format a message from a list of arguments and a format string.</span>

<span class="sd">    Args:</span>
<span class="sd">        args (list, obj): List of arguments or single argument that should be</span>
<span class="sd">            formatted using the format string.</span>
<span class="sd">        fmt_str (str, bytes): Format string that should be used to format the</span>
<span class="sd">            arguments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str, bytes: Formatted message. The type will match the type of the</span>
<span class="sd">            fmt_str.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the number of arguments does not match the number of</span>
<span class="sd">            format fields.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="p">)</span>
    <span class="n">nfmt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">extract_formats</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">))</span>
    <span class="n">args_</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nfmt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of arguments (</span><span class="si">%d</span><span class="s2">) does not match &quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
                           <span class="o">+</span> <span class="s2">&quot;number of format fields (</span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">nfmt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">a0</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">a0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="n">args_</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">imag</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">args_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="n">args_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">fmt_str</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">args_</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="process_message"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.process_message">[docs]</a><span class="k">def</span> <span class="nf">process_message</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">fmt_str</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extract python objects from a message using a format string.</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (str, bytes): Message that should be parsed.</span>
<span class="sd">        fmt_str (str, bytes): Format string that should be used to parse the</span>
<span class="sd">            message using scanf.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: Variables extracted from the message.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: If the message is not a string or bytes string type.</span>
<span class="sd">        ValueError: If the expected number of variables cannot be extracted</span>
<span class="sd">            from the message.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Message must be a string or bytes string type.&quot;</span><span class="p">)</span>
    <span class="n">nfmt</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">extract_formats</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">))</span>
    <span class="n">py_fmt_str</span> <span class="o">=</span> <span class="n">cformat2pyscanf</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">scanf</span><span class="o">.</span><span class="n">scanf</span><span class="p">(</span><span class="n">py_fmt_str</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nargs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">cformat2nptype</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
            <span class="n">dtype_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nargs</span><span class="p">)]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">],</span> <span class="n">idtype</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span>
                          <span class="n">a</span><span class="p">,</span> <span class="n">idtype</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">dtype_list</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">nargs</span> <span class="o">!=</span> <span class="n">nfmt</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> arguments were extracted, &quot;</span> <span class="o">%</span> <span class="n">nargs</span>
                         <span class="o">+</span> <span class="s2">&quot;but format string expected </span><span class="si">%d</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">nfmt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span></div>


<div class="viewcode-block" id="combine_flds"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.combine_flds">[docs]</a><span class="k">def</span> <span class="nf">combine_flds</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Combine a list of arrays as fields in a structured array.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrs (list): List of arrays, one for each field in a structured array.</span>
<span class="sd">        dtype (np.dtype, optional): Data type that resulting array should have.</span>
<span class="sd">            If not provided, it is determined from the types of the input arrays.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Structured numpy array with fields assigned from the</span>
<span class="sd">            provided arrays.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the number of arrays does not match the number of fields</span>
<span class="sd">            in the provided data type.</span>
<span class="sd">        ValueError: If any of the provided arrays does not have the same number</span>
<span class="sd">            of elements as the first array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get dtype</span>
    <span class="n">nflds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">)</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nflds</span><span class="p">)]</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">arrs</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">str</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">))]</span>
        <span class="n">update_dtype</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;S0&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">max</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="n">update_dtype</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">update_dtype</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="n">formats</span><span class="p">})</span>
    <span class="c1"># Check number of fields and array shapes</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nflds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;dtype has </span><span class="si">%d</span><span class="s2"> fields, but </span><span class="si">%d</span><span class="s2"> arrays were provided.&quot;</span> <span class="o">%</span>
                         <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">),</span> <span class="n">nflds</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shape of array </span><span class="si">%d</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">) does &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                             <span class="o">+</span> <span class="s2">&quot;match shape of 1st array (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">shape</span><span class="p">)</span>
    <span class="c1"># Combine arrays</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
        <span class="n">out</span><span class="p">[</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="combine_eles"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.combine_eles">[docs]</a><span class="k">def</span> <span class="nf">combine_eles</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Combine arrays as elements in a structure numpy array.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrs (list): List of numpy arrays or lists specifying the values of</span>
<span class="sd">            fields in elements of a structured numpy array.</span>
<span class="sd">        dtype (np.dtype, optional): Data type that the resulting array should</span>
<span class="sd">            have. If not provided, it is determined from the provided arrays.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Structured numpy array with information from the provided</span>
<span class="sd">            arrays/lists as elements.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the number of fields in any of the provided arrays/lists</span>
<span class="sd">            does not match the number of fields in the provided/created dtype.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">neles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">)</span>
    <span class="c1"># Check types of arrays</span>
    <span class="n">any_arrays</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">all_arrays</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">any_arrays</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">all_arrays</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_arrays</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">any_arrays</span><span class="p">:</span>
            <span class="n">arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arrs</span><span class="p">]</span>
            <span class="n">neles</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Elements must be arrays, lists or tuples. &quot;</span>
                            <span class="o">+</span> <span class="s2">&quot;Element </span><span class="si">%d</span><span class="s2"> has type </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
    <span class="c1"># Check that there are enough elements for each data type</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">)):</span>
            <span class="n">nflds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nflds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nflds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nflds</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Element </span><span class="si">%d</span><span class="s2"> has dtype </span><span class="si">%s</span><span class="s2">, but &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
                                 <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> fields are expected.&quot;</span> <span class="o">%</span> <span class="n">nflds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nflds</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Element </span><span class="si">%d</span><span class="s2"> has </span><span class="si">%d</span><span class="s2"> values, but &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
                                 <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> fields are expected.&quot;</span> <span class="o">%</span> <span class="n">nflds</span><span class="p">)</span>
    
    <span class="c1"># Get data type</span>
    <span class="k">def</span> <span class="nf">get_max_len</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">iele</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iele</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">)):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">iele</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">iele</span><span class="p">[</span><span class="n">n</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">iele</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">max_len</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">)):</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">iele</span> <span class="ow">in</span> <span class="n">arrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">iele</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">)):</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="n">iele</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
                    <span class="k">break</span>
            <span class="n">nflds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">dtype_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">dtype_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">.</span><span class="n">str</span>
                <span class="k">if</span> <span class="s1">&#39;S&#39;</span> <span class="ow">in</span> <span class="n">dtype_str</span><span class="p">:</span>
                    <span class="n">max_len</span> <span class="o">=</span> <span class="n">get_max_len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">dtype_str</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">max_len</span>
                <span class="n">dtype_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype_str</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nflds</span><span class="p">)]</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">names</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="n">dtype_list</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">str</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">))]</span>
        <span class="n">update_dtype</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;S0&#39;</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="n">get_max_len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">formats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;S</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">max_len</span>
            <span class="n">update_dtype</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">update_dtype</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">({</span><span class="s1">&#39;names&#39;</span><span class="p">:</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="s1">&#39;formats&#39;</span><span class="p">:</span> <span class="n">formats</span><span class="p">})</span>
    <span class="c1"># Combine rows</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">neles</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">)):</span>
            <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
                <span class="n">out</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="consolidate_array"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.consolidate_array">[docs]</a><span class="k">def</span> <span class="nf">consolidate_array</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Consolidate arrays either as fields or elements in a structured array.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrs (np.ndarray, list, tuple): Array or list of arrays that should be</span>
<span class="sd">            reformatted/consolidated as a structured array.</span>
<span class="sd">        dtype (np.dtype, optional): Data type that the resulting array should</span>
<span class="sd">            have. If not provided, it is determined from the input.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Structured array of the specified type with values taken</span>
<span class="sd">            from the provided array(s).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an unstructured array is provided, but the last dimension</span>
<span class="sd">            of the array does not have the proper size to fill the fields in</span>
<span class="sd">            the specified data type.</span>
<span class="sd">        ValueError: If a structured array is provided, but it does not have a</span>
<span class="sd">            data type compatible with the specified data type.</span>
<span class="sd">        TypeError: If &#39;arrs&#39; is not a numpy array, list, or tuple.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">arrs</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">arrs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arrs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The last dimension of the input array &quot;</span>
                                     <span class="o">+</span> <span class="s2">&quot;(</span><span class="si">%d</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="n">arrs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                     <span class="o">+</span> <span class="s2">&quot;dosn&#39;t match the number of fields in &quot;</span>
                                     <span class="o">+</span> <span class="s2">&quot;the dtype (</span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">arrs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arrs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">arrs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arrs</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">out</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrs</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The input array data type (</span><span class="si">%s</span><span class="s2">) &quot;</span> <span class="o">%</span> <span class="n">arrs</span><span class="o">.</span><span class="n">dtype</span>
                                 <span class="o">+</span> <span class="s2">&quot;is not compatible with the specified &quot;</span>
                                 <span class="o">+</span> <span class="s2">&quot;data type (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">void</span><span class="p">,</span>
                                <span class="n">units</span><span class="o">.</span><span class="n">_unit_array</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">combine_eles</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">combine_flds</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">combine_eles</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Input &#39;arrs&#39; must be a numpy array, list, or tuple.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="format2table"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.format2table">[docs]</a><span class="k">def</span> <span class="nf">format2table</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get table information from the table format string.</span>

<span class="sd">    Args:</span>
<span class="sd">        fmt_str (str, bytes): Format string that describes how the table</span>
<span class="sd">            columns are formatted.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Table information parameters.</span>

<span class="sd">    Raises:</span>
<span class="sd">        RuntimeError: If the column separator is not the same between all</span>
<span class="sd">            of the format codes.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">out</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extract_formats</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">out</span>
    <span class="n">seps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">comment</span><span class="p">,</span> <span class="n">fmt_rem</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comment</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]:</span>
        <span class="n">isep</span><span class="p">,</span> <span class="n">fmt_rem</span> <span class="o">=</span> <span class="n">fmt_rem</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">seps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">isep</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fmt_rem</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;newline&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fmt_rem</span>
    <span class="n">seps</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">seps</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_default_delimiter</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">seps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">seps</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">seps</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">seps</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">isspace</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;There is more than one column separator (</span><span class="si">%s</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">seps</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">seps</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="table2format"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.table2format">[docs]</a><span class="k">def</span> <span class="nf">table2format</span><span class="p">(</span><span class="n">fmts</span><span class="o">=</span><span class="p">[],</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create a format string from table information.</span>

<span class="sd">    Args:</span>
<span class="sd">        fmts (list, optional): List of format codes for each column. Defaults to</span>
<span class="sd">            [].</span>
<span class="sd">        delimiter (bytes, optional): String used to separate columns. Defaults</span>
<span class="sd">            to _default_delimiter.</span>
<span class="sd">        newline (bytes, optional): String used to indicate the end of a table</span>
<span class="sd">            line. Defaults to _default_newline.</span>
<span class="sd">        comment (bytes, optional): String that should be prepended to the format</span>
<span class="sd">            string to indicate a comment. Defaults to _default_comment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str, bytes: Table format string.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">delimiter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">delimiter</span> <span class="o">=</span> <span class="n">_default_delimiter</span>
    <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newline</span> <span class="o">=</span> <span class="n">_default_newline</span>
    <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">_default_comment</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fmts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">):</span>
        <span class="n">fmts</span> <span class="o">=</span> <span class="n">nptype2cformat</span><span class="p">(</span><span class="n">fmts</span><span class="p">)</span>
    <span class="n">bytes_fmts</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">fmts</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fmt_str</span> <span class="o">=</span> <span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>
               <span class="o">+</span> <span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bytes_fmts</span><span class="p">)</span>
               <span class="o">+</span> <span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">newline</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fmt_str</span></div>


<div class="viewcode-block" id="array_to_table"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.array_to_table">[docs]</a><span class="k">def</span> <span class="nf">array_to_table</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">fmt_str</span><span class="p">,</span> <span class="n">use_astropy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Serialize an array as an ASCII table.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrs (np.ndarray, list, tuple): Structured array or list/tuple of</span>
<span class="sd">            arrays that contain table information.</span>
<span class="sd">        fmt_str (str, bytes): Format string that should be used to structure</span>
<span class="sd">            the ASCII array.</span>
<span class="sd">        use_astropy (bool, optional): If True, astropy will be used to format</span>
<span class="sd">            the table if it is installed. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: ASCII table.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_use_astropy</span><span class="p">:</span>
        <span class="n">use_astropy</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">cformat2nptype</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)])</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">format2table</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fmt_str</span> <span class="o">=</span> <span class="n">fmt_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">arr1</span> <span class="o">=</span> <span class="n">consolidate_array</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_astropy</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">apy_Table</span><span class="p">(</span><span class="n">arr1</span><span class="p">)</span>
        <span class="n">delimiter</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">])</span>
        <span class="n">apy_ascii</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">fd</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;no_header&#39;</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">fmt_str</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">arr1</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">format_message</span><span class="p">(</span><span class="n">ele</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">fmt_str</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="c1"># fmt = fmt_str.split(info[&#39;newline&#39;])[0]</span>
        <span class="c1"># np.savetxt(fd, arr1,</span>
        <span class="c1">#            fmt=fmt, delimiter=info[&#39;delimiter&#39;],</span>
        <span class="c1">#            newline=info[&#39;newline&#39;], header=&#39;&#39;)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="table_to_array"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.table_to_array">[docs]</a><span class="k">def</span> <span class="nf">table_to_array</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">fmt_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_astropy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Extract information from an ASCII table as an array.</span>

<span class="sd">    Args:</span>
<span class="sd">        msg (bytes): ASCII table as bytes string.</span>
<span class="sd">        fmt_str (bytes): Format string that should be used to parse the table.</span>
<span class="sd">            If not provided, this will attempt to determine the types of columns</span>
<span class="sd">            based on their contents.</span>
<span class="sd">        use_astropy (bool, optional): If True, astropy will be used to parse</span>
<span class="sd">            the table if it is installed. Defaults to False.</span>
<span class="sd">        names (list, optional): Field names that should be used for the</span>
<span class="sd">            structured data type of the output array. If not provided, names</span>
<span class="sd">            are generated based on the order of the fields in the table.</span>
<span class="sd">        delimiter (str, optional): String used to separate columns. Defaults to</span>
<span class="sd">            None and is not used. This is only used if fmt_str is not provided.</span>
<span class="sd">        comment (str, optional): String used to denote comments. Defaults to</span>
<span class="sd">            None and is not used. This is only used if fmt_str is not provided.</span>
<span class="sd">        encoding (str, optional): Encoding that should be used in Python 3 or</span>
<span class="sd">            higher to extract information from the message. Defaults to &#39;utf-8&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Table contents as an array.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_use_astropy</span><span class="p">:</span>
        <span class="n">use_astropy</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">fmt_str</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">cformat2nptype</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">format2table</span><span class="p">(</span><span class="n">fmt_str</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">sio</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">np_kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delimiter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np_kws</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np_kws</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span>
    <span class="n">np_kws</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">np_kws</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">use_astropy</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;comments&#39;</span> <span class="ow">in</span> <span class="n">np_kws</span><span class="p">:</span>
            <span class="n">np_kws</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np_kws</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;comments&#39;</span><span class="p">)</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="n">apy_ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
                             <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;no_header&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">np_kws</span><span class="p">)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">tab</span><span class="o">.</span><span class="n">as_array</span><span class="p">()</span>
        <span class="n">typs</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">str</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">))]</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tab</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="c1"># Convert type bytes if python 3</span>
        <span class="n">new_typs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">typs</span><span class="p">)</span>
        <span class="n">convert</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">)):</span>
                <span class="n">new_typs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span> <span class="o">+</span> <span class="n">typs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">convert</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
            <span class="n">old_arr</span> <span class="o">=</span> <span class="n">arr</span>
            <span class="n">new_dtyp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">new_typs</span><span class="p">)])</span>
            <span class="n">new_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">new_dtyp</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">convert</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">old_arr</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
                    <span class="n">new_arr</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">x</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_arr</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">old_arr</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">new_arr</span>
            <span class="n">typs</span> <span class="o">=</span> <span class="n">new_typs</span>
        <span class="c1"># Convert complex type</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)):</span>
                <span class="n">new_typs</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">typs</span><span class="p">)</span>
                <span class="n">new_typs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;complex&#39;</span>
                <span class="n">new_dtyp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">([(</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">new_typs</span><span class="p">)])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">new_dtyp</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">np_ver</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)])</span>
        <span class="n">np_kws</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">autostrip</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np_ver</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)):</span>
            <span class="n">np_kws</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bytes&#39;</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">**</span><span class="n">np_kws</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="array_to_bytes"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.array_to_bytes">[docs]</a><span class="k">def</span> <span class="nf">array_to_bytes</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Serialize an array to bytes.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrs (np.ndarray, list, tuple): Structured array or list/tuple of</span>
<span class="sd">            arrays that should be serialized. If &#39;arrs&#39; is not a numpy</span>
<span class="sd">            structured array, a structured array will first be constructed</span>
<span class="sd">            from the provided data.</span>
<span class="sd">        dtype (np.dtype, optional): Structured data type that array should</span>
<span class="sd">            be converted to prior to serialization. If not provided, it</span>
<span class="sd">            will be determined from the array data.</span>
<span class="sd">        order (str, optional): Order that array should be serialized in.</span>
<span class="sd">            &#39;C&#39; for row first, &#39;F&#39; for column/field first. Defaults to &#39;C&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes, str: Serialized array.</span>

<span class="sd">    Raises:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr1</span> <span class="o">=</span> <span class="n">consolidate_array</span><span class="p">(</span><span class="n">arrs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">ntyp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr1</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ntyp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">arr1</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntyp</span><span class="p">):</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">arr1</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">arr1</span><span class="o">.</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)):</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">arr1</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">arr1</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">+</span> <span class="n">arr1</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">arr1</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="bytes_to_array"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.bytes_to_array">[docs]</a><span class="k">def</span> <span class="nf">bytes_to_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Deserialize an array from bytes data.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (bytes): Serialized array data.</span>
<span class="sd">        dtype (np.dtype, optional): Structured data type of the serialized array.</span>
<span class="sd">        order (str, optional): Order that array was serialized in.</span>
<span class="sd">            &#39;C&#39; for row first, &#39;F&#39; for column/field first. Defaults to &#39;C&#39;.</span>
<span class="sd">        shape (tuple, optional): Shape that array should be reshaped to</span>
<span class="sd">            after being deserialized. Defaults to a flat array if not provided.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Deserialized array.</span>

<span class="sd">    Raises:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Data length (</span><span class="si">%d</span><span class="s2">) is not a multiple &quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                           <span class="o">+</span> <span class="s2">&quot;of the itemsize (</span><span class="si">%d</span><span class="s2">).&quot;</span> <span class="o">%</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span>
    <span class="n">nele</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">//</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
    <span class="n">ntyp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">order</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ntyp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">nele</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ntyp</span><span class="p">):</span>
            <span class="n">idata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">prev</span><span class="p">:(</span><span class="n">prev</span> <span class="o">+</span> <span class="p">(</span><span class="n">nele</span> <span class="o">*</span> <span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">itemsize</span><span class="p">))]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s1">&#39;complex&#39;</span><span class="p">)):</span>
                <span class="n">idata_real</span> <span class="o">=</span> <span class="n">idata</span><span class="p">[:(</span><span class="n">nele</span> <span class="o">*</span> <span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)]</span>
                <span class="n">idata_imag</span> <span class="o">=</span> <span class="n">idata</span><span class="p">[(</span><span class="n">nele</span> <span class="o">*</span> <span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">//</span> <span class="mi">2</span><span class="p">):]</span>
                <span class="n">arr_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">idata_real</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="n">arr_imag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">idata_imag</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
                <span class="c1"># arr_real = np.fromstring(idata_real, dtype=&#39;float64&#39;)</span>
                <span class="c1"># arr_imag = np.fromstring(idata_imag, dtype=&#39;float64&#39;)</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nele</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">arr_real</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">arr_imag</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">arr</span><span class="p">[</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">idata</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="c1"># arr[dtype.names[i]] = np.fromstring(idata, dtype=dtype[i])</span>
            <span class="n">prev</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idata</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># arr = np.fromstring(data, dtype=dtype)</span>
    <span class="c1"># Reshape array</span>
    <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">arr</span></div>


<div class="viewcode-block" id="format_header"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.format_header">[docs]</a><span class="k">def</span> <span class="nf">format_header</span><span class="p">(</span><span class="n">format_str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">comment</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">field_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get header lines for a table based on table information.</span>

<span class="sd">    Args:</span>
<span class="sd">        format_str (bytes, str, optional): Format string describing how the</span>
<span class="sd">            table should be formatted. If not provided, information on the</span>
<span class="sd">            formats is extracted from dtype.</span>
<span class="sd">        dtype (np.dtype, optional): Structured data type specifying the types</span>
<span class="sd">            of fields in the table. If not provided and format_str not</span>
<span class="sd">            specified, the formats will not be part of the header.</span>
<span class="sd">        comment (bytes, optional): String that should be used to comment the</span>
<span class="sd">            header lines. If not provided and not in format_str, defaults to</span>
<span class="sd">            _default_comment.</span>
<span class="sd">        delimiter (bytes, optional): String that should be used to separate</span>
<span class="sd">            columns. If not provided and not in format_str, defaults to</span>
<span class="sd">            _default_delimiter.</span>
<span class="sd">        newline (bytes, optional): String that should be used to end lines in</span>
<span class="sd">            the table. If not provided and not in format_str, defaults to</span>
<span class="sd">            _default_newline.</span>
<span class="sd">        field_names (list, optional): List of field names that should be</span>
<span class="sd">            included in the header. If not provided and dtype is None, names</span>
<span class="sd">            will not be included in the header.</span>
<span class="sd">        field_units (list, optional): List of field units that should be</span>
<span class="sd">            included in the header. If not provided, units will not be</span>
<span class="sd">            included.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bytes: Bytes lines comprising a table header.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If there are not any format, names or units specified.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set defaults</span>
    <span class="n">fmts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">format_str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">format2table</span><span class="p">(</span><span class="n">format_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fmts</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">delimiter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delimiter</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">newline</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;newline&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">comment</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fmts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmts</span> <span class="o">=</span> <span class="n">nptype2cformat</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">asbytes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">field_names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">field_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">delimiter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">delimiter</span> <span class="o">=</span> <span class="n">_default_delimiter</span>
    <span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="n">_default_comment</span>
    <span class="k">if</span> <span class="n">newline</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">newline</span> <span class="o">=</span> <span class="n">_default_newline</span>
    <span class="c1"># Get count of fields</span>
    <span class="k">if</span> <span class="n">fmts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nfld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fmts</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">field_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nfld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">field_names</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">field_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nfld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">field_units</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No formats, names, or units provided.&quot;</span><span class="p">)</span>
    <span class="c1"># Create lines</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">field_names</span><span class="p">,</span> <span class="n">field_units</span><span class="p">,</span> <span class="n">fmts</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">nfld</span><span class="p">)</span>
            <span class="n">x_bytes</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">str2bytes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comment</span> <span class="o">+</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x_bytes</span><span class="p">))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">newline</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">+</span> <span class="n">newline</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="discover_header"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.discover_header">[docs]</a><span class="k">def</span> <span class="nf">discover_header</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">serializer</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">_default_newline</span><span class="p">,</span>
                    <span class="n">comment</span><span class="o">=</span><span class="n">_default_comment</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">lineno_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno_units</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">use_astropy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Discover ASCII table header info from a file.</span>

<span class="sd">    Args:</span>
<span class="sd">        fd (file): File object containing the table.</span>
<span class="sd">        serializer (DefaultSerialize): Serializer that should be updated with</span>
<span class="sd">            header information.</span>
<span class="sd">        newline (str, optional): Newline character that should be used to split</span>
<span class="sd">            header if it is not already a list. Defaults to _default_newline.</span>
<span class="sd">        comment (bytes, optional): String that should be used to mark the</span>
<span class="sd">            header lines. If not provided and not in format_str, defaults to</span>
<span class="sd">            _default_comment.</span>
<span class="sd">        delimiter (bytes, optional): String that should be used to separate</span>
<span class="sd">            columns. If not provided and not in format_str, defaults to</span>
<span class="sd">            _default_delimiter.</span>
<span class="sd">        lineno_format (int, optional): Line number where formats are located.</span>
<span class="sd">            If not provided, an attempt will be made to locate one.</span>
<span class="sd">        lineno_names (int, optional): Line number where field names are located.</span>
<span class="sd">            If not provided, an attempt will be made to locate one.</span>
<span class="sd">        lineno_units (int, optional): Line number where field units are located.</span>
<span class="sd">            If not provided, an attempt will be made to locate one.</span>
<span class="sd">        use_astropy (bool, optional): If True, astropy will be used to parse</span>
<span class="sd">            the table if it is installed. Defaults to False.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">header_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">header_size</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">prev_pos</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">_newline</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sline</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">comment</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="n">header_size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">header_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sline</span><span class="p">)</span>
    <span class="c1"># Parse header &amp; set serializer attributes</span>
    <span class="n">header</span> <span class="o">=</span> <span class="n">parse_header</span><span class="p">(</span><span class="n">header_lines</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">,</span>
                          <span class="n">lineno_format</span><span class="o">=</span><span class="n">lineno_format</span><span class="p">,</span>
                          <span class="n">lineno_names</span><span class="o">=</span><span class="n">lineno_names</span><span class="p">,</span>
                          <span class="n">lineno_units</span><span class="o">=</span><span class="n">lineno_units</span><span class="p">)</span>
    <span class="c1"># Override header with information set explicitly in serializer</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">serializer</span><span class="o">.</span><span class="n">_oldstyle_kws</span><span class="p">:</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">serializer</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">header</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;format_str&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">delimiter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;format_str&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">):</span>
        <span class="n">delimiter</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">]</span>
    <span class="c1"># Try to determine format from array without header</span>
    <span class="n">str_fmt</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">str_fmt</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">])):</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">prev_pos</span> <span class="o">+</span> <span class="n">header_size</span><span class="p">)</span>
        <span class="n">all_contents</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_contents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="k">return</span>  <span class="c1"># In case the file has not been written</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">table_to_array</span><span class="p">(</span><span class="n">all_contents</span><span class="p">,</span>
                             <span class="n">names</span><span class="o">=</span><span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;field_names&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                             <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span>
                             <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                             <span class="n">use_astropy</span><span class="o">=</span><span class="n">use_astropy</span><span class="p">)</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;field_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
        <span class="c1"># Get format from array</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table2format</span><span class="p">(</span>
                <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
                <span class="n">comment</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="n">newline</span><span class="o">=</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;newline&#39;</span><span class="p">])</span>
        <span class="c1"># Determine maximum size of string field</span>
        <span class="k">while</span> <span class="n">str_fmt</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]:</span>
            <span class="n">field_formats</span> <span class="o">=</span> <span class="n">extract_formats</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">])</span>
            <span class="n">ifld</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span>
                <span class="n">header</span><span class="p">[</span><span class="s1">&#39;field_names&#39;</span><span class="p">][</span><span class="n">field_formats</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">str_fmt</span><span class="p">)])</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">ifld</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
            <span class="n">new_str_fmt</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="si">%%%d</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="n">max_len</span>
            <span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="n">str_fmt</span><span class="p">,</span> <span class="n">new_str_fmt</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Update serializer</span>
    <span class="n">serializer</span><span class="o">.</span><span class="n">initialize_serializer</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
    <span class="c1"># Seek to just after the header</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">prev_pos</span> <span class="o">+</span> <span class="n">header_size</span><span class="p">)</span></div>


<div class="viewcode-block" id="parse_header"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.parse_header">[docs]</a><span class="k">def</span> <span class="nf">parse_header</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">_default_newline</span><span class="p">,</span> <span class="n">lineno_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">lineno_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lineno_units</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Parse an ASCII table header to get information about the table.</span>

<span class="sd">    Args:</span>
<span class="sd">        header (list, str): Header lines that should be parsed.</span>
<span class="sd">        newline (str, optional): Newline character that should be used to split</span>
<span class="sd">            header if it is not already a list. Defaults to _default_newline.</span>
<span class="sd">        lineno_format (int, optional): Line number where formats are located.</span>
<span class="sd">            If not provided, an attempt will be made to locate one.</span>
<span class="sd">        lineno_names (int, optional): Line number where field names are located.</span>
<span class="sd">            If not provided, an attempt will be made to locate one.</span>
<span class="sd">        lineno_units (int, optional): Line number where field units are located.</span>
<span class="sd">            If not provided, an attempt will be made to locate one.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Parameters describing the information determined from the header.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">excl_lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="n">h</span> <span class="o">+</span> <span class="n">newline</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">newline</span><span class="p">)]</span>
    <span class="c1"># Locate format line</span>
    <span class="k">if</span> <span class="n">lineno_format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">extract_formats</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lineno_format</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">break</span>
    <span class="c1"># Get format information from format line</span>
    <span class="k">if</span> <span class="n">lineno_format</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">excl_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineno_format</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">format2table</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="n">lineno_format</span><span class="p">])</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;fmts&#39;</span><span class="p">])</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">info</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;format_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="n">lineno_format</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ncol</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">delimiter</span><span class="o">=</span><span class="n">_default_delimiter</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">_default_comment</span><span class="p">,</span>
                   <span class="n">fmts</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">out</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;newline&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="p">)</span>
    <span class="c1"># Use explicit lines for names &amp; units</span>
    <span class="k">if</span> <span class="n">lineno_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">excl_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineno_names</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;field_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="n">lineno_names</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;newline&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">lineno_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">excl_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lineno_units</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;field_units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="n">lineno_units</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;newline&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">])</span>
    <span class="c1"># Locate units &amp; names</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;field_units&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;field_names&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">):</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">excl_lines</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;comment&#39;</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;newline&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s1">&#39;delimiter&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span> <span class="o">==</span> <span class="n">ncol</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ncol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">is_unit</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">units</span><span class="o">.</span><span class="n">is_unit</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
                    <span class="n">is_unit</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="n">is_unit</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;field_units&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Two lines could contain the field units.&quot;</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;field_units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;field_names&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Two lines could contain the field names.&quot;</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;field_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cols</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="dict2list"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.dict2list">[docs]</a><span class="k">def</span> <span class="nf">dict2list</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Covert a dictionary of arrays to a list of arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict): Dictionary of arrays.</span>
<span class="sd">        order (list, optional): Key order in which values from the dictionary</span>
<span class="sd">            should be add to the list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List with contents from the input array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;d must be a dictionary, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="list2dict"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.list2dict">[docs]</a><span class="k">def</span> <span class="nf">list2dict</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a list of arrays to a dictionary of arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrays (list): List of arrays.</span>
<span class="sd">        names (list, optional): Names to give to the new fields. Defaults to</span>
<span class="sd">            names based on order (e.g. &#39;f0&#39;, &#39;f1&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary of arrays.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;arrays must be a list or tuple, not </span><span class="si">%s</span><span class="s2">.&quot;</span>
                        <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">arrays</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;f</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">))]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">x</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">arrays</span><span class="p">)}</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="numpy2list"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.numpy2list">[docs]</a><span class="k">def</span> <span class="nf">numpy2list</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Covert a numpy structured array to a list of arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        arr (np.ndarray): Array to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List with contents from the input array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;arr must be a numpy array, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dict2list</span><span class="p">(</span><span class="n">numpy2dict</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">)</span></div>


<div class="viewcode-block" id="list2numpy"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.list2numpy">[docs]</a><span class="k">def</span> <span class="nf">list2numpy</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a list of arrays to a numpy structured array.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrays (list): List of arrays.</span>
<span class="sd">        names (list, optional): Names to give to the new fields. Defaults to</span>
<span class="sd">            names based on order.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Structured numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">dict2numpy</span><span class="p">(</span><span class="n">list2dict</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="n">names</span><span class="p">)</span></div>


<div class="viewcode-block" id="numpy2dict"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.numpy2dict">[docs]</a><span class="k">def</span> <span class="nf">numpy2dict</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Covert a numpy structured array to a dictionary of arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        arr (np.ndarray): Array to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary with contents from the input array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;arr must be a numpy array, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="dict2numpy"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.dict2numpy">[docs]</a><span class="k">def</span> <span class="nf">dict2numpy</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a dictionary of arrays to a numpy structured array.</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict): Dictionary of arrays.</span>
<span class="sd">        order (list, optional): Order that keys should be in array.</span>
<span class="sd">            Defaults to None and will be sorted keys.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Structured numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;d must be a dictionary, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
    <span class="n">dtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]</span>
    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="n">dtypes</span><span class="p">))</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">order</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">order</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="numpy2pandas"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.numpy2pandas">[docs]</a><span class="k">def</span> <span class="nf">numpy2pandas</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Covert a numpy structured array to a Pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        arr (np.ndarray): Array to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: Pandas data frame with contents from the input array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;arr must be a numpy array, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">arr</span><span class="p">))</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="pandas2numpy"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.pandas2numpy">[docs]</a><span class="k">def</span> <span class="nf">pandas2numpy</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a Pandas DataFrame to a numpy structured array.</span>

<span class="sd">    Args:</span>
<span class="sd">        frame (pandas.DataFrame): Frame to convert.</span>
<span class="sd">        index (bool, optional): If True, the index will be included as a field</span>
<span class="sd">            in the array. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Structured numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frame must be a pandas data frame, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">to_records</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="c1"># Covert object type to string</span>
    <span class="n">old_dtype</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span>
    <span class="n">new_dtype</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="n">old_dtype</span><span class="o">.</span><span class="n">names</span><span class="p">,</span> <span class="n">formats</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">old_dtype</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">old_dtype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">object</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">old_dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">old_dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">bytes</span><span class="p">):</span>
                <span class="n">char_str</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">char_str</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="n">old_dtype</span><span class="o">.</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">))</span>
                <span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;formats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">char_str</span><span class="p">,</span> <span class="n">max_len</span><span class="p">)))</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;formats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_dtype</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;formats&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">old_dtype</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c1"># Convert to unstructured array if name is default and only one column</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;formats&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">out</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">new_dtype</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">new_dtype</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">new_dtype</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[:]</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="dict2pandas"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.dict2pandas">[docs]</a><span class="k">def</span> <span class="nf">dict2pandas</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a dictionary of arrays to a Pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        d (dict): Dictionary of arrays.</span>
<span class="sd">        order (list, optional): Order that keys should be in array.</span>
<span class="sd">            Defaults to None and will be sorted keys.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: Pandas data frame with contents from the input dict.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">numpy2pandas</span><span class="p">(</span><span class="n">dict2numpy</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">))</span></div>


<div class="viewcode-block" id="pandas2dict"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.pandas2dict">[docs]</a><span class="k">def</span> <span class="nf">pandas2dict</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a Pandas DataFrame to a numpy structured array.</span>

<span class="sd">    Args:</span>
<span class="sd">        frame (pandas.DataFrame): Frame to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Dictionary with contents from the input frame.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;frame must be a pandas data frame, not </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">numpy2dict</span><span class="p">(</span><span class="n">pandas2numpy</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span></div>


<div class="viewcode-block" id="list2pandas"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.list2pandas">[docs]</a><span class="k">def</span> <span class="nf">list2pandas</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a list of arrays to a Pandas DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        arrays (list): List of arrays.</span>
<span class="sd">        names (list, optional): Names to give to the new fields. Defaults to</span>
<span class="sd">            names based on order (e.g. &#39;f0&#39;, &#39;f1&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        pandas.DataFrame: Pandas data frame with contents from the input list.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">numpy2pandas</span><span class="p">(</span><span class="n">list2numpy</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="pandas2list"><a class="viewcode-back" href="../../yggdrasil.serialize.html#yggdrasil.serialize.pandas2list">[docs]</a><span class="k">def</span> <span class="nf">pandas2list</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Convert a Pandas DataFrame to a list of arrays.</span>

<span class="sd">    Args:</span>
<span class="sd">        frame (pandas.DataFrame): Frame to convert.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List with contents from the input frame.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">numpy2list</span><span class="p">(</span><span class="n">pandas2numpy</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span></div>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>