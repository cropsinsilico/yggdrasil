

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>yggdrasil.command_line &mdash; yggdrasil v1.7.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> yggdrasil
          

          
          </a>

          
            
            
              <div class="version">
                v1.7.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../includeme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../formatted_io.html">Formatted I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server_client_io.html">Server/Client I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autowrap.html">Autowrapping Model Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../conditional_io.html">Conditional I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transformed_io.html">Transformed I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timesync_io.html">Timestep Synchronization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../yaml.html">YAML Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../config.html">Configuration Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hpc.html">High Performance Computing (HPC)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c_format_strings.html">C-Style Format Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../threading.html">OpenMP Threading in Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples_toc.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced/index.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/index.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hackathon2018/index.html">Welcome to the 2018 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hackathon2019/index.html">Welcome to the 2019 Crops in Silico Hackathon!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hackathon2021/index.html">Welcome to the 2021 Crops in Silico Hackathon!</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">yggdrasil</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>yggdrasil.command_line</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for yggdrasil.command_line</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/python</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">yggdrasil.constants</span> <span class="kn">import</span> <span class="n">LANGUAGES</span><span class="p">,</span> <span class="n">LANGUAGES_WITH_ALIASES</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">package_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>


<div class="viewcode-block" id="githook"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.githook">[docs]</a><span class="k">def</span> <span class="nf">githook</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Git hook to determine if the Github workflow need to be</span>
<span class="sd">    re-generated.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;diff-index&quot;</span><span class="p">,</span> <span class="s2">&quot;--cached&quot;</span><span class="p">,</span> <span class="s2">&quot;--name-only&quot;</span><span class="p">,</span>
             <span class="s2">&quot;--diff-filter=ACMRTUXB&quot;</span><span class="p">,</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">],</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="n">regen</span> <span class="o">=</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;utils&#39;</span><span class="p">,</span> <span class="s1">&#39;test-install-base.yml&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">files</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">regen</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">gitdir</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;--git-dir&quot;</span><span class="p">],</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">workflow_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gitdir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;.github&#39;</span><span class="p">,</span> <span class="s1">&#39;workflows&#39;</span><span class="p">)</span>
        <span class="n">generate_gha_workflow</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[],</span> <span class="n">gitdir</span><span class="o">=</span><span class="n">gitdir</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;git&#39;</span><span class="p">,</span> <span class="s1">&#39;add&#39;</span><span class="p">,</span>
                 <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workflow_dir</span><span class="p">,</span> <span class="s1">&#39;test-install.yml&#39;</span><span class="p">)],</span>
                <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="ArgumentTuple"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ArgumentTuple">[docs]</a><span class="k">class</span> <span class="nc">ArgumentTuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">ArgumentTuple</span><span class="p">,</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span></div>


<div class="viewcode-block" id="ConditionalArgumentTuple"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ConditionalArgumentTuple">[docs]</a><span class="k">class</span> <span class="nc">ConditionalArgumentTuple</span><span class="p">(</span><span class="n">ArgumentTuple</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">ArgumentTuple</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">ConditionalArgumentTuple</span><span class="p">,</span>
                                    <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="n">conditions</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">conditions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">out</span></div>
            

<div class="viewcode-block" id="ArgumentBase"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ArgumentBase">[docs]</a><span class="k">class</span> <span class="nc">ArgumentBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="n">arguments</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="n">conditions</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conditions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="ArgumentParser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ArgumentParser">[docs]</a><span class="k">class</span> <span class="nc">ArgumentParser</span><span class="p">(</span><span class="n">ArgumentBase</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ArgumentGroup"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ArgumentGroup">[docs]</a><span class="k">class</span> <span class="nc">ArgumentGroup</span><span class="p">(</span><span class="n">ArgumentBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclusive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusive</span> <span class="o">=</span> <span class="n">exclusive</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ArgumentGroup</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArgumentSubparser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ArgumentSubparser">[docs]</a><span class="k">class</span> <span class="nc">ArgumentSubparser</span><span class="p">(</span><span class="n">ArgumentBase</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parsers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parsers</span> <span class="o">=</span> <span class="n">parsers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parsers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parsers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ArgumentSubparser</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="SubCommandMeta"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommandMeta">[docs]</a><span class="k">class</span> <span class="nc">SubCommandMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Meta class for subcommands.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="ReplacementWarning"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ReplacementWarning">[docs]</a><span class="k">def</span> <span class="nf">ReplacementWarning</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">((</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; will soon be removed. Use &#39;</span><span class="si">%s</span><span class="s2">&#39; instead.&quot;</span><span class="p">)</span>
                  <span class="o">%</span> <span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">),</span> <span class="ne">FutureWarning</span><span class="p">)</span></div>


<div class="viewcode-block" id="SubCommand"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand">[docs]</a><span class="k">class</span> <span class="nc">SubCommand</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">SubCommandMeta</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Class for handling subcommands so that they can be run</span>
<span class="sd">    as subcommands or individually.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">help</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">allow_unknown</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="SubCommand.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_unknown</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                   <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># TODO: Check choices for positional arguments that can</span>
        <span class="c1"># have more than one element</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">args</span>
        <span class="n">kws</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">namespace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;namespace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">namespace</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">allow_unknown</span> <span class="ow">or</span> <span class="n">allow_unknown</span><span class="p">:</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">_extra_commands</span> <span class="o">=</span> <span class="n">extra</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">**</span><span class="n">kws</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="s1">&#39;languages&#39;</span><span class="p">]:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">v_flag</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39;_flag&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v_flag</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">v</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v_flag</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">])</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">all_languages</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="SubCommand.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>  <span class="c1"># pragma: debug</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="SubCommand.call"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.call">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_parser</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubCommand.get_parser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.get_parser">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">help</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span></div>

<div class="viewcode-block" id="SubCommand.add_argument_to_parser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.add_argument_to_parser">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_argument_to_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;conditions&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">conditions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">conditions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span>
                    <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">platform</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_platform</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                        <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">add_argument_to_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">xx</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">ArgumentTuple</span><span class="p">,</span>
                            <span class="n">ConditionalArgumentTuple</span><span class="p">)):</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;extend&#39;</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;append&#39;</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;nargs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ArgumentGroup</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">exclusive</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">(</span><span class="o">**</span><span class="n">x</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="o">**</span><span class="n">x</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">add_argument_to_parser</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ArgumentSubparser</span><span class="p">):</span>
            <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="o">**</span><span class="n">x</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">parsers</span><span class="p">:</span>
                <span class="n">isubparser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="o">**</span><span class="n">xx</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">add_argument_to_parser</span><span class="p">(</span><span class="n">isubparser</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">add_argument_to_parser</span><span class="p">(</span><span class="n">isubparser</span><span class="p">,</span> <span class="n">xx</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;type(x) = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>

<div class="viewcode-block" id="SubCommand.add_arguments"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.add_arguments">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">add_argument_to_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span></div>

<div class="viewcode-block" id="SubCommand.add_subparser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.SubCommand.add_subparser">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_subparser</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">subparsers</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">help</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">set_defaults</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">func</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.main">[docs]</a><span class="k">class</span> <span class="nc">main</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Runner for yggdrasil CLI.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;yggdrasil&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Command line interface for the yggdrasil package.&quot;</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="main.get_parser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.main.get_parser">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">ver</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">get_parser</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span>
                            <span class="n">version</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;yggdrasil </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ver</span><span class="p">))</span>
        <span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;subcommands&#39;</span><span class="p">,</span>
                                           <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;subcommand&#39;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">_ygg_subparsers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">yggrun</span><span class="p">,</span> <span class="n">ygginfo</span><span class="p">,</span> <span class="n">validate_yaml</span><span class="p">,</span>
                  <span class="n">yggcc</span><span class="p">,</span> <span class="n">yggcompile</span><span class="p">,</span> <span class="n">yggclean</span><span class="p">,</span>
                  <span class="n">ygginstall</span><span class="p">,</span> <span class="n">update_config</span><span class="p">,</span>
                  <span class="n">regen_metaschema</span><span class="p">,</span> <span class="n">regen_schema</span><span class="p">,</span>
                  <span class="n">yggmodelform</span><span class="p">,</span> <span class="n">yggdevup</span><span class="p">,</span> <span class="n">run_tsts</span><span class="p">,</span>
                  <span class="n">timing_plots</span><span class="p">,</span> <span class="n">generate_gha_workflow</span><span class="p">]:</span>
            <span class="n">x</span><span class="o">.</span><span class="n">add_subparser</span><span class="p">(</span><span class="n">subparsers</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">_ygg_subparsers</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">parser</span></div>

<div class="viewcode-block" id="main.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.main.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;allow_unknown&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">subcommand</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_ygg_subparsers</span><span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">subcommand</span><span class="p">]</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span>
                <span class="n">parser</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="main.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.main.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">args</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="yggrun"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggrun">[docs]</a><span class="k">class</span> <span class="nc">yggrun</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Start a run.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;run&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Run an integration.&quot;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;yamlfile&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s2">&quot;One or more yaml specification files.&quot;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--with-mpi&#39;</span><span class="p">,</span> <span class="s1">&#39;--mpi-nproc&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of MPI processes to run on.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--mpi-tag-start&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Tag that MPI communications should start at.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="yggrun.add_arguments"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggrun.add_arguments">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">config</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">yggrun</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">config</span><span class="o">.</span><span class="n">get_config_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">skip_sections</span><span class="o">=</span><span class="s1">&#39;testing&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="yggrun.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggrun.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">new_args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mpiexec&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span><span class="p">)]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;--with-mpi&#39;</span><span class="p">,</span> <span class="s1">&#39;--mpi-nproc&#39;</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="s1">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span><span class="n">new_args</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">runner</span><span class="p">,</span> <span class="n">config</span>
        <span class="n">prog</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">parser_config</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">yamlfile</span><span class="p">,</span> <span class="n">ygg_debug_prefix</span><span class="o">=</span><span class="n">prog</span><span class="p">,</span>
                       <span class="n">production_run</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">production_run</span><span class="p">,</span>
                       <span class="n">mpi_tag_start</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mpi_tag_start</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ygginfo"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ygginfo">[docs]</a><span class="k">class</span> <span class="nc">ygginfo</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Print information about yggdrasil installation.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;info&#39;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Display information about the current yggdrasil &#39;</span>
            <span class="s1">&#39;installation.&#39;</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--no-languages&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;no_languages&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Don</span><span class="se">\&#39;</span><span class="s1">t print information about individual &#39;</span>
                   <span class="s1">&#39;languages.&#39;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--no-comms&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;no_comms&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Don</span><span class="se">\&#39;</span><span class="s1">t print information about individual &#39;</span>
                   <span class="s1">&#39;comms.&#39;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Increase the verbosity of the printed &#39;</span>
                   <span class="s1">&#39;information.&#39;</span><span class="p">)}),</span>
        <span class="n">ArgumentSubparser</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;tool&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;tool&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Compilation tool types to get info about.&#39;</span><span class="p">,</span>
            <span class="n">arguments</span><span class="o">=</span><span class="p">[</span>
                <span class="p">((</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="p">),</span>
                 <span class="p">{</span><span class="s1">&#39;choices&#39;</span><span class="p">:</span> <span class="n">LANGUAGES_WITH_ALIASES</span><span class="p">[</span><span class="s1">&#39;compiled&#39;</span><span class="p">],</span>
                  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span>
                  <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Language to get tool information for.&#39;</span><span class="p">}),</span>
                <span class="p">((</span><span class="s1">&#39;--toolname&#39;</span><span class="p">,</span> <span class="p">),</span>
                 <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Name of tool to get information for. &#39;</span>
                           <span class="s1">&#39;If not provided, information for the &#39;</span>
                           <span class="s1">&#39;default tool will be returned.&#39;</span><span class="p">)}),</span>
                <span class="p">((</span><span class="s1">&#39;--flags&#39;</span><span class="p">,</span> <span class="p">),</span>
                 <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Display the flags that yggdrasil will &#39;</span>
                           <span class="s1">&#39; pass to the tool when it is called.&#39;</span><span class="p">)}),</span>
                <span class="p">((</span><span class="s1">&#39;--fullpath&#39;</span><span class="p">,</span> <span class="p">),</span>
                 <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the full path to the tool exectuable.&#39;</span><span class="p">})],</span>
            <span class="n">parsers</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Get information about a compiler.&#39;</span><span class="p">),</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;linker&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Get information about a linker.&#39;</span><span class="p">,</span>
                    <span class="n">arguments</span><span class="o">=</span><span class="p">[</span>
                        <span class="p">((</span><span class="s1">&#39;--library&#39;</span><span class="p">,</span> <span class="p">),</span>
                         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get flags for linking a library.&#39;</span><span class="p">})]),</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;archiver&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Get information about a archiver.&#39;</span><span class="p">)])]</span>

<div class="viewcode-block" id="ygginfo.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ygginfo.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">return_str</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">platform</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.components</span> <span class="kn">import</span> <span class="n">import_component</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tool</span><span class="p">:</span>
            <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">flags</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tool</span> <span class="o">==</span> <span class="s1">&#39;compiler&#39;</span><span class="p">:</span>
                    <span class="n">flags</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_compiler_flags</span><span class="p">(</span>
                        <span class="n">for_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span>
                        <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dont_link</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s1">&#39;/link&#39;</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                        <span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">[:</span><span class="n">flags</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;/link&#39;</span><span class="p">)]</span>
                    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-c&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">flags</span><span class="p">:</span>
                            <span class="n">flags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tool</span> <span class="o">==</span> <span class="s1">&#39;archiver&#39;</span><span class="p">:</span>
                        <span class="n">libtype</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
                    <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;library&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="n">libtype</span> <span class="o">=</span> <span class="s1">&#39;shared&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">libtype</span> <span class="o">=</span> <span class="s1">&#39;object&#39;</span>
                    <span class="n">flags</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_linker_flags</span><span class="p">(</span>
                        <span class="n">for_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">toolname</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span>
                        <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">libtype</span><span class="o">=</span><span class="n">libtype</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows:</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">fullpath</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tool</span><span class="p">)</span><span class="o">.</span><span class="n">get_executable</span><span class="p">(</span><span class="n">full_path</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">tool</span><span class="p">,</span> <span class="n">return_prop</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">out</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">tools</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">__version__</span>
        <span class="n">lang_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_installed_lang</span><span class="p">()</span>
        <span class="n">comm_list</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_installed_comm</span><span class="p">()</span>
        <span class="n">comm_lang_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;    &#39;</span>
        <span class="n">curr_prefix</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">vardict</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;Version&#39;</span><span class="p">,</span> <span class="n">__version__</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Languages&#39;</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lang_list</span><span class="p">)),</span>
            <span class="p">(</span><span class="s1">&#39;Communication Mechanisms&#39;</span><span class="p">,</span>
             <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">get_installed_comm</span><span class="p">())),</span>
            <span class="p">(</span><span class="s1">&#39;Default Comm Mechanism&#39;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_default_comm</span><span class="p">()),</span>
            <span class="p">(</span><span class="s1">&#39;Config File&#39;</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">usr_config_file</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Add language information</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_languages</span><span class="p">:</span>
                <span class="c1"># Install languages</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Installed Languages:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lang_list</span><span class="p">):</span>
                    <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">lang</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">drv</span><span class="o">.</span><span class="n">comms_implicit</span><span class="p">:</span>
                        <span class="n">comm_lang_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
                    <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                    <span class="n">exec_name</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">language_executable</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">exec_name</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">exec_name</span><span class="p">):</span>
                            <span class="n">exec_name</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="n">exec_name</span><span class="p">)</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;Location&#39;</span><span class="p">,</span>
                                        <span class="n">exec_name</span><span class="p">))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;Version&#39;</span><span class="p">,</span>
                                    <span class="n">drv</span><span class="o">.</span><span class="n">language_version</span><span class="p">()))</span>
                    <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Not installed languages</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Languages Not Installed:&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_supported_lang</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">lang_list</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">lang</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Language Installed&quot;</span><span class="p">,</span>
                         <span class="n">drv</span><span class="o">.</span><span class="n">is_language_installed</span><span class="p">()))</span>
                    <span class="k">if</span> <span class="n">drv</span><span class="o">.</span><span class="n">executable_type</span> <span class="o">==</span> <span class="s1">&#39;compiler&#39;</span><span class="p">:</span>
                        <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                        <span class="n">vardict</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> Installed (</span><span class="si">%s</span><span class="s2">)&quot;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
                                   <span class="nb">getattr</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="s1">&#39;default_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">))),</span>
                             <span class="n">drv</span><span class="o">.</span><span class="n">is_tool_installed</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]]</span>
                        <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Base Languages Installed&quot;</span><span class="p">,</span>
                         <span class="n">drv</span><span class="o">.</span><span class="n">are_base_languages_installed</span><span class="p">()))</span>
                    <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">drv</span><span class="o">.</span><span class="n">are_base_languages_installed</span><span class="p">(</span>
                            <span class="n">missing</span><span class="o">=</span><span class="n">missing</span><span class="p">):</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="s2">&quot;Base Languages Not Installed&quot;</span><span class="p">,</span>
                             <span class="n">missing</span><span class="p">))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Dependencies Installed&quot;</span><span class="p">,</span>
                         <span class="n">drv</span><span class="o">.</span><span class="n">are_dependencies_installed</span><span class="p">()))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">drv</span><span class="o">.</span><span class="n">are_dependencies_installed</span><span class="p">():</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="s2">&quot;Dependencies Not Installed&quot;</span><span class="p">,</span>
                             <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">drv</span><span class="o">.</span><span class="n">interface_dependencies</span> <span class="k">if</span>
                              <span class="p">(</span><span class="ow">not</span> <span class="n">drv</span><span class="o">.</span><span class="n">is_library_installed</span><span class="p">(</span><span class="n">b</span><span class="p">))]))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Interface Installed&quot;</span><span class="p">,</span>
                         <span class="n">drv</span><span class="o">.</span><span class="n">is_interface_installed</span><span class="p">()))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Comm Installed&quot;</span><span class="p">,</span>
                                    <span class="n">drv</span><span class="o">.</span><span class="n">is_comm_installed</span><span class="p">()))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Configured&quot;</span><span class="p">,</span>
                                    <span class="n">drv</span><span class="o">.</span><span class="n">is_configured</span><span class="p">()))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Disabled&quot;</span><span class="p">,</span>
                                    <span class="n">drv</span><span class="o">.</span><span class="n">is_disabled</span><span class="p">()))</span>
                    <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Add comm information</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">no_comms</span><span class="p">:</span>
                <span class="c1"># Fully installed comms</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="s1">&#39;Comms Available for All Languages:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">comm_list</span><span class="p">):</span>
                    <span class="n">cmm</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;comm&#39;</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">comm</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Partially installed comms</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="s1">&#39;Comms Available for Some/No Languages:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                <span class="k">for</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_supported_comm</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">comm</span> <span class="ow">in</span> <span class="n">comm_list</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">cmm</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;comm&#39;</span><span class="p">,</span> <span class="n">comm</span><span class="p">)</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">comm</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                    <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                    <span class="n">avail</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmm</span><span class="o">.</span><span class="n">is_installed</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span>
                             <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">comm_lang_list</span><span class="p">]</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Available for &quot;</span><span class="p">,</span>
                         <span class="nb">sorted</span><span class="p">([</span><span class="n">comm_lang_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">avail</span><span class="p">))</span>
                                 <span class="k">if</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">]])))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;Not Available for &quot;</span><span class="p">,</span>
                         <span class="nb">sorted</span><span class="p">([</span><span class="n">comm_lang_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
                                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">avail</span><span class="p">))</span>
                                 <span class="k">if</span> <span class="ow">not</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">]])))</span>
                    <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Add verbose information</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="c1"># Path variables</span>
                <span class="n">path_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;C_INCLUDE_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;INCLUDE&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;LD_LIBRARY_PATH&#39;</span><span class="p">,</span> <span class="s1">&#39;LIB&#39;</span><span class="p">]</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Environment paths:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">path_vars</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                                <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">)))))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Environment variabless</span>
                <span class="n">env_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CONDA_PREFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;CONDA&#39;</span><span class="p">,</span> <span class="s1">&#39;SDKROOT&#39;</span><span class="p">,</span> <span class="s1">&#39;CC&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;CXX&#39;</span><span class="p">,</span> <span class="s1">&#39;FC&#39;</span><span class="p">,</span> <span class="s1">&#39;GFORTRAN&#39;</span><span class="p">,</span> <span class="s1">&#39;DISPLAY&#39;</span><span class="p">,</span> <span class="s1">&#39;CL&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;_CL_&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                    <span class="n">env_vars</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;VCPKG_ROOT&#39;</span><span class="p">]</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Environment variables:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">env_vars</span><span class="p">:</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">None</span><span class="p">)))</span>
                <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Conda info</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONDA_PREFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                            <span class="s1">&#39;conda info&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                            <span class="p">[</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s1">&#39;Conda Info:&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                            <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                    <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># Configuration</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">usr_config_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                    <span class="n">contents</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">(</span><span class="s1">&#39;Configuration file:&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\t</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="n">config</span><span class="o">.</span><span class="n">usr_config_file</span><span class="p">,</span>
                        <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))))</span>
                <span class="c1"># R and reticulate info</span>
                <span class="n">Rdrv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">is_installed</span><span class="p">():</span>
                    <span class="n">env_reticulate</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
                    <span class="n">env_reticulate</span><span class="p">[</span><span class="s1">&#39;RETICULATE_PYTHON&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
                    <span class="c1"># Stack size</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">run_executable</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;Cstack_info()&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;R Cstack_info:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                            <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                    <span class="c1"># Compilation tools</span>
                    <span class="n">interp</span> <span class="o">=</span> <span class="s1">&#39;R&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="n">Rdrv</span><span class="o">.</span><span class="n">get_interpreter</span><span class="p">()</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;Rscript&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;R C Compiler:&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">curr_prefix</span> <span class="o">+=</span> <span class="n">prefix</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CC&#39;</span><span class="p">,</span> <span class="s1">&#39;CFLAGS&#39;</span><span class="p">,</span> <span class="s1">&#39;CXX&#39;</span><span class="p">,</span> <span class="s1">&#39;CXXFLAGS&#39;</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">out</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span>
                                <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">interp</span><span class="p">,</span> <span class="s1">&#39;CMD&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span>
                                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">STDOUT</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
                            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;ERROR (missing Rtools?)&#39;</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                 <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">))))</span>
                    <span class="n">curr_prefix</span> <span class="o">=</span> <span class="n">curr_prefix</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># Session info</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">run_executable</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="s2">&quot;sessionInfo()&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;R sessionInfo:&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span>
                         <span class="o">%</span> <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                            <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                    <span class="c1"># Reticulate conda_list</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;CONDA_PREFIX&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                            <span class="n">out</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                                <span class="s1">&#39;conda info --json&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">out</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">bytes2str</span><span class="p">(</span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                                <span class="p">[</span><span class="s1">&#39;conda&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;--json&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="s2">&quot;conda info --json&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                                 <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                     <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">out</span> <span class="o">=</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">run_executable</span><span class="p">(</span>
                                <span class="p">[</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;library(reticulate); &quot;</span>
                                        <span class="s2">&quot;reticulate::conda_list()&quot;</span><span class="p">)],</span>
                                <span class="n">env</span><span class="o">=</span><span class="n">env_reticulate</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;ERROR&#39;</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="s2">&quot;R reticulate::conda_list():&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                                 <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                     <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                    <span class="c1"># Windows python versions</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">run_executable</span><span class="p">(</span>
                            <span class="p">[</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span>
                             <span class="p">(</span><span class="s2">&quot;library(reticulate); &quot;</span>
                              <span class="s2">&quot;reticulate::py_versions_windows()&quot;</span><span class="p">)],</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">env_reticulate</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="s2">&quot;R reticulate::py_versions_windows():&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                                 <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                     <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                    <span class="c1"># conda_binary</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span> <span class="ow">and</span> <span class="n">shutil</span><span class="o">.</span><span class="n">which</span><span class="p">(</span><span class="s1">&#39;conda&#39;</span><span class="p">):</span>  <span class="c1"># pragma: windows</span>
                        <span class="n">out</span> <span class="o">=</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">run_executable</span><span class="p">(</span>
                            <span class="p">[</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span>
                             <span class="p">(</span><span class="s2">&quot;library(reticulate); &quot;</span>
                              <span class="s2">&quot;conda &lt;- reticulate:::conda_binary(</span><span class="se">\&quot;</span><span class="s2">auto</span><span class="se">\&quot;</span><span class="s2">); &quot;</span>
                              <span class="s2">&quot;system(paste(conda, </span><span class="se">\&quot;</span><span class="s2">info --json</span><span class="se">\&quot;</span><span class="s2">))&quot;</span><span class="p">)],</span>
                            <span class="n">env</span><span class="o">=</span><span class="n">env_reticulate</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="p">(</span><span class="n">curr_prefix</span>
                             <span class="o">+</span> <span class="s2">&quot;R reticulate::py_versions_windows():&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                 <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                                 <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                     <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
                    <span class="c1"># Reticulate py_config</span>
                    <span class="n">out</span> <span class="o">=</span> <span class="n">Rdrv</span><span class="o">.</span><span class="n">run_executable</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;-e&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;library(reticulate); &quot;</span>
                                <span class="s2">&quot;reticulate::py_config()&quot;</span><span class="p">)],</span>
                        <span class="n">env</span><span class="o">=</span><span class="n">env_reticulate</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">vardict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">curr_prefix</span> <span class="o">+</span> <span class="s2">&quot;R reticulate::py_config():&quot;</span><span class="p">,</span>
                         <span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                             <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">,</span>
                             <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">curr_prefix</span> <span class="o">+</span> <span class="n">prefix</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                                 <span class="n">out</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="kc">False</span><span class="p">)))))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Print things</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">vardict</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">line_format</span> <span class="o">=</span> <span class="s1">&#39;%-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_len</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;s&#39;</span> <span class="o">+</span> <span class="n">prefix</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vardict</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_format</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;yggdrasil info:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">return_str</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">msg</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div></div>

        
<div class="viewcode-block" id="validate_yaml"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.validate_yaml">[docs]</a><span class="k">class</span> <span class="nc">validate_yaml</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Validate a set of or or more YAMLs defining an integration.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;validate&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Validate a set of YAML specification files for an integration.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;yamlfile&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;One or more YAML specification files.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="validate_yaml.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.validate_yaml.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">yamlfile</span>
        <span class="n">yamlfile</span><span class="o">.</span><span class="n">parse_yaml</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">yamlfile</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validation succesful.&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="yggcc"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggcc">[docs]</a><span class="k">class</span> <span class="nc">yggcc</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compile a program.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;compile&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Compile a program from source files for use in an &quot;</span>
            <span class="s2">&quot;yggdrasil integration.&quot;</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;One or more source files or the directory containing an &quot;</span>
                   <span class="s2">&quot;R package.&quot;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--language&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;choices&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">LANGUAGES_WITH_ALIASES</span><span class="p">[</span><span class="s1">&#39;compiled&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">],</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Language of the source code. If not provided, &quot;</span>
                   <span class="s2">&quot;the language will be determined from the &quot;</span>
                   <span class="s2">&quot;source extension.&quot;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--toolname&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s2">&quot;Name of compilation tool that should be used&quot;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--flags&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Additional flags that should be added to the compilation &quot;</span>
                   <span class="s2">&quot;command&quot;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--use-ccache&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s2">&quot;Run compilation with ccache.&quot;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--Rpkg-language&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;Language that R package is written in &quot;</span>
                   <span class="s2">&quot;(only used if the specified language is R).&quot;</span><span class="p">)})]</span>

<div class="viewcode-block" id="yggcc.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggcc.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.components</span> <span class="kn">import</span> <span class="n">import_component</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.constants</span> <span class="kn">import</span> <span class="n">EXT2LANG</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">language</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(((</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                 <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;R&#39;</span><span class="p">)))):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;R&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">EXT2LANG</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">)</span>
        <span class="n">kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;toolname&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">toolname</span><span class="p">,</span> <span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
               <span class="s1">&#39;use_ccache&#39;</span><span class="p">:</span> <span class="n">args</span><span class="o">.</span><span class="n">use_ccache</span><span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">language</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">Rpkg_language</span><span class="p">:</span>
            <span class="n">kws</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">Rpkg_language</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;executable: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">drv</span><span class="o">.</span><span class="n">call_compiler</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kws</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="yggcompile"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggcompile">[docs]</a><span class="k">class</span> <span class="nc">yggcompile</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Compile interface library/libraries.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;compile-deps&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Compile yggdrasil dependency libraries. Existing &quot;</span>
            <span class="s2">&quot;libraries are first deleted.&quot;</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span>
          <span class="c1"># &#39;choices&#39;: ([&#39;all&#39;] + LANGUAGES_WITH_ALIASES[&#39;compiled&#39;]</span>
          <span class="c1">#             + LANGUAGES_WITH_ALIASES[&#39;compiled_dsl&#39;]),</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;One or more languages to compile dependencies &quot;</span>
                   <span class="s2">&quot;for.&quot;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--toolname&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s2">&quot;Name of compilation tool that should be used&quot;</span><span class="p">})]</span>

<div class="viewcode-block" id="yggcompile.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggcompile.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.components</span> <span class="kn">import</span> <span class="n">import_component</span>
        <span class="n">yggclean</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">error_on_missing</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;all_languages&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
            <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span><span class="o">.</span><span class="n">cleanup_dependencies</span><span class="p">()</span>
            <span class="n">drv</span> <span class="o">=</span> <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="s1">&#39;compile_dependencies&#39;</span><span class="p">)</span>
                 <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="s1">&#39;is_build_tool&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)))):</span>
                <span class="k">if</span> <span class="n">drv</span><span class="o">.</span><span class="n">is_installed</span><span class="p">():</span>
                    <span class="n">drv</span><span class="o">.</span><span class="n">compile_dependencies</span><span class="p">(</span><span class="n">toolname</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">toolname</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">missing</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error_on_missing</span> <span class="ow">and</span> <span class="n">missing</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">((</span><span class="s2">&quot;One or more of the requested languages &quot;</span>
                             <span class="s2">&quot;are not fully installed for use with &quot;</span>
                             <span class="s2">&quot;yggdrasil: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">missing</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="yggclean"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggclean">[docs]</a><span class="k">class</span> <span class="nc">yggclean</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Cleanup dependency files.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;clean&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Remove dependency libraries compiled by yggdrasil.&quot;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;language&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span>
          <span class="c1"># &#39;choices&#39;: [&#39;all&#39;] + LANGUAGES_WITH_ALIASES[&#39;all&#39;],</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;One or more languages to clean up dependencies &quot;</span>
                   <span class="s2">&quot;for.&quot;</span><span class="p">)})]</span>

<div class="viewcode-block" id="yggclean.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggclean.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.components</span> <span class="kn">import</span> <span class="n">import_component</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">language</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ipc&#39;</span><span class="p">,</span> <span class="s1">&#39;ipcs&#39;</span><span class="p">]:</span>
                <span class="kn">from</span> <span class="nn">yggdrasil.communication.IPCComm</span> <span class="kn">import</span> <span class="n">ipcrm_queues</span>
                <span class="n">ipcrm_queues</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">import_component</span><span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">lang</span><span class="p">)</span><span class="o">.</span><span class="n">cleanup_dependencies</span><span class="p">(</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="cc_toolname"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.cc_toolname">[docs]</a><span class="k">class</span> <span class="nc">cc_toolname</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Output the name of the compiler used to compile C or C++ programs.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;compiler-tool&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Get the compiler used for C/C++ programs.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--cpp&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the compiler used for C++ programs.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--fullpath&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the full path to the tool exectuable.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="cc_toolname.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.cc_toolname.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">cc_toolname</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;compiler&#39;</span>
        <span class="n">args</span><span class="o">.</span><span class="n">toolname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">args</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cpp</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;cpp&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="cc_toolname.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.cc_toolname.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">ygginfo</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ld_toolname"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ld_toolname">[docs]</a><span class="k">class</span> <span class="nc">ld_toolname</span><span class="p">(</span><span class="n">cc_toolname</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Output the name of the linker used to compile C or C++ programs.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;linker-tool&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Get the linker used for C/C++ programs.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--cpp&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the linker used for C++ programs.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--fullpath&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the full path to the tool exectuable.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="ld_toolname.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ld_toolname.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ld_toolname</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;linker&#39;</span>
        <span class="k">return</span> <span class="n">args</span></div></div>


<div class="viewcode-block" id="cc_flags"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.cc_flags">[docs]</a><span class="k">class</span> <span class="nc">cc_flags</span><span class="p">(</span><span class="n">cc_toolname</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the compiler flags necessary for including the interface</span>
<span class="sd">    library in a C or C++ program.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;compiler-flags&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Get the compilation flags necessary for a C/C++ program.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--cpp&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the compilation flags used for C++ programs.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--toolname&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Name of the tool that associated flags be returned for.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="cc_flags.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.cc_flags.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">cc_flags</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">args</span></div></div>


<div class="viewcode-block" id="ld_flags"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ld_flags">[docs]</a><span class="k">class</span> <span class="nc">ld_flags</span><span class="p">(</span><span class="n">cc_toolname</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Get the linker flags necessary for including the interface</span>
<span class="sd">    library in a C or C++ program.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;linker-flags&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Get the compilation flags necessary for a C/C++ program.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--cpp&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Get the compilation flags used for C++ programs.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--toolname&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Name of the tool that associated flags be returned for.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="ld_flags.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ld_flags.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ld_flags</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">tool</span> <span class="o">=</span> <span class="s1">&#39;linker&#39;</span>
        <span class="n">args</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">args</span></div></div>


<div class="viewcode-block" id="ygginstall"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ygginstall">[docs]</a><span class="k">class</span> <span class="nc">ygginstall</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Call installation script.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;install&quot;</span>

<div class="viewcode-block" id="ygginstall.get_parser"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ygginstall.get_parser">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_parser</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.languages</span> <span class="kn">import</span> <span class="n">install_languages</span>
        <span class="c1"># TODO: Migrate</span>
        <span class="k">return</span> <span class="n">install_languages</span><span class="o">.</span><span class="n">update_argparser</span><span class="p">()</span></div>

<div class="viewcode-block" id="ygginstall.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.ygginstall.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.languages</span> <span class="kn">import</span> <span class="n">install_languages</span>
        <span class="n">languages</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">language</span>
        <span class="k">if</span> <span class="p">(((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">languages</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">))</span>
             <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">languages</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">)))):</span>
            <span class="n">languages</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span>
                         <span class="n">install_languages</span><span class="o">.</span><span class="n">get_language_directories</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">languages</span><span class="p">:</span>
            <span class="n">install_languages</span><span class="o">.</span><span class="n">install_language</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="update_config"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.update_config">[docs]</a><span class="k">class</span> <span class="nc">update_config</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Update the user config file for yggdrasil.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;config&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Update the user config file.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">[((</span><span class="s1">&#39;languages&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
           <span class="c1"># &#39;choices&#39;: [&#39;all&#39;] + LANGUAGES_WITH_ALIASES[&#39;all&#39;],</span>
           <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[],</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;One or more languages that should be configured.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--languages&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;languages_flag&#39;</span><span class="p">,</span>
           <span class="c1"># &#39;choices&#39;: [&#39;all&#39;] + LANGUAGES_WITH_ALIASES[&#39;all&#39;],</span>
           <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[],</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;One or more languages that should be configured.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--show-file&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Print the path to the config file without updating it.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--remove-file&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Remove the existing config file and return.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--overwrite&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Overwrite the existing file.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--disable-languages&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[],</span>
           <span class="s1">&#39;choices&#39;</span><span class="p">:</span> <span class="n">LANGUAGES_WITH_ALIASES</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;One or more languages that should be disabled.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--enable-languages&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[],</span>
           <span class="s1">&#39;choices&#39;</span><span class="p">:</span> <span class="n">LANGUAGES_WITH_ALIASES</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;One or more languages that should be enabled.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--quiet&#39;</span><span class="p">,</span> <span class="s1">&#39;-q&#39;</span><span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Suppress output.&#39;</span><span class="p">}),</span>
         <span class="p">((</span><span class="s1">&#39;--allow-multiple-omp&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Have yggdrasil set the environment variable &#39;</span>
                    <span class="s1">&#39;KMP_DUPLICATE_LIB_OK to </span><span class="se">\&#39;</span><span class="s1">True</span><span class="se">\&#39;</span><span class="s1"> during model runs &#39;</span>
                    <span class="s1">&#39;to disable errors resembling &#39;</span>
                    <span class="s1">&#39;&quot;OMP: Error #15: Initializing libomp.dylib...&quot; &#39;</span>
                    <span class="s1">&#39;that result from having multiple versions of OpenMP &#39;</span>
                    <span class="s1">&#39;loaded during runtime.&#39;</span><span class="p">)}),</span>
         <span class="p">((</span><span class="s1">&#39;--dont-allow-multiple-omp&#39;</span><span class="p">,</span> <span class="p">),</span>
          <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
           <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Don</span><span class="se">\&#39;</span><span class="s1">t set the KMP_DUPLICATE_LIB_OK environment variable &#39;</span>
                    <span class="s1">&#39;when running models (see help for </span><span class="se">\&#39;</span><span class="s1">--allow-multiple-omp</span><span class="se">\&#39;</span><span class="s1"> &#39;</span>
                    <span class="s1">&#39;for more information).&#39;</span><span class="p">)})]</span>
        <span class="o">+</span> <span class="p">[((</span><span class="s1">&#39;--</span><span class="si">%s</span><span class="s1">-compiler&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Name or path to compiler that should be used to compile &#39;</span>
                      <span class="s1">&#39;models written in </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)})</span>
           <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="s1">&#39;compiled&#39;</span><span class="p">]]</span>
        <span class="o">+</span> <span class="p">[((</span><span class="s1">&#39;--</span><span class="si">%s</span><span class="s1">-linker&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Name or path to linker that should be used to link &#39;</span>
                      <span class="s1">&#39;models written in </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)})</span>
           <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="s1">&#39;compiled&#39;</span><span class="p">]]</span>
        <span class="o">+</span> <span class="p">[((</span><span class="s1">&#39;--</span><span class="si">%s</span><span class="s1">-archiver&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">,</span> <span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Name or path to archiver that should be used to create &#39;</span>
                      <span class="s1">&#39;static libraries for models written in </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)})</span>
           <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="s1">&#39;compiled&#39;</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="c1"># TODO: Move these into the language directories?</span>
    <span class="n">language_arguments</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">ConditionalArgumentTuple</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;--vcpkg-dir&#39;</span><span class="p">,</span> <span class="p">),</span>
                <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Directory containing the vcpkg installation.&#39;</span><span class="p">},</span>
                <span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Windows&#39;</span><span class="p">]}),</span>
            <span class="n">ConditionalArgumentTuple</span><span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;--macos-sdkroot&#39;</span><span class="p">,</span> <span class="s1">&#39;--sdkroot&#39;</span><span class="p">),</span>
                <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;The full path to the MacOS SDK that &#39;</span>
                          <span class="s1">&#39;should be used.&#39;</span><span class="p">)},</span>
                <span class="n">conditions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;MacOS&#39;</span><span class="p">]})],</span>
        <span class="s1">&#39;matlab&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">((</span><span class="s1">&#39;--disable-matlab-engine-for-python&#39;</span><span class="p">,</span> <span class="p">),</span>
             <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;disable_engine&#39;</span><span class="p">,</span>
              <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Disable use of the Matlab engine for Python.&#39;</span><span class="p">}),</span>
            <span class="p">((</span><span class="s1">&#39;--enable-matlab-engine-for-python&#39;</span><span class="p">,</span> <span class="p">),</span>
             <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;enable_engine&#39;</span><span class="p">,</span>
              <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Enable use of the Matlab engine for Python.&#39;</span><span class="p">}),</span>
            <span class="p">((</span><span class="s1">&#39;--hide-matlab-libiomp&#39;</span><span class="p">,</span> <span class="p">),</span>
             <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Hide the version of libiomp installed by Matlab &#39;</span>
                       <span class="s1">&#39;by slightly changing the filename so that the &#39;</span>
                       <span class="s1">&#39;conda version of libomp is used instead. This &#39;</span>
                       <span class="s1">&#39;helps to solve the error &quot;&#39;</span>
                       <span class="s1">&#39;OMP: Error #15: Initializing libomp.dylib...&quot; &#39;</span>
                       <span class="s1">&#39;that can occur when using a conda environment. &#39;</span>
                       <span class="s1">&#39;The hidden file location will be set in the &#39;</span>
                       <span class="s1">&#39;configuration file and can be restored via the &#39;</span>
                       <span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">--restore-matlab-libiomp</span><span class="se">\&#39;</span><span class="s1"> option.&#39;</span><span class="p">)}),</span>
            <span class="p">((</span><span class="s1">&#39;--restore-matlab-libiomp&#39;</span><span class="p">,</span> <span class="p">),</span>
             <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Restore the version of libiomp installed by Matlab. &#39;</span>
                       <span class="s1">&#39;(See help for </span><span class="se">\&#39;</span><span class="s1">--hide-matlab-libiomp</span><span class="se">\&#39;</span><span class="s1">)&#39;</span><span class="p">)}),</span>
        <span class="p">],</span>
        <span class="s1">&#39;osr&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">((</span><span class="s1">&#39;--osr-repository-path&#39;</span><span class="p">,</span> <span class="p">),</span>
             <span class="p">{</span><span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;repository&#39;</span><span class="p">,</span>
              <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;The full path to the OpenSimRoot repository.&#39;</span><span class="p">})]}</span>
    <span class="n">opposite_arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;allow_multiple_omp&#39;</span><span class="p">,</span> <span class="s1">&#39;dont_allow_multiple_omp&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;disable_engine&#39;</span><span class="p">,</span> <span class="s1">&#39;enable_engine&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;hide_matlab_libiomp&#39;</span><span class="p">,</span> <span class="s1">&#39;restore_matlab_libiomp&#39;</span><span class="p">)]</span>
        
<div class="viewcode-block" id="update_config.add_arguments"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.update_config.add_arguments">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">update_config</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;args&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;-h&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;--help&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;-h&#39;</span><span class="p">,</span> <span class="s1">&#39;--help&#39;</span><span class="p">]]</span>
        <span class="n">preargs</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">prelang</span> <span class="o">=</span> <span class="n">preargs</span><span class="o">.</span><span class="n">languages</span>
        <span class="k">if</span> <span class="n">preargs</span><span class="o">.</span><span class="n">languages_flag</span><span class="p">:</span>
            <span class="n">prelang</span> <span class="o">+=</span> <span class="n">preargs</span><span class="o">.</span><span class="n">languages_flag</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prelang</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">prelang</span><span class="p">):</span>
            <span class="n">prelang</span> <span class="o">=</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">]</span>
        <span class="c1"># TODO: The languages could be subparsers</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language_arguments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">prelang</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">add_argument_to_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="update_config.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.update_config.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">config</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">show_file</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Config file located here: </span><span class="si">%s</span><span class="s1">&#39;</span>
                  <span class="o">%</span> <span class="n">config</span><span class="o">.</span><span class="n">usr_config_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">remove_file</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">usr_config_file</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">usr_config_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">show_file</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">remove_file</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">x_true</span><span class="p">,</span> <span class="n">x_false</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">opposite_arguments</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">x_false</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">x_true</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">x_true</span><span class="p">,</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">x_false</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">x_false</span><span class="p">):</span>
                <span class="nb">delattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">x_false</span><span class="p">)</span>
        <span class="n">lang_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">language_arguments</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">v_args</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">v_args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s1">&#39;dest&#39;</span><span class="p">,</span>
                    <span class="n">v_args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lang_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">lang_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;compiler&#39;</span><span class="p">,</span> <span class="s1">&#39;linker&#39;</span><span class="p">,</span> <span class="s1">&#39;archiver&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">LANGUAGES</span><span class="p">[</span><span class="s1">&#39;compiled&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="n">lang_kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="n">lang_kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">config</span><span class="o">.</span><span class="n">update_language_config</span><span class="p">(</span>
            <span class="n">args</span><span class="o">.</span><span class="n">languages</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">overwrite</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">quiet</span><span class="p">),</span>
            <span class="n">disable_languages</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">disable_languages</span><span class="p">,</span>
            <span class="n">enable_languages</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">enable_languages</span><span class="p">,</span>
            <span class="n">allow_multiple_omp</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">allow_multiple_omp</span><span class="p">,</span>
            <span class="n">lang_kwargs</span><span class="o">=</span><span class="n">lang_kwargs</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="regen_metaschema"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.regen_metaschema">[docs]</a><span class="k">class</span> <span class="nc">regen_metaschema</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Regenerate the yggdrasil metaschema.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;metaschema&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Regenerate the yggdrasil metaschema.&quot;</span>

<div class="viewcode-block" id="regen_metaschema.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.regen_metaschema.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">metaschema</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">metaschema</span><span class="o">.</span><span class="n">_metaschema_fname</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">metaschema</span><span class="o">.</span><span class="n">_metaschema_fname</span><span class="p">)</span>
        <span class="n">metaschema</span><span class="o">.</span><span class="n">_metaschema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metaschema</span><span class="o">.</span><span class="n">_validator</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">metaschema</span><span class="o">.</span><span class="n">get_metaschema</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="regen_schema"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.regen_schema">[docs]</a><span class="k">class</span> <span class="nc">regen_schema</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Regenerate the yggdrasil schema.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;schema&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Regenerate the yggdrasil schema.&quot;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--only-constants&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Only update the constants.py file without updating &#39;</span>
                   <span class="s1">&#39;the schema.&#39;</span><span class="p">)})]</span>

<div class="viewcode-block" id="regen_schema.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.regen_schema.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">schema</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">only_constants</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">_schema_fname</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">_schema_fname</span><span class="p">)</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">clear_schema</span><span class="p">()</span>
            <span class="n">schema</span><span class="o">.</span><span class="n">init_schema</span><span class="p">()</span>
        <span class="n">schema</span><span class="o">.</span><span class="n">update_constants</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="yggmodelform"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggmodelform">[docs]</a><span class="k">class</span> <span class="nc">yggmodelform</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Save/print a JSON schema that can be used for generating a</span>
<span class="sd">    form for composing a model specification files.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;model-form-schema&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Save/print the JSON schema for generating the model &#39;</span>
            <span class="s1">&#39;specification form.&#39;</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Path to file where the schema should be saved.&#39;</span><span class="p">})]</span>

<div class="viewcode-block" id="yggmodelform.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggmodelform.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.schema</span> <span class="kn">import</span> <span class="n">get_model_form_schema</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">get_model_form_schema</span><span class="p">(</span><span class="n">fname_dst</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">file</span><span class="p">:</span>
            <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="yggdevup"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggdevup">[docs]</a><span class="k">class</span> <span class="nc">yggdevup</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Cleanup old libraries, re-install languages, and re-compile</span>
<span class="sd">    interface libraries following an update to the code (when doing</span>
<span class="sd">    development).&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;dev-update&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Perform cleanup and reinitialization following an &#39;</span>
            <span class="s1">&#39;update to the code during development.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="yggdevup.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggdevup.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="n">yggclean</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">])</span>
        <span class="n">ygginstall</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">])</span>
        <span class="n">yggcompile</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">])</span>
        <span class="n">ygginfo</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[])</span></div></div>


<div class="viewcode-block" id="run_tsts"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.run_tsts">[docs]</a><span class="k">class</span> <span class="nc">run_tsts</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Run yggdrasil test suite.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: Move this into a pytest extension?</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;test&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s1">&#39;Run yggdrasil tests.&#39;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--withcoverage&#39;</span><span class="p">,</span> <span class="s1">&#39;--with-coverage&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Record coverage during tests.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="s1">&#39;-v&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Increase verbosity of output from the test runner&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--nocapture&#39;</span><span class="p">,</span> <span class="s1">&#39;-s&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Don</span><span class="se">\&#39;</span><span class="s1">t capture output from tests.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--stop&#39;</span><span class="p">,</span> <span class="s1">&#39;-x&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Stop after first test failure.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--nologcapture&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Don</span><span class="se">\&#39;</span><span class="s1">t capture output from log messages &#39;</span>
                   <span class="s1">&#39;generated during tests.&#39;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--noflaky&#39;</span><span class="p">,</span> <span class="s1">&#39;--no-flaky&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Don</span><span class="se">\&#39;</span><span class="s1">t re-run flaky tests.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--ci&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Perform addition operations required for &#39;</span>
                   <span class="s1">&#39;testing on continuous integration services.&#39;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--test-suite&#39;</span><span class="p">,</span> <span class="s1">&#39;--test-suites&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
          <span class="s1">&#39;choices&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;examples_part1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;examples_part2&#39;</span><span class="p">,</span> <span class="s1">&#39;demos&#39;</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="s1">&#39;timing&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;connections&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;mpi&#39;</span><span class="p">],</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Test suite(s) that should be run.&#39;</span><span class="p">,</span>
          <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;test_suites&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--pytest-config&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;Pytest configuration file that should be used &#39;</span>
                   <span class="s1">&#39;instead of the defaults.&#39;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--cov-config&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Config file for coverage. Default: .coveragerc&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--ignore&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;append&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Ignore path during collection.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--rootdir&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Define root directory for tests.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--count&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of times to repeat a test.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--additional-info&#39;</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Display additional info for test results.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--with-mpi&#39;</span><span class="p">,</span> <span class="s1">&#39;--mpi-nproc&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Number of MPI processes to run tests on.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--write-script&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Name of script that should be created to run tests.&#39;</span><span class="p">}),</span>
        <span class="p">((</span><span class="s1">&#39;--separate-test&#39;</span><span class="p">,</span> <span class="s1">&#39;--separate-tests&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;nargs&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;extend&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
          <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s1">&#39;Flags defining tests that should be run separately.&#39;</span><span class="p">,</span>
          <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="s1">&#39;separate_tests&#39;</span><span class="p">})]</span>
    <span class="n">allow_unknown</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="run_tsts.add_arguments"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.run_tsts.add_arguments">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">config</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">run_tsts</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get_config_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span></div>

<div class="viewcode-block" id="run_tsts.parse_args"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.run_tsts.parse_args">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">platform</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">run_tsts</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">_extra_commands</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ci</span><span class="p">:</span>
            <span class="n">requires_mpi</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">test_suites</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;mpi&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="p">))</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">args</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">args</span><span class="o">.</span><span class="n">withcoverage</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">args</span><span class="o">.</span><span class="n">setup_cfg</span> <span class="o">=</span> <span class="s1">&#39;setup.cfg&#39;</span>
            <span class="n">args</span><span class="o">.</span><span class="n">pytest_config</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">setup_cfg</span>
            <span class="n">args</span><span class="o">.</span><span class="n">cov_config</span> <span class="o">=</span> <span class="s1">&#39;.coveragerc&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">ignore</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">ignore</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">args</span><span class="o">.</span><span class="n">ignore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;yggdrasil/rapidjson/&#39;</span><span class="p">)</span>
            <span class="n">args</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">=</span> <span class="n">package_dir</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">requires_mpi</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;--reruns=2&#39;</span><span class="p">,</span> <span class="s1">&#39;--reruns-delay=1&#39;</span><span class="p">,</span> <span class="s1">&#39;--timeout=900&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">):</span>
                <span class="n">args</span><span class="o">.</span><span class="n">write_script</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">)</span>
        <span class="c1"># Separate out paths from options</span>
        <span class="n">test_paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;demos&#39;</span><span class="p">,</span> <span class="s1">&#39;types&#39;</span><span class="p">,</span> <span class="s1">&#39;timing&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;connections&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;mpi&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="p">:</span>
                        <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_dir</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;examples&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_examples</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;examples_part1&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_examples</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>  <span class="c1"># pragma: windows</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;test_[a-g]*.py&#39;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;test_[A-Za-g]*.py&#39;</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;examples_part2&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_examples</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">pattern</span> <span class="o">=</span> <span class="s1">&#39;test_[h-z]*.py&#39;</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="n">pattern</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;demos&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_demos</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;demos&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;types&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_examples</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">long_running</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span>
                                                   <span class="s1">&#39;test_types.py&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;timing&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">long_running</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_production_runs</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="s1">&#39;test_timing.py&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;connections&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;test_ConnectionDriver.py&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;test_FileInputDriver.py&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;test_FileOutputDriver.py&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;test_RPCRequestDriver.py&#39;</span><span class="p">]:</span>
                        <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;drivers&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;models&#39;</span><span class="p">:</span>
                    <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;drivers&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;test_*ModelDriver.py&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;mpi&#39;</span><span class="p">:</span>
                    <span class="n">args</span><span class="o">.</span><span class="n">enable_examples</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="n">test_paths</span> <span class="o">+=</span> <span class="p">[</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;communication&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;test_MPIComm.py&#39;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;test_gs_lesson4.py&#39;</span><span class="p">),</span>
                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;test_rpc_lesson3b.py&#39;</span><span class="p">)]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">:</span>
                        <span class="n">test_paths</span> <span class="o">+=</span> <span class="p">[</span>
                            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;tests&#39;</span><span class="p">,</span>
                                         <span class="s1">&#39;test_model_error_with_io.py&#39;</span><span class="p">)]</span>
                    <span class="n">extra</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;no:flaky&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">test_paths</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">extra</span><span class="p">):</span>
            <span class="n">test_paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">package_dir</span><span class="p">)</span>
        <span class="c1"># Get expanded tests to allow for paths that are relative to</span>
        <span class="c1"># either the yggdrasil root directory or the current working</span>
        <span class="c1"># directory</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">resolve_config_parser</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">args</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">args</span><span class="o">.</span><span class="n">added_paths</span> <span class="o">=</span> <span class="n">test_paths</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">expand_and_add</span><span class="p">(</span><span class="n">extra</span> <span class="o">+</span> <span class="n">test_paths</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">extra</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">package_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()],</span>
                           <span class="n">add_on_nomatch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">args</span></div>

<div class="viewcode-block" id="run_tsts.expand_and_add"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.run_tsts.expand_and_add">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">expand_and_add</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">path_list</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">,</span>
                       <span class="n">add_on_nomatch</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Expand the specified path and add it&#39;s expanded forms to</span>
<span class="sd">        the provided list.</span>

<span class="sd">        Args:</span>
<span class="sd">            path (str): Absolute/relative path with or without regex</span>
<span class="sd">                wildcard expressions to expand.</span>
<span class="sd">            path_list (list): Existing list that expansions should be</span>
<span class="sd">                added to.</span>
<span class="sd">            dir_list (list): Directories that should be tried for</span>
<span class="sd">                relative paths.</span>
<span class="sd">            add_on_nomatch (bool, optional): If True, path will be added</span>
<span class="sd">                to path_list even if there are not matches. Defaults to</span>
<span class="sd">                False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of expansions added to path_list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">glob</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">nadded</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
                <span class="n">nadded</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">expand_and_add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path_list</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">,</span>
                                             <span class="n">add_on_nomatch</span><span class="o">=</span><span class="n">add_on_nomatch</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">nadded</span>
        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">add_on_nomatch</span><span class="p">:</span>
                <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;yggtest&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isabs</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="n">path_list</span> <span class="o">+=</span> <span class="n">matches</span>
            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">matches</span><span class="p">)</span> <span class="ow">and</span> <span class="n">add_on_nomatch</span><span class="p">:</span>
                <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span>
        <span class="c1"># Try checking for function</span>
        <span class="k">for</span> <span class="n">func_sep</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;::&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">func_sep</span> <span class="ow">in</span> <span class="n">path</span><span class="p">):</span>
                <span class="n">prepath</span><span class="p">,</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">func_sep</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">nadded</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">expand_and_add</span><span class="p">(</span><span class="n">prepath</span><span class="p">,</span> <span class="n">path_list</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nadded</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">nadded</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                        <span class="n">path_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func_sep</span><span class="p">,</span> <span class="n">mod</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">nadded</span>
        <span class="c1"># Try directory prefixes</span>
        <span class="k">for</span> <span class="n">path_prefix</span> <span class="ow">in</span> <span class="n">dir_list</span><span class="p">:</span>
            <span class="n">nadded</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">expand_and_add</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_prefix</span><span class="p">,</span> <span class="n">path</span><span class="p">),</span>
                                        <span class="n">path_list</span><span class="p">,</span> <span class="n">dir_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nadded</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">nadded</span>
        <span class="k">if</span> <span class="n">add_on_nomatch</span><span class="p">:</span>
            <span class="n">path_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="run_tsts.write_script"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.run_tsts.write_script">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">write_script</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">cfg_env</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Write a script to run the pytest command.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">stat</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">platform</span>
        <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#!/bin/bash&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cfg_env</span><span class="o">.</span><span class="n">new_env</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;export </span><span class="si">%s</span><span class="s1">=</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;export </span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argv</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cfg_env</span><span class="o">.</span><span class="n">old_env</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;unset </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">k</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;export </span><span class="si">%s</span><span class="s1">=</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;export </span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">,</span> <span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">S_IRWXU</span>
                                     <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IRGRP</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXGRP</span>
                                     <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IROTH</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXOTH</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrote test script to &#39;</span><span class="si">%s</span><span class="s2">&#39;:</span><span class="se">\n\t</span><span class="si">%s</span><span class="s2">&quot;</span>
              <span class="o">%</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)))</span></div>
                                     
<div class="viewcode-block" id="run_tsts.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.run_tsts.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">config</span><span class="p">,</span> <span class="n">platform</span>
        <span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="p">,</span> <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;pytest&#39;</span><span class="p">]</span>
        <span class="c1"># test_paths = args.test_paths</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mpiexec&#39;</span><span class="p">,</span> <span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">with_mpi</span><span class="p">)]</span> <span class="o">+</span> <span class="n">argv</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;--with-mpi&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-v&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">nocapture</span><span class="p">:</span>
            <span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">)</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;log_cli=true&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">nologcapture</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="s1">&#39;log_cli=true&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
            <span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;-x&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">withcoverage</span><span class="p">:</span>
            <span class="c1"># See information about getting coverage of test fixtures</span>
            <span class="c1"># https://pytest-cov.readthedocs.io/en/stable/plugins.html</span>
            <span class="n">argv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;--cov=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">package_dir</span><span class="p">)</span>
            <span class="c1"># argv.append(&#39;--cov-append&#39;)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">noflaky</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;no:flaky&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">pytest_config</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">pytest_config</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cov_config</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;--cov-config=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="o">.</span><span class="n">cov_config</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ignore</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;--ignore=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">ignore</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">rootdir</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;--rootdir=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">args</span><span class="o">.</span><span class="n">rootdir</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">additional_info</span><span class="p">:</span>
            <span class="n">argv</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">additional_info</span><span class="p">]</span>
        <span class="n">argv</span> <span class="o">+=</span> <span class="n">args</span><span class="o">.</span><span class="n">extra</span>
        <span class="c1"># Run test command and perform cleanup before logging any errors</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s2"> from </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">argv</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
        <span class="n">new_config</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># pth_file = &#39;ygg_coverage.pth&#39;</span>
        <span class="c1"># assert(not os.path.isfile(pth_file))</span>
        <span class="c1"># # Get arguments for temporary test environment</span>
        <span class="c1"># if args.withcoverage:</span>
        <span class="c1">#     new_config[&#39;COVERAGE_PROCESS_START&#39;] = &#39;True&#39;</span>
        <span class="c1">#     with open(pth_file, &#39;w&#39;) as fd:</span>
        <span class="c1">#         fd.write(&quot;import coverage; coverage.process_startup()&quot;)</span>
        <span class="n">initial_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="n">error_code</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">parser_config</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">new_config</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg_env</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Perform CI specific pretest operations</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ci</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">setup_cfg</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;The CI tests must be run &quot;</span>
                                           <span class="s2">&quot;from the root directory &quot;</span>
                                           <span class="s2">&quot;of the yggdrasil git &quot;</span>
                                           <span class="s2">&quot;repository.&quot;</span><span class="p">)</span>
                    <span class="n">top_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
                    <span class="n">src_cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;python -c </span><span class="se">\&quot;</span><span class="s1">import versioneer; &#39;</span>
                               <span class="s1">&#39;print(versioneer.get_version())</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">dst_cmd</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;python -c </span><span class="se">\&quot;</span><span class="s1">import yggdrasil; &#39;</span>
                               <span class="s1">&#39;print(yggdrasil.__version__)</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">src_ver</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">src_cmd</span><span class="p">,</span>
                                                      <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">dst_ver</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">dst_cmd</span><span class="p">,</span>
                                                      <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                      <span class="n">cwd</span><span class="o">=</span><span class="n">top_dir</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">src_ver</span> <span class="o">!=</span> <span class="n">dst_ver</span><span class="p">:</span>  <span class="c1"># pragma: debug</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">((</span><span class="s2">&quot;Versions do not match:</span><span class="se">\n</span><span class="s2">&quot;</span>
                                            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Source version: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span>
                                            <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Build  version: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                                           <span class="o">%</span> <span class="p">(</span><span class="n">src_ver</span><span class="p">,</span> <span class="n">dst_ver</span><span class="p">))</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span>
                        <span class="p">[</span><span class="s2">&quot;flake8&quot;</span><span class="p">,</span> <span class="s2">&quot;yggdrasil&quot;</span><span class="p">,</span> <span class="s2">&quot;--append-config&quot;</span><span class="p">,</span>
                         <span class="n">args</span><span class="o">.</span><span class="n">setup_cfg</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;YGG_CONDA&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">(</span>
                            <span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span> <span class="s2">&quot;create_coveragerc.py&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="s2">&quot;.coveragerc&quot;</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;.coveragerc file dosn&#39;t &quot;</span>
                                           <span class="s2">&quot;exist.&quot;</span><span class="p">)</span>
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;.coveragerc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="n">subprocess</span><span class="o">.</span><span class="n">check_call</span><span class="p">([</span><span class="s2">&quot;yggdrasil&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span>
                                           <span class="s2">&quot;--verbose&quot;</span><span class="p">])</span>
                <span class="n">error_code</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">write_script</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">platform</span><span class="o">.</span><span class="n">_is_win</span><span class="p">):</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">write_script</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">argv</span><span class="p">,</span> <span class="n">cfg_env</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
                        <span class="n">x_error_code</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">x_error_code</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">error_code</span> <span class="o">=</span> <span class="n">x_error_code</span>
                            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">stop</span><span class="p">:</span>
                                <span class="k">break</span>
            <span class="c1"># except BaseException:</span>
            <span class="c1">#     logger.exception(&#39;Error in running test.&#39;)</span>
            <span class="c1">#     error_code = -1</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">initial_dir</span><span class="p">)</span>
                <span class="c1"># if os.path.isfile(pth_file):</span>
                <span class="c1">#     os.remove(pth_file)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">separate_tests</span> <span class="ow">and</span> <span class="p">(</span><span class="n">error_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">re</span>
            <span class="k">assert</span><span class="p">(</span><span class="ow">not</span> <span class="n">args</span><span class="o">.</span><span class="n">write_script</span><span class="p">)</span>
            <span class="n">new_args</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">separate_tests</span>
            <span class="n">args</span><span class="o">.</span><span class="n">test_suites</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">args</span><span class="o">.</span><span class="n">separate_tests</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">expand_and_add</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">added_paths</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span>
                               <span class="p">[</span><span class="n">package_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()])</span>
            <span class="n">args</span><span class="o">.</span><span class="n">extra</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">args</span><span class="o">.</span><span class="n">extra</span> <span class="k">if</span>
                          <span class="p">((</span><span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">)</span>
                           <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;.*test\_.*\.py.*&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)))]</span>
            <span class="k">for</span> <span class="n">iargs</span> <span class="ow">in</span> <span class="n">new_args</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">error_code</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">error_code</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">iargs</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">+</span> <span class="n">args</span><span class="o">.</span><span class="n">extra</span><span class="p">),</span>
                                      <span class="n">namespace</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">error_code</span></div></div>


<div class="viewcode-block" id="timing_plots"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.timing_plots">[docs]</a><span class="k">class</span> <span class="nc">timing_plots</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create performance plots using timing results.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;timing&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="s2">&quot;Create performance plots using timing results.&quot;</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">ArgumentSubparser</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;comparison&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;comparison&#39;</span><span class="p">,</span>
            <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Comparison plot that should be created.&#39;</span><span class="p">,</span>
            <span class="n">parsers</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;commtype&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Compare different communication avenues.&#39;</span><span class="p">),</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;language&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Compare different programming languages.&#39;</span><span class="p">),</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;os&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Compare different operating systems.&#39;</span><span class="p">),</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;python&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Compare different versions of Python.&#39;</span><span class="p">),</span>
                <span class="n">ArgumentParser</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lang2019&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Create plots from Lang (2019) paper.&#39;</span><span class="p">)])]</span>

<div class="viewcode-block" id="timing_plots.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.timing_plots.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">yggdrasil</span> <span class="kn">import</span> <span class="n">timing</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;lang2019&#39;</span><span class="p">:</span>
            <span class="n">_lang_list</span> <span class="o">=</span> <span class="n">timing</span><span class="o">.</span><span class="n">_lang_list</span>
            <span class="n">_lang_list_nomatlab</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">_lang_list</span><span class="p">)</span>
            <span class="n">_lang_list_nomatlab</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;matlab&#39;</span><span class="p">)</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">plot_scalings</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="s1">&#39;platform&#39;</span><span class="p">,</span> <span class="n">python_ver</span><span class="o">=</span><span class="s1">&#39;2.7&#39;</span><span class="p">)</span>
            <span class="c1"># All plots on Linux, no matlab</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">plot_scalings</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="s1">&#39;comm_type&#39;</span><span class="p">,</span>
                                 <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;Linux&#39;</span><span class="p">,</span>
                                 <span class="n">python_ver</span><span class="o">=</span><span class="s1">&#39;2.7&#39;</span><span class="p">)</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">plot_scalings</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="s1">&#39;python_ver&#39;</span><span class="p">,</span>
                                 <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;Linux&#39;</span><span class="p">)</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">plot_scalings</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="s1">&#39;language&#39;</span><span class="p">,</span>
                                 <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;Linux&#39;</span><span class="p">,</span>
                                 <span class="n">python_ver</span><span class="o">=</span><span class="s1">&#39;2.7&#39;</span><span class="p">,</span>
                                 <span class="n">compare_values</span><span class="o">=</span><span class="n">_lang_list_nomatlab</span><span class="p">)</span>
            <span class="c1"># Language comparision on MacOS, with matlab</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">plot_scalings</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="s1">&#39;language&#39;</span><span class="p">,</span>
                                 <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;MacOS&#39;</span><span class="p">,</span>
                                 <span class="n">python_ver</span><span class="o">=</span><span class="s1">&#39;2.7&#39;</span><span class="p">,</span>
                                 <span class="n">compare_values</span><span class="o">=</span><span class="n">_lang_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;commtype&#39;</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;comm_type&#39;</span>
            <span class="k">elif</span> <span class="n">args</span><span class="o">.</span><span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;platform&#39;</span>
            <span class="n">timing</span><span class="o">.</span><span class="n">plot_scalings</span><span class="p">(</span><span class="n">compare</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">comparison</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="generate_gha_workflow"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.generate_gha_workflow">[docs]</a><span class="k">class</span> <span class="nc">generate_gha_workflow</span><span class="p">(</span><span class="n">SubCommand</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Re-generate the Github actions workflow yaml.&quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;gha&quot;</span>
    <span class="n">help</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;Generate a Github Actions (GHA) workflow yaml file from &quot;</span>
        <span class="s2">&quot;a version of the file that uses anchors (not supported by &quot;</span>
        <span class="s2">&quot;GHA as of 2021-01-14).&quot;</span><span class="p">)</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">((</span><span class="s1">&#39;--base&#39;</span><span class="p">,</span> <span class="s1">&#39;--base-file&#39;</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span>
             <span class="s2">&quot;Version of GHA workflow yaml that contains anchors.&quot;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--dest&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="p">(</span>
             <span class="s2">&quot;Name of target GHA workflow yaml file.&quot;</span><span class="p">)}),</span>
        <span class="p">((</span><span class="s1">&#39;--verbose&#39;</span><span class="p">,</span> <span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="s1">&#39;help&#39;</span><span class="p">:</span> <span class="s2">&quot;Print yaml contents.&quot;</span><span class="p">})]</span>

<div class="viewcode-block" id="generate_gha_workflow.func"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.generate_gha_workflow.func">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">gitdir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">yaml</span>
        <span class="kn">from</span> <span class="nn">yggdrasil.metaschema.encoder</span> <span class="kn">import</span> <span class="n">decode_yaml</span><span class="p">,</span> <span class="n">encode_yaml</span>
        <span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

        <span class="k">class</span> <span class="nc">NoAliasDumper</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">SafeDumper</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">ignore_aliases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">args</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">gitdir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gitdir</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot;git&quot;</span><span class="p">,</span> <span class="s2">&quot;rev-parse&quot;</span><span class="p">,</span> <span class="s2">&quot;--git-dir&quot;</span><span class="p">],</span>
                    <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gitdir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;utils&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;test-install-base.yml&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gitdir</span><span class="p">,</span> <span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;.github&#39;</span><span class="p">,</span> <span class="s1">&#39;workflows&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;test-install.yml&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">base</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">decode_yaml</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">sorted_dict_type</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">)</span>
            <span class="c1"># contents = yaml.load(fd, Loader=yaml.SafeLoader)</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;# DO NOT MODIFY THIS FILE, IT IS GENERATED.</span><span class="se">\n</span><span class="s1">&#39;</span>
                      <span class="s1">&#39;# To make changes, modify </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;\n</span><span class="s1">&#39;</span>
                      <span class="s1">&#39;# and run </span><span class="se">\&#39;</span><span class="s1">ygggha</span><span class="se">\&#39;\n</span><span class="s1">&#39;</span><span class="p">)</span>
                     <span class="o">%</span> <span class="n">args</span><span class="o">.</span><span class="n">base</span><span class="p">)</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encode_yaml</span><span class="p">(</span><span class="n">contents</span><span class="p">,</span> <span class="n">sorted_dict_type</span><span class="o">=</span><span class="n">OrderedDict</span><span class="p">,</span>
                                 <span class="n">Dumper</span><span class="o">=</span><span class="n">NoAliasDumper</span><span class="p">))</span></div></div>
            <span class="c1"># yaml.dump(contents, fd, Dumper=NoAliasDumper)</span>


<div class="viewcode-block" id="rebuild_c_api"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.rebuild_c_api">[docs]</a><span class="k">def</span> <span class="nf">rebuild_c_api</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Rebuild the C/C++ API.&quot;&quot;&quot;</span>
    <span class="n">ReplacementWarning</span><span class="p">(</span><span class="s1">&#39;yggbuildapi_c&#39;</span><span class="p">,</span> <span class="s1">&#39;yggdrasil compile-deps c cpp&#39;</span><span class="p">)</span>
    <span class="n">yggcompile</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;cpp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="yggtime_comm"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggtime_comm">[docs]</a><span class="k">def</span> <span class="nf">yggtime_comm</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot timing statistics comparing the different communication mechanisms.&quot;&quot;&quot;</span>
    <span class="n">ReplacementWarning</span><span class="p">(</span><span class="s1">&#39;yggtime_comm&#39;</span><span class="p">,</span> <span class="s1">&#39;yggdrasil timing commtype&#39;</span><span class="p">)</span>
    <span class="n">timing_plots</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;commtype&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="yggtime_lang"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggtime_lang">[docs]</a><span class="k">def</span> <span class="nf">yggtime_lang</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot timing statistics comparing the different languages.&quot;&quot;&quot;</span>
    <span class="n">ReplacementWarning</span><span class="p">(</span><span class="s1">&#39;yggtime_lang&#39;</span><span class="p">,</span> <span class="s1">&#39;yggdrasil timing language&#39;</span><span class="p">)</span>
    <span class="n">timing_plots</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;language&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="yggtime_os"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggtime_os">[docs]</a><span class="k">def</span> <span class="nf">yggtime_os</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot timing statistics comparing the different operating systems.&quot;&quot;&quot;</span>
    <span class="n">ReplacementWarning</span><span class="p">(</span><span class="s1">&#39;yggtime_os&#39;</span><span class="p">,</span> <span class="s1">&#39;yggdrasil timing os&#39;</span><span class="p">)</span>
    <span class="n">timing_plots</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;os&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="yggtime_py"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggtime_py">[docs]</a><span class="k">def</span> <span class="nf">yggtime_py</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Plot timing statistics comparing the different versions of Python.&quot;&quot;&quot;</span>
    <span class="n">ReplacementWarning</span><span class="p">(</span><span class="s1">&#39;yggtime_py&#39;</span><span class="p">,</span> <span class="s1">&#39;yggdrasil timing python&#39;</span><span class="p">)</span>
    <span class="n">timing_plots</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;python&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<div class="viewcode-block" id="yggtime_paper"><a class="viewcode-back" href="../../advanced/code_python.html#yggdrasil.command_line.yggtime_paper">[docs]</a><span class="k">def</span> <span class="nf">yggtime_paper</span><span class="p">():</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Create plots for timing.&quot;&quot;&quot;</span>
    <span class="n">ReplacementWarning</span><span class="p">(</span><span class="s1">&#39;yggtime_paper&#39;</span><span class="p">,</span> <span class="s1">&#39;yggdrasil timing lang2019&#39;</span><span class="p">)</span>
    <span class="n">timing_plots</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lang2019&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">yggrun</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017, Meagan Lang, David Raila.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>